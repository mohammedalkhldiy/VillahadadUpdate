import{r,j as t,b as J}from"./vendor-react-Ce27NbrU.js";import{D as Q,H as q}from"./index-BFvmHygk.js";import{V as ee,T as N,o as te,q as A,b1 as k,a as se,m as le,X as z,ab as re,ac as ae,bP as oe,bK as ie,aW as ne,b2 as ce}from"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";const de=c=>(c==null?void 0:c.images)||[],fe=({bookings:c,isReception:B=!0,isManager:a=!1})=>{const[d,C]=r.useState(null),[g,M]=r.useState(""),[u,O]=r.useState("all"),[o,W]=r.useState({}),[i,p]=r.useState(null),[x,h]=r.useState(100),[b,m]=r.useState({x:0,y:0}),[S,D]=r.useState(!1),[$,F]=r.useState({x:0,y:0}),[T,L]=r.useState(!1),[V,I]=r.useState([]),X=r.useRef(null),[ue,Y]=r.useState(!0);r.useRef(null);const E=r.useMemo(()=>d?de(d):[],[d]),f=r.useMemo(()=>{let e=E;return u==="selected"?e=e.filter(l=>o[l.id]==="green"):u==="maybe"?e=e.filter(l=>o[l.id]==="yellow"):u==="rejected"&&(e=e.filter(l=>o[l.id]==="red")),g&&(e=e.filter(l=>(l.title||"").toLowerCase().includes(g.toLowerCase()))),e},[E,u,o,g]),w=(e,l)=>{W(s=>({...s,[e]:s[e]===l?"none":l}))},y=e=>{if(i===null)return;let l=i+e;l<0&&(l=f.length-1),l>=f.length&&(l=0),p(l),h(100),m({x:0,y:0})},v=e=>{h(l=>Math.max(50,Math.min(300,l+e)))},Z=e=>{x>100&&(e.preventDefault(),D(!0),F({x:e.clientX-b.x,y:e.clientY-b.y}))},K=e=>{S&&(e.preventDefault(),m({x:e.clientX-$.x,y:e.clientY-$.y}))},R=()=>{D(!1)};r.useEffect(()=>{const e=s=>{i!==null&&(s.key==="Escape"?x>100?(h(100),m({x:0,y:0})):p(null):s.key==="ArrowLeft"||s.key==="a"||s.key==="A"||s.key==="ش"?(s.preventDefault(),y(1)):s.key==="ArrowRight"||s.key==="d"||s.key==="D"||s.key==="ي"?(s.preventDefault(),y(-1)):s.key==="+"||s.key==="="?(s.preventDefault(),v(25)):s.key==="-"||s.key==="_"?(s.preventDefault(),v(-25)):(s.key==="0"||s.key==="٠")&&(s.preventDefault(),h(100),m({x:0,y:0})))},l=s=>{if(i===null)return;s.preventDefault();const j=s.deltaY>0?-25:25;v(j)};return window.addEventListener("keydown",e),window.addEventListener("wheel",l,{passive:!1}),()=>{window.removeEventListener("keydown",e),window.removeEventListener("wheel",l)}},[i,x]),r.useEffect(()=>{if(i===null)return;const e=setTimeout(()=>{Y(!1)},2e3);return()=>clearTimeout(e)},[i]),r.useEffect(()=>{const e=document.querySelector("header")||document.querySelector('[class*="Header"]')||document.querySelector('div[class*="z-"]');return i!==null?(document.body.style.overflow="hidden",e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.zIndex="-1")):(document.body.style.overflow="",e&&(e.style.display="",e.style.visibility="",e.style.opacity="",e.style.zIndex="")),()=>{document.body.style.overflow="",e&&(e.style.display="",e.style.visibility="",e.style.opacity="",e.style.zIndex="")}},[i]);const U=()=>{h(100),m({x:0,y:0})},_=(e,l)=>{const s={id:`tag_${Date.now()}`,imageId:e,option:l};I(j=>[...j,s]),L(!1)},G=e=>{I(l=>l.filter(s=>s.id!==e))},P=e=>V.filter(l=>l.imageId===e),n=i!==null?f[i]:null,H=n?P(n.id):[];return t.jsx(Q,{isReception:B,isManager:a,children:t.jsxs("div",{className:"flex flex-col h-full overflow-hidden relative",dir:"rtl",children:[t.jsxs("div",{className:`flex items-center justify-between mb-4 ${a?"bg-white/60 backdrop-blur-3xl border-white/40 ring-1 ring-white/60 text-gray-800":"bg-[#262626]/80 border-white/5"} p-4 rounded-[2rem] border`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[d&&t.jsx("button",{onClick:()=>C(null),className:`p-2 ${a?"bg-white/50 text-gray-500 hover:text-gray-800":"bg-white/5 text-gray-400 hover:text-white"} rounded-lg`,children:t.jsx(ee,{size:16,className:"rotate-180"})}),t.jsxs("h2",{className:`text-lg font-bold ${a?"text-gray-800":"text-white"} flex items-center gap-2`,children:[t.jsx(N,{size:18,className:a?"text-amber-500":"text-pink-500"}),d?d.clientName:"اختيار الصور"]})]}),t.jsxs("div",{className:"flex gap-2",children:[d&&t.jsx("div",{className:`flex ${a?"bg-gray-100/50":"bg-black/20"} p-1 rounded-lg`,children:["all","selected","maybe","rejected"].map(e=>t.jsx("button",{onClick:()=>O(e),className:`px-3 py-1 rounded text-[10px] font-bold ${u===e?a?"bg-amber-500 text-white":"bg-pink-500 text-white":a?"text-gray-500 hover:text-gray-800":"text-gray-500"}`,children:e==="all"?"الكل":e==="selected"?"مختارة":e==="maybe"?"محتار":"مرفوضة"},e))}),t.jsxs("div",{className:"relative",children:[t.jsx(te,{className:`absolute right-3 top-1/2 -translate-y-1/2 ${a?"text-gray-400":"text-gray-500"}`,size:14}),t.jsx("input",{type:"text",placeholder:"بحث...",value:g,onChange:e=>M(e.target.value),className:`${a?"bg-white/50 border-gray-200 text-gray-800 focus:border-amber-400":"bg-black/30 border-white/10 text-white"} border rounded-xl pr-9 pl-4 py-1.5 text-xs outline-none w-32 focus:w-48 transition-all`})]})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:d?t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:f.map((e,l)=>{const s=P(e.id);return t.jsxs("div",{onClick:()=>p(l),className:"relative aspect-square rounded-xl overflow-hidden group border border-white/5 cursor-pointer",children:[t.jsx("img",{src:e.url,className:"w-full h-full object-cover transition-transform group-hover:scale-110"}),t.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx("span",{className:"text-[10px] text-white font-bold",children:e.title})}),o[e.id]&&o[e.id]!=="none"&&t.jsx("div",{className:`absolute top-2 right-2 p-1 rounded-full ${o[e.id]==="green"?"bg-green-500":o[e.id]==="yellow"?"bg-yellow-500":"bg-red-500"}`,children:t.jsx(A,{size:8,fill:"white",className:"text-white"})}),s.length>0&&t.jsxs("div",{className:"absolute top-2 left-2 px-2 py-1 bg-purple-500 rounded-full flex items-center gap-1",children:[t.jsx(k,{size:10,className:"text-white"}),t.jsx("span",{className:"text-[9px] text-white font-bold",children:s.length})]})]},e.id)})}):t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:c.length>0?c.map(e=>t.jsxs("div",{onClick:()=>C(e),className:`${a?"bg-white/40 hover:bg-white/60 border-white/40 hover:border-amber-400/30":"bg-[#21242b] border-white/5 hover:border-pink-500/30"} p-4 rounded-xl border cursor-pointer transition-all group`,children:[t.jsx("div",{className:`aspect-[4/3] ${a?"bg-white/50 border-white/20":"bg-black/40 border-white/5"} rounded-lg mb-3 flex items-center justify-center border group-hover:border-opacity-100`,children:t.jsx(N,{size:32,className:`${a?"text-gray-400 group-hover:text-amber-500":"text-gray-600 group-hover:text-pink-500"} transition-colors`})}),t.jsx("h3",{className:`${a?"text-gray-800":"text-white"} font-bold text-sm truncate`,children:e.clientName}),t.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:e.shootDate})]},e.id)):t.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-16 text-gray-500",children:[t.jsx(N,{size:48,className:"mb-4 opacity-30"}),t.jsx("p",{className:"text-sm font-medium",children:"لا توجد حجوزات بعد"}),t.jsx("p",{className:"text-xs mt-1",children:"ستظهر المعارض هنا بعد إضافة الحجوزات"})]})})}),t.jsx(se,{children:i!==null&&n&&t.jsx(xe,{children:t.jsxs(le.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[99999] bg-black flex flex-col",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:[t.jsx("div",{className:"absolute inset-0 z-0",onClick:()=>p(null)}),t.jsxs("div",{className:"relative z-10 flex flex-col h-full",onClick:e=>e.stopPropagation(),children:[t.jsx("button",{onClick:()=>p(null),className:"fixed top-6 left-6 z-[1000] p-3 rounded-full bg-black/50 hover:bg-red-600/80 text-white transition-all backdrop-blur-md border border-white/10 shadow-2xl group",title:"إغلاق (Esc)",children:t.jsx(z,{size:24,className:"group-hover:rotate-90 transition-transform duration-300"})}),t.jsxs("div",{ref:X,className:"flex-1 relative flex items-center justify-center p-4 overflow-hidden",onMouseDown:Z,onMouseMove:K,onMouseUp:R,onMouseLeave:R,children:[t.jsxs("div",{className:"relative inline-flex items-center justify-center max-w-full max-h-full",children:[t.jsx("div",{onClick:e=>{e.stopPropagation(),y(-1)},className:"fixed right-0 top-0 bottom-0 w-[15%] z-[100] cursor-pointer flex items-center justify-end pr-4 opacity-0 hover:opacity-100 transition-opacity duration-300 group",children:t.jsx("div",{className:"p-3 bg-black/40 rounded-full text-white backdrop-blur-md group-hover:bg-black/60 group-hover:scale-110 transition-all",children:t.jsx(re,{size:40})})}),t.jsx("div",{onClick:e=>{e.stopPropagation(),y(1)},className:"fixed left-0 top-0 bottom-0 w-[15%] z-[100] cursor-pointer flex items-center justify-start pl-4 opacity-0 hover:opacity-100 transition-opacity duration-300 group",children:t.jsx("div",{className:"p-3 bg-black/40 rounded-full text-white backdrop-blur-md group-hover:bg-black/60 group-hover:scale-110 transition-all",children:t.jsx(ae,{size:40})})}),t.jsx("img",{src:n.url,onDoubleClick:U,style:{transform:`scale(${x/100}) translate(${b.x}px, ${b.y}px)`,transition:S?"none":"transform 0.2s",transformOrigin:"center center"},className:"max-h-[calc(100vh-200px)] max-w-full object-contain shadow-2xl rounded select-none",draggable:!1})]}),x===100&&t.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-black/60 rounded-lg text-xs text-gray-400 flex items-center gap-2 pointer-events-none",children:[t.jsx(oe,{size:12}),t.jsx("span",{children:"Scroll للزوم | نقرتين للإعادة"})]}),x>100&&t.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-black/60 rounded-lg text-xs text-green-400 flex items-center gap-2 pointer-events-none",children:[t.jsx(ie,{size:12}),t.jsx("span",{children:"اسحب للتحرك | ESC للخروج من الزوم"})]})]}),t.jsxs("div",{className:"p-6 flex flex-col items-center gap-4 bg-gradient-to-t from-black to-transparent",onClick:e=>e.stopPropagation(),children:[H.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:H.map(e=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 rounded-lg",children:[t.jsx(k,{size:12,className:"text-purple-400"}),t.jsx("span",{className:"text-xs text-white",children:q[e.option]}),t.jsx("button",{onClick:()=>G(e.id),className:"text-white/50 hover:text-white",children:t.jsx(z,{size:12})})]},e.id))}),t.jsxs("div",{className:"flex gap-2 bg-[#1a1c22] p-1.5 rounded-xl border border-white/10 shadow-xl",children:[t.jsxs("button",{onClick:()=>w(n.id,"green"),className:`flex items-center gap-2 px-6 py-2 rounded-lg text-xs font-bold transition-all ${o[n.id]==="green"?"bg-green-600 text-white shadow-lg":"bg-white/5 text-gray-400"}`,children:[t.jsx(A,{size:14,fill:o[n.id]==="green"?"white":"none"})," اختيار"]}),t.jsxs("button",{onClick:()=>w(n.id,"yellow"),className:`flex items-center gap-2 px-6 py-2 rounded-lg text-xs font-bold transition-all ${o[n.id]==="yellow"?"bg-yellow-600 text-white shadow-lg":"bg-white/5 text-gray-400"}`,children:[t.jsx(ne,{size:14})," محتار"]}),t.jsxs("button",{onClick:()=>w(n.id,"red"),className:`flex items-center gap-2 px-6 py-2 rounded-lg text-xs font-bold transition-all ${o[n.id]==="red"?"bg-red-600 text-white shadow-lg":"bg-white/5 text-gray-400"}`,children:[t.jsx(z,{size:14})," رفض"]}),t.jsxs("button",{onClick:()=>L(!T),className:"flex items-center gap-2 px-6 py-2 rounded-lg text-xs font-bold transition-all bg-purple-500/20 text-purple-400 hover:bg-purple-500/30",children:[t.jsx(k,{size:14})," تعديل"]})]}),T&&t.jsxs("div",{className:"w-full max-w-md bg-[#1a1c22] border border-white/10 rounded-xl p-3",children:[t.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"اختر نوع التعديل:"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Double Chin","Eye Opening","Object Removal","Teeth Whitening","Skin Smoothing","Hair Fix","Body Slimming"].map(e=>t.jsx("button",{onClick:()=>_(n.id,e),className:"px-3 py-2 bg-white/5 hover:bg-purple-500/20 border border-white/10 hover:border-purple-500/30 rounded-lg text-xs text-white transition-all",children:q[e]},e))})]}),t.jsxs("div",{className:"w-full max-w-md relative",children:[t.jsx(ce,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",size:14}),t.jsx("input",{type:"text",placeholder:"ملاحظة للمصمم...",className:"w-full bg-black/40 border border-white/5 rounded-xl pr-9 pl-4 py-2.5 text-xs text-white outline-none focus:border-pink-500/50"})]})]})]})," "]})})})]})})},xe=({children:c})=>typeof window>"u"?null:J.createPortal(c,document.body);export{fe as default};
