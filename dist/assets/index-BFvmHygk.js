const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./schema-CAZKW4R0.js","./vendor-react-Ce27NbrU.js","./vendor-ui-TjLGESBy.js","./vendor-supabase-CSCOup90.js","./vendor-utils-DKqDJWuS.js","./seed-Bf6FwK0s.js","./ManagerLayout-DdAGI23C.js","./ManagerDashboard-BzqbmZq8.js","./ManagerDashboardCard-CvhNOwym.js","./generateCategoricalChart-NQEqos2u.js","./clsx-B-dksMZM.js","./CurrentUserService-BpRsn01f.js","./ManagerClientsView-mHlHKH7d.js","./utils-BykweIWy.js","./ScrollReveal-DKkvXRwD.js","./ClientBadge-BDLI63ku.js","./GlowCard-71-V6_az.js","./FilterBar-D-KgzGOA.js","./ManagerTeamView-BsQ4kTCV.js","./LeaveService-DmmVspSu.js","./ManagerGalleryView-ZL4L7Dlj.js","./ManagerBookingDetailsView-xi-0oFn1.js","./AdminLayout-B9gBmglZ.js","./ProfileDropdown-C17_ILYZ.js","./DashboardOverview-Bh3z-jCZ.js","./AdminClientsListView-DRfcUCK-.js","./AdminFinancialView-dSBsTRXQ.js","./AdminSystemView-A2StsLTD.js","./ConflictResolutionView-CvlM6q40.js","./AdminAuditView-BJQmH90j.js","./WorkflowManagerView-DSb2r88O.js","./AdminSentinelView-z4il5wlk.js","./AreaChart-Dq4vkcq7.js","./AdminHRView-BVHBX5Ln.js","./AdminInventoryView-DngpbRkf.js","./AdminWarRoomView-CnM6KPYX.js","./AdminGeniusDashboard-DgAcBQKd.js","./DeletedBookingsView-w2ynIuAs.js","./ReceptionSidebar-HxZqWZsI.js","./ReceptionDashboard-Dsx8YEnX.js","./ReceptionClientsView-C47VWlCu.js","./ReceptionBookingsView-DJIy0PLq.js","./ReceptionFinancialView-C2f5fXgI.js","./ReceptionWidgetCard-DgiBK5ow.js","./ElectronicPaymentsWidget-D6occVo1.js","./ReceptionGalleryView-C40mFtsr.js","./PhotoEditorLayout-x4D6GvEm.js","./ProductionHeader-9b3fAeTh.js","./PhotoEditorDashboard-CVgswIAP.js","./UnifiedTeamChat-C4pUsPfK.js","./PhotoEditorGalleryView-g24nUSg3.js","./VideoEditorLayout-1phYADRS.js","./VideoEditorDashboard-DIDqc8L6.js","./PrinterLayout-DpZV42fC.js","./PrinterDashboard-M3UFC0Jy.js","./SelectionLayout-BAqQAoi5.js","./SelectionDashboard-BS6PVPHy.js","./WorkflowView-WAJwU9sY.js","./ClientPortal-CZASAAEX.js","./ManagerFinancialView-DI45iXno.js","./ManagerAccountsView-BD3H48gB.js"])))=>i.map(i=>d[i]);
var z0=Object.defineProperty;var Eh=t=>{throw TypeError(t)};var B0=(t,e,n)=>e in t?z0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var kn=(t,e,n)=>B0(t,typeof e!="symbol"?e+"":e,n),nd=(t,e,n)=>e.has(t)||Eh("Cannot "+n);var o=(t,e,n)=>(nd(t,e,"read from private field"),n?n.call(t):e.get(t)),j=(t,e,n)=>e.has(t)?Eh("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),k=(t,e,n,r)=>(nd(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),Q=(t,e,n)=>(nd(t,e,"access private method"),n);var Nc=(t,e,n,r)=>({set _(s){k(t,e,s,n)},get _(){return o(t,e,r)}});import{r as x,j as i,R as T,a as F0,b as mm,u as W0,D as Ll,c as U0}from"./vendor-react-Ce27NbrU.js";import{A as Jo,R as q0,C as pm,a as Bt,m as ve,b as dr,S as V0,c as Zo,X as Jt,F as $l,Z as Pc,D as Q0,d as Fi,e as H0,W as va,f as Ch,g as rd,H as gm,h as xm,E as ym,i as bm,j as wm,k as vm,l as J0,n as Z0,o as Nm,p as G0,q as Sm,M as K0,r as km,s as _h,B as Ms,I as Y0,t as X0,u as zu,v as zs,w as Rc,x as Hc,P as Wa,y as Bs,z as Jc,U as qs,G as Oh,J as eg,K as Go,L as _d,N as tg,O as Xr,Q as Od,T as uo,V as ng,Y as jm,_ as rg,$ as Em,a0 as Cm,a1 as sg,a2 as Na,a3 as ig,a4 as Id,a5 as Bu,a6 as Ko,a7 as og,a8 as Ih,a9 as Th,aa as ag,ab as cg,ac as _m,ad as lg,ae as sd,af as dg,ag as ug,ah as hg,ai as fg,aj as mg,ak as pg,al as Om,am as Im,an as gg,ao as Tm,ap as xg,aq as yg,ar as bg,as as wg,at as vg,au as Ng}from"./vendor-ui-TjLGESBy.js";import{c as Sg}from"./vendor-supabase-CSCOup90.js";import{f as kg,a as jg,p as Eg}from"./vendor-utils-DKqDJWuS.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();var Ml=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Cg={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},ks,Mu,im,_g=(im=class{constructor(){j(this,ks,Cg);j(this,Mu,!1)}setTimeoutProvider(t){k(this,ks,t)}setTimeout(t,e){return o(this,ks).setTimeout(t,e)}clearTimeout(t){o(this,ks).clearTimeout(t)}setInterval(t,e){return o(this,ks).setInterval(t,e)}clearInterval(t){o(this,ks).clearInterval(t)}},ks=new WeakMap,Mu=new WeakMap,im),Zc=new _g;function Og(t){setTimeout(t,0)}var zl=typeof window>"u"||"Deno"in globalThis;function Xt(){}function Ig(t,e){return typeof t=="function"?t(e):t}function Tg(t){return typeof t=="number"&&t>=0&&t!==1/0}function Ag(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Td(t,e){return typeof t=="function"?t(e):t}function Dg(t,e){return typeof t=="function"?t(e):t}function Ah(t,e){const{type:n="all",exact:r,fetchStatus:s,predicate:a,queryKey:c,stale:l}=t;if(c){if(r){if(e.queryHash!==Fu(c,e.options))return!1}else if(!qa(e.queryKey,c))return!1}if(n!=="all"){const d=e.isActive();if(n==="active"&&!d||n==="inactive"&&d)return!1}return!(typeof l=="boolean"&&e.isStale()!==l||s&&s!==e.state.fetchStatus||a&&!a(e))}function Dh(t,e){const{exact:n,status:r,predicate:s,mutationKey:a}=t;if(a){if(!e.options.mutationKey)return!1;if(n){if(Ua(e.options.mutationKey)!==Ua(a))return!1}else if(!qa(e.options.mutationKey,a))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function Fu(t,e){return((e==null?void 0:e.queryKeyHashFn)||Ua)(t)}function Ua(t){return JSON.stringify(t,(e,n)=>Ad(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function qa(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>qa(t[n],e[n])):!1}var Pg=Object.prototype.hasOwnProperty;function Am(t,e){if(t===e)return t;const n=Ph(t)&&Ph(e);if(!n&&!(Ad(t)&&Ad(e)))return e;const s=(n?t:Object.keys(t)).length,a=n?e:Object.keys(e),c=a.length,l=n?new Array(c):{};let d=0;for(let h=0;h<c;h++){const m=n?h:a[h],u=t[m],p=e[m];if(u===p){l[m]=u,(n?h<s:Pg.call(t,m))&&d++;continue}if(u===null||p===null||typeof u!="object"||typeof p!="object"){l[m]=p;continue}const w=Am(u,p);l[m]=w,w===u&&d++}return s===c&&d===s?t:l}function Ph(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Ad(t){if(!Rh(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Rh(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Rh(t){return Object.prototype.toString.call(t)==="[object Object]"}function Rg(t){return new Promise(e=>{Zc.setTimeout(e,t)})}function Lg(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?Am(t,e):e}function $g(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Mg(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Wu=Symbol();function Dm(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===Wu?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function zg(t,e,n){let r=!1,s;return Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(s??(s=e()),r||(r=!0,s.aborted?n():s.addEventListener("abort",n,{once:!0})),s)}),t}var fi,js,po,om,Bg=(om=class extends Ml{constructor(){super();j(this,fi);j(this,js);j(this,po);k(this,po,e=>{if(!zl&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){o(this,js)||this.setEventListener(o(this,po))}onUnsubscribe(){var e;this.hasListeners()||((e=o(this,js))==null||e.call(this),k(this,js,void 0))}setEventListener(e){var n;k(this,po,e),(n=o(this,js))==null||n.call(this),k(this,js,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){o(this,fi)!==e&&(k(this,fi,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(n=>{n(e)})}isFocused(){var e;return typeof o(this,fi)=="boolean"?o(this,fi):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},fi=new WeakMap,js=new WeakMap,po=new WeakMap,om),Pm=new Bg;function Fg(){let t,e;const n=new Promise((s,a)=>{t=s,e=a});n.status="pending",n.catch(()=>{});function r(s){Object.assign(n,s),delete n.resolve,delete n.reject}return n.resolve=s=>{r({status:"fulfilled",value:s}),t(s)},n.reject=s=>{r({status:"rejected",reason:s}),e(s)},n}function Wg(t){var n;let e;if((n=t.then(r=>(e=r,r),Xt))==null||n.catch(Xt),e!==void 0)return{data:e}}function Rm(t){return t}function Ug(t){return{mutationKey:t.options.mutationKey,state:t.state,...t.options.scope&&{scope:t.options.scope},...t.meta&&{meta:t.meta}}}function qg(t,e,n){const r=()=>{var a;const s=(a=t.promise)==null?void 0:a.then(e).catch(c=>n(c)?Promise.reject(new Error("redacted")):Promise.reject(c));return s==null||s.catch(Xt),s};return{dehydratedAt:Date.now(),state:{...t.state,...t.state.data!==void 0&&{data:e(t.state.data)}},queryKey:t.queryKey,queryHash:t.queryHash,...t.state.status==="pending"&&{promise:r()},...t.meta&&{meta:t.meta}}}function Vg(t){return t.state.isPaused}function Qg(t){return t.state.status==="success"}function Hg(t){return!0}function Jg(t,e={}){var d,h,m,u;const n=e.shouldDehydrateMutation??((d=t.getDefaultOptions().dehydrate)==null?void 0:d.shouldDehydrateMutation)??Vg,r=t.getMutationCache().getAll().flatMap(p=>n(p)?[Ug(p)]:[]),s=e.shouldDehydrateQuery??((h=t.getDefaultOptions().dehydrate)==null?void 0:h.shouldDehydrateQuery)??Qg,a=e.shouldRedactErrors??((m=t.getDefaultOptions().dehydrate)==null?void 0:m.shouldRedactErrors)??Hg,c=e.serializeData??((u=t.getDefaultOptions().dehydrate)==null?void 0:u.serializeData)??Rm,l=t.getQueryCache().getAll().flatMap(p=>s(p)?[qg(p,c,a)]:[]);return{mutations:r,queries:l}}function Zg(t,e,n){var d,h;if(typeof e!="object"||e===null)return;const r=t.getMutationCache(),s=t.getQueryCache(),a=((d=n==null?void 0:n.defaultOptions)==null?void 0:d.deserializeData)??((h=t.getDefaultOptions().hydrate)==null?void 0:h.deserializeData)??Rm,c=e.mutations||[],l=e.queries||[];c.forEach(({state:m,...u})=>{var p,w;r.build(t,{...(p=t.getDefaultOptions().hydrate)==null?void 0:p.mutations,...(w=n==null?void 0:n.defaultOptions)==null?void 0:w.mutations,...u},m)}),l.forEach(({queryKey:m,state:u,queryHash:p,meta:w,promise:y,dehydratedAt:g})=>{var O,b;const N=y?Wg(y):void 0,v=u.data===void 0?N==null?void 0:N.data:u.data,C=v===void 0?v:a(v);let S=s.get(p);const _=(S==null?void 0:S.state.status)==="pending",D=(S==null?void 0:S.state.fetchStatus)==="fetching";if(S){const A=N&&g!==void 0&&g>S.state.dataUpdatedAt;if(u.dataUpdatedAt>S.state.dataUpdatedAt||A){const{fetchStatus:q,...I}=u;S.setState({...I,data:C})}}else S=s.build(t,{...(O=t.getDefaultOptions().hydrate)==null?void 0:O.queries,...(b=n==null?void 0:n.defaultOptions)==null?void 0:b.queries,queryKey:m,queryHash:p,meta:w},{...u,data:C,fetchStatus:"idle",status:C!==void 0?"success":u.status});y&&!_&&!D&&(g===void 0||g>S.state.dataUpdatedAt)&&S.fetch(void 0,{initialPromise:Promise.resolve(y).then(a)}).catch(Xt)})}var Gg=Og;function Kg(){let t=[],e=0,n=l=>{l()},r=l=>{l()},s=Gg;const a=l=>{e?t.push(l):s(()=>{n(l)})},c=()=>{const l=t;t=[],l.length&&s(()=>{r(()=>{l.forEach(d=>{n(d)})})})};return{batch:l=>{let d;e++;try{d=l()}finally{e--,e||c()}return d},batchCalls:l=>(...d)=>{a(()=>{l(...d)})},schedule:a,setNotifyFunction:l=>{n=l},setBatchNotifyFunction:l=>{r=l},setScheduler:l=>{s=l}}}var en=Kg(),go,Es,xo,am,Yg=(am=class extends Ml{constructor(){super();j(this,go,!0);j(this,Es);j(this,xo);k(this,xo,e=>{if(!zl&&window.addEventListener){const n=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){o(this,Es)||this.setEventListener(o(this,xo))}onUnsubscribe(){var e;this.hasListeners()||((e=o(this,Es))==null||e.call(this),k(this,Es,void 0))}setEventListener(e){var n;k(this,xo,e),(n=o(this,Es))==null||n.call(this),k(this,Es,e(this.setOnline.bind(this)))}setOnline(e){o(this,go)!==e&&(k(this,go,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return o(this,go)}},go=new WeakMap,Es=new WeakMap,xo=new WeakMap,am),Gc=new Yg;function Xg(t){return Math.min(1e3*2**t,3e4)}function Lm(t){return(t??"online")==="online"?Gc.isOnline():!0}var Dd=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function $m(t){let e=!1,n=0,r;const s=Fg(),a=()=>s.status!=="pending",c=g=>{var N;if(!a()){const v=new Dd(g);p(v),(N=t.onCancel)==null||N.call(t,v)}},l=()=>{e=!0},d=()=>{e=!1},h=()=>Pm.isFocused()&&(t.networkMode==="always"||Gc.isOnline())&&t.canRun(),m=()=>Lm(t.networkMode)&&t.canRun(),u=g=>{a()||(r==null||r(),s.resolve(g))},p=g=>{a()||(r==null||r(),s.reject(g))},w=()=>new Promise(g=>{var N;r=v=>{(a()||h())&&g(v)},(N=t.onPause)==null||N.call(t)}).then(()=>{var g;r=void 0,a()||(g=t.onContinue)==null||g.call(t)}),y=()=>{if(a())return;let g;const N=n===0?t.initialPromise:void 0;try{g=N??t.fn()}catch(v){g=Promise.reject(v)}Promise.resolve(g).then(u).catch(v=>{var O;if(a())return;const C=t.retry??(zl?0:3),S=t.retryDelay??Xg,_=typeof S=="function"?S(n,v):S,D=C===!0||typeof C=="number"&&n<C||typeof C=="function"&&C(n,v);if(e||!D){p(v);return}n++,(O=t.onFail)==null||O.call(t,n,v),Rg(_).then(()=>h()?void 0:w()).then(()=>{e?p(v):y()})})};return{promise:s,status:()=>s.status,cancel:c,continue:()=>(r==null||r(),s),cancelRetry:l,continueRetry:d,canStart:m,start:()=>(m()?y():w().then(y),s)}}var mi,cm,Mm=(cm=class{constructor(){j(this,mi)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Tg(this.gcTime)&&k(this,mi,Zc.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(zl?1/0:300*1e3))}clearGcTimeout(){o(this,mi)&&(Zc.clearTimeout(o(this,mi)),k(this,mi,void 0))}},mi=new WeakMap,cm),pi,yo,zn,gi,It,Ya,xi,nr,Lr,lm,ex=(lm=class extends Mm{constructor(e){super();j(this,nr);j(this,pi);j(this,yo);j(this,zn);j(this,gi);j(this,It);j(this,Ya);j(this,xi);k(this,xi,!1),k(this,Ya,e.defaultOptions),this.setOptions(e.options),this.observers=[],k(this,gi,e.client),k(this,zn,o(this,gi).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,k(this,pi,$h(this.options)),this.state=e.state??o(this,pi),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=o(this,It))==null?void 0:e.promise}setOptions(e){if(this.options={...o(this,Ya),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=$h(this.options);n.data!==void 0&&(this.setState(Lh(n.data,n.dataUpdatedAt)),k(this,pi,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&o(this,zn).remove(this)}setData(e,n){const r=Lg(this.state.data,e,this.options);return Q(this,nr,Lr).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(e,n){Q(this,nr,Lr).call(this,{type:"setState",state:e,setStateOptions:n})}cancel(e){var r,s;const n=(r=o(this,It))==null?void 0:r.promise;return(s=o(this,It))==null||s.cancel(e),n?n.then(Xt).catch(Xt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(o(this,pi))}isActive(){return this.observers.some(e=>Dg(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Wu||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Td(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!Ag(this.state.dataUpdatedAt,e)}onFocus(){var n;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(n=o(this,It))==null||n.continue()}onOnline(){var n;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(n=o(this,It))==null||n.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),o(this,zn).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(o(this,It)&&(o(this,xi)?o(this,It).cancel({revert:!0}):o(this,It).cancelRetry()),this.scheduleGc()),o(this,zn).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Q(this,nr,Lr).call(this,{type:"invalidate"})}async fetch(e,n){var d,h,m,u,p,w,y,g,N,v,C,S;if(this.state.fetchStatus!=="idle"&&((d=o(this,It))==null?void 0:d.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(o(this,It))return o(this,It).continueRetry(),o(this,It).promise}if(e&&this.setOptions(e),!this.options.queryFn){const _=this.observers.find(D=>D.options.queryFn);_&&this.setOptions(_.options)}const r=new AbortController,s=_=>{Object.defineProperty(_,"signal",{enumerable:!0,get:()=>(k(this,xi,!0),r.signal)})},a=()=>{const _=Dm(this.options,n),O=(()=>{const b={client:o(this,gi),queryKey:this.queryKey,meta:this.meta};return s(b),b})();return k(this,xi,!1),this.options.persister?this.options.persister(_,O,this):_(O)},l=(()=>{const _={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:o(this,gi),state:this.state,fetchFn:a};return s(_),_})();(h=this.options.behavior)==null||h.onFetch(l,this),k(this,yo,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((m=l.fetchOptions)==null?void 0:m.meta))&&Q(this,nr,Lr).call(this,{type:"fetch",meta:(u=l.fetchOptions)==null?void 0:u.meta}),k(this,It,$m({initialPromise:n==null?void 0:n.initialPromise,fn:l.fetchFn,onCancel:_=>{_ instanceof Dd&&_.revert&&this.setState({...o(this,yo),fetchStatus:"idle"}),r.abort()},onFail:(_,D)=>{Q(this,nr,Lr).call(this,{type:"failed",failureCount:_,error:D})},onPause:()=>{Q(this,nr,Lr).call(this,{type:"pause"})},onContinue:()=>{Q(this,nr,Lr).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const _=await o(this,It).start();if(_===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(_),(w=(p=o(this,zn).config).onSuccess)==null||w.call(p,_,this),(g=(y=o(this,zn).config).onSettled)==null||g.call(y,_,this.state.error,this),_}catch(_){if(_ instanceof Dd){if(_.silent)return o(this,It).promise;if(_.revert){if(this.state.data===void 0)throw _;return this.state.data}}throw Q(this,nr,Lr).call(this,{type:"error",error:_}),(v=(N=o(this,zn).config).onError)==null||v.call(N,_,this),(S=(C=o(this,zn).config).onSettled)==null||S.call(C,this.state.data,_,this),_}finally{this.scheduleGc()}}},pi=new WeakMap,yo=new WeakMap,zn=new WeakMap,gi=new WeakMap,It=new WeakMap,Ya=new WeakMap,xi=new WeakMap,nr=new WeakSet,Lr=function(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...tx(r.data,this.options),fetchMeta:e.meta??null};case"success":const s={...r,...Lh(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return k(this,yo,e.manual?s:void 0),s;case"error":const a=e.error;return{...r,error:a,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),en.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),o(this,zn).notify({query:this,type:"updated",action:e})})},lm);function tx(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Lm(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Lh(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function $h(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}function Mh(t){return{onFetch:(e,n)=>{var m,u,p,w,y;const r=e.options,s=(p=(u=(m=e.fetchOptions)==null?void 0:m.meta)==null?void 0:u.fetchMore)==null?void 0:p.direction,a=((w=e.state.data)==null?void 0:w.pages)||[],c=((y=e.state.data)==null?void 0:y.pageParams)||[];let l={pages:[],pageParams:[]},d=0;const h=async()=>{let g=!1;const N=S=>{zg(S,()=>e.signal,()=>g=!0)},v=Dm(e.options,e.fetchOptions),C=async(S,_,D)=>{if(g)return Promise.reject();if(_==null&&S.pages.length)return Promise.resolve(S);const b=(()=>{const M={client:e.client,queryKey:e.queryKey,pageParam:_,direction:D?"backward":"forward",meta:e.options.meta};return N(M),M})(),A=await v(b),{maxPages:q}=e.options,I=D?Mg:$g;return{pages:I(S.pages,A,q),pageParams:I(S.pageParams,_,q)}};if(s&&a.length){const S=s==="backward",_=S?nx:zh,D={pages:a,pageParams:c},O=_(r,D);l=await C(D,O,S)}else{const S=t??a.length;do{const _=d===0?c[0]??r.initialPageParam:zh(r,l);if(d>0&&_==null)break;l=await C(l,_),d++}while(d<S)}return l};e.options.persister?e.fetchFn=()=>{var g,N;return(N=(g=e.options).persister)==null?void 0:N.call(g,h,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=h}}}function zh(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function nx(t,{pages:e,pageParams:n}){var r;return e.length>0?(r=t.getPreviousPageParam)==null?void 0:r.call(t,e[0],e,n[0],n):void 0}var Xa,xr,Yt,yi,yr,ms,dm,rx=(dm=class extends Mm{constructor(e){super();j(this,yr);j(this,Xa);j(this,xr);j(this,Yt);j(this,yi);k(this,Xa,e.client),this.mutationId=e.mutationId,k(this,Yt,e.mutationCache),k(this,xr,[]),this.state=e.state||sx(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){o(this,xr).includes(e)||(o(this,xr).push(e),this.clearGcTimeout(),o(this,Yt).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){k(this,xr,o(this,xr).filter(n=>n!==e)),this.scheduleGc(),o(this,Yt).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){o(this,xr).length||(this.state.status==="pending"?this.scheduleGc():o(this,Yt).remove(this))}continue(){var e;return((e=o(this,yi))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var c,l,d,h,m,u,p,w,y,g,N,v,C,S,_,D,O,b,A,q;const n=()=>{Q(this,yr,ms).call(this,{type:"continue"})},r={client:o(this,Xa),meta:this.options.meta,mutationKey:this.options.mutationKey};k(this,yi,$m({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(I,M)=>{Q(this,yr,ms).call(this,{type:"failed",failureCount:I,error:M})},onPause:()=>{Q(this,yr,ms).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>o(this,Yt).canRun(this)}));const s=this.state.status==="pending",a=!o(this,yi).canStart();try{if(s)n();else{Q(this,yr,ms).call(this,{type:"pending",variables:e,isPaused:a}),await((l=(c=o(this,Yt).config).onMutate)==null?void 0:l.call(c,e,this,r));const M=await((h=(d=this.options).onMutate)==null?void 0:h.call(d,e,r));M!==this.state.context&&Q(this,yr,ms).call(this,{type:"pending",context:M,variables:e,isPaused:a})}const I=await o(this,yi).start();return await((u=(m=o(this,Yt).config).onSuccess)==null?void 0:u.call(m,I,e,this.state.context,this,r)),await((w=(p=this.options).onSuccess)==null?void 0:w.call(p,I,e,this.state.context,r)),await((g=(y=o(this,Yt).config).onSettled)==null?void 0:g.call(y,I,null,this.state.variables,this.state.context,this,r)),await((v=(N=this.options).onSettled)==null?void 0:v.call(N,I,null,e,this.state.context,r)),Q(this,yr,ms).call(this,{type:"success",data:I}),I}catch(I){try{await((S=(C=o(this,Yt).config).onError)==null?void 0:S.call(C,I,e,this.state.context,this,r))}catch(M){Promise.reject(M)}try{await((D=(_=this.options).onError)==null?void 0:D.call(_,I,e,this.state.context,r))}catch(M){Promise.reject(M)}try{await((b=(O=o(this,Yt).config).onSettled)==null?void 0:b.call(O,void 0,I,this.state.variables,this.state.context,this,r))}catch(M){Promise.reject(M)}try{await((q=(A=this.options).onSettled)==null?void 0:q.call(A,void 0,I,e,this.state.context,r))}catch(M){Promise.reject(M)}throw Q(this,yr,ms).call(this,{type:"error",error:I}),I}finally{o(this,Yt).runNext(this)}}},Xa=new WeakMap,xr=new WeakMap,Yt=new WeakMap,yi=new WeakMap,yr=new WeakSet,ms=function(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),en.batch(()=>{o(this,xr).forEach(r=>{r.onMutationUpdate(e)}),o(this,Yt).notify({mutation:this,type:"updated",action:e})})},dm);function sx(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Wr,rr,ec,um,ix=(um=class extends Ml{constructor(e={}){super();j(this,Wr);j(this,rr);j(this,ec);this.config=e,k(this,Wr,new Set),k(this,rr,new Map),k(this,ec,0)}build(e,n,r){const s=new rx({client:e,mutationCache:this,mutationId:++Nc(this,ec)._,options:e.defaultMutationOptions(n),state:r});return this.add(s),s}add(e){o(this,Wr).add(e);const n=Sc(e);if(typeof n=="string"){const r=o(this,rr).get(n);r?r.push(e):o(this,rr).set(n,[e])}this.notify({type:"added",mutation:e})}remove(e){if(o(this,Wr).delete(e)){const n=Sc(e);if(typeof n=="string"){const r=o(this,rr).get(n);if(r)if(r.length>1){const s=r.indexOf(e);s!==-1&&r.splice(s,1)}else r[0]===e&&o(this,rr).delete(n)}}this.notify({type:"removed",mutation:e})}canRun(e){const n=Sc(e);if(typeof n=="string"){const r=o(this,rr).get(n),s=r==null?void 0:r.find(a=>a.state.status==="pending");return!s||s===e}else return!0}runNext(e){var r;const n=Sc(e);if(typeof n=="string"){const s=(r=o(this,rr).get(n))==null?void 0:r.find(a=>a!==e&&a.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){en.batch(()=>{o(this,Wr).forEach(e=>{this.notify({type:"removed",mutation:e})}),o(this,Wr).clear(),o(this,rr).clear()})}getAll(){return Array.from(o(this,Wr))}find(e){const n={exact:!0,...e};return this.getAll().find(r=>Dh(n,r))}findAll(e={}){return this.getAll().filter(n=>Dh(e,n))}notify(e){en.batch(()=>{this.listeners.forEach(n=>{n(e)})})}resumePausedMutations(){const e=this.getAll().filter(n=>n.state.isPaused);return en.batch(()=>Promise.all(e.map(n=>n.continue().catch(Xt))))}},Wr=new WeakMap,rr=new WeakMap,ec=new WeakMap,um);function Sc(t){var e;return(e=t.options.scope)==null?void 0:e.id}var br,hm,ox=(hm=class extends Ml{constructor(e={}){super();j(this,br);this.config=e,k(this,br,new Map)}build(e,n,r){const s=n.queryKey,a=n.queryHash??Fu(s,n);let c=this.get(a);return c||(c=new ex({client:e,queryKey:s,queryHash:a,options:e.defaultQueryOptions(n),state:r,defaultOptions:e.getQueryDefaults(s)}),this.add(c)),c}add(e){o(this,br).has(e.queryHash)||(o(this,br).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const n=o(this,br).get(e.queryHash);n&&(e.destroy(),n===e&&o(this,br).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){en.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return o(this,br).get(e)}getAll(){return[...o(this,br).values()]}find(e){const n={exact:!0,...e};return this.getAll().find(r=>Ah(n,r))}findAll(e={}){const n=this.getAll();return Object.keys(e).length>0?n.filter(r=>Ah(e,r)):n}notify(e){en.batch(()=>{this.listeners.forEach(n=>{n(e)})})}onFocus(){en.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){en.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},br=new WeakMap,hm),ut,Cs,_s,bo,wo,Os,vo,No,fm,ax=(fm=class{constructor(t={}){j(this,ut);j(this,Cs);j(this,_s);j(this,bo);j(this,wo);j(this,Os);j(this,vo);j(this,No);k(this,ut,t.queryCache||new ox),k(this,Cs,t.mutationCache||new ix),k(this,_s,t.defaultOptions||{}),k(this,bo,new Map),k(this,wo,new Map),k(this,Os,0)}mount(){Nc(this,Os)._++,o(this,Os)===1&&(k(this,vo,Pm.subscribe(async t=>{t&&(await this.resumePausedMutations(),o(this,ut).onFocus())})),k(this,No,Gc.subscribe(async t=>{t&&(await this.resumePausedMutations(),o(this,ut).onOnline())})))}unmount(){var t,e;Nc(this,Os)._--,o(this,Os)===0&&((t=o(this,vo))==null||t.call(this),k(this,vo,void 0),(e=o(this,No))==null||e.call(this),k(this,No,void 0))}isFetching(t){return o(this,ut).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return o(this,Cs).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=o(this,ut).get(e.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=o(this,ut).build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Td(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return o(this,ut).findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),s=o(this,ut).get(r.queryHash),a=s==null?void 0:s.state.data,c=Ig(e,a);if(c!==void 0)return o(this,ut).build(this,r).setData(c,{...n,manual:!0})}setQueriesData(t,e,n){return en.batch(()=>o(this,ut).findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=o(this,ut).get(e.queryHash))==null?void 0:n.state}removeQueries(t){const e=o(this,ut);en.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=o(this,ut);return en.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=en.batch(()=>o(this,ut).findAll(t).map(s=>s.cancel(n)));return Promise.all(r).then(Xt).catch(Xt)}invalidateQueries(t,e={}){return en.batch(()=>(o(this,ut).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=en.batch(()=>o(this,ut).findAll(t).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let a=s.fetch(void 0,n);return n.throwOnError||(a=a.catch(Xt)),s.state.fetchStatus==="paused"?Promise.resolve():a}));return Promise.all(r).then(Xt)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=o(this,ut).build(this,e);return n.isStaleByTime(Td(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Xt).catch(Xt)}fetchInfiniteQuery(t){return t.behavior=Mh(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Xt).catch(Xt)}ensureInfiniteQueryData(t){return t.behavior=Mh(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return Gc.isOnline()?o(this,Cs).resumePausedMutations():Promise.resolve()}getQueryCache(){return o(this,ut)}getMutationCache(){return o(this,Cs)}getDefaultOptions(){return o(this,_s)}setDefaultOptions(t){k(this,_s,t)}setQueryDefaults(t,e){o(this,bo).set(Ua(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...o(this,bo).values()],n={};return e.forEach(r=>{qa(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){o(this,wo).set(Ua(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...o(this,wo).values()],n={};return e.forEach(r=>{qa(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...o(this,_s).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Fu(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Wu&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...o(this,_s).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){o(this,ut).clear(),o(this,Cs).clear()}},ut=new WeakMap,Cs=new WeakMap,_s=new WeakMap,bo=new WeakMap,wo=new WeakMap,Os=new WeakMap,vo=new WeakMap,No=new WeakMap,fm),cx=x.createContext(void 0),lx=({client:t,children:e})=>(x.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),i.jsx(cx.Provider,{value:t,children:e})),dx=x.createContext(!1),ux=dx.Provider;function hx(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const fx=t=>{switch(t){case"success":return gx;case"info":return yx;case"warning":return xx;case"error":return bx;default:return null}},mx=Array(12).fill(0),px=({visible:t,className:e})=>T.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},T.createElement("div",{className:"sonner-spinner"},mx.map((n,r)=>T.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),gx=T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},T.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),xx=T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},T.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),yx=T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},T.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),bx=T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},T.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),wx=T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},T.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),T.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),vx=()=>{const[t,e]=T.useState(document.hidden);return T.useEffect(()=>{const n=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),t};let Pd=1;class Nx{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const n=this.subscribers.indexOf(e);this.subscribers.splice(n,1)}),this.publish=e=>{this.subscribers.forEach(n=>n(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var n;const{message:r,...s}=e,a=typeof(e==null?void 0:e.id)=="number"||((n=e.id)==null?void 0:n.length)>0?e.id:Pd++,c=this.toasts.find(d=>d.id===a),l=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),c?this.toasts=this.toasts.map(d=>d.id===a?(this.publish({...d,...e,id:a,title:r}),{...d,...e,id:a,dismissible:l,title:r}):d):this.addToast({title:r,...s,dismissible:l,id:a}),a},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(n=>n({id:e,dismiss:!0})))):this.toasts.forEach(n=>{this.subscribers.forEach(r=>r({id:n.id,dismiss:!0}))}),e),this.message=(e,n)=>this.create({...n,message:e}),this.error=(e,n)=>this.create({...n,message:e,type:"error"}),this.success=(e,n)=>this.create({...n,type:"success",message:e}),this.info=(e,n)=>this.create({...n,type:"info",message:e}),this.warning=(e,n)=>this.create({...n,type:"warning",message:e}),this.loading=(e,n)=>this.create({...n,type:"loading",message:e}),this.promise=(e,n)=>{if(!n)return;let r;n.loading!==void 0&&(r=this.create({...n,promise:e,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));const s=Promise.resolve(e instanceof Function?e():e);let a=r!==void 0,c;const l=s.then(async h=>{if(c=["resolve",h],T.isValidElement(h))a=!1,this.create({id:r,type:"default",message:h});else if(kx(h)&&!h.ok){a=!1;const u=typeof n.error=="function"?await n.error(`HTTP error! status: ${h.status}`):n.error,p=typeof n.description=="function"?await n.description(`HTTP error! status: ${h.status}`):n.description,y=typeof u=="object"&&!T.isValidElement(u)?u:{message:u};this.create({id:r,type:"error",description:p,...y})}else if(h instanceof Error){a=!1;const u=typeof n.error=="function"?await n.error(h):n.error,p=typeof n.description=="function"?await n.description(h):n.description,y=typeof u=="object"&&!T.isValidElement(u)?u:{message:u};this.create({id:r,type:"error",description:p,...y})}else if(n.success!==void 0){a=!1;const u=typeof n.success=="function"?await n.success(h):n.success,p=typeof n.description=="function"?await n.description(h):n.description,y=typeof u=="object"&&!T.isValidElement(u)?u:{message:u};this.create({id:r,type:"success",description:p,...y})}}).catch(async h=>{if(c=["reject",h],n.error!==void 0){a=!1;const m=typeof n.error=="function"?await n.error(h):n.error,u=typeof n.description=="function"?await n.description(h):n.description,w=typeof m=="object"&&!T.isValidElement(m)?m:{message:m};this.create({id:r,type:"error",description:u,...w})}}).finally(()=>{a&&(this.dismiss(r),r=void 0),n.finally==null||n.finally.call(n)}),d=()=>new Promise((h,m)=>l.then(()=>c[0]==="reject"?m(c[1]):h(c[1])).catch(m));return typeof r!="string"&&typeof r!="number"?{unwrap:d}:Object.assign(r,{unwrap:d})},this.custom=(e,n)=>{const r=(n==null?void 0:n.id)||Pd++;return this.create({jsx:e(r),id:r,...n}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const mn=new Nx,Sx=(t,e)=>{const n=(e==null?void 0:e.id)||Pd++;return mn.addToast({title:t,...e,id:n}),n},kx=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",jx=Sx,Ex=()=>mn.toasts,Cx=()=>mn.getActiveToasts(),z=Object.assign(jx,{success:mn.success,info:mn.info,warning:mn.warning,error:mn.error,custom:mn.custom,message:mn.message,promise:mn.promise,dismiss:mn.dismiss,loading:mn.loading},{getHistory:Ex,getToasts:Cx});hx("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function kc(t){return t.label!==void 0}const _x=3,Ox="24px",Ix="16px",Bh=4e3,Tx=356,Ax=14,Dx=45,Px=200;function pr(...t){return t.filter(Boolean).join(" ")}function Rx(t){const[e,n]=t.split("-"),r=[];return e&&r.push(e),n&&r.push(n),r}const Lx=t=>{var e,n,r,s,a,c,l,d,h;const{invert:m,toast:u,unstyled:p,interacting:w,setHeights:y,visibleToasts:g,heights:N,index:v,toasts:C,expanded:S,removeToast:_,defaultRichColors:D,closeButton:O,style:b,cancelButtonStyle:A,actionButtonStyle:q,className:I="",descriptionClassName:M="",duration:V,position:de,gap:X,expandByDefault:he,classNames:ie,icons:P,closeButtonAriaLabel:J="Close toast"}=t,[le,Fe]=T.useState(null),[kt,lt]=T.useState(null),[K,ne]=T.useState(!1),[Ne,Qe]=T.useState(!1),[mt,Se]=T.useState(!1),[Ut,pe]=T.useState(!1),[F,ce]=T.useState(!1),[Ce,Me]=T.useState(0),[rt,os]=T.useState(0),mr=T.useRef(u.duration||V||Bh),Zs=T.useRef(null),Pn=T.useRef(null),aa=v===0,ca=v+1<=g,L=u.type,B=u.dismissible!==!1,ue=u.className||"",we=u.descriptionClassName||"",ke=T.useMemo(()=>N.findIndex(xe=>xe.toastId===u.id)||0,[N,u.id]),Ke=T.useMemo(()=>{var xe;return(xe=u.closeButton)!=null?xe:O},[u.closeButton,O]),be=T.useMemo(()=>u.duration||V||Bh,[u.duration,V]),We=T.useRef(0),qt=T.useRef(0),st=T.useRef(0),sn=T.useRef(null),[on,an]=de.split("-"),Zt=T.useMemo(()=>N.reduce((xe,dt,_t)=>_t>=ke?xe:xe+dt.height,0),[N,ke]),Gs=vx(),qi=u.invert||m,vn=L==="loading";qt.current=T.useMemo(()=>ke*X+Zt,[ke,Zt]),T.useEffect(()=>{mr.current=be},[be]),T.useEffect(()=>{ne(!0)},[]),T.useEffect(()=>{const xe=Pn.current;if(xe){const dt=xe.getBoundingClientRect().height;return os(dt),y(_t=>[{toastId:u.id,height:dt,position:u.position},..._t]),()=>y(_t=>_t.filter(Rt=>Rt.toastId!==u.id))}},[y,u.id]),T.useLayoutEffect(()=>{if(!K)return;const xe=Pn.current,dt=xe.style.height;xe.style.height="auto";const _t=xe.getBoundingClientRect().height;xe.style.height=dt,os(_t),y(Rt=>Rt.find(pt=>pt.toastId===u.id)?Rt.map(pt=>pt.toastId===u.id?{...pt,height:_t}:pt):[{toastId:u.id,height:_t,position:u.position},...Rt])},[K,u.title,u.description,y,u.id,u.jsx,u.action,u.cancel]);const Ct=T.useCallback(()=>{Qe(!0),Me(qt.current),y(xe=>xe.filter(dt=>dt.toastId!==u.id)),setTimeout(()=>{_(u)},Px)},[u,_,y,qt]);T.useEffect(()=>{if(u.promise&&L==="loading"||u.duration===1/0||u.type==="loading")return;let xe;return S||w||Gs?(()=>{if(st.current<We.current){const Rt=new Date().getTime()-We.current;mr.current=mr.current-Rt}st.current=new Date().getTime()})():(()=>{mr.current!==1/0&&(We.current=new Date().getTime(),xe=setTimeout(()=>{u.onAutoClose==null||u.onAutoClose.call(u,u),Ct()},mr.current))})(),()=>clearTimeout(xe)},[S,w,u,L,Gs,Ct]),T.useEffect(()=>{u.delete&&(Ct(),u.onDismiss==null||u.onDismiss.call(u,u))},[Ct,u.delete]);function Rn(){var xe;if(P!=null&&P.loading){var dt;return T.createElement("div",{className:pr(ie==null?void 0:ie.loader,u==null||(dt=u.classNames)==null?void 0:dt.loader,"sonner-loader"),"data-visible":L==="loading"},P.loading)}return T.createElement(px,{className:pr(ie==null?void 0:ie.loader,u==null||(xe=u.classNames)==null?void 0:xe.loader),visible:L==="loading"})}const Gt=u.icon||(P==null?void 0:P[L])||fx(L);var Ln,Vi;return T.createElement("li",{tabIndex:0,ref:Pn,className:pr(I,ue,ie==null?void 0:ie.toast,u==null||(e=u.classNames)==null?void 0:e.toast,ie==null?void 0:ie.default,ie==null?void 0:ie[L],u==null||(n=u.classNames)==null?void 0:n[L]),"data-sonner-toast":"","data-rich-colors":(Ln=u.richColors)!=null?Ln:D,"data-styled":!(u.jsx||u.unstyled||p),"data-mounted":K,"data-promise":!!u.promise,"data-swiped":F,"data-removed":Ne,"data-visible":ca,"data-y-position":on,"data-x-position":an,"data-index":v,"data-front":aa,"data-swiping":mt,"data-dismissible":B,"data-type":L,"data-invert":qi,"data-swipe-out":Ut,"data-swipe-direction":kt,"data-expanded":!!(S||he&&K),"data-testid":u.testId,style:{"--index":v,"--toasts-before":v,"--z-index":C.length-v,"--offset":`${Ne?Ce:qt.current}px`,"--initial-height":he?"auto":`${rt}px`,...b,...u.style},onDragEnd:()=>{Se(!1),Fe(null),sn.current=null},onPointerDown:xe=>{xe.button!==2&&(vn||!B||(Zs.current=new Date,Me(qt.current),xe.target.setPointerCapture(xe.pointerId),xe.target.tagName!=="BUTTON"&&(Se(!0),sn.current={x:xe.clientX,y:xe.clientY})))},onPointerUp:()=>{var xe,dt,_t;if(Ut||!B)return;sn.current=null;const Rt=Number(((xe=Pn.current)==null?void 0:xe.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),as=Number(((dt=Pn.current)==null?void 0:dt.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),pt=new Date().getTime()-((_t=Zs.current)==null?void 0:_t.getTime()),wt=le==="x"?Rt:as,Ks=Math.abs(wt)/pt;if(Math.abs(wt)>=Dx||Ks>.11){Me(qt.current),u.onDismiss==null||u.onDismiss.call(u,u),lt(le==="x"?Rt>0?"right":"left":as>0?"down":"up"),Ct(),pe(!0);return}else{var Ot,cn;(Ot=Pn.current)==null||Ot.style.setProperty("--swipe-amount-x","0px"),(cn=Pn.current)==null||cn.style.setProperty("--swipe-amount-y","0px")}ce(!1),Se(!1),Fe(null)},onPointerMove:xe=>{var dt,_t,Rt;if(!sn.current||!B||((dt=window.getSelection())==null?void 0:dt.toString().length)>0)return;const pt=xe.clientY-sn.current.y,wt=xe.clientX-sn.current.x;var Ks;const Ot=(Ks=t.swipeDirections)!=null?Ks:Rx(de);!le&&(Math.abs(wt)>1||Math.abs(pt)>1)&&Fe(Math.abs(wt)>Math.abs(pt)?"x":"y");let cn={x:0,y:0};const Ys=Zn=>1/(1.5+Math.abs(Zn)/20);if(le==="y"){if(Ot.includes("top")||Ot.includes("bottom"))if(Ot.includes("top")&&pt<0||Ot.includes("bottom")&&pt>0)cn.y=pt;else{const Zn=pt*Ys(pt);cn.y=Math.abs(Zn)<Math.abs(pt)?Zn:pt}}else if(le==="x"&&(Ot.includes("left")||Ot.includes("right")))if(Ot.includes("left")&&wt<0||Ot.includes("right")&&wt>0)cn.x=wt;else{const Zn=wt*Ys(wt);cn.x=Math.abs(Zn)<Math.abs(wt)?Zn:wt}(Math.abs(cn.x)>0||Math.abs(cn.y)>0)&&ce(!0),(_t=Pn.current)==null||_t.style.setProperty("--swipe-amount-x",`${cn.x}px`),(Rt=Pn.current)==null||Rt.style.setProperty("--swipe-amount-y",`${cn.y}px`)}},Ke&&!u.jsx&&L!=="loading"?T.createElement("button",{"aria-label":J,"data-disabled":vn,"data-close-button":!0,onClick:vn||!B?()=>{}:()=>{Ct(),u.onDismiss==null||u.onDismiss.call(u,u)},className:pr(ie==null?void 0:ie.closeButton,u==null||(r=u.classNames)==null?void 0:r.closeButton)},(Vi=P==null?void 0:P.close)!=null?Vi:wx):null,(L||u.icon||u.promise)&&u.icon!==null&&((P==null?void 0:P[L])!==null||u.icon)?T.createElement("div",{"data-icon":"",className:pr(ie==null?void 0:ie.icon,u==null||(s=u.classNames)==null?void 0:s.icon)},u.promise||u.type==="loading"&&!u.icon?u.icon||Rn():null,u.type!=="loading"?Gt:null):null,T.createElement("div",{"data-content":"",className:pr(ie==null?void 0:ie.content,u==null||(a=u.classNames)==null?void 0:a.content)},T.createElement("div",{"data-title":"",className:pr(ie==null?void 0:ie.title,u==null||(c=u.classNames)==null?void 0:c.title)},u.jsx?u.jsx:typeof u.title=="function"?u.title():u.title),u.description?T.createElement("div",{"data-description":"",className:pr(M,we,ie==null?void 0:ie.description,u==null||(l=u.classNames)==null?void 0:l.description)},typeof u.description=="function"?u.description():u.description):null),T.isValidElement(u.cancel)?u.cancel:u.cancel&&kc(u.cancel)?T.createElement("button",{"data-button":!0,"data-cancel":!0,style:u.cancelButtonStyle||A,onClick:xe=>{kc(u.cancel)&&B&&(u.cancel.onClick==null||u.cancel.onClick.call(u.cancel,xe),Ct())},className:pr(ie==null?void 0:ie.cancelButton,u==null||(d=u.classNames)==null?void 0:d.cancelButton)},u.cancel.label):null,T.isValidElement(u.action)?u.action:u.action&&kc(u.action)?T.createElement("button",{"data-button":!0,"data-action":!0,style:u.actionButtonStyle||q,onClick:xe=>{kc(u.action)&&(u.action.onClick==null||u.action.onClick.call(u.action,xe),!xe.defaultPrevented&&Ct())},className:pr(ie==null?void 0:ie.actionButton,u==null||(h=u.classNames)==null?void 0:h.actionButton)},u.action.label):null)};function Fh(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function $x(t,e){const n={};return[t,e].forEach((r,s)=>{const a=s===1,c=a?"--mobile-offset":"--offset",l=a?Ix:Ox;function d(h){["top","right","bottom","left"].forEach(m=>{n[`${c}-${m}`]=typeof h=="number"?`${h}px`:h})}typeof r=="number"||typeof r=="string"?d(r):typeof r=="object"?["top","right","bottom","left"].forEach(h=>{r[h]===void 0?n[`${c}-${h}`]=l:n[`${c}-${h}`]=typeof r[h]=="number"?`${r[h]}px`:r[h]}):d(l)}),n}const Mx=T.forwardRef(function(e,n){const{id:r,invert:s,position:a="bottom-right",hotkey:c=["altKey","KeyT"],expand:l,closeButton:d,className:h,offset:m,mobileOffset:u,theme:p="light",richColors:w,duration:y,style:g,visibleToasts:N=_x,toastOptions:v,dir:C=Fh(),gap:S=Ax,icons:_,containerAriaLabel:D="Notifications"}=e,[O,b]=T.useState([]),A=T.useMemo(()=>r?O.filter(K=>K.toasterId===r):O.filter(K=>!K.toasterId),[O,r]),q=T.useMemo(()=>Array.from(new Set([a].concat(A.filter(K=>K.position).map(K=>K.position)))),[A,a]),[I,M]=T.useState([]),[V,de]=T.useState(!1),[X,he]=T.useState(!1),[ie,P]=T.useState(p!=="system"?p:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),J=T.useRef(null),le=c.join("+").replace(/Key/g,"").replace(/Digit/g,""),Fe=T.useRef(null),kt=T.useRef(!1),lt=T.useCallback(K=>{b(ne=>{var Ne;return(Ne=ne.find(Qe=>Qe.id===K.id))!=null&&Ne.delete||mn.dismiss(K.id),ne.filter(({id:Qe})=>Qe!==K.id)})},[]);return T.useEffect(()=>mn.subscribe(K=>{if(K.dismiss){requestAnimationFrame(()=>{b(ne=>ne.map(Ne=>Ne.id===K.id?{...Ne,delete:!0}:Ne))});return}setTimeout(()=>{F0.flushSync(()=>{b(ne=>{const Ne=ne.findIndex(Qe=>Qe.id===K.id);return Ne!==-1?[...ne.slice(0,Ne),{...ne[Ne],...K},...ne.slice(Ne+1)]:[K,...ne]})})})}),[O]),T.useEffect(()=>{if(p!=="system"){P(p);return}if(p==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?P("dark"):P("light")),typeof window>"u")return;const K=window.matchMedia("(prefers-color-scheme: dark)");try{K.addEventListener("change",({matches:ne})=>{P(ne?"dark":"light")})}catch{K.addListener(({matches:Ne})=>{try{P(Ne?"dark":"light")}catch(Qe){console.error(Qe)}})}},[p]),T.useEffect(()=>{O.length<=1&&de(!1)},[O]),T.useEffect(()=>{const K=ne=>{var Ne;if(c.every(Se=>ne[Se]||ne.code===Se)){var mt;de(!0),(mt=J.current)==null||mt.focus()}ne.code==="Escape"&&(document.activeElement===J.current||(Ne=J.current)!=null&&Ne.contains(document.activeElement))&&de(!1)};return document.addEventListener("keydown",K),()=>document.removeEventListener("keydown",K)},[c]),T.useEffect(()=>{if(J.current)return()=>{Fe.current&&(Fe.current.focus({preventScroll:!0}),Fe.current=null,kt.current=!1)}},[J.current]),T.createElement("section",{ref:n,"aria-label":`${D} ${le}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},q.map((K,ne)=>{var Ne;const[Qe,mt]=K.split("-");return A.length?T.createElement("ol",{key:K,dir:C==="auto"?Fh():C,tabIndex:-1,ref:J,className:h,"data-sonner-toaster":!0,"data-sonner-theme":ie,"data-y-position":Qe,"data-x-position":mt,style:{"--front-toast-height":`${((Ne=I[0])==null?void 0:Ne.height)||0}px`,"--width":`${Tx}px`,"--gap":`${S}px`,...g,...$x(m,u)},onBlur:Se=>{kt.current&&!Se.currentTarget.contains(Se.relatedTarget)&&(kt.current=!1,Fe.current&&(Fe.current.focus({preventScroll:!0}),Fe.current=null))},onFocus:Se=>{Se.target instanceof HTMLElement&&Se.target.dataset.dismissible==="false"||kt.current||(kt.current=!0,Fe.current=Se.relatedTarget)},onMouseEnter:()=>de(!0),onMouseMove:()=>de(!0),onMouseLeave:()=>{X||de(!1)},onDragEnd:()=>de(!1),onPointerDown:Se=>{Se.target instanceof HTMLElement&&Se.target.dataset.dismissible==="false"||he(!0)},onPointerUp:()=>he(!1)},A.filter(Se=>!Se.position&&ne===0||Se.position===K).map((Se,Ut)=>{var pe,F;return T.createElement(Lx,{key:Se.id,icons:_,index:Ut,toast:Se,defaultRichColors:w,duration:(pe=v==null?void 0:v.duration)!=null?pe:y,className:v==null?void 0:v.className,descriptionClassName:v==null?void 0:v.descriptionClassName,invert:s,visibleToasts:N,closeButton:(F=v==null?void 0:v.closeButton)!=null?F:d,interacting:X,position:K,style:v==null?void 0:v.style,unstyled:v==null?void 0:v.unstyled,classNames:v==null?void 0:v.classNames,cancelButtonStyle:v==null?void 0:v.cancelButtonStyle,actionButtonStyle:v==null?void 0:v.actionButtonStyle,closeButtonAriaLabel:v==null?void 0:v.closeButtonAriaLabel,removeToast:lt,toasts:A.filter(ce=>ce.position==Se.position),heights:I.filter(ce=>ce.position==Se.position),setHeights:M,expandByDefault:l,gap:S,expanded:V,swipeDirections:e.swipeDirections})})):null}))});var zx=["added","removed","updated"];function Wh(t){return zx.includes(t)}async function Bx({queryClient:t,persister:e,maxAge:n=1e3*60*60*24,buster:r="",hydrateOptions:s}){try{const a=await e.restoreClient();if(a)if(a.timestamp){const c=Date.now()-a.timestamp>n,l=a.buster!==r;if(c||l)return e.removeClient();Zg(t,a.clientState,s)}else return e.removeClient()}catch(a){throw await e.removeClient(),a}}async function Uh({queryClient:t,persister:e,buster:n="",dehydrateOptions:r}){const s={buster:n,timestamp:Date.now(),clientState:Jg(t,r)};await e.persistClient(s)}function Fx(t){const e=t.queryClient.getQueryCache().subscribe(r=>{Wh(r.type)&&Uh(t)}),n=t.queryClient.getMutationCache().subscribe(r=>{Wh(r.type)&&Uh(t)});return()=>{e(),n()}}var Wx=({children:t,persistOptions:e,onSuccess:n,onError:r,...s})=>{const[a,c]=x.useState(!0),l=x.useRef({persistOptions:e,onSuccess:n,onError:r}),d=x.useRef(!1);return x.useEffect(()=>{l.current={persistOptions:e,onSuccess:n,onError:r}}),x.useEffect(()=>{const h={...l.current.persistOptions,queryClient:s.client};return d.current||(d.current=!0,Bx(h).then(()=>{var m,u;return(u=(m=l.current).onSuccess)==null?void 0:u.call(m)}).catch(()=>{var m,u;return(u=(m=l.current).onError)==null?void 0:u.call(m)}).finally(()=>{c(!1)})),a?void 0:Fx(h)},[s.client,a]),i.jsx(lx,{...s,children:i.jsx(ux,{value:a,children:t})})};function id(){}function Ux({storage:t,key:e="REACT_QUERY_OFFLINE_CACHE",throttleTime:n=1e3,serialize:r=JSON.stringify,deserialize:s=JSON.parse,retry:a}){if(t){const c=l=>{try{t.setItem(e,r(l));return}catch(d){return d}};return{persistClient:qx(l=>{let d=l,h=c(d),m=0;for(;h&&d;)m++,d=a==null?void 0:a({persistedClient:d,error:h,errorCount:m}),d&&(h=c(d))},n),restoreClient:()=>{const l=t.getItem(e);if(l)return s(l)},removeClient:()=>{t.removeItem(e)}}}return{persistClient:id,restoreClient:id,removeClient:id}}function qx(t,e=100){let n=null,r;return function(...s){r=s,n===null&&(n=Zc.setTimeout(()=>{t(...r),n=null},e))}}const Vx="modulepreload",Qx=function(t,e){return new URL(t,e).href},qh={},fe=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){let c=function(m){return Promise.all(m.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const l=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=c(n.map(m=>{if(m=Qx(m,r),m in qh)return;qh[m]=!0;const u=m.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(!!r)for(let g=l.length-1;g>=0;g--){const N=l[g];if(N.href===m&&(!u||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${p}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":Vx,u||(y.as="script"),y.crossOrigin="",y.href=m,h&&y.setAttribute("nonce",h),document.head.appendChild(y),u)return new Promise((g,N)=>{y.addEventListener("load",g),y.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return s.then(c=>{for(const l of c||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};class Hx extends x.Component{constructor(){super(...arguments),this.state={hasError:!1},this.handleReset=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.handleCopyError=()=>{var n,r;const e=`Error in ${this.props.name||"Global"}:
${(n=this.state.error)==null?void 0:n.message}

${((r=this.state.errorInfo)==null?void 0:r.componentStack)||""}`;navigator.clipboard.writeText(e),z.success("   ")}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error(` Error in Boundary [${this.props.name||"Global"}]:`,e,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:i.jsxs("div",{className:"p-6 rounded-2xl bg-red-500/5 border border-red-500/20 backdrop-blur-xl flex flex-col items-center justify-center text-center space-y-4 min-h-[300px] animate-in fade-in zoom-in-95 duration-200",children:[i.jsx("div",{className:"p-4 rounded-full bg-red-500/10 ring-1 ring-red-500/30",children:i.jsx(Jo,{className:"w-10 h-10 text-red-500"})}),i.jsxs("div",{className:"space-y-2 max-w-md",children:[i.jsx("h3",{className:"text-xl font-bold text-white",children:"   "}),i.jsx("p",{className:"text-sm text-gray-400",children:this.props.name?`    "${this.props.name}".    .`:"         ."})]}),!1,i.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[i.jsxs("button",{onClick:this.handleReset,className:"flex items-center space-x-2 px-5 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-xl transition-all font-medium shadow-lg shadow-red-500/20 active:scale-95",children:[i.jsx(q0,{className:"w-4 h-4"}),i.jsx("span",{children:" "})]}),i.jsx("button",{onClick:this.handleCopyError,className:"flex items-center space-x-2 px-4 py-2.5 bg-white/5 hover:bg-white/10 text-gray-300 rounded-xl transition-all font-medium border border-white/10 active:scale-95",title:"  ",children:i.jsx(pm,{className:"w-4 h-4"})}),!1]})]}):this.props.children}}const Jx=()=>{const[t,e]=x.useState({status:"idle"}),[n,r]=x.useState(!1),[s,a]=x.useState(!1);x.useEffect(()=>{var m;const d=window.electronAPI;if(!(d!=null&&d.onUpdateStatus))return;const h=d.onUpdateStatus(u=>{u.status==="available"?(e({status:"available",version:u.version,releaseNotes:u.releaseNotes||"       ."}),r(!0)):u.status==="downloading"?(e(p=>({...p,status:"downloading",progress:Math.round(u.progress)})),r(!0)):u.status==="ready"?(e(p=>({...p,status:"downloaded",version:u.version})),r(!0)):u.status==="error"&&e({status:"error",error:"   "})});return(m=d.checkForUpdates)==null||m.call(d),()=>h()},[]);const c=async()=>{const d=window.electronAPI;d!=null&&d.downloadUpdate&&(e(h=>({...h,status:"downloading",progress:0})),await d.downloadUpdate())},l=async()=>{const d=window.electronAPI;d!=null&&d.installUpdate&&await d.installUpdate()};return!n||t.status==="idle"?null:i.jsx(Bt,{children:i.jsx(ve.div,{initial:{x:400,opacity:0},animate:{x:0,opacity:1},exit:{x:400,opacity:0},className:"fixed bottom-6 right-6 z-[999] w-[380px]",dir:"rtl",children:i.jsx("div",{className:"bg-[#14161c]/90 backdrop-blur-2xl border border-white/10 rounded-[2rem] shadow-[0_20px_50px_rgba(0,0,0,0.5)] overflow-hidden",children:i.jsxs("div",{className:"p-5 relative",children:[i.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 blur-[60px] opacity-20 pointer-events-none ${t.status==="available"?"bg-amber-500":t.status==="downloading"?"bg-blue-500":"bg-emerald-500"}`}),i.jsxs("div",{className:"flex items-center justify-between mb-4 relative z-10",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg ${t.status==="available"?"bg-amber-500/20 text-amber-400":t.status==="downloading"?"bg-blue-500/20 text-blue-400":"bg-emerald-500/20 text-emerald-400"}`,children:t.status==="downloading"?i.jsx(dr,{className:"animate-spin",size:24}):t.status==="downloaded"?i.jsx(V0,{size:24}):i.jsx(Zo,{className:"animate-pulse",size:24})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-white font-black text-sm tracking-tight",children:"  "}),i.jsxs("p",{className:"text-[10px] text-zinc-500 font-mono uppercase tracking-widest",children:["Villa Hadad v",t.version]})]})]}),i.jsx("button",{onClick:()=>r(!1),className:"p-2 hover:bg-white/5 rounded-full text-zinc-500 transition-colors",children:i.jsx(Jt,{size:18})})]}),i.jsxs("div",{className:"space-y-4 relative z-10",children:[t.status==="available"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-black/20 rounded-2xl p-4 border border-white/5",children:[i.jsx("p",{className:"text-xs text-zinc-300 leading-relaxed mb-3",children:"         NAS."}),i.jsxs("button",{onClick:()=>a(!s),className:"flex items-center gap-1.5 text-[10px] font-bold text-[#ff6d00] hover:opacity-80 transition-opacity",children:[i.jsx($l,{size:12}),s?" ":"  "]}),i.jsx(Bt,{children:s&&i.jsx(ve.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:i.jsxs("div",{className:"pt-3 mt-3 border-t border-white/5 space-y-2",children:[i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(Pc,{size:10,className:"text-amber-500 mt-0.5 shrink-0"}),i.jsx("p",{className:"text-[10px] text-zinc-400",children:"   (Offline Mode)   ."})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(Pc,{size:10,className:"text-blue-500 mt-0.5 shrink-0"}),i.jsx("p",{className:"text-[10px] text-zinc-400",children:"      NAS ."})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(Pc,{size:10,className:"text-emerald-500 mt-0.5 shrink-0"}),i.jsx("p",{className:"text-[10px] text-zinc-400",children:"     ."})]})]})})})]}),i.jsxs("button",{onClick:c,className:"w-full py-4 bg-[#ff6d00] hover:bg-[#ff8500] text-black font-black rounded-2xl shadow-xl shadow-orange-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 text-sm",children:[i.jsx(Q0,{size:18}),"  "]})]}),t.status==="downloading"&&i.jsxs("div",{className:"space-y-4 py-2",children:[i.jsxs("div",{className:"flex justify-between items-end mb-1",children:[i.jsx("span",{className:"text-[10px] font-bold text-zinc-400",children:"  ..."}),i.jsxs("span",{className:"text-lg font-black text-blue-400 font-mono",children:[t.progress,"%"]})]}),i.jsx("div",{className:"h-2 w-full bg-white/5 rounded-full overflow-hidden border border-white/5 p-px",children:i.jsx(ve.div,{className:"h-full bg-gradient-to-l from-blue-600 to-blue-400 rounded-full",initial:{width:0},animate:{width:`${t.progress}%`},transition:{type:"spring",bounce:0,duration:.5}})}),i.jsx("p",{className:"text-[9px] text-center text-zinc-600",children:"      "})]}),t.status==="downloaded"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 rounded-2xl p-4 flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center text-black",children:i.jsx(Fi,{size:16})}),i.jsx("p",{className:"text-xs text-emerald-400 font-bold",children:"  !   ."})]}),i.jsx("button",{onClick:l,className:"w-full py-4 bg-emerald-500 hover:bg-emerald-600 text-black font-black rounded-2xl shadow-xl shadow-emerald-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 text-sm",children:"   "})]})]})]})})})})};var es=(t=>(t.WEDDING="Wedding",t.SHOOT="Shoot",t.LOCATION="Location",t.STUDIO="Studio",t.BIRTHDAY="Birthday",t.GRADUATION="Graduation",t.FAMILY="Family",t.TRANSACTION="Transaction",t))(es||{}),me=(t=>(t.INQUIRY="Inquiry",t.CONFIRMED="Confirmed",t.SHOOTING="Shooting",t.SHOOTING_COMPLETED="Shooting Completed",t.SELECTION="Selection",t.EDITING="Editing",t.READY_TO_PRINT="Ready to Print",t.PRINTING="Printing",t.READY_FOR_PICKUP="Ready for Pickup",t.DELIVERED="Delivered",t.ARCHIVED="Archived",t.CLIENT_DELAY="Client Delay",t))(me||{});const Zx={Inquiry:"",Confirmed:" ()",Shooting:" ","Shooting Completed":" ",Selection:" ",Editing:" ","Ready to Print":"  ",Printing:" ","Ready for Pickup":" ",Delivered:"",Archived:"","Client Delay":" "},cj={"Double Chin":" ","Eye Opening":" ","Object Removal":" ","Teeth Whitening":" ","Skin Smoothing":" ","Hair Fix":" ","Body Slimming":" "},Gx={general:"",payment:"",shooting:"",editing:"",delivery:"",booking:"",alert:"",manual:""},lj={rent:"",salaries:"",equipment:"",marketing:" ",services:"",printing:" ",other:" "};var ee=(t=>(t.MANAGER="manager",t.ADMIN="admin",t.RECEPTION="reception",t.PHOTO_EDITOR="photo_editor",t.VIDEO_EDITOR="video_editor",t.PRINTER="printer",t.SELECTOR="selector",t))(ee||{});const xn={manager:" ",admin:" ",reception:" ",photo_editor:" ",video_editor:"",printer:" ",selector:" / "},dj={manager:{canViewFinancials:!0,canEditBookings:!0,canDeleteBookings:!0,canViewGallery:!0,canEditGallery:!0,canViewClientPhone:!0,canViewPrices:!0,canAccessSettings:!0,canAssignTasks:!0,canManageUsers:!0,canAccessDevTools:!1,canViewSystemLogs:!1,canApproveBookings:!0},admin:{canViewFinancials:!0,canEditBookings:!0,canDeleteBookings:!0,canViewGallery:!0,canEditGallery:!0,canViewClientPhone:!0,canViewPrices:!0,canAccessSettings:!0,canAssignTasks:!0,canManageUsers:!1,canAccessDevTools:!1,canViewSystemLogs:!1,canApproveBookings:!0},reception:{canViewFinancials:!1,canEditBookings:!0,canDeleteBookings:!1,canViewGallery:!1,canEditGallery:!1,canViewClientPhone:!0,canViewPrices:!0,canAccessSettings:!1,canAssignTasks:!1,canManageUsers:!1,canAccessDevTools:!1,canViewSystemLogs:!1,canApproveBookings:!1},photo_editor:{canViewFinancials:!1,canEditBookings:!1,canDeleteBookings:!1,canViewGallery:!0,canEditGallery:!0,canViewClientPhone:!1,canViewPrices:!1,canAccessSettings:!1,canAssignTasks:!1,canManageUsers:!1,canAccessDevTools:!1,canViewSystemLogs:!1,canApproveBookings:!1},video_editor:{canViewFinancials:!1,canEditBookings:!1,canDeleteBookings:!1,canViewGallery:!0,canEditGallery:!1,canViewClientPhone:!1,canViewPrices:!1,canAccessSettings:!1,canAssignTasks:!1,canManageUsers:!1,canAccessDevTools:!1,canViewSystemLogs:!1,canApproveBookings:!1},printer:{canViewFinancials:!1,canEditBookings:!1,canDeleteBookings:!1,canViewGallery:!0,canEditGallery:!1,canViewClientPhone:!1,canViewPrices:!1,canAccessSettings:!1,canAssignTasks:!1,canManageUsers:!1,canAccessDevTools:!1,canViewSystemLogs:!1,canApproveBookings:!1},selector:{canViewFinancials:!1,canEditBookings:!1,canDeleteBookings:!1,canViewGallery:!0,canEditGallery:!1,canViewClientPhone:!1,canViewPrices:!1,canAccessSettings:!1,canAssignTasks:!1,canManageUsers:!1,canAccessDevTools:!1,canViewSystemLogs:!1,canApproveBookings:!1}},cs=[{id:"vip",label:" VIP ()",mapTo:"Wedding"},{id:"wedding_party",label:"  ()",mapTo:"Wedding"},{id:"wedding_studio",label:"  ()",mapTo:"Studio"},{id:"kids",label:" ",mapTo:"Birthday"},{id:"general",label:"  (  )",mapTo:"Graduation"},{id:"printing",label:"  (Printing)",mapTo:"Transaction"},{id:"location",label:"  ",mapTo:"Location"}],Vh=[{id:"general_150",categoryId:"general",title:" ",price:15e4,currency:"IQD",features:["  10","  8 ","   "]},{id:"general_250",categoryId:"general",title:" ",price:25e4,currency:"IQD",features:["  20 "," ","  12 ","    5"," (2)  (1)","    "]},{id:"general_400",categoryId:"general",title:" ",price:4e5,currency:"IQD",features:["  30 ","    ","    Vip"," ","    ","  10 ","  10 ","  2","a3+a4   2","   6","    "]},{id:"kids_200",categoryId:"kids",title:"  ",price:2e5,currency:"IQD",features:["  10","  8 ","(1) +  (1)"]},{id:"kids_350",categoryId:"kids",title:"  ",price:35e4,currency:"IQD",features:["  20 "," ","  14 ","    3"," (2)  (1)","    "]},{id:"kids_500",categoryId:"kids",title:"  ",price:5e5,currency:"IQD",features:["  30 ","    ","    Vip"," ","    ","  10 ","  10 ","  2","a3+a4   2","   6","    "]},{id:"party_400",categoryId:"wedding_party",title:" ",price:4e5,currency:"IQD",features:["   ","       ","   30  "]},{id:"party_750",categoryId:"wedding_party",title:" ",price:75e4,currency:"IQD",features:["       ","     45 ","  20  ","30  ","   "]},{id:"party_1m",categoryId:"wedding_party",title:" ",price:1e6,currency:"IQD",features:["      ","    ","  80 "," ","    ","  16 ","  10 ","  2","a3+a4   2","  10 ","  40  "]},{id:"wedding_studio_400",categoryId:"wedding_studio",title:" ",price:4e5,currency:"IQD",features:["  17 ","  14 ","  2","  3040"]},{id:"wedding_studio_700",categoryId:"wedding_studio",title:" ",price:7e5,currency:"IQD",features:["  25 "," ","  12 ","  10 "," (2)  (1)","    "]},{id:"wedding_studio_1m",categoryId:"wedding_studio",title:" ",price:1e6,currency:"IQD",features:["  40 ","    ","   "," ","    ","  14 ","  10 ","  2","a3+a4   2","    "]},{id:"bride_studio_400",categoryId:"wedding_studio",title:"  ",price:4e5,currency:"IQD",features:["  17 ","  14 ","  2","  3040"]},{id:"bride_studio_700",categoryId:"wedding_studio",title:"  ",price:7e5,currency:"IQD",features:["  25 "," ","  12 ","  10 "," (2)  (1)","    "]},{id:"bride_studio_1m",categoryId:"wedding_studio",title:"  ",price:1e6,currency:"IQD",features:["  40 ","    ","   "," ","    ","  14 ","  10 ","  2","a3+a4   2","    "]},{id:"venue_session_couples",categoryId:"venue_session",title:" ",price:15e4,currency:"IQD",features:["  "]},{id:"venue_session_private",categoryId:"venue_session",title:" ",price:3e5,currency:"IQD",features:[" "]},{id:"venue_session_maternity",categoryId:"venue_session",title:" ",price:75e3,currency:"IQD",features:[]},{id:"venue_session_graduation",categoryId:"venue_session",title:" ",price:75e3,currency:"IQD",features:[]},{id:"venue_session_couples_gen",categoryId:"venue_session",title:"",price:75e3,currency:"IQD",features:[]},{id:"venue_session_kids",categoryId:"venue_session",title:" ",price:75e3,currency:"IQD",features:[]},{id:"venue_ad_60min",categoryId:"venue_commercial",title:"",price:15e4,currency:"IQD",features:[" 50 "]},{id:"venue_ad_3hours",categoryId:"venue_commercial",title:"3 ",price:3e5,currency:"IQD",features:[]},{id:"venue_ad_monthly",categoryId:"venue_commercial",title:" 4  (3 )",price:1e6,currency:"IQD",features:[]},{id:"vip_room_economy",categoryId:"venue_room",title:" ",price:75e3,currency:"IQD",features:[]},{id:"vip_room_silver",categoryId:"venue_room",title:" ",price:15e4,currency:"IQD",features:[]},{id:"vip_room_gold",categoryId:"venue_room",title:" ",price:25e4,currency:"IQD",features:[]},{id:"vip_room_royal",categoryId:"venue_room",title:" ",price:5e5,currency:"IQD",features:[]},{id:"vip_room_rental",categoryId:"venue_room",title:"  ",price:5e4,currency:"IQD",features:[]},{id:"venue_full_3pm_12am",categoryId:"venue_party",title:" 3 - : 12",price:3e6,currency:"IQD",features:[]},{id:"venue_full_4pm_11pm",categoryId:"venue_party",title:" 4 - : 11",price:25e5,currency:"IQD",features:[]},{id:"venue_full_5pm_10pm",categoryId:"venue_party",title:" 5 - : 10",price:2e6,currency:"IQD",features:[]},{id:"venue_full_6pm_10pm",categoryId:"venue_party",title:" 6 - : 10",price:15e5,currency:"IQD",features:[]},{id:"vip_1000",categoryId:"vip",title:"  VIP ( )",price:1e3,currency:"USD",features:["  70 ","   ","  10  +   10 ","  45 "," (2) +  (3)","     "]},{id:"vip_1550",categoryId:"vip",title:" FULL DAY VVIP",price:1550,currency:"USD",features:["   ( )",":     ","  100 ","   +  ","  40 +  20 +  10 +  10"," (2) +  (3)","   (   )","   "]},{id:"vip_2100",categoryId:"vip",title:" ROYAL VVIP",price:2100,currency:"USD",features:["   ( + )","  () +   ","   +   ","  150 ","  +  +  + ","     ","    +  "]}],Kx=t=>{const e=typeof t.price=="number"?t.price:0;return`${t.title} - ${e.toLocaleString()} ${t.currency}`};function Yx(t,e){return t.deletedAt?!1:e.role==="admin"||e.role==="manager"||e.role==="reception"?!0:e.role==="photo_editor"?t.assignedPhotoEditor===e.id||t.status==="Editing":e.role==="video_editor"?t.assignedVideoEditor===e.id:e.role==="printer"?t.assignedPrinter===e.id||t.status==="Ready to Print":!1}const zm=({uploadProgress:t,isUploading:e,className:n=""})=>{const[r,s]=x.useState(!1),[a,c]=x.useState({internet:!1,synology:!1,r2:!1,nasRootPath:"",appFolderPath:""}),[l,d]=x.useState(!1),h=x.useCallback(async()=>{var C,S,_,D,O,b,A;d(!0);try{const q=navigator.onLine;let I=!1,M=!1,V="",de="";if((C=window.electronAPI)!=null&&C.nasConfig)try{const X=await((_=(S=window.electronAPI.nasConfig).testConnection)==null?void 0:_.call(S));I=(X==null?void 0:X.success)??!1;const he=await((O=(D=window.electronAPI.nasConfig).getConfig)==null?void 0:O.call(D));he&&(V=he.nasRootPath||"/Volumes/VillaHadad",de=he.appFolderPath||"")}catch{I=!1}if((A=(b=window.electronAPI)==null?void 0:b.sessionLifecycle)!=null&&A.getR2Status)try{const X=await window.electronAPI.sessionLifecycle.getR2Status();M=(X==null?void 0:X.enabled)??!1}catch{M=!1}c({internet:q,synology:I,r2:M,nasRootPath:V,appFolderPath:de})}catch(q){console.error("Error checking network status:",q)}finally{d(!1)}},[]),m=async()=>{var C,S,_;try{await((_=(S=(C=window.electronAPI)==null?void 0:C.nasConfig)==null?void 0:S.openAppFolder)==null?void 0:_.call(S))}catch(D){console.error("Failed to open folder:",D)}};x.useEffect(()=>{h();const C=setInterval(h,3e4);return()=>clearInterval(C)},[h]);const u=C=>{if(!C)return"0 B";const S=1024,_=["B","KB","MB","GB"],D=Math.floor(Math.log(C)/Math.log(S));return`${parseFloat((C/Math.pow(S,D)).toFixed(1))} ${_[D]}`},p=()=>{if(!(t!=null&&t.startTime)||!t.percent||t.percent>=100)return"";const S=(Date.now()-t.startTime)/t.percent*(100-t.percent),_=Math.round(S/1e3);return _<60?`${_} `:`${Math.round(_/60)} `},w=a.internet,y=a.internet&&a.synology,g=e&&t,N=()=>g?i.jsx(ve.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:i.jsx(rd,{className:"w-4 h-4 text-blue-400"})}):w?a.synology?i.jsx(va,{className:"w-4 h-4 text-emerald-400"}):i.jsx(va,{className:"w-4 h-4 text-amber-400"}):i.jsx(bm,{className:"w-4 h-4 text-red-400"}),v=()=>g?`  ${(t==null?void 0:t.percent)??0}%`:w?a.synology?"":" ":" ";return i.jsxs("div",{className:`relative ${n}`,children:[i.jsxs("button",{onClick:()=>s(!r),className:`
          flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all w-full
          ${g?"bg-blue-500/20 text-blue-400 border border-blue-500/30":y?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 hover:bg-emerald-500/20":w?"bg-amber-500/10 text-amber-400 border border-amber-500/20 hover:bg-amber-500/20":"bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20"}
        `,children:[N(),i.jsx("span",{className:"flex-1 text-right",children:v()}),i.jsx(H0,{className:`w-3 h-3 transition-transform ${r?"rotate-180":""}`})]}),i.jsx(Bt,{children:r&&i.jsxs(ve.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute top-full right-0 mt-2 w-72 bg-[#1a1a1f]/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/10",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(va,{className:"w-4 h-4 text-violet-400"}),i.jsx("span",{className:"text-sm font-bold text-white",children:" "})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:C=>{C.stopPropagation(),h()},className:"w-6 h-6 rounded-md hover:bg-white/10 flex items-center justify-center text-zinc-400",disabled:l,children:i.jsx(dr,{className:`w-3.5 h-3.5 ${l?"animate-spin":""}`})}),i.jsx("button",{onClick:()=>s(!1),className:"w-6 h-6 rounded-md hover:bg-white/10 flex items-center justify-center text-zinc-400",children:i.jsx(Jt,{className:"w-4 h-4"})})]})]}),i.jsxs("div",{className:"p-3 space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-zinc-800/50",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(va,{className:"w-4 h-4 text-zinc-400"}),i.jsx("span",{className:"text-xs text-zinc-300",children:""})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${a.internet?"bg-emerald-400":"bg-red-400"}`}),i.jsx("span",{className:`text-xs font-medium ${a.internet?"text-emerald-400":"text-red-400"}`,children:a.internet?"":" "})]})]}),i.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-zinc-800/50",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ch,{className:"w-4 h-4 text-zinc-400"}),i.jsx("span",{className:"text-xs text-zinc-300",children:"Synology NAS"})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${a.synology?"bg-emerald-400":"bg-amber-400"}`}),i.jsx("span",{className:`text-xs font-medium ${a.synology?"text-emerald-400":"text-amber-400"}`,children:a.synology?"":" "})]})]}),i.jsxs("div",{className:"p-2 rounded-lg bg-zinc-800/50",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[g?i.jsx(ve.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:i.jsx(rd,{className:"w-4 h-4 text-blue-400"})}):i.jsx(rd,{className:`w-4 h-4 ${a.r2?"text-emerald-400":"text-zinc-500"}`}),i.jsx("span",{className:"text-xs text-zinc-300",children:"Cloud R2"})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${a.r2?"bg-emerald-400":"bg-zinc-500"}`}),i.jsx("span",{className:`text-xs font-medium ${a.r2?"text-emerald-400":"text-zinc-500"}`,children:a.r2?"":" "})]})]}),g&&t&&i.jsxs("div",{className:"mt-3 pt-3 border-t border-white/5 space-y-2",children:[i.jsx("div",{className:"w-full h-1.5 bg-zinc-700 rounded-full overflow-hidden",children:i.jsx(ve.div,{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-400 rounded-full",initial:{width:0},animate:{width:`${t.percent}%`},transition:{duration:.3}})}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[10px]",children:[i.jsxs("div",{className:"bg-zinc-700/50 rounded px-2 py-1",children:[i.jsx("span",{className:"text-zinc-500 block",children:""}),i.jsxs("span",{className:"text-white font-bold",children:[t.current??0," / ",t.total??0]})]}),i.jsxs("div",{className:"bg-zinc-700/50 rounded px-2 py-1",children:[i.jsx("span",{className:"text-zinc-500 block",children:""}),i.jsxs("span",{className:"text-white font-bold",children:[u(t.uploadedBytes)," /"," ",u(t.totalBytes)]})]}),t.bytesPerSecond&&t.bytesPerSecond>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-zinc-700/50 rounded px-2 py-1",children:[i.jsx("span",{className:"text-zinc-500 block",children:""}),i.jsxs("span",{className:"text-white font-bold",children:[u(t.bytesPerSecond),"/s"]})]}),i.jsxs("div",{className:"bg-zinc-700/50 rounded px-2 py-1",children:[i.jsx("span",{className:"text-zinc-500 block",children:""}),i.jsx("span",{className:"text-white font-bold",children:p()})]})]})]}),i.jsx("p",{className:"text-[10px] text-zinc-500 truncate",children:t.status})]})]}),i.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-zinc-800/30",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(gm,{className:"w-4 h-4 text-zinc-500"}),i.jsx("span",{className:"text-xs text-zinc-400",children:" "})]}),i.jsx("span",{className:"text-xs text-zinc-300",children:g?"Cloud R2":a.synology?"NAS + Cloud":""})]}),i.jsx("div",{className:"border-t border-white/10 my-2"}),i.jsxs("div",{className:"p-2 rounded-lg bg-zinc-800/30",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx(Ch,{className:"w-3.5 h-3.5 text-zinc-500"}),i.jsx("span",{className:"text-[10px] text-zinc-400",children:" NAS"})]}),i.jsx("code",{className:"block text-[10px] text-blue-400 font-mono truncate",children:a.nasRootPath||"/Volumes/VillaHadad"})]}),i.jsxs("div",{className:"p-2 rounded-lg bg-zinc-800/30",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(xm,{className:"w-3.5 h-3.5 text-zinc-500"}),i.jsx("span",{className:"text-[10px] text-zinc-400",children:" "})]}),a.appFolderPath&&i.jsxs("button",{onClick:m,className:"flex items-center gap-1 px-2 py-0.5 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 rounded text-[9px] transition-colors",children:[i.jsx(ym,{className:"w-3 h-3"}),""]})]}),i.jsx("code",{className:"block text-[10px] text-emerald-400 font-mono truncate",children:a.appFolderPath||" "})]})]})]})})]})};class no{constructor(){this.logHistory=[],this.maxHistorySize=1e3}static getInstance(){return no.instance||(no.instance=new no),no.instance}shouldLog(e){const n=["debug","info","warn","error"];return n.indexOf(e)>=n.indexOf("info")}formatMessage(e,n,r){const a=`[${new Date().toISOString()}] [${e.toUpperCase()}]`;return r?`${a} ${n} ${JSON.stringify(r)}`:`${a} ${n}`}addToHistory(e){this.logHistory.push(e),this.logHistory.length>this.maxHistorySize&&this.logHistory.shift()}debug(e,n){if(!this.shouldLog("debug"))return;const r={level:"debug",message:e,timestamp:new Date().toISOString(),context:n};this.addToHistory(r)}info(e,n){if(!this.shouldLog("info"))return;const r={level:"info",message:e,timestamp:new Date().toISOString(),context:n};this.addToHistory(r),console.info(this.formatMessage("info",e,n))}warn(e,n){if(!this.shouldLog("warn"))return;const r={level:"warn",message:e,timestamp:new Date().toISOString(),context:n};this.addToHistory(r),console.warn(this.formatMessage("warn",e,n))}error(e,n,r){if(!this.shouldLog("error"))return;const s={level:"error",message:e,timestamp:new Date().toISOString(),context:{...r,errorName:n==null?void 0:n.name,errorMessage:n==null?void 0:n.message,errorStack:n==null?void 0:n.stack}};this.addToHistory(s),console.error(this.formatMessage("error",e,r),n)}getHistory(e){return e?this.logHistory.filter(n=>n.level===e):[...this.logHistory]}clearHistory(){this.logHistory=[]}exportLogs(){return JSON.stringify(this.logHistory,null,2)}}const fr=no.getInstance(),Xx="https://jgptgqjaeogfovijfrpv.supabase.co",ey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpncHRncWphZW9nZm92aWpmcnB2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMzMwMjAsImV4cCI6MjA4MzgwOTAyMH0.-dIH0JQBcPb0BTTh_IsrAyJjUbUEdKKYDsFaV1DRbxA",ty=()=>Sg(Xx,ey,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1,flowType:"implicit"},db:{schema:"public"},global:{headers:{"x-app-version":"2.0.0"}},realtime:{params:{eventsPerSecond:10}}}),H=typeof window<"u"&&window.__supabase?window.__supabase:(()=>{const t=ty();return typeof window<"u"&&(window.__supabase=t),t})();console.log(" Supabase client initialized (Admin client removed for security)");console.log("   Sync operations use secure Edge Function");async function Zi(t,e,n){try{const{data:r,error:s}=await H.functions.invoke("sync",{body:{action:t,entity:e,data:n}});return s?(console.error("Sync Function Error:",s),{success:!1,error:s.message}):{success:!0,data:r}}catch(r){return console.error("Sync Function Call Failed:",r),{success:!1,error:String(r)}}}class ro{constructor(){this.checks=new Map,this.checkInterval=null,this.listeners=[]}static getInstance(){return ro.instance||(ro.instance=new ro),ro.instance}startMonitoring(e=3e4){if(this.checkInterval){fr.warn("Health monitoring already started");return}fr.info("Starting health monitoring",{intervalMs:e}),this.runAllChecks(),this.checkInterval=setInterval(()=>{this.runAllChecks()},e)}stopMonitoring(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null,fr.info("Health monitoring stopped"))}registerCheck(e,n){this.checks.set(e,{name:e,status:"unknown",responseTime:0,lastChecked:new Date}),this.checks.get(e).checkFn=n}async runAllChecks(){const e=[];for(const[a,c]of this.checks){const l=c.checkFn;l&&e.push(this.runCheckWithTimeout(a,l))}const n=await Promise.allSettled(e),r=[];n.forEach((a,c)=>{var d;const l=Array.from(this.checks.keys());if(a.status==="fulfilled")r.push(a.value),this.checks.set(a.value.name,a.value);else{const h={name:l[c],status:"unhealthy",responseTime:0,lastChecked:new Date,error:((d=a.reason)==null?void 0:d.message)||"Check failed"};r.push(h),this.checks.set(l[c],h)}});const s={overall:this.calculateOverallStatus(r),checks:r,timestamp:new Date};return this.listeners.forEach(a=>a(s)),s}async runCheckWithTimeout(e,n,r=5e3){const s=performance.now();try{const a=n(),c=new Promise((h,m)=>{setTimeout(()=>m(new Error("Health check timeout")),r)}),l=await Promise.race([a,c]),d=Math.round(performance.now()-s);return{...l,responseTime:d}}catch(a){const c=Math.round(performance.now()-s);return{name:e,status:"unhealthy",responseTime:c,lastChecked:new Date,error:a.message}}}calculateOverallStatus(e){if(e.length===0)return"unknown";const n=e.filter(s=>s.status==="unhealthy").length,r=e.filter(s=>s.status==="degraded").length;return n>0?"unhealthy":r>0?"degraded":"healthy"}subscribe(e){return this.listeners.push(e),()=>{const n=this.listeners.indexOf(e);n>-1&&this.listeners.splice(n,1)}}getHealth(){const e=Array.from(this.checks.values());return{overall:this.calculateOverallStatus(e),checks:e,timestamp:new Date}}}const ts=ro.getInstance(),Bl={async checkSupabase(){const t=performance.now();try{const{error:e}=await H.from("users").select("count",{count:"exact",head:!0});if(e)throw e;return{name:"supabase",status:"healthy",responseTime:Math.round(performance.now()-t),lastChecked:new Date,message:"Connected successfully"}}catch(e){return{name:"supabase",status:"unhealthy",responseTime:Math.round(performance.now()-t),lastChecked:new Date,error:e.message}}},async checkLocalDatabase(){const t=performance.now();try{const e=window.electronAPI;return e!=null&&e.db?(await e.db.query("SELECT 1"),{name:"localDatabase",status:"healthy",responseTime:Math.round(performance.now()-t),lastChecked:new Date,message:"Local database responsive"}):{name:"localDatabase",status:"degraded",responseTime:Math.round(performance.now()-t),lastChecked:new Date,message:"Running in web mode (no local DB)"}}catch(e){return{name:"localDatabase",status:"unhealthy",responseTime:Math.round(performance.now()-t),lastChecked:new Date,error:e.message}}},async checkNetwork(){const t=performance.now(),e=navigator.onLine;return{name:"network",status:e?"healthy":"unhealthy",responseTime:Math.round(performance.now()-t),lastChecked:new Date,message:e?"Online":"Offline"}},async checkNAS(){var e;const t=performance.now();try{const n=window.electronAPI;if(!((e=n==null?void 0:n.fileSystem)!=null&&e.checkNasStatus))return{name:"nas",status:"unknown",responseTime:Math.round(performance.now()-t),lastChecked:new Date,message:"NAS check not available"};const r=await n.fileSystem.checkNasStatus();return{name:"nas",status:r.connected?"healthy":"unhealthy",responseTime:Math.round(performance.now()-t),lastChecked:new Date,message:r.connected?"NAS connected":"NAS disconnected"}}catch(n){return{name:"nas",status:"unhealthy",responseTime:Math.round(performance.now()-t),lastChecked:new Date,error:n.message}}}};ts.registerCheck("supabase",Bl.checkSupabase);ts.registerCheck("localDatabase",Bl.checkLocalDatabase);ts.registerCheck("network",Bl.checkNetwork);ts.registerCheck("nas",Bl.checkNAS);function ny(){const[t,e]=x.useState(ts.getHealth()),[n,r]=x.useState(!1);x.useEffect(()=>ts.subscribe(d=>{e(d)}),[]);const s=x.useCallback(async()=>{r(!0);try{await ts.runAllChecks()}finally{r(!1)}},[]),a=x.useCallback(l=>t.checks.find(d=>d.name===l),[t.checks]),c=t.overall==="healthy";return{health:t,isHealthy:c,isLoading:n,refresh:s,getCheck:a}}function od(t){const{health:e,isLoading:n,refresh:r}=ny(),s=e.checks.find(c=>c.name===t),a=(s==null?void 0:s.status)==="healthy";return{check:s,isHealthy:a,isLoading:n,refresh:r}}const Bm={manager:{container:"bg-white/80 shadow-sm ring-1 ring-black/5",healthy:"text-green-500 bg-green-50",degraded:"text-yellow-500 bg-yellow-50",unhealthy:"text-red-500 bg-red-50",text:"text-gray-700",muted:"text-gray-500",border:"border-gray-100"},reception:{container:"bg-[#1A1A1A] border border-teal-400/20",healthy:"text-teal-400 bg-teal-400/10",degraded:"text-yellow-400 bg-yellow-400/10",unhealthy:"text-red-400 bg-red-400/10",text:"text-white",muted:"text-gray-400",border:"border-gray-700"},dark:{container:"bg-[#21242b] border border-white/10",healthy:"text-green-400 bg-green-400/10",degraded:"text-yellow-400 bg-yellow-400/10",unhealthy:"text-red-400 bg-red-400/10",text:"text-white",muted:"text-gray-400",border:"border-gray-700"}},ry=({theme:t="dark",showDetails:e=!1})=>{const[n,r]=x.useState(!1),{check:s,isHealthy:a}=od("network"),{check:c,isHealthy:l}=od("supabase"),{check:d,isHealthy:h}=od("localDatabase"),m=Bm[t],p=!a||!l||!h?"unhealthy":(s==null?void 0:s.status)==="degraded"||(c==null?void 0:c.status)==="degraded"?"degraded":"healthy",y={healthy:{icon:vm,color:m.healthy,label:""},degraded:{icon:Jo,color:m.degraded,label:""},unhealthy:{icon:wm,color:m.unhealthy,label:" "}}[p],g=y.icon;return i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:()=>r(!n),className:`flex items-center gap-2 px-3 py-2 rounded-xl transition-all duration-200 ${m.container} hover:scale-105`,title:" ",children:[i.jsx("div",{className:`p-1.5 rounded-lg ${y.color}`,children:i.jsx(g,{className:"w-4 h-4"})}),i.jsx("span",{className:`text-xs font-bold ${m.text}`,children:y.label}),i.jsx(J0,{className:`w-3 h-3 ${m.muted} ${p==="healthy"?"animate-pulse":""}`})]}),i.jsx(Bt,{children:n&&e&&i.jsxs(ve.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},className:`absolute top-full right-0 mt-2 w-64 ${m.container} rounded-xl p-4 z-50`,children:[i.jsx("h4",{className:`text-sm font-bold mb-3 ${m.text}`,children:" "}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(va,{className:`w-4 h-4 ${m.muted}`}),i.jsx("span",{className:`text-xs ${m.text}`,children:""})]}),i.jsx(ad,{status:(s==null?void 0:s.status)||"unknown",theme:t,responseTime:s==null?void 0:s.responseTime})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Z0,{className:`w-4 h-4 ${m.muted}`}),i.jsx("span",{className:`text-xs ${m.text}`,children:"  "})]}),i.jsx(ad,{status:(c==null?void 0:c.status)||"unknown",theme:t,responseTime:c==null?void 0:c.responseTime})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(gm,{className:`w-4 h-4 ${m.muted}`}),i.jsx("span",{className:`text-xs ${m.text}`,children:"  "})]}),i.jsx(ad,{status:(d==null?void 0:d.status)||"unknown",theme:t,responseTime:d==null?void 0:d.responseTime})]})]}),(s==null?void 0:s.message)&&i.jsx("div",{className:`mt-3 pt-3 border-t ${m.border}`,children:i.jsx("p",{className:`text-xs ${m.muted}`,children:s.message})})]})})]})},ad=({status:t,theme:e,responseTime:n})=>{const r=Bm[e],s={healthy:{color:r.healthy,label:""},degraded:{color:r.degraded,label:""},unhealthy:{color:r.unhealthy,label:" "},unknown:{color:"text-gray-400 bg-gray-100",label:" "}},{color:a,label:c}=s[t]||s.unknown;return i.jsxs("div",{className:"flex items-center gap-1.5",children:[n&&n>0&&i.jsxs("span",{className:`text-[10px] ${r.muted}`,children:[n,"ms"]}),i.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${a}`,children:c})]})},sy=6e4,iy=15,oy=3e5,ay=1e4,cy=5e3,Lc=3;class ly{constructor(){this.isOnline=typeof navigator<"u"?navigator.onLine:!0,this.syncQueue=[],this.listeners=[],this.pingInterval=null,this.serverUrl="http://localhost:3000",this.onlineHandler=null,this.offlineHandler=null,typeof window<"u"&&this.init()}init(){if(typeof localStorage<"u"){const e=localStorage.getItem("offline_sync_queue");if(e)try{this.syncQueue=JSON.parse(e)}catch{this.syncQueue=[]}}typeof window<"u"&&(this.onlineHandler=()=>this.handleConnectionChange(!0),this.offlineHandler=()=>this.handleConnectionChange(!1),window.addEventListener("online",this.onlineHandler),window.addEventListener("offline",this.offlineHandler)),this.startPing()}startPing(){this.checkConnection(),this.pingInterval=setInterval(()=>{this.checkConnection()},oy)}destroy(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),typeof window<"u"&&(this.onlineHandler&&window.removeEventListener("online",this.onlineHandler),this.offlineHandler&&window.removeEventListener("offline",this.offlineHandler)),this.listeners=[]}async checkConnection(){var e,n;try{if(typeof navigator<"u"&&!navigator.onLine){this.isOnline&&this.handleConnectionChange(!1);return}if(typeof window<"u"&&((n=(e=window.electronAPI)==null?void 0:e.fileSystem)!=null&&n.checkNasStatus)){const r=await window.electronAPI.fileSystem.checkNasStatus();r&&r.connected?this.isOnline||this.handleConnectionChange(!0):this.notifyListeners("server_down")}}catch{this.isOnline&&this.handleConnectionChange(!1)}}handleConnectionChange(e){this.isOnline=e,this.notifyListeners("status_change",{online:e}),e?(z.success("    "),this.processSyncQueue()):z.error("  -     ")}addToQueue(e){const n={...e,id:crypto.randomUUID(),timestamp:Date.now(),retryCount:0};this.syncQueue.push(n),this.saveQueue(),z.info("    (  )")}saveQueue(){typeof localStorage<"u"&&localStorage.setItem("offline_sync_queue",JSON.stringify(this.syncQueue))}async processSyncQueue(){if(this.syncQueue.length===0)return;this.notifyListeners("sync_start");const e=[...this.syncQueue],n=[];for(const r of e)try{await this.syncItem(r)}catch(s){console.error("Sync failed for item",r.id,s),r.retryCount++,r.retryCount<Lc?n.push(r):z.error(`   : ${r.action} ${r.entity}`)}this.syncQueue=n,this.saveQueue(),n.length===0?(this.notifyListeners("sync_complete"),z.success("     ")):this.notifyListeners("sync_error")}async syncItem(e){if(!e.data)return;const{action:n,entity:r,data:s}=e;if(r==="booking"){const a="bookings";if(n==="create"){const{error:c}=await H.from(a).insert(s);if(c)throw c}else if(n==="update"){const{id:c,...l}=s,{error:d}=await H.from(a).update(l).eq("id",c);if(d)throw d}else if(n==="delete"){const{id:c}=s,{error:l}=await H.from(a).update({deleted_at:new Date().toISOString()}).eq("id",c);if(l)throw l}}else console.warn(`Unknown entity for sync: ${r}`)}getStatus(){return{isOnline:this.isOnline,queueLength:this.syncQueue.length}}getQueueSize(){return this.syncQueue.length}hasPendingItem(e){return this.syncQueue.some(n=>n.data&&n.data.id===e||n.data&&n.data.ID===e)}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(n=>n!==e)}}notifyListeners(e,n){this.listeners.forEach(r=>r(e,n))}}const cd=new ly,dy=({currentUser:t,allUsers:e,onSwitchUser:n,onLogout:r,onOpenSettings:s,notifications:a=[],onMarkAllRead:c,isUploading:l=!1,uploadProgress:d=0,isSnowing:h=!1,onToggleSnow:m,isHeartTrail:u=!1,onToggleHeartTrail:p,isRamadan:w=!1,onToggleRamadan:y,isSparkles:g=!1,onToggleSparkles:N,isDraggable:v=!1,onToggleDraggable:C,onResetLayout:S,onExportLayout:_,onImportLayout:D,activeSection:O,onNavigate:b})=>{const[A,q]=x.useState(!1),[I,M]=x.useState(!1),[V,de]=x.useState(!1),[X,he]=x.useState(""),ie=x.useRef(null),P=x.useRef(null),J=x.useRef(null),le=a.filter(pe=>!pe.read).length,[Fe,kt]=x.useState(cd.getStatus());x.useEffect(()=>{ts.startMonitoring(3e4);const pe=()=>kt(cd.getStatus());pe();const F=cd.subscribe(ce=>{(ce==="status_change"||ce==="sync_start"||ce==="sync_complete")&&pe()});return()=>{F(),ts.stopMonitoring()}},[]),x.useEffect(()=>{const pe=F=>{ie.current&&!ie.current.contains(F.target)&&q(!1),P.current&&!P.current.contains(F.target)&&M(!1)};return document.addEventListener("mousedown",pe),()=>document.removeEventListener("mousedown",pe)},[]),x.useEffect(()=>{V&&J.current&&J.current.focus()},[V]);const lt=pe=>{switch(pe){case"booking":return i.jsx(zs,{size:16,className:"text-blue-400"});case"payment":return i.jsx(zu,{size:16,className:"text-green-400"});case"workflow_reminder":return i.jsx(X0,{size:16,className:"text-[#F7931E]"});case"system":return i.jsx(Y0,{size:16,className:"text-gray-400"});default:return i.jsx(Ms,{size:16,className:Qe})}},K=(t==null?void 0:t.role)===ee.RECEPTION,ne=(t==null?void 0:t.role)===ee.MANAGER,Ne=ne?"bg-white/70 backdrop-blur-xl":K?"bg-[#1A1A1A]":"bg-[#21242b]",Qe=ne?"text-amber-500":K?"text-[#C94557]":"text-pink-500",mt=ne?"bg-amber-500":K?"bg-[#C94557]":"bg-pink-500",Se=ne?"hover:bg-amber-500/10":K?"hover:bg-[#C94557]/10":"hover:bg-white/5",Ut=[{id:"section-home",label:""},{id:"section-my-bookings",label:""},{id:"section-clients",label:""},{id:"section-financial",label:""},{id:"section-files",label:""},{id:"section-team",label:" "}];return i.jsx("div",{className:"relative px-6 pt-6 pb-2 shrink-0 z-1000",children:i.jsxs("div",{className:`h-18 ${Ne} rounded-4xl flex items-center justify-between px-6 
        ${ne?"shadow-[0_10px_30px_rgba(0,0,0,0.04)] border-white ring-1 ring-black/5":`shadow-[8px_8px_16px_#111216,-8px_-8px_16px_#23262e] border ${K?"border-teal-400/10":"border-white/5"}`} relative transition-all duration-300`,children:[i.jsx("div",{className:`flex items-center transition-all duration-300 ${V?"flex-1 max-w-[200px]":"w-auto"}`,children:i.jsxs("div",{className:`relative flex items-center w-full h-10 rounded-xl transition-all duration-300 ${V?ne?"bg-gray-100 shadow-inner":"bg-[#1a1c22] shadow-[inset_2px_2px_4px_#16181d,inset_-2px_-2px_4px_#2c3039]":"bg-transparent"}`,children:[i.jsx("button",{onClick:()=>de(!V),className:`h-10 w-10 flex items-center justify-center rounded-xl transition-all shrink-0 z-10 
                   ${V?Qe:ne?"text-gray-400 hover:text-gray-800 hover:bg-gray-100":`text-gray-400 hover:text-white ${Se}`}
                 `,children:i.jsx(Nm,{size:20})}),i.jsx(Bt,{children:V&&i.jsx(ve.input,{ref:J,initial:{width:0,opacity:0},animate:{width:"100%",opacity:1},exit:{width:0,opacity:0},type:"text",placeholder:"...",value:X,onChange:pe=>he(pe.target.value),onBlur:()=>!X&&de(!1),className:`bg-transparent border-none outline-none text-xs ${ne?"text-gray-800":"text-white"} placeholder-gray-400 px-2 w-full h-full font-bold`})})]})}),ne&&i.jsx("div",{className:"flex flex-1 justify-center px-4",children:i.jsx("div",{className:"flex gap-1 items-center p-1 rounded-2xl border border-white ring-1 shadow-sm bg-gray-100/50 ring-black/5",children:Ut.map(pe=>i.jsx("button",{onClick:()=>b(pe.id),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 
                      ${O===pe.id?"bg-white text-gray-800 shadow-sm ring-1 ring-black/5 scale-105":"text-gray-500 hover:text-gray-800 hover:bg-white/40"}
                    `,children:pe.label},pe.id))})}),i.jsxs("div",{className:"flex gap-4 items-center",children:[i.jsxs("div",{className:"relative",ref:P,children:[i.jsx("button",{onClick:()=>M(!I),className:`h-10 w-10 flex items-center justify-center rounded-xl transition-all border 
                    ${I?"bg-amber-500 text-white border-amber-500 shadow-lg":h||u||w||g?"bg-amber-500/10 border-amber-500/30 text-amber-500":"bg-[#21242b] border-white/5 text-gray-400 hover:text-white shadow-neu-icon hover:shadow-[inset_2px_2px_4px_#16181d,inset_-2px_-2px_4px_#2c3039]"}`,children:i.jsx(Zo,{size:18})}),i.jsx(Bt,{children:I&&i.jsxs(ve.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{duration:.2},className:"absolute top-full left-0 mt-4 w-64 bg-[#21242b] rounded-2xl shadow-neu-flat border border-white/5 z-100000 p-3 overflow-hidden",children:[i.jsxs("div",{className:"px-2 py-2 text-[10px] font-black text-gray-500 uppercase tracking-wider mb-2 border-b border-white/5 flex items-center gap-2",children:[i.jsx(Zo,{size:12,className:"text-amber-500"})," "]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[i.jsxs("button",{onClick:m,className:`flex flex-col items-center justify-center p-3 rounded-xl border transition-all ${h?"text-cyan-400 bg-cyan-500/20 border-cyan-500/50":"text-gray-400 bg-white/5 border-white/5 hover:bg-white/10 hover:text-white"}`,children:[i.jsx(G0,{size:20,className:"mb-2"}),i.jsx("span",{className:"text-[10px] font-bold",children:""})]}),i.jsxs("button",{onClick:p,className:`flex flex-col items-center justify-center p-3 rounded-xl border transition-all ${u?"text-pink-400 bg-pink-500/20 border-pink-500/50":"text-gray-400 bg-white/5 border-white/5 hover:bg-white/10 hover:text-white"}`,children:[i.jsx(Sm,{size:20,className:"mb-2"}),i.jsx("span",{className:"text-[10px] font-bold",children:""})]}),i.jsxs("button",{onClick:y,className:`flex flex-col items-center justify-center p-3 rounded-xl border transition-all ${w?"text-emerald-400 bg-emerald-500/20 border-emerald-500/50":"text-gray-400 bg-white/5 border-white/5 hover:bg-white/10 hover:text-white"}`,children:[i.jsx(K0,{size:20,className:"mb-2"}),i.jsx("span",{className:"text-[10px] font-bold",children:""})]}),i.jsxs("button",{onClick:N,className:`flex flex-col items-center justify-center p-3 rounded-xl border transition-all ${g?"text-amber-400 bg-amber-500/20 border-amber-500/50":"text-gray-400 bg-white/5 border-white/5 hover:bg-white/10 hover:text-white"}`,children:[i.jsx(km,{size:20,className:"mb-2"}),i.jsx("span",{className:"text-[10px] font-bold",children:""})]})]}),!K&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"px-2 py-2 text-[10px] font-black text-gray-500 uppercase tracking-wider mb-2 border-t border-b border-white/5 mt-2",children:" "}),i.jsxs("button",{onClick:C,className:`w-full text-right px-3 py-2.5 flex items-center gap-2 hover:bg-white/5 rounded-xl transition-colors mb-1 ${v?"bg-green-500/10":""}`,children:[i.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${v?"bg-green-500 border-green-500":"border-gray-500"}`,children:v&&i.jsx(_h,{size:10,className:"text-black"})}),i.jsx("span",{className:`text-xs font-bold ${v?"text-green-400":"text-gray-300"}`,children:" "})]}),i.jsx("div",{className:"mt-2",children:i.jsx("button",{onClick:S,className:"w-full text-center px-3 py-2 text-[10px] font-bold text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors bg-white/5",children:" "})})]})]})})]}),i.jsx("div",{className:"hidden sm:block",children:i.jsx(ry,{theme:ne?"manager":K?"reception":"dark",showDetails:!0})}),i.jsx("div",{className:"hidden sm:block",children:i.jsx(zm,{theme:ne?"manager":"reception"})}),i.jsxs("div",{className:"relative",ref:ie,children:[i.jsxs("button",{onClick:()=>q(!A),className:`h-10 w-10 flex items-center justify-center rounded-xl transition-all relative
                      ${A?`${mt} text-white shadow-lg`:`${ne?"bg-white shadow-sm ring-1 ring-black/5 text-gray-400 hover:text-gray-800 hover:bg-gray-50":"bg-[#21242b] text-gray-400 border border-white/5 hover:text-white shadow-neu-icon hover:shadow-[inset_2px_2px_4px_#16181d,inset_-2px_-2px_4px_#2c3039]"}`}
                  `,children:[i.jsx(Ms,{size:18}),le>0&&i.jsx("span",{className:`absolute top-2 right-2.5 h-2 w-2 ${ne?"bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.4)]":K?"bg-teal-400 shadow-[0_0_4px_rgba(255,87,34,0.3)]":"bg-teal-400 shadow-[0_0_4px_rgba(236,72,153,0.3)]"} rounded-full border ${ne?"border-white":"border-[#21242b]"}`})]}),i.jsx(Bt,{children:A&&i.jsxs(ve.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{duration:.2},className:`absolute top-full left-0 mt-4 w-96 ${ne?"bg-white shadow-2xl ring-1 ring-black/5":"bg-[#21242b] border border-white/5 shadow-neu-flat"} rounded-2xl z-100000 overflow-hidden flex flex-col origin-top-left`,children:[i.jsxs("div",{className:`p-4 border-b ${ne?"border-gray-100 bg-gray-50/50":"border-white/5 bg-[#21242b]"} flex justify-between items-center`,children:[i.jsxs("div",{className:"flex gap-2 items-center",children:[i.jsx("h4",{className:`text-sm font-bold ${ne?"text-gray-800":"text-white"}`,children:""}),le>0&&i.jsxs("span",{className:`${ne?"text-white bg-amber-500":"text-white bg-teal-400"} text-[10px] font-bold px-1.5 py-0.5 rounded-md shadow-sm`,children:[le," "]})]}),le>0&&i.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 text-[10px] text-gray-400 hover:text-white transition-colors bg-white/5 hover:bg-white/10 px-2 py-1 rounded-lg border border-white/5",children:[i.jsx(_h,{size:12}),"  "]})]}),i.jsx("div",{className:"max-h-[400px] overflow-y-auto custom-scrollbar p-2 space-y-1",children:a.length>0?a.map(pe=>i.jsxs("div",{onClick:()=>{pe.type==="workflow_reminder"&&(b("section-workflow"),q(!1))},className:`group relative p-3 rounded-xl flex gap-4 transition-all duration-200 border border-transparent ${ne?"hover:bg-gray-50":"hover:border-white/5"} ${pe.read?"bg-transparent opacity-60 hover:opacity-100":ne?"bg-amber-50/50":"bg-white/3 hover:bg-white/6 shadow-inner"} ${pe.type==="workflow_reminder"?"cursor-pointer hover:border-[#F7931E]/30 hover:bg-[#F7931E]/5":""}`,children:[!pe.read&&i.jsx("div",{className:`absolute right-2 top-2 h-2 w-2 ${ne?"bg-amber-500":K?"bg-teal-400 shadow-[0_0_4px_rgba(255,87,34,0.3)]":"bg-teal-400 shadow-[0_0_4px_rgba(236,72,153,0.3)]"} rounded-full`}),i.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 border border-white/5 ${pe.read?"bg-[#1a1c22]":"bg-linear-to-br from-[#1a1c22] to-[#2a2d36] shadow-md"} ${pe.type==="workflow_reminder"?"text-[#F7931E] shadow-[0_0_10px_rgba(247,147,30,0.2)]":""}`,children:lt(pe.type)}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex justify-between items-start mb-0.5",children:[i.jsx("p",{className:`text-xs font-bold ${pe.read?"text-gray-400":"text-gray-200"}`,children:pe.title}),i.jsx("span",{className:"text-[9px] text-gray-600 font-mono whitespace-nowrap mr-2",children:pe.time})]}),i.jsx("p",{className:"text-[11px] text-gray-500 leading-relaxed line-clamp-2 group-hover:text-gray-400 transition-colors",children:pe.message})]})]},pe.id)):i.jsxs("div",{className:"flex flex-col gap-3 justify-center items-center py-12 text-gray-500",children:[i.jsx("div",{className:"flex justify-center items-center w-12 h-12 text-gray-600 rounded-full shadow-inner bg-white/5",children:i.jsx(Ms,{size:20,className:"opacity-50"})}),i.jsx("p",{className:"text-xs font-medium",children:"   "})]})}),a.length>0&&i.jsx("div",{className:"p-2 border-t border-white/5 bg-[#21242b]",children:i.jsx("button",{className:"w-full py-2 text-[10px] font-bold text-gray-500 hover:text-white transition-colors",children:"   "})})]})})]})]})]})})},zt=(t,e="IQD")=>t==null?"0":e==="USD"?`$${t.toLocaleString("en-US")}`:`${t.toLocaleString("en-US")} .`,Qh=t=>{switch(t){case"deposit":return"  ";case"addon":return"   ";case"full":return"   ";case"partial":return"  ";default:return" "}},jc=t=>{const{booking:e,type:n,amount:r,currency:s,description:a,receivedBy:c=" ",date:l=new Date().toISOString()}=t,d=`REC-${Date.now().toString(36).toUpperCase()}`,h=new Date(l).toLocaleDateString("ar-IQ",{year:"numeric",month:"long",day:"numeric"}),m=new Date(l).toLocaleTimeString("ar-IQ",{hour:"2-digit",minute:"2-digit"}),u=e.totalAmount-e.paidAmount,p=(e.category||"").toLowerCase()==="location"||(e.title||"").toLowerCase().includes("")||(e.title||"").toLowerCase().includes("villa"),w=`<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8">
<title>${Qh(n)} - ${e.clientName}</title>
<style>
  @page {
    size: A5 portrait;
    margin: 10mm;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
    color: #1a1a2e;
    background: #fff;
    font-size: 11px;
    line-height: 1.5;
    width: 148mm;
    min-height: 210mm;
    padding: 8mm;
  }

  .receipt-container {
    border: 2px solid #1a1a2e;
    border-radius: 12px;
    padding: 16px;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  .receipt-header {
    text-align: center;
    padding-bottom: 12px;
    border-bottom: 2px solid #1a1a2e;
    margin-bottom: 12px;
  }
  .receipt-logo {
    font-size: 24px;
    font-weight: 900;
    color: #1a1a2e;
    margin-bottom: 2px;
  }
  .receipt-logo span { color: #e11d48; }
  .receipt-subtitle {
    font-size: 9px;
    color: #888;
    font-weight: 600;
  }
  .receipt-type {
    display: inline-block;
    margin-top: 8px;
    padding: 4px 16px;
    background: #1a1a2e;
    color: #fff;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 800;
  }

  /* Receipt Info */
  .receipt-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
    font-size: 9px;
    color: #666;
  }
  .receipt-meta .receipt-num {
    font-family: monospace;
    font-weight: 700;
    font-size: 10px;
    color: #1a1a2e;
  }

  /* Client Info */
  .client-section {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 14px;
    border: 1px solid #e5e7eb;
  }
  .client-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
  }
  .client-row:last-child { margin-bottom: 0; }
  .client-label {
    font-size: 9px;
    color: #888;
    font-weight: 700;
  }
  .client-value {
    font-size: 10px;
    font-weight: 800;
    color: #1a1a2e;
  }

  /* Amount Section */
  .amount-section {
    text-align: center;
    padding: 16px;
    margin: 14px 0;
    background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
    border: 2px solid #059669;
    border-radius: 12px;
  }
  .amount-label {
    font-size: 10px;
    color: #059669;
    font-weight: 800;
    margin-bottom: 4px;
    text-transform: uppercase;
  }
  .amount-value {
    font-size: 28px;
    font-weight: 900;
    color: #059669;
    direction: ltr;
  }
  .amount-desc {
    font-size: 9px;
    color: #666;
    margin-top: 4px;
    font-weight: 600;
  }

  /* Financial Details */
  .financial-details {
    margin: 14px 0;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    overflow: hidden;
  }
  .fin-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    font-size: 10px;
    border-bottom: 1px solid #f0f0f0;
  }
  .fin-row:last-child { border-bottom: none; }
  .fin-row.total-row {
    background: #f8f9fa;
    font-weight: 900;
    font-size: 11px;
  }
  .fin-label { color: #666; font-weight: 700; }
  .fin-value { font-weight: 800; color: #1a1a2e; font-family: monospace; }
  .fin-value.paid { color: #059669; }
  .fin-value.remaining { color: #dc2626; }

  /* Signatures */
  .signatures {
    display: flex;
    justify-content: space-between;
    margin-top: auto;
    padding-top: 20px;
  }
  .sig-box {
    text-align: center;
    width: 40%;
  }
  .sig-line {
    border-top: 1px solid #ccc;
    margin-top: 30px;
    padding-top: 4px;
    font-size: 9px;
    color: #888;
    font-weight: 700;
  }

  /* Footer */
  .receipt-footer {
    text-align: center;
    padding-top: 10px;
    border-top: 1px dashed #ccc;
    margin-top: 14px;
    font-size: 8px;
    color: #aaa;
  }

  @media print {
    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .receipt-container { border-color: #1a1a2e; }
  }
</style>
</head>
<body>
  <div class="receipt-container">
    <div class="receipt-header">
      <div class="receipt-logo"> <span></span></div>
      <div class="receipt-subtitle">${p?"  ":"   "}</div>
      <div class="receipt-type">${Qh(n)}</div>
    </div>

    <div class="receipt-meta">
      <div>
        <span> : </span>
        <span class="receipt-num">${d}</span>
      </div>
      <div>${h} - ${m}</div>
    </div>

    <div class="client-section">
      <div class="client-row">
        <span class="client-label"> </span>
        <span class="client-value">${e.clientName||"-"}</span>
      </div>
      <div class="client-row">
        <span class="client-label"> </span>
        <span class="client-value" style="direction:ltr">${e.clientPhone||"-"}</span>
      </div>
      <div class="client-row">
        <span class="client-label"> </span>
        <span class="client-value">${e.title||e.servicePackage||"-"}</span>
      </div>
      <div class="client-row">
        <span class="client-label"> </span>
        <span class="client-value">${e.shootDate?new Date(e.shootDate).toLocaleDateString("ar-IQ"):"-"}</span>
      </div>
    </div>

    <div class="amount-section">
      <div class="amount-label"> </div>
      <div class="amount-value">${zt(r,s)}</div>
      ${a?`<div class="amount-desc">${a}</div>`:""}
    </div>

    <div class="financial-details">
      <div class="fin-row">
        <span class="fin-label">  </span>
        <span class="fin-value">${zt(e.totalAmount,e.currency)}</span>
      </div>
      <div class="fin-row">
        <span class="fin-label"> </span>
        <span class="fin-value paid">${zt(e.paidAmount,e.currency)}</span>
      </div>
      <div class="fin-row total-row">
        <span class="fin-label"> </span>
        <span class="fin-value ${u>0?"remaining":"paid"}">${zt(u,e.currency)}</span>
      </div>
    </div>

    <div class="signatures">
      <div class="sig-box">
        <div class="sig-line"> </div>
      </div>
      <div class="sig-box">
        <div class="sig-line"> </div>
      </div>
    </div>

    <div class="receipt-footer">
        -   |       
    </div>
  </div>
</body>
</html>`,y=window.open("","_blank");y&&(y.document.write(w),y.document.close(),setTimeout(()=>y.print(),400))},Rd={initiatePayment:async(t,e,n="Photography Service")=>{if(!t||t<=0)throw new Error("      ");if(t>1e7)throw new Error("   -   10  ");if(!e||e.trim().length===0)throw new Error("  ");const{data:r,error:s}=await H.functions.invoke("zaincash",{body:{action:"init",amount:t,orderId:e,serviceType:n}});if(s)throw console.error("ZainCash Init Error:",s),s;return r},checkStatus:async t=>{const{data:e,error:n}=await H.functions.invoke("zaincash",{body:{action:"check",transactionId:t}});if(n)throw console.error("ZainCash Check Error:",n),n;return e}},uy=({booking:t,onPaymentSuccess:e})=>{const[n,r]=x.useState(!1),[s,a]=x.useState(null),[c,l]=x.useState(t.zainCashTransactionId||null),d=async()=>{try{r(!0);const m=t.totalAmount-t.paidAmount;if(m<=0){z.error("  ");return}const u=await Rd.initiatePayment(m,t.id,t.servicePackage);a(u.url),l(u.id),window.electronAPI?window.electronAPI.openExternal(u.url):window.open(u.url,"_blank"),z.success("   ")}catch(m){z.error("    "),console.error(m)}finally{r(!1)}},h=async()=>{if(c)try{r(!0);const m=await Rd.checkStatus(c);m.status==="success"||m.status==="completed"?(z.success("  !"),e(c),a(null)):m.status==="pending"?z.info("     ..."):z.error(` : ${m.status}`)}catch{z.error("    ")}finally{r(!1)}};return t.totalAmount-t.paidAmount<=0?null:i.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[i.jsx("h4",{className:"text-xs font-bold text-gray-400 mb-3",children:"  (ZainCash)"}),!s&&!c?i.jsxs("button",{onClick:d,disabled:n,className:"w-full py-2.5 bg-gray-900 hover:bg-black text-white rounded-xl font-bold text-xs transition-colors flex items-center justify-center gap-2",children:[n?i.jsx(dr,{size:14,className:"animate-spin"}):i.jsx(zu,{size:14}),"   "]}):i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"p-3 bg-amber-50 text-amber-800 text-xs rounded-lg border border-amber-100 flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"}),i.jsx("span",{children:" :      "})]}),i.jsxs("div",{className:"flex gap-2",children:[s&&i.jsxs("button",{onClick:()=>window.open(s,"_blank"),className:"flex-1 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-bold text-xs flex items-center justify-center gap-1",children:[i.jsx(ym,{size:12}),"  "]}),i.jsxs("button",{onClick:h,disabled:n,className:"flex-1 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold text-xs flex items-center justify-center gap-1",children:[n?i.jsx(dr,{size:12,className:"animate-spin"}):i.jsx(Fi,{size:12}),"  "]})]})]})]})};function Fs(t){return typeof t>"u"||t===void 0}function tn(t){return typeof t=="string"}function Fl(t){return typeof t=="number"}function Kc(t){return typeof t=="boolean"}function Uu(t){return t===null}function hy(t){return t instanceof Date}function qu(t){return typeof t=="bigint"}function bn(t){return typeof t=="function"}function ur(t){return typeof t=="object"&&t!==null}function f(t){return Object.freeze(t)}function Ec(t){return ns(t)?t:[t]}function ns(t){return Array.isArray(t)}function In(t){return t}const Re=f({is(t){return t.kind==="AlterTableNode"},create(t){return f({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return f({...t,...e})},cloneWithColumnAlteration(t,e){return f({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),$e=f({is(t){return t.kind==="IdentifierNode"},create(t){return f({kind:"IdentifierNode",name:t})}}),$r=f({is(t){return t.kind==="CreateIndexNode"},create(t){return f({kind:"CreateIndexNode",name:$e.create(t)})},cloneWith(t,e){return f({...t,...e})},cloneWithColumns(t,e){return f({...t,columns:[...t.columns||[],...e]})}}),Fm=f({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return f({kind:"CreateSchemaNode",schema:$e.create(t),...e})},cloneWith(t,e){return f({...t,...e})}}),fy=["preserve rows","delete rows","drop"],jn=f({is(t){return t.kind==="CreateTableNode"},create(t){return f({kind:"CreateTableNode",table:t,columns:f([])})},cloneWithColumn(t,e){return f({...t,columns:f([...t.columns,e])})},cloneWithConstraint(t,e){return f({...t,constraints:t.constraints?f([...t.constraints,e]):f([e])})},cloneWithFrontModifier(t,e){return f({...t,frontModifiers:t.frontModifiers?f([...t.frontModifiers,e]):f([e])})},cloneWithEndModifier(t,e){return f({...t,endModifiers:t.endModifiers?f([...t.endModifiers,e]):f([e])})},cloneWith(t,e){return f({...t,...e})}}),rs=f({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return f({kind:"SchemableIdentifierNode",identifier:$e.create(t)})},createWithSchema(t,e){return f({kind:"SchemableIdentifierNode",schema:$e.create(t),identifier:$e.create(e)})}}),Ea=f({is(t){return t.kind==="DropIndexNode"},create(t,e){return f({kind:"DropIndexNode",name:rs.create(t),...e})},cloneWith(t,e){return f({...t,...e})}}),Ld=f({is(t){return t.kind==="DropSchemaNode"},create(t,e){return f({kind:"DropSchemaNode",schema:$e.create(t),...e})},cloneWith(t,e){return f({...t,...e})}}),$d=f({is(t){return t.kind==="DropTableNode"},create(t,e){return f({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return f({...t,...e})}}),is=f({is(t){return t.kind==="AliasNode"},create(t,e){return f({kind:"AliasNode",node:t,alias:e})}}),_r=f({is(t){return t.kind==="TableNode"},create(t){return f({kind:"TableNode",table:rs.create(t)})},createWithSchema(t,e){return f({kind:"TableNode",table:rs.createWithSchema(t,e)})}});function rn(t){return ur(t)&&bn(t.toOperationNode)}function Wm(t){return ur(t)&&"expressionType"in t&&rn(t)}function my(t){return ur(t)&&"expression"in t&&tn(t.alias)&&rn(t)}const Rr=f({is(t){return t.kind==="SelectModifierNode"},create(t,e){return f({kind:"SelectModifierNode",modifier:t,of:e})},createWithExpression(t){return f({kind:"SelectModifierNode",rawModifier:t})}}),Vs=f({is(t){return t.kind==="AndNode"},create(t,e){return f({kind:"AndNode",left:t,right:e})}}),ta=f({is(t){return t.kind==="OrNode"},create(t,e){return f({kind:"OrNode",left:t,right:e})}}),ld=f({is(t){return t.kind==="OnNode"},create(t){return f({kind:"OnNode",on:t})},cloneWithOperation(t,e,n){return f({...t,on:e==="And"?Vs.create(t.on,n):ta.create(t.on,n)})}}),Di=f({is(t){return t.kind==="JoinNode"},create(t,e){return f({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,n){return f({kind:"JoinNode",joinType:t,table:e,on:ld.create(n)})},cloneWithOn(t,e){return f({...t,on:t.on?ld.cloneWithOperation(t.on,"And",e):ld.create(e)})}}),Yo=f({is(t){return t.kind==="BinaryOperationNode"},create(t,e,n){return f({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:n})}}),py=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],gy=["+","-","*","/","%","^","&","|","#","<<",">>"],Um=["->","->>"],xy=[...py,...gy,"&&","||"],yy=["exists","not exists"],by=["not","-",...yy],wy=[...xy,...Um,...by,"between","between symmetric"],Qs=f({is(t){return t.kind==="OperatorNode"},create(t){return f({kind:"OperatorNode",operator:t})}});function Hh(t){return tn(t)&&Um.includes(t)}const bt=f({is(t){return t.kind==="ColumnNode"},create(t){return f({kind:"ColumnNode",column:$e.create(t)})}}),Vu=f({is(t){return t.kind==="SelectAllNode"},create(){return f({kind:"SelectAllNode"})}}),Wl=f({is(t){return t.kind==="ReferenceNode"},create(t,e){return f({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return f({kind:"ReferenceNode",table:t,column:Vu.create()})}});var So;class vy{constructor(e){j(this,So);k(this,So,e)}get dynamicReference(){return o(this,So)}get refType(){}toOperationNode(){return Jm(o(this,So))}}So=new WeakMap;function qm(t){return ur(t)&&rn(t)&&tn(t.dynamicReference)}const Kr=f({is(t){return t.kind==="OrderByItemNode"},create(t,e){return f({kind:"OrderByItemNode",orderBy:t,direction:e})},cloneWith(t,e){return f({...t,...e})}}),tt=f({is(t){return t.kind==="RawNode"},create(t,e){return f({kind:"RawNode",sqlFragments:f(t),parameters:f(e)})},createWithSql(t){return tt.create([t],[])},createWithChild(t){return tt.create(["",""],[t])},createWithChildren(t){return tt.create(new Array(t.length+1).fill(""),t)}}),Ny=f({is(t){return t.kind==="CollateNode"},create(t){return f({kind:"CollateNode",collation:$e.create(t)})}});var wr;const ai=class ai{constructor(e){j(this,wr);k(this,wr,f(e))}desc(){return new ai({node:Kr.cloneWith(o(this,wr).node,{direction:tt.createWithSql("desc")})})}asc(){return new ai({node:Kr.cloneWith(o(this,wr).node,{direction:tt.createWithSql("asc")})})}nullsLast(){return new ai({node:Kr.cloneWith(o(this,wr).node,{nulls:"last"})})}nullsFirst(){return new ai({node:Kr.cloneWith(o(this,wr).node,{nulls:"first"})})}collate(e){return new ai({node:Kr.cloneWith(o(this,wr).node,{collation:Ny.create(e)})})}toOperationNode(){return o(this,wr).node}};wr=new WeakMap;let Md=ai;const Jh=new Set;function na(t){Jh.has(t)||(Jh.add(t),console.log(t))}function Vm(t){return t==="asc"||t==="desc"}function Pi(t){if(t.length===2)return[dd(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?(na("orderBy(array) is deprecated, use multiple orderBy calls instead."),e.map(n=>dd(n))):[dd(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function dd(t,e){const n=Sy(t);if(Kr.is(n)){if(e)throw new Error("Cannot specify direction twice!");return n}return Qm(n,e)}function Sy(t){if(pc(t))return Wi(t);if(qm(t))return t.toOperationNode();const[e,n]=t.split(" ");return n?(na("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),Qm(ss(e),n)):ss(t)}function Qm(t,e){if(typeof e=="string"){if(!Vm(e))throw new Error(`Invalid order by direction: ${e}`);return Kr.create(t,tt.createWithSql(e))}if(Wm(e))return na("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),Kr.create(t,e.toOperationNode());const n=Kr.create(t);return e?e(new Md({node:n})).toOperationNode():n}const Yc=f({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return f({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return f({...t,traversal:e})}}),Hm=f({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return f({kind:"JSONOperatorChainNode",operator:t,values:f([])})},cloneWithValue(t,e){return f({...t,values:f([...t.values,e])})}}),Ca=f({is(t){return t.kind==="JSONPathNode"},create(t){return f({kind:"JSONPathNode",inOperator:t,pathLegs:f([])})},cloneWithLeg(t,e){return f({...t,pathLegs:f([...t.pathLegs,e])})}});function Jm(t){return tn(t)?ss(t):t.toOperationNode()}function Va(t){return ns(t)?t.map(e=>An(e)):[An(t)]}function An(t){return pc(t)?Wi(t):Jm(t)}function ky(t,e){const n=ss(t);if(Hh(e))return Yc.create(n,Hm.create(Qs.create(e)));const r=e.slice(0,-1);if(Hh(r))return Yc.create(n,Ca.create(Qs.create(r)));throw new Error(`Invalid JSON operator: ${e}`)}function ss(t){if(!t.includes("."))return Wl.create(bt.create(t));const n=t.split(".").map(Qu);if(n.length===3)return Ey(n);if(n.length===2)return Cy(n);throw new Error(`invalid column reference ${t}`)}function jy(t){const e=" as ";if(t.includes(e)){const[n,r]=t.split(e).map(Qu);return is.create(ss(n),$e.create(r))}else return ss(t)}function Zm(t){return bt.create(t)}function Xc(t){if(t.includes(" ")){const[n,r]=t.split(" ").map(Qu);if(!Vm(r))throw new Error(`invalid order direction "${r}" next to "${n}"`);return Pi([n,r])[0]}else return Zm(t)}function Ey(t){const[e,n,r]=t;return Wl.create(bt.create(r),_r.createWithSchema(e,n))}function Cy(t){const[e,n]=t;return Wl.create(bt.create(n),_r.create(e))}function Qu(t){return t.trim()}const Gm=f({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return f({kind:"PrimitiveValueListNode",values:f([...t])})}}),Ul=f({is(t){return t.kind==="ValueListNode"},create(t){return f({kind:"ValueListNode",values:f(t)})}}),Qn=f({is(t){return t.kind==="ValueNode"},create(t){return f({kind:"ValueNode",value:t})},createImmediate(t){return f({kind:"ValueNode",value:t,immediate:!0})}});function _y(t){return ns(t)?Oy(t):St(t)}function St(t){return pc(t)?Wi(t):Qn.create(t)}function Hu(t){return Fl(t)||Kc(t)||Uu(t)}function Ju(t){if(!Hu(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return Qn.createImmediate(t)}function Oy(t){return t.some(pc)?Ul.create(t.map(e=>St(e))):Gm.create(t)}const Yr=f({is(t){return t.kind==="ParensNode"},create(t){return f({kind:"ParensNode",node:t})}});function Ft(t){if(t.length===3)return Zu(t[0],t[1],t[2]);if(t.length===1)return St(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function Zu(t,e,n){return Iy(e)&&Km(n)?Yo.create(An(t),zd(e),Qn.createImmediate(n)):Yo.create(An(t),zd(e),_y(n))}function Ar(t,e,n){return Yo.create(An(t),zd(e),An(n))}function Zh(t,e){return el(Object.entries(t).filter(([,n])=>!Fs(n)).map(([n,r])=>Zu(n,Km(r)?"is":"=",r)),e)}function el(t,e,n=!0){const r=e==="and"?Vs.create:ta.create;if(t.length===0)return Yo.create(Qn.createImmediate(1),Qs.create("="),Qn.createImmediate(e==="and"?1:0));let s=Gh(t[0]);for(let a=1;a<t.length;++a)s=r(s,Gh(t[a]));return t.length>1&&n?Yr.create(s):s}function Iy(t){return t==="is"||t==="is not"}function Km(t){return Uu(t)||Kc(t)}function zd(t){if(tn(t)&&wy.includes(t))return Qs.create(t);if(rn(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function Gh(t){return rn(t)?t.toOperationNode():t}const Xo=f({is(t){return t.kind==="OrderByNode"},create(t){return f({kind:"OrderByNode",items:f([...t])})},cloneWithItems(t,e){return f({...t,items:f([...t.items,...e])})}}),Kh=f({is(t){return t.kind==="PartitionByNode"},create(t){return f({kind:"PartitionByNode",items:f(t)})},cloneWithItems(t,e){return f({...t,items:f([...t.items,...e])})}}),Bd=f({is(t){return t.kind==="OverNode"},create(){return f({kind:"OverNode"})},cloneWithOrderByItems(t,e){return f({...t,orderBy:t.orderBy?Xo.cloneWithItems(t.orderBy,e):Xo.create(e)})},cloneWithPartitionByItems(t,e){return f({...t,partitionBy:t.partitionBy?Kh.cloneWithItems(t.partitionBy,e):Kh.create(e)})}}),tl=f({is(t){return t.kind==="FromNode"},create(t){return f({kind:"FromNode",froms:f(t)})},cloneWithFroms(t,e){return f({...t,froms:f([...t.froms,...e])})}}),Yh=f({is(t){return t.kind==="GroupByNode"},create(t){return f({kind:"GroupByNode",items:f(t)})},cloneWithItems(t,e){return f({...t,items:f([...t.items,...e])})}}),Xh=f({is(t){return t.kind==="HavingNode"},create(t){return f({kind:"HavingNode",having:t})},cloneWithOperation(t,e,n){return f({...t,having:e==="And"?Vs.create(t.having,n):ta.create(t.having,n)})}}),Pt=f({is(t){return t.kind==="InsertQueryNode"},create(t,e,n){return f({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:n})},createWithoutInto(){return f({kind:"InsertQueryNode"})},cloneWith(t,e){return f({...t,...e})}}),Ym=f({is(t){return t.kind==="ListNode"},create(t){return f({kind:"ListNode",items:f(t)})}}),ho=f({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return f({kind:"UpdateQueryNode",table:t.length===1?t[0]:Ym.create(t),...e&&{with:e}})},createWithoutTable(){return f({kind:"UpdateQueryNode"})},cloneWithFromItems(t,e){return f({...t,from:t.from?tl.cloneWithFroms(t.from,e):tl.create(e)})},cloneWithUpdates(t,e){return f({...t,updates:t.updates?f([...t.updates,...e]):e})},cloneWithLimit(t,e){return f({...t,limit:e})}}),Fd=f({is(t){return t.kind==="UsingNode"},create(t){return f({kind:"UsingNode",tables:f(t)})},cloneWithTables(t,e){return f({...t,tables:f([...t.tables,...e])})}}),_a=f({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return f({kind:"DeleteQueryNode",from:tl.create(t),...e&&{with:e}})},cloneWithOrderByItems:(t,e)=>G.cloneWithOrderByItems(t,e),cloneWithoutOrderBy:t=>G.cloneWithoutOrderBy(t),cloneWithLimit(t,e){return f({...t,limit:e})},cloneWithoutLimit(t){return f({...t,limit:void 0})},cloneWithUsing(t,e){return f({...t,using:t.using!==void 0?Fd.cloneWithTables(t.using,e):Fd.create(e)})}}),gn=f({is(t){return t.kind==="WhereNode"},create(t){return f({kind:"WhereNode",where:t})},cloneWithOperation(t,e,n){return f({...t,where:e==="And"?Vs.create(t.where,n):ta.create(t.where,n)})}}),ef=f({is(t){return t.kind==="ReturningNode"},create(t){return f({kind:"ReturningNode",selections:f(t)})},cloneWithSelections(t,e){return f({...t,selections:t.selections?f([...t.selections,...e]):f(e)})}}),Ty=f({is(t){return t.kind==="ExplainNode"},create(t,e){return f({kind:"ExplainNode",format:t,options:e})}}),Ri=f({is(t){return t.kind==="WhenNode"},create(t){return f({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return f({...t,result:e})}}),Tr=f({is(t){return t.kind==="MergeQueryNode"},create(t,e){return f({kind:"MergeQueryNode",into:t,...e&&{with:e}})},cloneWithUsing(t,e){return f({...t,using:e})},cloneWithWhen(t,e){return f({...t,whens:t.whens?f([...t.whens,e]):f([e])})},cloneWithThen(t,e){return f({...t,whens:t.whens?f([...t.whens.slice(0,-1),Ri.cloneWithResult(t.whens[t.whens.length-1],e)]):void 0})}}),tf=f({is(t){return t.kind==="OutputNode"},create(t){return f({kind:"OutputNode",selections:f(t)})},cloneWithSelections(t,e){return f({...t,selections:t.selections?f([...t.selections,...e]):f(e)})}}),G=f({is(t){return qe.is(t)||Pt.is(t)||ho.is(t)||_a.is(t)||Tr.is(t)},cloneWithEndModifier(t,e){return f({...t,endModifiers:t.endModifiers?f([...t.endModifiers,e]):f([e])})},cloneWithWhere(t,e){return f({...t,where:t.where?gn.cloneWithOperation(t.where,"And",e):gn.create(e)})},cloneWithJoin(t,e){return f({...t,joins:t.joins?f([...t.joins,e]):f([e])})},cloneWithReturning(t,e){return f({...t,returning:t.returning?ef.cloneWithSelections(t.returning,e):ef.create(e)})},cloneWithoutReturning(t){return f({...t,returning:void 0})},cloneWithoutWhere(t){return f({...t,where:void 0})},cloneWithExplain(t,e,n){return f({...t,explain:Ty.create(e,n==null?void 0:n.toOperationNode())})},cloneWithTop(t,e){return f({...t,top:e})},cloneWithOutput(t,e){return f({...t,output:t.output?tf.cloneWithSelections(t.output,e):tf.create(e)})},cloneWithOrderByItems(t,e){return f({...t,orderBy:t.orderBy?Xo.cloneWithItems(t.orderBy,e):Xo.create(e)})},cloneWithoutOrderBy(t){return f({...t,orderBy:void 0})}}),qe=f({is(t){return t.kind==="SelectQueryNode"},create(t){return f({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return f({kind:"SelectQueryNode",from:tl.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return f({...t,selections:t.selections?f([...t.selections,...e]):f(e)})},cloneWithDistinctOn(t,e){return f({...t,distinctOn:t.distinctOn?f([...t.distinctOn,...e]):f(e)})},cloneWithFrontModifier(t,e){return f({...t,frontModifiers:t.frontModifiers?f([...t.frontModifiers,e]):f([e])})},cloneWithOrderByItems:(t,e)=>G.cloneWithOrderByItems(t,e),cloneWithGroupByItems(t,e){return f({...t,groupBy:t.groupBy?Yh.cloneWithItems(t.groupBy,e):Yh.create(e)})},cloneWithLimit(t,e){return f({...t,limit:e})},cloneWithOffset(t,e){return f({...t,offset:e})},cloneWithFetch(t,e){return f({...t,fetch:e})},cloneWithHaving(t,e){return f({...t,having:t.having?Xh.cloneWithOperation(t.having,"And",e):Xh.create(e)})},cloneWithSetOperations(t,e){return f({...t,setOperations:t.setOperations?f([...t.setOperations,...e]):f([...e])})},cloneWithoutSelections(t){return f({...t,selections:[]})},cloneWithoutLimit(t){return f({...t,limit:void 0})},cloneWithoutOffset(t){return f({...t,offset:void 0})},cloneWithoutOrderBy:t=>G.cloneWithoutOrderBy(t),cloneWithoutGroupBy(t){return f({...t,groupBy:void 0})}});var sr;const Da=class Da{constructor(e){j(this,sr);k(this,sr,f(e))}on(...e){return new Da({...o(this,sr),joinNode:Di.cloneWithOn(o(this,sr).joinNode,Ft(e))})}onRef(e,n,r){return new Da({...o(this,sr),joinNode:Di.cloneWithOn(o(this,sr).joinNode,Ar(e,n,r))})}onTrue(){return new Da({...o(this,sr),joinNode:Di.cloneWithOn(o(this,sr).joinNode,tt.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return o(this,sr).joinNode}};sr=new WeakMap;let Wd=Da;const Ay=f({is(t){return t.kind==="PartitionByItemNode"},create(t){return f({kind:"PartitionByItemNode",partitionBy:t})}});function Dy(t){return Va(t).map(Ay.create)}var Is;const Pa=class Pa{constructor(e){j(this,Is);k(this,Is,f(e))}orderBy(...e){return new Pa({overNode:Bd.cloneWithOrderByItems(o(this,Is).overNode,Pi(e))})}clearOrderBy(){return new Pa({overNode:G.cloneWithoutOrderBy(o(this,Is).overNode)})}partitionBy(e){return new Pa({overNode:Bd.cloneWithPartitionByItems(o(this,Is).overNode,Dy(e))})}$call(e){return e(this)}toOperationNode(){return o(this,Is).overNode}};Is=new WeakMap;let Ud=Pa;const Oa=f({is(t){return t.kind==="SelectionNode"},create(t){return f({kind:"SelectionNode",selection:t})},createSelectAll(){return f({kind:"SelectionNode",selection:Vu.create()})},createSelectAllFromTable(t){return f({kind:"SelectionNode",selection:Wl.createSelectAll(t)})}});function Dn(t){return bn(t)?Dn(t(ia())):ns(t)?t.map(e=>nf(e)):[nf(t)]}function nf(t){return tn(t)?Oa.create(jy(t)):qm(t)?Oa.create(t.toOperationNode()):Oa.create(fp(t))}function Hn(t){return t?Array.isArray(t)?t.map(rf):[rf(t)]:[Oa.createSelectAll()]}function rf(t){if(tn(t))return Oa.createSelectAllFromTable(ft(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const Py=f({is(t){return t.kind==="ValuesNode"},create(t){return f({kind:"ValuesNode",values:f(t)})}}),Ry=f({is(t){return t.kind==="DefaultInsertValueNode"},create(){return f({kind:"DefaultInsertValueNode"})}});function Xm(t){const e=bn(t)?t(ia()):t,n=ns(e)?e:f([e]);return Ly(n)}function Ly(t){const e=$y(t);return[f([...e.keys()].map(bt.create)),Py.create(t.map(n=>My(n,e)))]}function $y(t){const e=new Map;for(const n of t){const r=Object.keys(n);for(const s of r)!e.has(s)&&n[s]!==void 0&&e.set(s,e.size)}return e}function My(t,e){const n=Object.keys(t),r=Array.from({length:e.size});let s=!1,a=n.length;for(const l of n){const d=e.get(l);if(Fs(d)){a--;continue}const h=t[l];(Fs(h)||pc(h))&&(s=!0),r[d]=h}if(a<e.size||s){const l=Ry.create();return Ul.create(r.map(d=>Fs(d)?l:St(d)))}return Gm.create(r)}const ep=f({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return f({kind:"ColumnUpdateNode",column:t,value:e})}});function zy(...t){return t.length===2?[ep.create(An(t[0]),St(t[1]))]:Gu(t[0])}function Gu(t){const e=bn(t)?t(ia()):t;return Object.entries(e).filter(([n,r])=>r!==void 0).map(([n,r])=>ep.create(bt.create(n),St(r)))}const By=f({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return f({kind:"OnDuplicateKeyNode",updates:t})}});class Fy{constructor(e,n){kn(this,"insertId");kn(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=n}}class fc extends Error{constructor(n){super("no result");kn(this,"node");this.node=n}}function mc(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const On=f({is(t){return t.kind==="OnConflictNode"},create(){return f({kind:"OnConflictNode"})},cloneWith(t,e){return f({...t,...e})},cloneWithIndexWhere(t,e){return f({...t,indexWhere:t.indexWhere?gn.cloneWithOperation(t.indexWhere,"And",e):gn.create(e)})},cloneWithIndexOrWhere(t,e){return f({...t,indexWhere:t.indexWhere?gn.cloneWithOperation(t.indexWhere,"Or",e):gn.create(e)})},cloneWithUpdateWhere(t,e){return f({...t,updateWhere:t.updateWhere?gn.cloneWithOperation(t.updateWhere,"And",e):gn.create(e)})},cloneWithUpdateOrWhere(t,e){return f({...t,updateWhere:t.updateWhere?gn.cloneWithOperation(t.updateWhere,"Or",e):gn.create(e)})},cloneWithoutIndexWhere(t){return f({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return f({...t,updateWhere:void 0})}});var He;const zr=class zr{constructor(e){j(this,He);k(this,He,f(e))}column(e){const n=bt.create(e);return new zr({...o(this,He),onConflictNode:On.cloneWith(o(this,He).onConflictNode,{columns:o(this,He).onConflictNode.columns?f([...o(this,He).onConflictNode.columns,n]):f([n])})})}columns(e){const n=e.map(bt.create);return new zr({...o(this,He),onConflictNode:On.cloneWith(o(this,He).onConflictNode,{columns:o(this,He).onConflictNode.columns?f([...o(this,He).onConflictNode.columns,...n]):f(n)})})}constraint(e){return new zr({...o(this,He),onConflictNode:On.cloneWith(o(this,He).onConflictNode,{constraint:$e.create(e)})})}expression(e){return new zr({...o(this,He),onConflictNode:On.cloneWith(o(this,He).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new zr({...o(this,He),onConflictNode:On.cloneWithIndexWhere(o(this,He).onConflictNode,Ft(e))})}whereRef(e,n,r){return new zr({...o(this,He),onConflictNode:On.cloneWithIndexWhere(o(this,He).onConflictNode,Ar(e,n,r))})}clearWhere(){return new zr({...o(this,He),onConflictNode:On.cloneWithoutIndexWhere(o(this,He).onConflictNode)})}doNothing(){return new Wy({...o(this,He),onConflictNode:On.cloneWith(o(this,He).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Vd({...o(this,He),onConflictNode:On.cloneWith(o(this,He).onConflictNode,{updates:Gu(e)})})}$call(e){return e(this)}};He=new WeakMap;let qd=zr;var tc;class Wy{constructor(e){j(this,tc);k(this,tc,f(e))}toOperationNode(){return o(this,tc).onConflictNode}}tc=new WeakMap;var ir;const Ra=class Ra{constructor(e){j(this,ir);k(this,ir,f(e))}where(...e){return new Ra({...o(this,ir),onConflictNode:On.cloneWithUpdateWhere(o(this,ir).onConflictNode,Ft(e))})}whereRef(e,n,r){return new Ra({...o(this,ir),onConflictNode:On.cloneWithUpdateWhere(o(this,ir).onConflictNode,Ar(e,n,r))})}clearWhere(){return new Ra({...o(this,ir),onConflictNode:On.cloneWithoutUpdateWhere(o(this,ir).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return o(this,ir).onConflictNode}};ir=new WeakMap;let Vd=Ra;const Uy=f({is(t){return t.kind==="TopNode"},create(t,e){return f({kind:"TopNode",expression:t,modifiers:e})}});function ra(t,e){if(!Fl(t)&&!qu(t))throw new Error(`Invalid top expression: ${t}`);if(!Fs(e)&&!qy(e))throw new Error(`Invalid top modifiers: ${e}`);return Uy.create(t,e)}function qy(t){return t==="percent"||t==="with ties"||t==="percent with ties"}const Gi=f({is(t){return t.kind==="OrActionNode"},create(t){return f({kind:"OrActionNode",action:t})}});var te;const Ue=class Ue{constructor(e){j(this,te);k(this,te,f(e))}values(e){const[n,r]=Xm(e);return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{columns:n,values:r})})}columns(e){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{columns:f(e.map(bt.create))})})}expression(e){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{values:Wi(e)})})}defaultValues(){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{defaultValues:!0})})}modifyEnd(e){return new Ue({...o(this,te),queryNode:G.cloneWithEndModifier(o(this,te).queryNode,e.toOperationNode())})}ignore(){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{orAction:Gi.create("ignore")})})}orIgnore(){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{orAction:Gi.create("ignore")})})}orAbort(){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{orAction:Gi.create("abort")})})}orFail(){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{orAction:Gi.create("fail")})})}orReplace(){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{orAction:Gi.create("replace")})})}orRollback(){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{orAction:Gi.create("rollback")})})}top(e,n){return new Ue({...o(this,te),queryNode:G.cloneWithTop(o(this,te).queryNode,ra(e,n))})}onConflict(e){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{onConflict:e(new qd({onConflictNode:On.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Ue({...o(this,te),queryNode:Pt.cloneWith(o(this,te).queryNode,{onDuplicateKey:By.create(Gu(e))})})}returning(e){return new Ue({...o(this,te),queryNode:G.cloneWithReturning(o(this,te).queryNode,Dn(e))})}returningAll(){return new Ue({...o(this,te),queryNode:G.cloneWithReturning(o(this,te).queryNode,Hn())})}output(e){return new Ue({...o(this,te),queryNode:G.cloneWithOutput(o(this,te).queryNode,Dn(e))})}outputAll(e){return new Ue({...o(this,te),queryNode:G.cloneWithOutput(o(this,te).queryNode,Hn(e))})}clearReturning(){return new Ue({...o(this,te),queryNode:G.cloneWithoutReturning(o(this,te).queryNode)})}$call(e){return e(this)}$if(e,n){return e?n(this):new Ue({...o(this,te)})}$castTo(){return new Ue(o(this,te))}$narrowType(){return new Ue(o(this,te))}$assertType(){return new Ue(o(this,te))}withPlugin(e){return new Ue({...o(this,te),executor:o(this,te).executor.withPlugin(e)})}toOperationNode(){return o(this,te).executor.transformQuery(o(this,te).queryNode,o(this,te).queryId)}compile(){return o(this,te).executor.compileQuery(this.toOperationNode(),o(this,te).queryId)}async execute(){const e=this.compile(),n=await o(this,te).executor.executeQuery(e),{adapter:r}=o(this,te).executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?n.rows:[new Fy(n.insertId,n.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=fc){const n=await this.executeTakeFirst();if(n===void 0)throw mc(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=o(this,te).executor.stream(n,e);for await(const s of r)yield*s.rows}async explain(e,n){return await new Ue({...o(this,te),queryNode:G.cloneWithExplain(o(this,te).queryNode,e,n)}).execute()}};te=new WeakMap;let nl=Ue;class Vy{constructor(e){kn(this,"numDeletedRows");this.numDeletedRows=e}}const Ku=f({is(t){return t.kind==="LimitNode"},create(t){return f({kind:"LimitNode",limit:t})}});var oe,bi,Sa;const Ye=class Ye{constructor(e){j(this,bi);j(this,oe);k(this,oe,f(e))}where(...e){return new Ye({...o(this,oe),queryNode:G.cloneWithWhere(o(this,oe).queryNode,Ft(e))})}whereRef(e,n,r){return new Ye({...o(this,oe),queryNode:G.cloneWithWhere(o(this,oe).queryNode,Ar(e,n,r))})}clearWhere(){return new Ye({...o(this,oe),queryNode:G.cloneWithoutWhere(o(this,oe).queryNode)})}top(e,n){return new Ye({...o(this,oe),queryNode:G.cloneWithTop(o(this,oe).queryNode,ra(e,n))})}using(e){return new Ye({...o(this,oe),queryNode:_a.cloneWithUsing(o(this,oe).queryNode,fo(e))})}innerJoin(...e){return Q(this,bi,Sa).call(this,"InnerJoin",e)}leftJoin(...e){return Q(this,bi,Sa).call(this,"LeftJoin",e)}rightJoin(...e){return Q(this,bi,Sa).call(this,"RightJoin",e)}fullJoin(...e){return Q(this,bi,Sa).call(this,"FullJoin",e)}returning(e){return new Ye({...o(this,oe),queryNode:G.cloneWithReturning(o(this,oe).queryNode,Dn(e))})}returningAll(e){return new Ye({...o(this,oe),queryNode:G.cloneWithReturning(o(this,oe).queryNode,Hn(e))})}output(e){return new Ye({...o(this,oe),queryNode:G.cloneWithOutput(o(this,oe).queryNode,Dn(e))})}outputAll(e){return new Ye({...o(this,oe),queryNode:G.cloneWithOutput(o(this,oe).queryNode,Hn(e))})}clearReturning(){return new Ye({...o(this,oe),queryNode:G.cloneWithoutReturning(o(this,oe).queryNode)})}clearLimit(){return new Ye({...o(this,oe),queryNode:_a.cloneWithoutLimit(o(this,oe).queryNode)})}orderBy(...e){return new Ye({...o(this,oe),queryNode:G.cloneWithOrderByItems(o(this,oe).queryNode,Pi(e))})}clearOrderBy(){return new Ye({...o(this,oe),queryNode:G.cloneWithoutOrderBy(o(this,oe).queryNode)})}limit(e){return new Ye({...o(this,oe),queryNode:_a.cloneWithLimit(o(this,oe).queryNode,Ku.create(St(e)))})}modifyEnd(e){return new Ye({...o(this,oe),queryNode:G.cloneWithEndModifier(o(this,oe).queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,n){return e?n(this):new Ye({...o(this,oe)})}$castTo(){return new Ye(o(this,oe))}$narrowType(){return new Ye(o(this,oe))}$assertType(){return new Ye(o(this,oe))}withPlugin(e){return new Ye({...o(this,oe),executor:o(this,oe).executor.withPlugin(e)})}toOperationNode(){return o(this,oe).executor.transformQuery(o(this,oe).queryNode,o(this,oe).queryId)}compile(){return o(this,oe).executor.compileQuery(this.toOperationNode(),o(this,oe).queryId)}async execute(){const e=this.compile(),n=await o(this,oe).executor.executeQuery(e),{adapter:r}=o(this,oe).executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?n.rows:[new Vy(n.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=fc){const n=await this.executeTakeFirst();if(n===void 0)throw mc(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=o(this,oe).executor.stream(n,e);for await(const s of r)yield*s.rows}async explain(e,n){return await new Ye({...o(this,oe),queryNode:G.cloneWithExplain(o(this,oe).queryNode,e,n)}).execute()}};oe=new WeakMap,bi=new WeakSet,Sa=function(e,n){return new Ye({...o(this,oe),queryNode:G.cloneWithJoin(o(this,oe).queryNode,Vl(e,n))})};let Qd=Ye;class Qy{constructor(e,n){kn(this,"numUpdatedRows");kn(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=n}}var ae,wi,ka;const Xe=class Xe{constructor(e){j(this,wi);j(this,ae);k(this,ae,f(e))}where(...e){return new Xe({...o(this,ae),queryNode:G.cloneWithWhere(o(this,ae).queryNode,Ft(e))})}whereRef(e,n,r){return new Xe({...o(this,ae),queryNode:G.cloneWithWhere(o(this,ae).queryNode,Ar(e,n,r))})}clearWhere(){return new Xe({...o(this,ae),queryNode:G.cloneWithoutWhere(o(this,ae).queryNode)})}top(e,n){return new Xe({...o(this,ae),queryNode:G.cloneWithTop(o(this,ae).queryNode,ra(e,n))})}from(e){return new Xe({...o(this,ae),queryNode:ho.cloneWithFromItems(o(this,ae).queryNode,fo(e))})}innerJoin(...e){return Q(this,wi,ka).call(this,"InnerJoin",e)}leftJoin(...e){return Q(this,wi,ka).call(this,"LeftJoin",e)}rightJoin(...e){return Q(this,wi,ka).call(this,"RightJoin",e)}fullJoin(...e){return Q(this,wi,ka).call(this,"FullJoin",e)}orderBy(...e){return new Xe({...o(this,ae),queryNode:G.cloneWithOrderByItems(o(this,ae).queryNode,Pi(e))})}clearOrderBy(){return new Xe({...o(this,ae),queryNode:G.cloneWithoutOrderBy(o(this,ae).queryNode)})}limit(e){return new Xe({...o(this,ae),queryNode:ho.cloneWithLimit(o(this,ae).queryNode,Ku.create(St(e)))})}set(...e){return new Xe({...o(this,ae),queryNode:ho.cloneWithUpdates(o(this,ae).queryNode,zy(...e))})}returning(e){return new Xe({...o(this,ae),queryNode:G.cloneWithReturning(o(this,ae).queryNode,Dn(e))})}returningAll(e){return new Xe({...o(this,ae),queryNode:G.cloneWithReturning(o(this,ae).queryNode,Hn(e))})}output(e){return new Xe({...o(this,ae),queryNode:G.cloneWithOutput(o(this,ae).queryNode,Dn(e))})}outputAll(e){return new Xe({...o(this,ae),queryNode:G.cloneWithOutput(o(this,ae).queryNode,Hn(e))})}modifyEnd(e){return new Xe({...o(this,ae),queryNode:G.cloneWithEndModifier(o(this,ae).queryNode,e.toOperationNode())})}clearReturning(){return new Xe({...o(this,ae),queryNode:G.cloneWithoutReturning(o(this,ae).queryNode)})}$call(e){return e(this)}$if(e,n){return e?n(this):new Xe({...o(this,ae)})}$castTo(){return new Xe(o(this,ae))}$narrowType(){return new Xe(o(this,ae))}$assertType(){return new Xe(o(this,ae))}withPlugin(e){return new Xe({...o(this,ae),executor:o(this,ae).executor.withPlugin(e)})}toOperationNode(){return o(this,ae).executor.transformQuery(o(this,ae).queryNode,o(this,ae).queryId)}compile(){return o(this,ae).executor.compileQuery(this.toOperationNode(),o(this,ae).queryId)}async execute(){const e=this.compile(),n=await o(this,ae).executor.executeQuery(e),{adapter:r}=o(this,ae).executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?n.rows:[new Qy(n.numAffectedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=fc){const n=await this.executeTakeFirst();if(n===void 0)throw mc(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=o(this,ae).executor.stream(n,e);for await(const s of r)yield*s.rows}async explain(e,n){return await new Xe({...o(this,ae),queryNode:G.cloneWithExplain(o(this,ae).queryNode,e,n)}).execute()}};ae=new WeakMap,wi=new WeakSet,ka=function(e,n){return new Xe({...o(this,ae),queryNode:G.cloneWithJoin(o(this,ae).queryNode,Vl(e,n))})};let rl=Xe;const sf=f({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return f({kind:"CommonTableExpressionNameNode",table:_r.create(t),columns:e?f(e.map(bt.create)):void 0})}}),sl=f({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return f({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return f({...t,...e})}});var Ur;const Nl=class Nl{constructor(e){j(this,Ur);k(this,Ur,f(e))}materialized(){return new Nl({...o(this,Ur),node:sl.cloneWith(o(this,Ur).node,{materialized:!0})})}notMaterialized(){return new Nl({...o(this,Ur),node:sl.cloneWith(o(this,Ur).node,{materialized:!1})})}toOperationNode(){return o(this,Ur).node}};Ur=new WeakMap;let Hd=Nl;function of(t,e){const n=e(sb()).toOperationNode();return bn(t)?t(Hy(n)).toOperationNode():sl.create(tp(t),n)}function Hy(t){return e=>new Hd({node:sl.create(tp(e),t)})}function tp(t){if(t.includes("(")){const e=t.split(/[\(\)]/),n=e[0],r=e[1].split(",").map(s=>s.trim());return sf.create(n,r)}else return sf.create(t)}const Cc=f({is(t){return t.kind==="WithNode"},create(t,e){return f({kind:"WithNode",expressions:f([t]),...e})},cloneWithExpression(t,e){return f({...t,expressions:f([...t.expressions,e])})}}),af=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Jy(t){let e="";for(let n=0;n<t;++n)e+=Zy();return e}function Zy(){return af[~~(Math.random()*af.length)]}function Ee(){return new Gy}var ko;class Gy{constructor(){j(this,ko)}get queryId(){return o(this,ko)===void 0&&k(this,ko,Jy(8)),o(this,ko)}}ko=new WeakMap;var Sl;class np{constructor(){kn(this,"nodeStack",[]);j(this,Sl,f({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)}))}transformNode(e,n){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e,n);return this.nodeStack.pop(),f(r)}transformNodeImpl(e,n){return o(this,Sl)[e.kind](e,n)}transformNodeList(e,n){return e&&f(e.map(r=>this.transformNode(r,n)))}transformSelectQuery(e,n){return{kind:"SelectQueryNode",from:this.transformNode(e.from,n),selections:this.transformNodeList(e.selections,n),distinctOn:this.transformNodeList(e.distinctOn,n),joins:this.transformNodeList(e.joins,n),groupBy:this.transformNode(e.groupBy,n),orderBy:this.transformNode(e.orderBy,n),where:this.transformNode(e.where,n),frontModifiers:this.transformNodeList(e.frontModifiers,n),endModifiers:this.transformNodeList(e.endModifiers,n),limit:this.transformNode(e.limit,n),offset:this.transformNode(e.offset,n),with:this.transformNode(e.with,n),having:this.transformNode(e.having,n),explain:this.transformNode(e.explain,n),setOperations:this.transformNodeList(e.setOperations,n),fetch:this.transformNode(e.fetch,n),top:this.transformNode(e.top,n)}}transformSelection(e,n){return{kind:"SelectionNode",selection:this.transformNode(e.selection,n)}}transformColumn(e,n){return{kind:"ColumnNode",column:this.transformNode(e.column,n)}}transformAlias(e,n){return{kind:"AliasNode",node:this.transformNode(e.node,n),alias:this.transformNode(e.alias,n)}}transformTable(e,n){return{kind:"TableNode",table:this.transformNode(e.table,n)}}transformFrom(e,n){return{kind:"FromNode",froms:this.transformNodeList(e.froms,n)}}transformReference(e,n){return{kind:"ReferenceNode",column:this.transformNode(e.column,n),table:this.transformNode(e.table,n)}}transformAnd(e,n){return{kind:"AndNode",left:this.transformNode(e.left,n),right:this.transformNode(e.right,n)}}transformOr(e,n){return{kind:"OrNode",left:this.transformNode(e.left,n),right:this.transformNode(e.right,n)}}transformValueList(e,n){return{kind:"ValueListNode",values:this.transformNodeList(e.values,n)}}transformParens(e,n){return{kind:"ParensNode",node:this.transformNode(e.node,n)}}transformJoin(e,n){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table,n),on:this.transformNode(e.on,n)}}transformRaw(e,n){return{kind:"RawNode",sqlFragments:f([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters,n)}}transformWhere(e,n){return{kind:"WhereNode",where:this.transformNode(e.where,n)}}transformInsertQuery(e,n){return{kind:"InsertQueryNode",into:this.transformNode(e.into,n),columns:this.transformNodeList(e.columns,n),values:this.transformNode(e.values,n),returning:this.transformNode(e.returning,n),onConflict:this.transformNode(e.onConflict,n),onDuplicateKey:this.transformNode(e.onDuplicateKey,n),endModifiers:this.transformNodeList(e.endModifiers,n),with:this.transformNode(e.with,n),ignore:e.ignore,orAction:this.transformNode(e.orAction,n),replace:e.replace,explain:this.transformNode(e.explain,n),defaultValues:e.defaultValues,top:this.transformNode(e.top,n),output:this.transformNode(e.output,n)}}transformValues(e,n){return{kind:"ValuesNode",values:this.transformNodeList(e.values,n)}}transformDeleteQuery(e,n){return{kind:"DeleteQueryNode",from:this.transformNode(e.from,n),using:this.transformNode(e.using,n),joins:this.transformNodeList(e.joins,n),where:this.transformNode(e.where,n),returning:this.transformNode(e.returning,n),endModifiers:this.transformNodeList(e.endModifiers,n),with:this.transformNode(e.with,n),orderBy:this.transformNode(e.orderBy,n),limit:this.transformNode(e.limit,n),explain:this.transformNode(e.explain,n),top:this.transformNode(e.top,n),output:this.transformNode(e.output,n)}}transformReturning(e,n){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections,n)}}transformCreateTable(e,n){return{kind:"CreateTableNode",table:this.transformNode(e.table,n),columns:this.transformNodeList(e.columns,n),constraints:this.transformNodeList(e.constraints,n),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers,n),endModifiers:this.transformNodeList(e.endModifiers,n),selectQuery:this.transformNode(e.selectQuery,n)}}transformColumnDefinition(e,n){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column,n),dataType:this.transformNode(e.dataType,n),references:this.transformNode(e.references,n),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo,n),check:this.transformNode(e.check,n),generated:this.transformNode(e.generated,n),frontModifiers:this.transformNodeList(e.frontModifiers,n),endModifiers:this.transformNodeList(e.endModifiers,n),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e,n){return{kind:"AddColumnNode",column:this.transformNode(e.column,n)}}transformDropTable(e,n){return{kind:"DropTableNode",table:this.transformNode(e.table,n),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e,n){return{kind:"OrderByNode",items:this.transformNodeList(e.items,n)}}transformOrderByItem(e,n){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy,n),direction:this.transformNode(e.direction,n),collation:this.transformNode(e.collation,n),nulls:e.nulls}}transformGroupBy(e,n){return{kind:"GroupByNode",items:this.transformNodeList(e.items,n)}}transformGroupByItem(e,n){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy,n)}}transformUpdateQuery(e,n){return{kind:"UpdateQueryNode",table:this.transformNode(e.table,n),from:this.transformNode(e.from,n),joins:this.transformNodeList(e.joins,n),where:this.transformNode(e.where,n),updates:this.transformNodeList(e.updates,n),returning:this.transformNode(e.returning,n),endModifiers:this.transformNodeList(e.endModifiers,n),with:this.transformNode(e.with,n),explain:this.transformNode(e.explain,n),limit:this.transformNode(e.limit,n),top:this.transformNode(e.top,n),output:this.transformNode(e.output,n),orderBy:this.transformNode(e.orderBy,n)}}transformColumnUpdate(e,n){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column,n),value:this.transformNode(e.value,n)}}transformLimit(e,n){return{kind:"LimitNode",limit:this.transformNode(e.limit,n)}}transformOffset(e,n){return{kind:"OffsetNode",offset:this.transformNode(e.offset,n)}}transformOnConflict(e,n){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns,n),constraint:this.transformNode(e.constraint,n),indexExpression:this.transformNode(e.indexExpression,n),indexWhere:this.transformNode(e.indexWhere,n),updates:this.transformNodeList(e.updates,n),updateWhere:this.transformNode(e.updateWhere,n),doNothing:e.doNothing}}transformOnDuplicateKey(e,n){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates,n)}}transformCreateIndex(e,n){return{kind:"CreateIndexNode",name:this.transformNode(e.name,n),table:this.transformNode(e.table,n),columns:this.transformNodeList(e.columns,n),unique:e.unique,using:this.transformNode(e.using,n),ifNotExists:e.ifNotExists,where:this.transformNode(e.where,n),nullsNotDistinct:e.nullsNotDistinct}}transformList(e,n){return{kind:"ListNode",items:this.transformNodeList(e.items,n)}}transformDropIndex(e,n){return{kind:"DropIndexNode",name:this.transformNode(e.name,n),table:this.transformNode(e.table,n),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e,n){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns,n),name:this.transformNode(e.name,n),deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformUniqueConstraint(e,n){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns,n),name:this.transformNode(e.name,n),nullsNotDistinct:e.nullsNotDistinct,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformForeignKeyConstraint(e,n){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns,n),references:this.transformNode(e.references,n),name:this.transformNode(e.name,n),onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformSetOperation(e,n){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression,n),all:e.all}}transformReferences(e,n){return{kind:"ReferencesNode",table:this.transformNode(e.table,n),columns:this.transformNodeList(e.columns,n),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e,n){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression,n),name:this.transformNode(e.name,n)}}transformWith(e,n){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions,n),recursive:e.recursive}}transformCommonTableExpression(e,n){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name,n),materialized:e.materialized,expression:this.transformNode(e.expression,n)}}transformCommonTableExpressionName(e,n){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table,n),columns:this.transformNodeList(e.columns,n)}}transformHaving(e,n){return{kind:"HavingNode",having:this.transformNode(e.having,n)}}transformCreateSchema(e,n){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema,n),ifNotExists:e.ifNotExists}}transformDropSchema(e,n){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema,n),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e,n){return{kind:"AlterTableNode",table:this.transformNode(e.table,n),renameTo:this.transformNode(e.renameTo,n),setSchema:this.transformNode(e.setSchema,n),columnAlterations:this.transformNodeList(e.columnAlterations,n),addConstraint:this.transformNode(e.addConstraint,n),dropConstraint:this.transformNode(e.dropConstraint,n),renameConstraint:this.transformNode(e.renameConstraint,n),addIndex:this.transformNode(e.addIndex,n),dropIndex:this.transformNode(e.dropIndex,n)}}transformDropColumn(e,n){return{kind:"DropColumnNode",column:this.transformNode(e.column,n)}}transformRenameColumn(e,n){return{kind:"RenameColumnNode",column:this.transformNode(e.column,n),renameTo:this.transformNode(e.renameTo,n)}}transformAlterColumn(e,n){return{kind:"AlterColumnNode",column:this.transformNode(e.column,n),dataType:this.transformNode(e.dataType,n),dataTypeExpression:this.transformNode(e.dataTypeExpression,n),setDefault:this.transformNode(e.setDefault,n),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e,n){return{kind:"ModifyColumnNode",column:this.transformNode(e.column,n)}}transformAddConstraint(e,n){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint,n)}}transformDropConstraint(e,n){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName,n),ifExists:e.ifExists,modifier:e.modifier}}transformRenameConstraint(e,n){return{kind:"RenameConstraintNode",oldName:this.transformNode(e.oldName,n),newName:this.transformNode(e.newName,n)}}transformCreateView(e,n){return{kind:"CreateViewNode",name:this.transformNode(e.name,n),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns,n),as:this.transformNode(e.as,n)}}transformRefreshMaterializedView(e,n){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(e.name,n),concurrently:e.concurrently,withNoData:e.withNoData}}transformDropView(e,n){return{kind:"DropViewNode",name:this.transformNode(e.name,n),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e,n){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression,n)}}transformDefaultValue(e,n){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue,n)}}transformOn(e,n){return{kind:"OnNode",on:this.transformNode(e.on,n)}}transformSelectModifier(e,n){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier,n),of:this.transformNodeList(e.of,n)}}transformCreateType(e,n){return{kind:"CreateTypeNode",name:this.transformNode(e.name,n),enum:this.transformNode(e.enum,n)}}transformDropType(e,n){return{kind:"DropTypeNode",name:this.transformNode(e.name,n),ifExists:e.ifExists}}transformExplain(e,n){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options,n)}}transformSchemableIdentifier(e,n){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema,n),identifier:this.transformNode(e.identifier,n)}}transformAggregateFunction(e,n){return{kind:"AggregateFunctionNode",func:e.func,aggregated:this.transformNodeList(e.aggregated,n),distinct:e.distinct,orderBy:this.transformNode(e.orderBy,n),withinGroup:this.transformNode(e.withinGroup,n),filter:this.transformNode(e.filter,n),over:this.transformNode(e.over,n)}}transformOver(e,n){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy,n),partitionBy:this.transformNode(e.partitionBy,n)}}transformPartitionBy(e,n){return{kind:"PartitionByNode",items:this.transformNodeList(e.items,n)}}transformPartitionByItem(e,n){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy,n)}}transformBinaryOperation(e,n){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand,n),operator:this.transformNode(e.operator,n),rightOperand:this.transformNode(e.rightOperand,n)}}transformUnaryOperation(e,n){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator,n),operand:this.transformNode(e.operand,n)}}transformUsing(e,n){return{kind:"UsingNode",tables:this.transformNodeList(e.tables,n)}}transformFunction(e,n){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments,n)}}transformCase(e,n){return{kind:"CaseNode",value:this.transformNode(e.value,n),when:this.transformNodeList(e.when,n),else:this.transformNode(e.else,n),isStatement:e.isStatement}}transformWhen(e,n){return{kind:"WhenNode",condition:this.transformNode(e.condition,n),result:this.transformNode(e.result,n)}}transformJSONReference(e,n){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference,n),traversal:this.transformNode(e.traversal,n)}}transformJSONPath(e,n){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator,n),pathLegs:this.transformNodeList(e.pathLegs,n)}}transformJSONPathLeg(e,n){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e,n){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator,n),values:this.transformNodeList(e.values,n)}}transformTuple(e,n){return{kind:"TupleNode",values:this.transformNodeList(e.values,n)}}transformMergeQuery(e,n){return{kind:"MergeQueryNode",into:this.transformNode(e.into,n),using:this.transformNode(e.using,n),whens:this.transformNodeList(e.whens,n),with:this.transformNode(e.with,n),top:this.transformNode(e.top,n),endModifiers:this.transformNodeList(e.endModifiers,n),output:this.transformNode(e.output,n),returning:this.transformNode(e.returning,n)}}transformMatched(e,n){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e,n){return{kind:"AddIndexNode",name:this.transformNode(e.name,n),columns:this.transformNodeList(e.columns,n),unique:e.unique,using:this.transformNode(e.using,n),ifNotExists:e.ifNotExists}}transformCast(e,n){return{kind:"CastNode",expression:this.transformNode(e.expression,n),dataType:this.transformNode(e.dataType,n)}}transformFetch(e,n){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount,n),modifier:e.modifier}}transformTop(e,n){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e,n){return{kind:"OutputNode",selections:this.transformNodeList(e.selections,n)}}transformDataType(e,n){return e}transformSelectAll(e,n){return e}transformIdentifier(e,n){return e}transformValue(e,n){return e}transformPrimitiveValueList(e,n){return e}transformOperator(e,n){return e}transformDefaultInsertValue(e,n){return e}transformOrAction(e,n){return e}transformCollate(e,n){return e}}Sl=new WeakMap;const Ky=f({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),Yy={json_agg:!0,to_json:!0};var jo,vi,Ni,Ze,Jd,rp,sp,ip,Mr,$c,op;class Xy extends np{constructor(n){super();j(this,Ze);j(this,jo);j(this,vi,new Set);j(this,Ni,new Set);k(this,jo,n)}transformNodeImpl(n,r){if(!Q(this,Ze,rp).call(this,n))return super.transformNodeImpl(n,r);const s=Q(this,Ze,ip).call(this,n);for(const l of s)o(this,Ni).add(l);const a=Q(this,Ze,sp).call(this,n);for(const l of a)o(this,vi).add(l);const c=super.transformNodeImpl(n,r);for(const l of a)o(this,vi).delete(l);for(const l of s)o(this,Ni).delete(l);return c}transformSchemableIdentifier(n,r){const s=super.transformSchemableIdentifier(n,r);return s.schema||!o(this,vi).has(n.identifier.name)?s:{...s,schema:$e.create(o(this,jo))}}transformReferences(n,r){const s=super.transformReferences(n,r);return s.table.table.schema?s:{...s,table:_r.createWithSchema(o(this,jo),s.table.table.identifier.name)}}transformAggregateFunction(n,r){return{...super.transformAggregateFunction({...n,aggregated:[]},r),aggregated:Q(this,Ze,Jd).call(this,n,r,"aggregated")}}transformFunction(n,r){return{...super.transformFunction({...n,arguments:[]},r),arguments:Q(this,Ze,Jd).call(this,n,r,"arguments")}}transformSelectModifier(n,r){var s;return{...super.transformSelectModifier({...n,of:void 0},r),of:(s=n.of)==null?void 0:s.map(a=>_r.is(a)&&!a.table.schema?{...a,table:this.transformIdentifier(a.table.identifier,r)}:this.transformNode(a,r))}}}jo=new WeakMap,vi=new WeakMap,Ni=new WeakMap,Ze=new WeakSet,Jd=function(n,r,s){return Yy[n.func]?n[s].map(a=>!_r.is(a)||a.table.schema?this.transformNode(a,r):{...a,table:this.transformIdentifier(a.table.identifier,r)}):this.transformNodeList(n[s],r)},rp=function(n){return n.kind in Ky},sp=function(n){const r=new Set;if("name"in n&&n.name&&rs.is(n.name)&&Q(this,Ze,$c).call(this,n.name,r),"from"in n&&n.from)for(const s of n.from.froms)Q(this,Ze,Mr).call(this,s,r);if("into"in n&&n.into&&Q(this,Ze,Mr).call(this,n.into,r),"table"in n&&n.table&&Q(this,Ze,Mr).call(this,n.table,r),"joins"in n&&n.joins)for(const s of n.joins)Q(this,Ze,Mr).call(this,s.table,r);return"using"in n&&n.using&&(Di.is(n.using)?Q(this,Ze,Mr).call(this,n.using.table,r):Q(this,Ze,Mr).call(this,n.using,r)),r},ip=function(n){const r=new Set;return"with"in n&&n.with&&Q(this,Ze,op).call(this,n.with,r),r},Mr=function(n,r){if(_r.is(n))return Q(this,Ze,$c).call(this,n.table,r);if(is.is(n)&&_r.is(n.node))return Q(this,Ze,$c).call(this,n.node.table,r);if(Ym.is(n)){for(const s of n.items)Q(this,Ze,Mr).call(this,s,r);return}if(Fd.is(n)){for(const s of n.tables)Q(this,Ze,Mr).call(this,s,r);return}},$c=function(n,r){const s=n.identifier.name;!o(this,vi).has(s)&&!o(this,Ni).has(s)&&r.add(s)},op=function(n,r){for(const s of n.expressions){const a=s.name.table.table.identifier.name;o(this,Ni).has(a)||r.add(a)}};var nc;class sa{constructor(e){j(this,nc);k(this,nc,new Xy(e))}transformQuery(e){return o(this,nc).transformNode(e.node,e.queryId)}async transformResult(e){return e.result}}nc=new WeakMap;const eb=f({is(t){return t.kind==="MatchedNode"},create(t,e=!1){return f({kind:"MatchedNode",not:t,bySource:e})}});function cf(t,e,n){return Ri.create(el([eb.create(!t.isMatched,t.bySource),...e&&e.length>0?[e.length===3&&n?Ar(e[0],e[1],e[2]):Ft(e)]:[]],"and",!1))}function Ia(t){return tn(t)?tt.create([t],[]):rn(t)?t.toOperationNode():t}var rc,Eo,Co;class lf{constructor(){j(this,rc);j(this,Eo);j(this,Co);kn(this,"resolve",e=>{o(this,Eo)&&o(this,Eo).call(this,e)});kn(this,"reject",e=>{o(this,Co)&&o(this,Co).call(this,e)});k(this,rc,new Promise((e,n)=>{k(this,Co,n),k(this,Eo,e)}))}get promise(){return o(this,rc)}}rc=new WeakMap,Eo=new WeakMap,Co=new WeakMap;async function ap(t){const e=new lf,n=new lf;return t.provideConnection(async r=>(e.resolve(r),await n.promise)).catch(r=>e.reject(r)),f({connection:await e.promise,release:n.resolve})}const tb=f([]);var Si,sc,Zd;class cp{constructor(e=tb){j(this,sc);j(this,Si);k(this,Si,e)}get plugins(){return o(this,Si)}transformQuery(e,n){for(const r of o(this,Si)){const s=r.transformQuery({node:e,queryId:n});if(s.kind===e.kind)e=s;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${s.kind}`].join(" "))}return e}async executeQuery(e){return await this.provideConnection(async n=>{const r=await n.executeQuery(e);return"numUpdatedOrDeletedRows"in r&&na("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await Q(this,sc,Zd).call(this,r,e.queryId)})}async*stream(e,n){const{connection:r,release:s}=await ap(this);try{for await(const a of r.streamQuery(e,n))yield await Q(this,sc,Zd).call(this,a,e.queryId)}finally{s()}}}Si=new WeakMap,sc=new WeakSet,Zd=async function(e,n){for(const r of o(this,Si))e=await r.transformResult({result:e,queryId:n});return e};class so extends cp{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new so([...this.plugins,e])}withPlugins(e){return new so([...this.plugins,...e])}withPluginAtFront(e){return new so([e,...this.plugins])}withoutPlugins(){return new so([])}}const ql=new so;class nb{constructor(e){kn(this,"numChangedRows");this.numChangedRows=e}}var Tt;const ys=class ys{constructor(e){j(this,Tt);k(this,Tt,f(e))}modifyEnd(e){return new ys({...o(this,Tt),queryNode:G.cloneWithEndModifier(o(this,Tt).queryNode,e.toOperationNode())})}top(e,n){return new ys({...o(this,Tt),queryNode:G.cloneWithTop(o(this,Tt).queryNode,ra(e,n))})}using(...e){return new Ws({...o(this,Tt),queryNode:Tr.cloneWithUsing(o(this,Tt).queryNode,Vl("Using",e))})}returning(e){return new ys({...o(this,Tt),queryNode:G.cloneWithReturning(o(this,Tt).queryNode,Dn(e))})}returningAll(e){return new ys({...o(this,Tt),queryNode:G.cloneWithReturning(o(this,Tt).queryNode,Hn(e))})}output(e){return new ys({...o(this,Tt),queryNode:G.cloneWithOutput(o(this,Tt).queryNode,Dn(e))})}outputAll(e){return new ys({...o(this,Tt),queryNode:G.cloneWithOutput(o(this,Tt).queryNode,Hn(e))})}};Tt=new WeakMap;let Gd=ys;var Be,Tn,Mc,ri;const Br=class Br{constructor(e){j(this,Tn);j(this,Be);k(this,Be,f(e))}modifyEnd(e){return new Br({...o(this,Be),queryNode:G.cloneWithEndModifier(o(this,Be).queryNode,e.toOperationNode())})}top(e,n){return new Br({...o(this,Be),queryNode:G.cloneWithTop(o(this,Be).queryNode,ra(e,n))})}whenMatched(){return Q(this,Tn,Mc).call(this,[])}whenMatchedAnd(...e){return Q(this,Tn,Mc).call(this,e)}whenMatchedAndRef(e,n,r){return Q(this,Tn,Mc).call(this,[e,n,r],!0)}whenNotMatched(){return Q(this,Tn,ri).call(this,[])}whenNotMatchedAnd(...e){return Q(this,Tn,ri).call(this,e)}whenNotMatchedAndRef(e,n,r){return Q(this,Tn,ri).call(this,[e,n,r],!0)}whenNotMatchedBySource(){return Q(this,Tn,ri).call(this,[],!1,!0)}whenNotMatchedBySourceAnd(...e){return Q(this,Tn,ri).call(this,e,!1,!0)}whenNotMatchedBySourceAndRef(e,n,r){return Q(this,Tn,ri).call(this,[e,n,r],!0,!0)}returning(e){return new Br({...o(this,Be),queryNode:G.cloneWithReturning(o(this,Be).queryNode,Dn(e))})}returningAll(e){return new Br({...o(this,Be),queryNode:G.cloneWithReturning(o(this,Be).queryNode,Hn(e))})}output(e){return new Br({...o(this,Be),queryNode:G.cloneWithOutput(o(this,Be).queryNode,Dn(e))})}outputAll(e){return new Br({...o(this,Be),queryNode:G.cloneWithOutput(o(this,Be).queryNode,Hn(e))})}$call(e){return e(this)}$if(e,n){return e?n(this):new Br({...o(this,Be)})}toOperationNode(){return o(this,Be).executor.transformQuery(o(this,Be).queryNode,o(this,Be).queryId)}compile(){return o(this,Be).executor.compileQuery(this.toOperationNode(),o(this,Be).queryId)}async execute(){const e=this.compile(),n=await o(this,Be).executor.executeQuery(e),{adapter:r}=o(this,Be).executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?n.rows:[new nb(n.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=fc){const n=await this.executeTakeFirst();if(n===void 0)throw mc(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}};Be=new WeakMap,Tn=new WeakSet,Mc=function(e,n){return new df({...o(this,Be),queryNode:Tr.cloneWithWhen(o(this,Be).queryNode,cf({isMatched:!0},e,n))})},ri=function(e,n=!1,r=!1){const s={...o(this,Be),queryNode:Tr.cloneWithWhen(o(this,Be).queryNode,cf({isMatched:!1,bySource:r},e,n))},a=r?df:rb;return new a(s)};let Ws=Br;var or;class df{constructor(e){j(this,or);k(this,or,f(e))}thenDelete(){return new Ws({...o(this,or),queryNode:Tr.cloneWithThen(o(this,or).queryNode,Ia("delete"))})}thenDoNothing(){return new Ws({...o(this,or),queryNode:Tr.cloneWithThen(o(this,or).queryNode,Ia("do nothing"))})}thenUpdate(e){return new Ws({...o(this,or),queryNode:Tr.cloneWithThen(o(this,or).queryNode,Ia(e(new rl({queryId:o(this,or).queryId,executor:ql,queryNode:ho.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(n=>n.set(...e))}}or=new WeakMap;var Ts;class rb{constructor(e){j(this,Ts);k(this,Ts,f(e))}thenDoNothing(){return new Ws({...o(this,Ts),queryNode:Tr.cloneWithThen(o(this,Ts).queryNode,Ia("do nothing"))})}thenInsertValues(e){const[n,r]=Xm(e);return new Ws({...o(this,Ts),queryNode:Tr.cloneWithThen(o(this,Ts).queryNode,Ia(Pt.cloneWith(Pt.createWithoutInto(),{columns:n,values:r})))})}}Ts=new WeakMap;var Te;const ci=class ci{constructor(e){j(this,Te);k(this,Te,f(e))}selectFrom(e){return eu({queryId:Ee(),executor:o(this,Te).executor,queryNode:qe.createFrom(fo(e),o(this,Te).withNode)})}selectNoFrom(e){return eu({queryId:Ee(),executor:o(this,Te).executor,queryNode:qe.cloneWithSelections(qe.create(o(this,Te).withNode),Dn(e))})}insertInto(e){return new nl({queryId:Ee(),executor:o(this,Te).executor,queryNode:Pt.create(ft(e),o(this,Te).withNode)})}replaceInto(e){return new nl({queryId:Ee(),executor:o(this,Te).executor,queryNode:Pt.create(ft(e),o(this,Te).withNode,!0)})}deleteFrom(e){return new Qd({queryId:Ee(),executor:o(this,Te).executor,queryNode:_a.create(fo(e),o(this,Te).withNode)})}updateTable(e){return new rl({queryId:Ee(),executor:o(this,Te).executor,queryNode:ho.create(fo(e),o(this,Te).withNode)})}mergeInto(e){return new Gd({queryId:Ee(),executor:o(this,Te).executor,queryNode:Tr.create(mp(e),o(this,Te).withNode)})}with(e,n){const r=of(e,n);return new ci({...o(this,Te),withNode:o(this,Te).withNode?Cc.cloneWithExpression(o(this,Te).withNode,r):Cc.create(r)})}withRecursive(e,n){const r=of(e,n);return new ci({...o(this,Te),withNode:o(this,Te).withNode?Cc.cloneWithExpression(o(this,Te).withNode,r):Cc.create(r,{recursive:!0})})}withPlugin(e){return new ci({...o(this,Te),executor:o(this,Te).executor.withPlugin(e)})}withoutPlugins(){return new ci({...o(this,Te),executor:o(this,Te).executor.withoutPlugins()})}withSchema(e){return new ci({...o(this,Te),executor:o(this,Te).executor.withPluginAtFront(new sa(e))})}};Te=new WeakMap;let il=ci;function sb(){return new il({executor:ql})}function ib(t,e){return new Wd({joinNode:Di.create(t,Qa(e))})}function ob(){return new Ud({overNode:Bd.create()})}function Vl(t,e){if(e.length===3)return cb(t,e[0],e[1],e[2]);if(e.length===2)return ab(t,e[0],e[1]);if(e.length===1)return lb(t,e[0]);throw new Error("not implemented")}function ab(t,e,n){return n(ib(t,e)).toOperationNode()}function cb(t,e,n,r){return Di.createWithOn(t,Qa(e),Ar(n,"=",r))}function lb(t,e){return Di.create(t,Qa(e))}const db=f({is(t){return t.kind==="OffsetNode"},create(t){return f({kind:"OffsetNode",offset:t})}}),ub=f({is(t){return t.kind==="GroupByItemNode"},create(t){return f({kind:"GroupByItemNode",groupBy:t})}});function hb(t){return t=bn(t)?t(ia()):t,Va(t).map(ub.create)}const lp=f({is(t){return t.kind==="SetOperationNode"},create(t,e,n){return f({kind:"SetOperationNode",operator:t,expression:e,all:n})}});function Ki(t,e,n){return bn(e)&&(e=e(Xu())),ns(e)||(e=[e]),e.map(r=>lp.create(t,Wi(r),n))}var qr;const kl=class kl{constructor(e){j(this,qr);k(this,qr,e)}get expressionType(){}as(e){return new Yu(this,e)}or(...e){return new Kd(ta.create(o(this,qr),Ft(e)))}and(...e){return new Yd(Vs.create(o(this,qr),Ft(e)))}$castTo(){return new kl(o(this,qr))}$notNull(){return new kl(o(this,qr))}toOperationNode(){return o(this,qr)}};qr=new WeakMap;let Ve=kl;var _o,As;class Yu{constructor(e,n){j(this,_o);j(this,As);k(this,_o,e),k(this,As,n)}get expression(){return o(this,_o)}get alias(){return o(this,As)}toOperationNode(){return is.create(o(this,_o).toOperationNode(),rn(o(this,As))?o(this,As).toOperationNode():$e.create(o(this,As)))}}_o=new WeakMap,As=new WeakMap;var ki;const jl=class jl{constructor(e){j(this,ki);k(this,ki,e)}get expressionType(){}as(e){return new Yu(this,e)}or(...e){return new jl(ta.create(o(this,ki),Ft(e)))}$castTo(){return new jl(o(this,ki))}toOperationNode(){return Yr.create(o(this,ki))}};ki=new WeakMap;let Kd=jl;var ji;const El=class El{constructor(e){j(this,ji);k(this,ji,e)}get expressionType(){}as(e){return new Yu(this,e)}and(...e){return new El(Vs.create(o(this,ji),Ft(e)))}$castTo(){return new El(o(this,ji))}toOperationNode(){return Yr.create(o(this,ji))}};ji=new WeakMap;let Yd=El;const fb=f({is(t){return t.kind==="FetchNode"},create(t,e){return{kind:"FetchNode",rowCount:Qn.create(t),modifier:e}}});function mb(t,e){if(!Fl(t)&&!qu(t))throw new Error(`Invalid fetch row count: ${t}`);if(!pb(e))throw new Error(`Invalid fetch modifier: ${e}`);return fb.create(t,e)}function pb(t){return t==="only"||t==="with ties"}var U,Cn,Yn;const ye=class ye{constructor(e){j(this,Cn);j(this,U);k(this,U,f(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new ye({...o(this,U),queryNode:G.cloneWithWhere(o(this,U).queryNode,Ft(e))})}whereRef(e,n,r){return new ye({...o(this,U),queryNode:G.cloneWithWhere(o(this,U).queryNode,Ar(e,n,r))})}having(...e){return new ye({...o(this,U),queryNode:qe.cloneWithHaving(o(this,U).queryNode,Ft(e))})}havingRef(e,n,r){return new ye({...o(this,U),queryNode:qe.cloneWithHaving(o(this,U).queryNode,Ar(e,n,r))})}select(e){return new ye({...o(this,U),queryNode:qe.cloneWithSelections(o(this,U).queryNode,Dn(e))})}distinctOn(e){return new ye({...o(this,U),queryNode:qe.cloneWithDistinctOn(o(this,U).queryNode,Va(e))})}modifyFront(e){return new ye({...o(this,U),queryNode:qe.cloneWithFrontModifier(o(this,U).queryNode,Rr.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new ye({...o(this,U),queryNode:G.cloneWithEndModifier(o(this,U).queryNode,Rr.createWithExpression(e.toOperationNode()))})}distinct(){return new ye({...o(this,U),queryNode:qe.cloneWithFrontModifier(o(this,U).queryNode,Rr.create("Distinct"))})}forUpdate(e){return new ye({...o(this,U),queryNode:G.cloneWithEndModifier(o(this,U).queryNode,Rr.create("ForUpdate",e?Ec(e).map(ft):void 0))})}forShare(e){return new ye({...o(this,U),queryNode:G.cloneWithEndModifier(o(this,U).queryNode,Rr.create("ForShare",e?Ec(e).map(ft):void 0))})}forKeyShare(e){return new ye({...o(this,U),queryNode:G.cloneWithEndModifier(o(this,U).queryNode,Rr.create("ForKeyShare",e?Ec(e).map(ft):void 0))})}forNoKeyUpdate(e){return new ye({...o(this,U),queryNode:G.cloneWithEndModifier(o(this,U).queryNode,Rr.create("ForNoKeyUpdate",e?Ec(e).map(ft):void 0))})}skipLocked(){return new ye({...o(this,U),queryNode:G.cloneWithEndModifier(o(this,U).queryNode,Rr.create("SkipLocked"))})}noWait(){return new ye({...o(this,U),queryNode:G.cloneWithEndModifier(o(this,U).queryNode,Rr.create("NoWait"))})}selectAll(e){return new ye({...o(this,U),queryNode:qe.cloneWithSelections(o(this,U).queryNode,Hn(e))})}innerJoin(...e){return Q(this,Cn,Yn).call(this,"InnerJoin",e)}leftJoin(...e){return Q(this,Cn,Yn).call(this,"LeftJoin",e)}rightJoin(...e){return Q(this,Cn,Yn).call(this,"RightJoin",e)}fullJoin(...e){return Q(this,Cn,Yn).call(this,"FullJoin",e)}crossJoin(...e){return Q(this,Cn,Yn).call(this,"CrossJoin",e)}innerJoinLateral(...e){return Q(this,Cn,Yn).call(this,"LateralInnerJoin",e)}leftJoinLateral(...e){return Q(this,Cn,Yn).call(this,"LateralLeftJoin",e)}crossJoinLateral(...e){return Q(this,Cn,Yn).call(this,"LateralCrossJoin",e)}crossApply(...e){return Q(this,Cn,Yn).call(this,"CrossApply",e)}outerApply(...e){return Q(this,Cn,Yn).call(this,"OuterApply",e)}orderBy(...e){return new ye({...o(this,U),queryNode:G.cloneWithOrderByItems(o(this,U).queryNode,Pi(e))})}groupBy(e){return new ye({...o(this,U),queryNode:qe.cloneWithGroupByItems(o(this,U).queryNode,hb(e))})}limit(e){return new ye({...o(this,U),queryNode:qe.cloneWithLimit(o(this,U).queryNode,Ku.create(St(e)))})}offset(e){return new ye({...o(this,U),queryNode:qe.cloneWithOffset(o(this,U).queryNode,db.create(St(e)))})}fetch(e,n="only"){return new ye({...o(this,U),queryNode:qe.cloneWithFetch(o(this,U).queryNode,mb(e,n))})}top(e,n){return new ye({...o(this,U),queryNode:G.cloneWithTop(o(this,U).queryNode,ra(e,n))})}union(e){return new ye({...o(this,U),queryNode:qe.cloneWithSetOperations(o(this,U).queryNode,Ki("union",e,!1))})}unionAll(e){return new ye({...o(this,U),queryNode:qe.cloneWithSetOperations(o(this,U).queryNode,Ki("union",e,!0))})}intersect(e){return new ye({...o(this,U),queryNode:qe.cloneWithSetOperations(o(this,U).queryNode,Ki("intersect",e,!1))})}intersectAll(e){return new ye({...o(this,U),queryNode:qe.cloneWithSetOperations(o(this,U).queryNode,Ki("intersect",e,!0))})}except(e){return new ye({...o(this,U),queryNode:qe.cloneWithSetOperations(o(this,U).queryNode,Ki("except",e,!1))})}exceptAll(e){return new ye({...o(this,U),queryNode:qe.cloneWithSetOperations(o(this,U).queryNode,Ki("except",e,!0))})}as(e){return new gb(this,e)}clearSelect(){return new ye({...o(this,U),queryNode:qe.cloneWithoutSelections(o(this,U).queryNode)})}clearWhere(){return new ye({...o(this,U),queryNode:G.cloneWithoutWhere(o(this,U).queryNode)})}clearLimit(){return new ye({...o(this,U),queryNode:qe.cloneWithoutLimit(o(this,U).queryNode)})}clearOffset(){return new ye({...o(this,U),queryNode:qe.cloneWithoutOffset(o(this,U).queryNode)})}clearOrderBy(){return new ye({...o(this,U),queryNode:G.cloneWithoutOrderBy(o(this,U).queryNode)})}clearGroupBy(){return new ye({...o(this,U),queryNode:qe.cloneWithoutGroupBy(o(this,U).queryNode)})}$call(e){return e(this)}$if(e,n){return e?n(this):new ye({...o(this,U)})}$castTo(){return new ye(o(this,U))}$narrowType(){return new ye(o(this,U))}$assertType(){return new ye(o(this,U))}$asTuple(){return new Ve(this.toOperationNode())}$asScalar(){return new Ve(this.toOperationNode())}withPlugin(e){return new ye({...o(this,U),executor:o(this,U).executor.withPlugin(e)})}toOperationNode(){return o(this,U).executor.transformQuery(o(this,U).queryNode,o(this,U).queryId)}compile(){return o(this,U).executor.compileQuery(this.toOperationNode(),o(this,U).queryId)}async execute(){const e=this.compile();return(await o(this,U).executor.executeQuery(e)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=fc){const n=await this.executeTakeFirst();if(n===void 0)throw mc(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=o(this,U).executor.stream(n,e);for await(const s of r)yield*s.rows}async explain(e,n){return await new ye({...o(this,U),queryNode:G.cloneWithExplain(o(this,U).queryNode,e,n)}).execute()}};U=new WeakMap,Cn=new WeakSet,Yn=function(e,n){return new ye({...o(this,U),queryNode:G.cloneWithJoin(o(this,U).queryNode,Vl(e,n))})};let Xd=ye;function eu(t){return new Xd(t)}var Oo,Io;class gb{constructor(e,n){j(this,Oo);j(this,Io);k(this,Oo,e),k(this,Io,n)}get expression(){return o(this,Oo)}get alias(){return o(this,Io)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return is.create(o(this,Oo).toOperationNode(),$e.create(o(this,Io)))}}Oo=new WeakMap,Io=new WeakMap;const Ss=f({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return f({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return f({...t,distinct:!0})},cloneWithOrderBy(t,e,n=!1){const r=n?"withinGroup":"orderBy";return f({...t,[r]:t[r]?Xo.cloneWithItems(t[r],e):Xo.create(e)})},cloneWithFilter(t,e){return f({...t,filter:t.filter?gn.cloneWithOperation(t.filter,"And",e):gn.create(e)})},cloneWithOrFilter(t,e){return f({...t,filter:t.filter?gn.cloneWithOperation(t.filter,"Or",e):gn.create(e)})},cloneWithOver(t,e){return f({...t,over:e})}}),uf=f({is(t){return t.kind==="FunctionNode"},create(t,e){return f({kind:"FunctionNode",func:t,arguments:e})}});var xt;const Xn=class Xn{constructor(e){j(this,xt);k(this,xt,f(e))}get expressionType(){}as(e){return new xb(this,e)}distinct(){return new Xn({...o(this,xt),aggregateFunctionNode:Ss.cloneWithDistinct(o(this,xt).aggregateFunctionNode)})}orderBy(...e){return new Xn({...o(this,xt),aggregateFunctionNode:G.cloneWithOrderByItems(o(this,xt).aggregateFunctionNode,Pi(e))})}clearOrderBy(){return new Xn({...o(this,xt),aggregateFunctionNode:G.cloneWithoutOrderBy(o(this,xt).aggregateFunctionNode)})}withinGroupOrderBy(...e){return new Xn({...o(this,xt),aggregateFunctionNode:Ss.cloneWithOrderBy(o(this,xt).aggregateFunctionNode,Pi(e),!0)})}filterWhere(...e){return new Xn({...o(this,xt),aggregateFunctionNode:Ss.cloneWithFilter(o(this,xt).aggregateFunctionNode,Ft(e))})}filterWhereRef(e,n,r){return new Xn({...o(this,xt),aggregateFunctionNode:Ss.cloneWithFilter(o(this,xt).aggregateFunctionNode,Ar(e,n,r))})}over(e){const n=ob();return new Xn({...o(this,xt),aggregateFunctionNode:Ss.cloneWithOver(o(this,xt).aggregateFunctionNode,(e?e(n):n).toOperationNode())})}$call(e){return e(this)}$castTo(){return new Xn(o(this,xt))}$notNull(){return new Xn(o(this,xt))}toOperationNode(){return o(this,xt).aggregateFunctionNode}};xt=new WeakMap;let Ta=Xn;var To,Ao;class xb{constructor(e,n){j(this,To);j(this,Ao);k(this,To,e),k(this,Ao,n)}get expression(){return o(this,To)}get alias(){return o(this,Ao)}toOperationNode(){return is.create(o(this,To).toOperationNode(),$e.create(o(this,Ao)))}}To=new WeakMap,Ao=new WeakMap;function dp(){const t=(n,r)=>new Ve(uf.create(n,Va(r??[]))),e=(n,r)=>new Ta({aggregateFunctionNode:Ss.create(n,r?Va(r):void 0)});return Object.assign(t,{agg:e,avg(n){return e("avg",[n])},coalesce(...n){return t("coalesce",n)},count(n){return e("count",[n])},countAll(n){return new Ta({aggregateFunctionNode:Ss.create("count",Hn(n))})},max(n){return e("max",[n])},min(n){return e("min",[n])},sum(n){return e("sum",[n])},any(n){return t("any",[n])},jsonAgg(n){return new Ta({aggregateFunctionNode:Ss.create("json_agg",[tn(n)?ft(n):n.toOperationNode()])})},toJson(n){return new Ve(uf.create("to_json",[tn(n)?ft(n):n.toOperationNode()]))}})}const yb=f({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return f({kind:"UnaryOperationNode",operator:t,operand:e})}});function bb(t,e){return yb.create(Qs.create(t),An(e))}const Ir=f({is(t){return t.kind==="CaseNode"},create(t){return f({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return f({...t,when:f(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return f({...t,when:t.when?f([...t.when.slice(0,-1),Ri.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return f({...t,...e})}});var Do;class up{constructor(e){j(this,Do);k(this,Do,f(e))}when(...e){return new hp({...o(this,Do),node:Ir.cloneWithWhen(o(this,Do).node,Ri.create(Ft(e)))})}}Do=new WeakMap;var Po;class hp{constructor(e){j(this,Po);k(this,Po,f(e))}then(e){return new wb({...o(this,Po),node:Ir.cloneWithThen(o(this,Po).node,Hu(e)?Ju(e):St(e))})}}Po=new WeakMap;var vr;class wb{constructor(e){j(this,vr);k(this,vr,f(e))}when(...e){return new hp({...o(this,vr),node:Ir.cloneWithWhen(o(this,vr).node,Ri.create(Ft(e)))})}else(e){return new vb({...o(this,vr),node:Ir.cloneWith(o(this,vr).node,{else:Hu(e)?Ju(e):St(e)})})}end(){return new Ve(Ir.cloneWith(o(this,vr).node,{isStatement:!1}))}endCase(){return new Ve(Ir.cloneWith(o(this,vr).node,{isStatement:!0}))}}vr=new WeakMap;var Ro;class vb{constructor(e){j(this,Ro);k(this,Ro,f(e))}end(){return new Ve(Ir.cloneWith(o(this,Ro).node,{isStatement:!1}))}endCase(){return new Ve(Ir.cloneWith(o(this,Ro).node,{isStatement:!0}))}}Ro=new WeakMap;const hf=f({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return f({kind:"JSONPathLegNode",type:t,value:e})}});var Nr,ic,nu;class tu{constructor(e){j(this,ic);j(this,Nr);k(this,Nr,e)}at(e){return Q(this,ic,nu).call(this,"ArrayLocation",e)}key(e){return Q(this,ic,nu).call(this,"Member",e)}}Nr=new WeakMap,ic=new WeakSet,nu=function(e,n){return Yc.is(o(this,Nr))?new ol(Yc.cloneWithTraversal(o(this,Nr),Ca.is(o(this,Nr).traversal)?Ca.cloneWithLeg(o(this,Nr).traversal,hf.create(e,n)):Hm.cloneWithValue(o(this,Nr).traversal,Qn.createImmediate(n)))):new ol(Ca.cloneWithLeg(o(this,Nr),hf.create(e,n)))};var Ei;const Cl=class Cl extends tu{constructor(n){super(n);j(this,Ei);k(this,Ei,n)}get expressionType(){}as(n){return new Nb(this,n)}$castTo(){return new Cl(o(this,Ei))}$notNull(){return new Cl(o(this,Ei))}toOperationNode(){return o(this,Ei)}};Ei=new WeakMap;let ol=Cl;var Lo,Ds;class Nb{constructor(e,n){j(this,Lo);j(this,Ds);k(this,Lo,e),k(this,Ds,n)}get expression(){return o(this,Lo)}get alias(){return o(this,Ds)}toOperationNode(){return is.create(o(this,Lo).toOperationNode(),rn(o(this,Ds))?o(this,Ds).toOperationNode():$e.create(o(this,Ds)))}}Lo=new WeakMap,Ds=new WeakMap;const ff=f({is(t){return t.kind==="TupleNode"},create(t){return f({kind:"TupleNode",values:f(t)})}}),Sb=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],kb=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],jb=f({is(t){return t.kind==="DataTypeNode"},create(t){return f({kind:"DataTypeNode",dataType:t})}});function Eb(t){return!!(Sb.includes(t)||kb.some(e=>e.test(t)))}function Li(t){if(rn(t))return t.toOperationNode();if(Eb(t))return jb.create(t);throw new Error(`invalid column data type ${JSON.stringify(t)}`)}const Cb=f({is(t){return t.kind==="CastNode"},create(t,e){return f({kind:"CastNode",expression:t,dataType:e})}});function Xu(t=ql){function e(s,a,c){return new Ve(Zu(s,a,c))}function n(s,a){return new Ve(bb(s,a))}const r=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(s){return eu({queryId:Ee(),executor:t,queryNode:qe.createFrom(fo(s))})},case(s){return new up({node:Ir.create(Fs(s)?void 0:An(s))})},ref(s,a){return Fs(a)?new Ve(ss(s)):new tu(ky(s,a))},jsonPath(){return new tu(Ca.create())},table(s){return new Ve(ft(s))},val(s){return new Ve(St(s))},refTuple(...s){return new Ve(ff.create(s.map(An)))},tuple(...s){return new Ve(ff.create(s.map(St)))},lit(s){return new Ve(Ju(s))},unary:n,not(s){return n("not",s)},exists(s){return n("exists",s)},neg(s){return n("-",s)},between(s,a,c){return new Ve(Yo.create(An(s),Qs.create("between"),Vs.create(St(a),St(c))))},betweenSymmetric(s,a,c){return new Ve(Yo.create(An(s),Qs.create("between symmetric"),Vs.create(St(a),St(c))))},and(s){return ns(s)?new Ve(el(s,"and")):new Ve(Zh(s,"and"))},or(s){return ns(s)?new Ve(el(s,"or")):new Ve(Zh(s,"or"))},parens(...s){const a=Ft(s);return Yr.is(a)?new Ve(a):new Ve(Yr.create(a))},cast(s,a){return new Ve(Cb.create(An(s),Li(a)))},withSchema(s){return Xu(t.withPluginAtFront(new sa(s)))}});return r.fn=dp(),r.eb=r,r}function ia(t){return Xu()}function Wi(t){if(rn(t))return t.toOperationNode();if(bn(t))return t(ia()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function fp(t){if(rn(t))return t.toOperationNode();if(bn(t))return t(ia()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function pc(t){return Wm(t)||my(t)||bn(t)}var $o;class _b{constructor(e){j(this,$o);k(this,$o,e)}get table(){return o(this,$o)}as(e){return new Ob(o(this,$o),e)}}$o=new WeakMap;var Mo,zo;class Ob{constructor(e,n){j(this,Mo);j(this,zo);k(this,Mo,e),k(this,zo,n)}get table(){return o(this,Mo)}get alias(){return o(this,zo)}toOperationNode(){return is.create(ft(o(this,Mo)),$e.create(o(this,zo)))}}Mo=new WeakMap,zo=new WeakMap;function Ib(t){return ur(t)&&rn(t)&&tn(t.table)&&tn(t.alias)}function fo(t){return ns(t)?t.map(e=>Qa(e)):[Qa(t)]}function Qa(t){return tn(t)?mp(t):Ib(t)?t.toOperationNode():fp(t)}function mp(t){const e=" as ";if(t.includes(e)){const[n,r]=t.split(e).map(pp);return is.create(ft(n),$e.create(r))}else return ft(t)}function ft(t){if(t.includes(".")){const[n,r]=t.split(".").map(pp);return _r.createWithSchema(n,r)}else return _r.create(t)}function pp(t){return t.trim()}const gp=f({is(t){return t.kind==="AddColumnNode"},create(t){return f({kind:"AddColumnNode",column:t})}}),et=f({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return f({kind:"ColumnDefinitionNode",column:bt.create(t),dataType:e})},cloneWithFrontModifier(t,e){return f({...t,frontModifiers:t.frontModifiers?f([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return f({...t,endModifiers:t.endModifiers?f([...t.endModifiers,e]):[e]})},cloneWith(t,e){return f({...t,...e})}}),xp=f({is(t){return t.kind==="DropColumnNode"},create(t){return f({kind:"DropColumnNode",column:bt.create(t)})}}),yp=f({is(t){return t.kind==="RenameColumnNode"},create(t,e){return f({kind:"RenameColumnNode",column:bt.create(t),renameTo:bt.create(e)})}}),eh=f({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return f({kind:"CheckConstraintNode",expression:t,name:e?$e.create(e):void 0})}}),Tb=["no action","restrict","cascade","set null","set default"],zc=f({is(t){return t.kind==="ReferencesNode"},create(t,e){return f({kind:"ReferencesNode",table:t,columns:f([...e])})},cloneWithOnDelete(t,e){return f({...t,onDelete:e})},cloneWithOnUpdate(t,e){return f({...t,onUpdate:e})}});function bp(t){return rn(t)?t.toOperationNode():Qn.createImmediate(t)}const _c=f({is(t){return t.kind==="GeneratedNode"},create(t){return f({kind:"GeneratedNode",...t})},createWithExpression(t){return f({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return f({...t,...e})}}),Ab=f({is(t){return t.kind==="DefaultValueNode"},create(t){return f({kind:"DefaultValueNode",defaultValue:t})}});function al(t){if(Tb.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var Ae;const gt=class gt{constructor(e){j(this,Ae);k(this,Ae,e)}autoIncrement(){return new gt(et.cloneWith(o(this,Ae),{autoIncrement:!0}))}identity(){return new gt(et.cloneWith(o(this,Ae),{identity:!0}))}primaryKey(){return new gt(et.cloneWith(o(this,Ae),{primaryKey:!0}))}references(e){const n=ss(e);if(!n.table||Vu.is(n.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new gt(et.cloneWith(o(this,Ae),{references:zc.create(n.table,[n.column])}))}onDelete(e){if(!o(this,Ae).references)throw new Error("on delete constraint can only be added for foreign keys");return new gt(et.cloneWith(o(this,Ae),{references:zc.cloneWithOnDelete(o(this,Ae).references,al(e))}))}onUpdate(e){if(!o(this,Ae).references)throw new Error("on update constraint can only be added for foreign keys");return new gt(et.cloneWith(o(this,Ae),{references:zc.cloneWithOnUpdate(o(this,Ae).references,al(e))}))}unique(){return new gt(et.cloneWith(o(this,Ae),{unique:!0}))}notNull(){return new gt(et.cloneWith(o(this,Ae),{notNull:!0}))}unsigned(){return new gt(et.cloneWith(o(this,Ae),{unsigned:!0}))}defaultTo(e){return new gt(et.cloneWith(o(this,Ae),{defaultTo:Ab.create(bp(e))}))}check(e){return new gt(et.cloneWith(o(this,Ae),{check:eh.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new gt(et.cloneWith(o(this,Ae),{generated:_c.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new gt(et.cloneWith(o(this,Ae),{generated:_c.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new gt(et.cloneWith(o(this,Ae),{generated:_c.create({identity:!0,byDefault:!0})}))}stored(){if(!o(this,Ae).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new gt(et.cloneWith(o(this,Ae),{generated:_c.cloneWith(o(this,Ae).generated,{stored:!0})}))}modifyFront(e){return new gt(et.cloneWithFrontModifier(o(this,Ae),e.toOperationNode()))}nullsNotDistinct(){return new gt(et.cloneWith(o(this,Ae),{nullsNotDistinct:!0}))}ifNotExists(){return new gt(et.cloneWith(o(this,Ae),{ifNotExists:!0}))}modifyEnd(e){return new gt(et.cloneWithEndModifier(o(this,Ae),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return o(this,Ae)}};Ae=new WeakMap;let $i=gt;const wp=f({is(t){return t.kind==="ModifyColumnNode"},create(t){return f({kind:"ModifyColumnNode",column:t})}}),ps=f({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,n,r){return f({kind:"ForeignKeyConstraintNode",columns:t,references:zc.create(e,n),name:r?$e.create(r):void 0})},cloneWith(t,e){return f({...t,...e})}});var ar;const bs=class bs{constructor(e){j(this,ar);k(this,ar,e)}onDelete(e){return new bs(ps.cloneWith(o(this,ar),{onDelete:al(e)}))}onUpdate(e){return new bs(ps.cloneWith(o(this,ar),{onUpdate:al(e)}))}deferrable(){return new bs(ps.cloneWith(o(this,ar),{deferrable:!0}))}notDeferrable(){return new bs(ps.cloneWith(o(this,ar),{deferrable:!1}))}initiallyDeferred(){return new bs(ps.cloneWith(o(this,ar),{initiallyDeferred:!0}))}initiallyImmediate(){return new bs(ps.cloneWith(o(this,ar),{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return o(this,ar)}};ar=new WeakMap;let cl=bs;const Bc=f({is(t){return t.kind==="AddConstraintNode"},create(t){return f({kind:"AddConstraintNode",constraint:t})}}),si=f({is(t){return t.kind==="UniqueConstraintNode"},create(t,e,n){return f({kind:"UniqueConstraintNode",columns:f(t.map(bt.create)),name:e?$e.create(e):void 0,nullsNotDistinct:n})},cloneWith(t,e){return f({...t,...e})}}),Fc=f({is(t){return t.kind==="DropConstraintNode"},create(t){return f({kind:"DropConstraintNode",constraintName:$e.create(t)})},cloneWith(t,e){return f({...t,...e})}}),pa=f({is(t){return t.kind==="AlterColumnNode"},create(t,e,n){return f({kind:"AlterColumnNode",column:bt.create(t),[e]:n})}});var Vr;class vp{constructor(e){j(this,Vr);k(this,Vr,e)}setDataType(e){return new ga(pa.create(o(this,Vr),"dataType",Li(e)))}setDefault(e){return new ga(pa.create(o(this,Vr),"setDefault",bp(e)))}dropDefault(){return new ga(pa.create(o(this,Vr),"dropDefault",!0))}setNotNull(){return new ga(pa.create(o(this,Vr),"setNotNull",!0))}dropNotNull(){return new ga(pa.create(o(this,Vr),"dropNotNull",!0))}$call(e){return e(this)}}Vr=new WeakMap;var oc;class ga{constructor(e){j(this,oc);k(this,oc,e)}toOperationNode(){return o(this,oc)}}oc=new WeakMap;var Sr;class Yi{constructor(e){j(this,Sr);k(this,Sr,f(e))}toOperationNode(){return o(this,Sr).executor.transformQuery(o(this,Sr).node,o(this,Sr).queryId)}compile(){return o(this,Sr).executor.compileQuery(this.toOperationNode(),o(this,Sr).queryId)}async execute(){await o(this,Sr).executor.executeQuery(this.compile())}}Sr=new WeakMap;var it;const ws=class ws{constructor(e){j(this,it);k(this,it,f(e))}onDelete(e){return new ws({...o(this,it),constraintBuilder:o(this,it).constraintBuilder.onDelete(e)})}onUpdate(e){return new ws({...o(this,it),constraintBuilder:o(this,it).constraintBuilder.onUpdate(e)})}deferrable(){return new ws({...o(this,it),constraintBuilder:o(this,it).constraintBuilder.deferrable()})}notDeferrable(){return new ws({...o(this,it),constraintBuilder:o(this,it).constraintBuilder.notDeferrable()})}initiallyDeferred(){return new ws({...o(this,it),constraintBuilder:o(this,it).constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new ws({...o(this,it),constraintBuilder:o(this,it).constraintBuilder.initiallyImmediate()})}$call(e){return e(this)}toOperationNode(){return o(this,it).executor.transformQuery(Re.cloneWithTableProps(o(this,it).node,{addConstraint:Bc.create(o(this,it).constraintBuilder.toOperationNode())}),o(this,it).queryId)}compile(){return o(this,it).executor.compileQuery(this.toOperationNode(),o(this,it).queryId)}async execute(){await o(this,it).executor.executeQuery(this.compile())}};it=new WeakMap;let ru=ws;var jt;const La=class La{constructor(e){j(this,jt);k(this,jt,f(e))}ifExists(){return new La({...o(this,jt),node:Re.cloneWithTableProps(o(this,jt).node,{dropConstraint:Fc.cloneWith(o(this,jt).node.dropConstraint,{ifExists:!0})})})}cascade(){return new La({...o(this,jt),node:Re.cloneWithTableProps(o(this,jt).node,{dropConstraint:Fc.cloneWith(o(this,jt).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new La({...o(this,jt),node:Re.cloneWithTableProps(o(this,jt).node,{dropConstraint:Fc.cloneWith(o(this,jt).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return o(this,jt).executor.transformQuery(o(this,jt).node,o(this,jt).queryId)}compile(){return o(this,jt).executor.compileQuery(this.toOperationNode(),o(this,jt).queryId)}async execute(){await o(this,jt).executor.executeQuery(this.compile())}};jt=new WeakMap;let ll=La;const io=f({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return f({kind:"PrimaryKeyConstraintNode",columns:f(t.map(bt.create)),name:e?$e.create(e):void 0})},cloneWith(t,e){return f({...t,...e})}}),eo=f({is(t){return t.kind==="AddIndexNode"},create(t){return f({kind:"AddIndexNode",name:$e.create(t)})},cloneWith(t,e){return f({...t,...e})},cloneWithColumns(t,e){return f({...t,columns:[...t.columns||[],...e]})}});var Ge;const li=class li{constructor(e){j(this,Ge);k(this,Ge,f(e))}unique(){return new li({...o(this,Ge),node:Re.cloneWithTableProps(o(this,Ge).node,{addIndex:eo.cloneWith(o(this,Ge).node.addIndex,{unique:!0})})})}column(e){return new li({...o(this,Ge),node:Re.cloneWithTableProps(o(this,Ge).node,{addIndex:eo.cloneWithColumns(o(this,Ge).node.addIndex,[Xc(e)])})})}columns(e){return new li({...o(this,Ge),node:Re.cloneWithTableProps(o(this,Ge).node,{addIndex:eo.cloneWithColumns(o(this,Ge).node.addIndex,e.map(Xc))})})}expression(e){return new li({...o(this,Ge),node:Re.cloneWithTableProps(o(this,Ge).node,{addIndex:eo.cloneWithColumns(o(this,Ge).node.addIndex,[e.toOperationNode()])})})}using(e){return new li({...o(this,Ge),node:Re.cloneWithTableProps(o(this,Ge).node,{addIndex:eo.cloneWith(o(this,Ge).node.addIndex,{using:tt.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return o(this,Ge).executor.transformQuery(o(this,Ge).node,o(this,Ge).queryId)}compile(){return o(this,Ge).executor.compileQuery(this.toOperationNode(),o(this,Ge).queryId)}async execute(){await o(this,Ge).executor.executeQuery(this.compile())}};Ge=new WeakMap;let su=li;var kr;const di=class di{constructor(e){j(this,kr);k(this,kr,e)}nullsNotDistinct(){return new di(si.cloneWith(o(this,kr),{nullsNotDistinct:!0}))}deferrable(){return new di(si.cloneWith(o(this,kr),{deferrable:!0}))}notDeferrable(){return new di(si.cloneWith(o(this,kr),{deferrable:!1}))}initiallyDeferred(){return new di(si.cloneWith(o(this,kr),{initiallyDeferred:!0}))}initiallyImmediate(){return new di(si.cloneWith(o(this,kr),{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return o(this,kr)}};kr=new WeakMap;let dl=di;var Qr;const ao=class ao{constructor(e){j(this,Qr);k(this,Qr,e)}deferrable(){return new ao(io.cloneWith(o(this,Qr),{deferrable:!0}))}notDeferrable(){return new ao(io.cloneWith(o(this,Qr),{deferrable:!1}))}initiallyDeferred(){return new ao(io.cloneWith(o(this,Qr),{initiallyDeferred:!0}))}initiallyImmediate(){return new ao(io.cloneWith(o(this,Qr),{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return o(this,Qr)}};Qr=new WeakMap;let ul=ao;var ac;class Np{constructor(e){j(this,ac);k(this,ac,e)}$call(e){return e(this)}toOperationNode(){return o(this,ac)}}ac=new WeakMap;const Db=f({is(t){return t.kind==="RenameConstraintNode"},create(t,e){return f({kind:"RenameConstraintNode",oldName:$e.create(t),newName:$e.create(e)})}});var je;class Pb{constructor(e){j(this,je);k(this,je,f(e))}renameTo(e){return new Yi({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{renameTo:ft(e)})})}setSchema(e){return new Yi({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{setSchema:$e.create(e)})})}alterColumn(e,n){const r=n(new vp(e));return new ii({...o(this,je),node:Re.cloneWithColumnAlteration(o(this,je).node,r.toOperationNode())})}dropColumn(e){return new ii({...o(this,je),node:Re.cloneWithColumnAlteration(o(this,je).node,xp.create(e))})}renameColumn(e,n){return new ii({...o(this,je),node:Re.cloneWithColumnAlteration(o(this,je).node,yp.create(e,n))})}addColumn(e,n,r=In){const s=r(new $i(et.create(e,Li(n))));return new ii({...o(this,je),node:Re.cloneWithColumnAlteration(o(this,je).node,gp.create(s.toOperationNode()))})}modifyColumn(e,n,r=In){const s=r(new $i(et.create(e,Li(n))));return new ii({...o(this,je),node:Re.cloneWithColumnAlteration(o(this,je).node,wp.create(s.toOperationNode()))})}addUniqueConstraint(e,n,r=In){const s=r(new dl(si.create(n,e)));return new Yi({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{addConstraint:Bc.create(s.toOperationNode())})})}addCheckConstraint(e,n,r=In){const s=r(new Np(eh.create(n.toOperationNode(),e)));return new Yi({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{addConstraint:Bc.create(s.toOperationNode())})})}addForeignKeyConstraint(e,n,r,s,a=In){const c=a(new cl(ps.create(n.map(bt.create),ft(r),s.map(bt.create),e)));return new ru({...o(this,je),constraintBuilder:c})}addPrimaryKeyConstraint(e,n,r=In){const s=r(new ul(io.create(n,e)));return new Yi({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{addConstraint:Bc.create(s.toOperationNode())})})}dropConstraint(e){return new ll({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{dropConstraint:Fc.create(e)})})}renameConstraint(e,n){return new ll({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{renameConstraint:Db.create(e,n)})})}addIndex(e){return new su({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{addIndex:eo.create(e)})})}dropIndex(e){return new Yi({...o(this,je),node:Re.cloneWithTableProps(o(this,je).node,{dropIndex:Ea.create(e)})})}$call(e){return e(this)}}je=new WeakMap;var Nt;const ui=class ui{constructor(e){j(this,Nt);k(this,Nt,f(e))}alterColumn(e,n){const r=n(new vp(e));return new ui({...o(this,Nt),node:Re.cloneWithColumnAlteration(o(this,Nt).node,r.toOperationNode())})}dropColumn(e){return new ui({...o(this,Nt),node:Re.cloneWithColumnAlteration(o(this,Nt).node,xp.create(e))})}renameColumn(e,n){return new ui({...o(this,Nt),node:Re.cloneWithColumnAlteration(o(this,Nt).node,yp.create(e,n))})}addColumn(e,n,r=In){const s=r(new $i(et.create(e,Li(n))));return new ui({...o(this,Nt),node:Re.cloneWithColumnAlteration(o(this,Nt).node,gp.create(s.toOperationNode()))})}modifyColumn(e,n,r=In){const s=r(new $i(et.create(e,Li(n))));return new ui({...o(this,Nt),node:Re.cloneWithColumnAlteration(o(this,Nt).node,wp.create(s.toOperationNode()))})}toOperationNode(){return o(this,Nt).executor.transformQuery(o(this,Nt).node,o(this,Nt).queryId)}compile(){return o(this,Nt).executor.compileQuery(this.toOperationNode(),o(this,Nt).queryId)}async execute(){await o(this,Nt).executor.executeQuery(this.compile())}};Nt=new WeakMap;let ii=ui;class Sp extends np{transformPrimitiveValueList(e){return Ul.create(e.values.map(Qn.createImmediate))}transformValue(e){return Qn.createImmediate(e.value)}}var Pe;const er=class er{constructor(e){j(this,Pe);k(this,Pe,f(e))}ifNotExists(){return new er({...o(this,Pe),node:$r.cloneWith(o(this,Pe).node,{ifNotExists:!0})})}unique(){return new er({...o(this,Pe),node:$r.cloneWith(o(this,Pe).node,{unique:!0})})}nullsNotDistinct(){return new er({...o(this,Pe),node:$r.cloneWith(o(this,Pe).node,{nullsNotDistinct:!0})})}on(e){return new er({...o(this,Pe),node:$r.cloneWith(o(this,Pe).node,{table:ft(e)})})}column(e){return new er({...o(this,Pe),node:$r.cloneWithColumns(o(this,Pe).node,[Xc(e)])})}columns(e){return new er({...o(this,Pe),node:$r.cloneWithColumns(o(this,Pe).node,e.map(Xc))})}expression(e){return new er({...o(this,Pe),node:$r.cloneWithColumns(o(this,Pe).node,[e.toOperationNode()])})}using(e){return new er({...o(this,Pe),node:$r.cloneWith(o(this,Pe).node,{using:tt.createWithSql(e)})})}where(...e){const n=new Sp;return new er({...o(this,Pe),node:G.cloneWithWhere(o(this,Pe).node,n.transformNode(Ft(e),o(this,Pe).queryId))})}$call(e){return e(this)}toOperationNode(){return o(this,Pe).executor.transformQuery(o(this,Pe).node,o(this,Pe).queryId)}compile(){return o(this,Pe).executor.compileQuery(this.toOperationNode(),o(this,Pe).queryId)}async execute(){await o(this,Pe).executor.executeQuery(this.compile())}};Pe=new WeakMap;let iu=er;var Bn;const hh=class hh{constructor(e){j(this,Bn);k(this,Bn,f(e))}ifNotExists(){return new hh({...o(this,Bn),node:Fm.cloneWith(o(this,Bn).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return o(this,Bn).executor.transformQuery(o(this,Bn).node,o(this,Bn).queryId)}compile(){return o(this,Bn).executor.compileQuery(this.toOperationNode(),o(this,Bn).queryId)}async execute(){await o(this,Bn).executor.executeQuery(this.compile())}};Bn=new WeakMap;let ou=hh;function Rb(t){if(fy.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var _e;const En=class En{constructor(e){j(this,_e);k(this,_e,f(e))}temporary(){return new En({...o(this,_e),node:jn.cloneWith(o(this,_e).node,{temporary:!0})})}onCommit(e){return new En({...o(this,_e),node:jn.cloneWith(o(this,_e).node,{onCommit:Rb(e)})})}ifNotExists(){return new En({...o(this,_e),node:jn.cloneWith(o(this,_e).node,{ifNotExists:!0})})}addColumn(e,n,r=In){const s=r(new $i(et.create(e,Li(n))));return new En({...o(this,_e),node:jn.cloneWithColumn(o(this,_e).node,s.toOperationNode())})}addPrimaryKeyConstraint(e,n,r=In){const s=r(new ul(io.create(n,e)));return new En({...o(this,_e),node:jn.cloneWithConstraint(o(this,_e).node,s.toOperationNode())})}addUniqueConstraint(e,n,r=In){const s=r(new dl(si.create(n,e)));return new En({...o(this,_e),node:jn.cloneWithConstraint(o(this,_e).node,s.toOperationNode())})}addCheckConstraint(e,n,r=In){const s=r(new Np(eh.create(n.toOperationNode(),e)));return new En({...o(this,_e),node:jn.cloneWithConstraint(o(this,_e).node,s.toOperationNode())})}addForeignKeyConstraint(e,n,r,s,a=In){const c=a(new cl(ps.create(n.map(bt.create),ft(r),s.map(bt.create),e)));return new En({...o(this,_e),node:jn.cloneWithConstraint(o(this,_e).node,c.toOperationNode())})}modifyFront(e){return new En({...o(this,_e),node:jn.cloneWithFrontModifier(o(this,_e).node,e.toOperationNode())})}modifyEnd(e){return new En({...o(this,_e),node:jn.cloneWithEndModifier(o(this,_e).node,e.toOperationNode())})}as(e){return new En({...o(this,_e),node:jn.cloneWith(o(this,_e).node,{selectQuery:Wi(e)})})}$call(e){return e(this)}toOperationNode(){return o(this,_e).executor.transformQuery(o(this,_e).node,o(this,_e).queryId)}compile(){return o(this,_e).executor.compileQuery(this.toOperationNode(),o(this,_e).queryId)}async execute(){await o(this,_e).executor.executeQuery(this.compile())}};_e=new WeakMap;let au=En;var Vt;const $a=class $a{constructor(e){j(this,Vt);k(this,Vt,f(e))}on(e){return new $a({...o(this,Vt),node:Ea.cloneWith(o(this,Vt).node,{table:ft(e)})})}ifExists(){return new $a({...o(this,Vt),node:Ea.cloneWith(o(this,Vt).node,{ifExists:!0})})}cascade(){return new $a({...o(this,Vt),node:Ea.cloneWith(o(this,Vt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return o(this,Vt).executor.transformQuery(o(this,Vt).node,o(this,Vt).queryId)}compile(){return o(this,Vt).executor.compileQuery(this.toOperationNode(),o(this,Vt).queryId)}async execute(){await o(this,Vt).executor.executeQuery(this.compile())}};Vt=new WeakMap;let cu=$a;var un;const _l=class _l{constructor(e){j(this,un);k(this,un,f(e))}ifExists(){return new _l({...o(this,un),node:Ld.cloneWith(o(this,un).node,{ifExists:!0})})}cascade(){return new _l({...o(this,un),node:Ld.cloneWith(o(this,un).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return o(this,un).executor.transformQuery(o(this,un).node,o(this,un).queryId)}compile(){return o(this,un).executor.compileQuery(this.toOperationNode(),o(this,un).queryId)}async execute(){await o(this,un).executor.executeQuery(this.compile())}};un=new WeakMap;let lu=_l;var hn;const Ol=class Ol{constructor(e){j(this,hn);k(this,hn,f(e))}ifExists(){return new Ol({...o(this,hn),node:$d.cloneWith(o(this,hn).node,{ifExists:!0})})}cascade(){return new Ol({...o(this,hn),node:$d.cloneWith(o(this,hn).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return o(this,hn).executor.transformQuery(o(this,hn).node,o(this,hn).queryId)}compile(){return o(this,hn).executor.compileQuery(this.toOperationNode(),o(this,hn).queryId)}async execute(){await o(this,hn).executor.executeQuery(this.compile())}};hn=new WeakMap;let du=Ol;const gs=f({is(t){return t.kind==="CreateViewNode"},create(t){return f({kind:"CreateViewNode",name:rs.create(t)})},cloneWith(t,e){return f({...t,...e})}});var Il;class Lb{constructor(){j(this,Il,new Sp)}transformQuery(e){return o(this,Il).transformNode(e.node,e.queryId)}transformResult(e){return Promise.resolve(e.result)}}Il=new WeakMap;var ht;const vs=class vs{constructor(e){j(this,ht);k(this,ht,f(e))}temporary(){return new vs({...o(this,ht),node:gs.cloneWith(o(this,ht).node,{temporary:!0})})}materialized(){return new vs({...o(this,ht),node:gs.cloneWith(o(this,ht).node,{materialized:!0})})}ifNotExists(){return new vs({...o(this,ht),node:gs.cloneWith(o(this,ht).node,{ifNotExists:!0})})}orReplace(){return new vs({...o(this,ht),node:gs.cloneWith(o(this,ht).node,{orReplace:!0})})}columns(e){return new vs({...o(this,ht),node:gs.cloneWith(o(this,ht).node,{columns:e.map(Zm)})})}as(e){const n=e.withPlugin(new Lb).toOperationNode();return new vs({...o(this,ht),node:gs.cloneWith(o(this,ht).node,{as:n})})}$call(e){return e(this)}toOperationNode(){return o(this,ht).executor.transformQuery(o(this,ht).node,o(this,ht).queryId)}compile(){return o(this,ht).executor.compileQuery(this.toOperationNode(),o(this,ht).queryId)}async execute(){await o(this,ht).executor.executeQuery(this.compile())}};ht=new WeakMap;let uu=vs;const Wc=f({is(t){return t.kind==="DropViewNode"},create(t){return f({kind:"DropViewNode",name:rs.create(t)})},cloneWith(t,e){return f({...t,...e})}});var Qt;const Ma=class Ma{constructor(e){j(this,Qt);k(this,Qt,f(e))}materialized(){return new Ma({...o(this,Qt),node:Wc.cloneWith(o(this,Qt).node,{materialized:!0})})}ifExists(){return new Ma({...o(this,Qt),node:Wc.cloneWith(o(this,Qt).node,{ifExists:!0})})}cascade(){return new Ma({...o(this,Qt),node:Wc.cloneWith(o(this,Qt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return o(this,Qt).executor.transformQuery(o(this,Qt).node,o(this,Qt).queryId)}compile(){return o(this,Qt).executor.compileQuery(this.toOperationNode(),o(this,Qt).queryId)}async execute(){await o(this,Qt).executor.executeQuery(this.compile())}};Qt=new WeakMap;let hu=Ma;const kp=f({is(t){return t.kind==="CreateTypeNode"},create(t){return f({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return f({...t,enum:Ul.create(e.map(Qn.createImmediate))})}});var Fn;const fh=class fh{constructor(e){j(this,Fn);k(this,Fn,f(e))}toOperationNode(){return o(this,Fn).executor.transformQuery(o(this,Fn).node,o(this,Fn).queryId)}asEnum(e){return new fh({...o(this,Fn),node:kp.cloneWithEnum(o(this,Fn).node,e)})}$call(e){return e(this)}compile(){return o(this,Fn).executor.compileQuery(this.toOperationNode(),o(this,Fn).queryId)}async execute(){await o(this,Fn).executor.executeQuery(this.compile())}};Fn=new WeakMap;let fu=fh;const jp=f({is(t){return t.kind==="DropTypeNode"},create(t){return f({kind:"DropTypeNode",name:t})},cloneWith(t,e){return f({...t,...e})}});var Wn;const mh=class mh{constructor(e){j(this,Wn);k(this,Wn,f(e))}ifExists(){return new mh({...o(this,Wn),node:jp.cloneWith(o(this,Wn).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return o(this,Wn).executor.transformQuery(o(this,Wn).node,o(this,Wn).queryId)}compile(){return o(this,Wn).executor.compileQuery(this.toOperationNode(),o(this,Wn).queryId)}async execute(){await o(this,Wn).executor.executeQuery(this.compile())}};Wn=new WeakMap;let mu=mh;function mf(t){if(t.includes(".")){const n=t.split(".").map($b);if(n.length===2)return rs.createWithSchema(n[0],n[1]);throw new Error(`invalid schemable identifier ${t}`)}else return rs.create(t)}function $b(t){return t.trim()}const Uc=f({is(t){return t.kind==="RefreshMaterializedViewNode"},create(t){return f({kind:"RefreshMaterializedViewNode",name:rs.create(t)})},cloneWith(t,e){return f({...t,...e})}});var Ht;const za=class za{constructor(e){j(this,Ht);k(this,Ht,f(e))}concurrently(){return new za({...o(this,Ht),node:Uc.cloneWith(o(this,Ht).node,{concurrently:!0,withNoData:!1})})}withData(){return new za({...o(this,Ht),node:Uc.cloneWith(o(this,Ht).node,{withNoData:!1})})}withNoData(){return new za({...o(this,Ht),node:Uc.cloneWith(o(this,Ht).node,{withNoData:!0,concurrently:!1})})}$call(e){return e(this)}toOperationNode(){return o(this,Ht).executor.transformQuery(o(this,Ht).node,o(this,Ht).queryId)}compile(){return o(this,Ht).executor.compileQuery(this.toOperationNode(),o(this,Ht).queryId)}async execute(){await o(this,Ht).executor.executeQuery(this.compile())}};Ht=new WeakMap;let pu=za;var Et;const Ba=class Ba{constructor(e){j(this,Et);k(this,Et,e)}createTable(e){return new au({queryId:Ee(),executor:o(this,Et),node:jn.create(ft(e))})}dropTable(e){return new du({queryId:Ee(),executor:o(this,Et),node:$d.create(ft(e))})}createIndex(e){return new iu({queryId:Ee(),executor:o(this,Et),node:$r.create(e)})}dropIndex(e){return new cu({queryId:Ee(),executor:o(this,Et),node:Ea.create(e)})}createSchema(e){return new ou({queryId:Ee(),executor:o(this,Et),node:Fm.create(e)})}dropSchema(e){return new lu({queryId:Ee(),executor:o(this,Et),node:Ld.create(e)})}alterTable(e){return new Pb({queryId:Ee(),executor:o(this,Et),node:Re.create(ft(e))})}createView(e){return new uu({queryId:Ee(),executor:o(this,Et),node:gs.create(e)})}refreshMaterializedView(e){return new pu({queryId:Ee(),executor:o(this,Et),node:Uc.create(e)})}dropView(e){return new hu({queryId:Ee(),executor:o(this,Et),node:Wc.create(e)})}createType(e){return new fu({queryId:Ee(),executor:o(this,Et),node:kp.create(mf(e))})}dropType(e){return new mu({queryId:Ee(),executor:o(this,Et),node:jp.create(mf(e))})}withPlugin(e){return new Ba(o(this,Et).withPlugin(e))}withoutPlugins(){return new Ba(o(this,Et).withoutPlugins())}withSchema(e){return new Ba(o(this,Et).withPluginAtFront(new sa(e)))}};Et=new WeakMap;let gu=Ba;class Mb{ref(e){return new vy(e)}table(e){return new _b(e)}}var Bo;class zb{constructor(e){j(this,Bo);k(this,Bo,e)}async provideConnection(e){const n=await o(this,Bo).acquireConnection();try{return await e(n)}finally{await o(this,Bo).releaseConnection(n)}}}Bo=new WeakMap;var jr,Er,Hr;const hi=class hi extends cp{constructor(n,r,s,a=[]){super(a);j(this,jr);j(this,Er);j(this,Hr);k(this,jr,n),k(this,Er,r),k(this,Hr,s)}get adapter(){return o(this,Er)}compileQuery(n,r){return o(this,jr).compileQuery(n,r)}provideConnection(n){return o(this,Hr).provideConnection(n)}withPlugins(n){return new hi(o(this,jr),o(this,Er),o(this,Hr),[...this.plugins,...n])}withPlugin(n){return new hi(o(this,jr),o(this,Er),o(this,Hr),[...this.plugins,n])}withPluginAtFront(n){return new hi(o(this,jr),o(this,Er),o(this,Hr),[n,...this.plugins])}withConnectionProvider(n){return new hi(o(this,jr),o(this,Er),n,[...this.plugins])}withoutPlugins(){return new hi(o(this,jr),o(this,Er),o(this,Hr),[])}};jr=new WeakMap,Er=new WeakMap,Hr=new WeakMap;let xu=hi;function ud(){return typeof performance<"u"&&bn(performance.now)?performance.now():Date.now()}var $t,Ps,Jr,Fo,Zr,cc,nn,Ep,Cp,yu,bu,wu;class Bb{constructor(e,n){j(this,nn);j(this,$t);j(this,Ps);j(this,Jr);j(this,Fo);j(this,Zr);j(this,cc,new WeakSet);k(this,Fo,!1),k(this,$t,e),k(this,Ps,n)}async init(){if(o(this,Zr))throw new Error("driver has already been destroyed");o(this,Jr)||k(this,Jr,o(this,$t).init().then(()=>{k(this,Fo,!0)}).catch(e=>(k(this,Jr,void 0),Promise.reject(e)))),await o(this,Jr)}async acquireConnection(){if(o(this,Zr))throw new Error("driver has already been destroyed");o(this,Fo)||await this.init();const e=await o(this,$t).acquireConnection();return o(this,cc).has(e)||(Q(this,nn,Ep).call(this)&&Q(this,nn,Cp).call(this,e),o(this,cc).add(e)),e}async releaseConnection(e){await o(this,$t).releaseConnection(e)}beginTransaction(e,n){return o(this,$t).beginTransaction(e,n)}commitTransaction(e){return o(this,$t).commitTransaction(e)}rollbackTransaction(e){return o(this,$t).rollbackTransaction(e)}savepoint(e,n,r){if(o(this,$t).savepoint)return o(this,$t).savepoint(e,n,r);throw new Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(e,n,r){if(o(this,$t).rollbackToSavepoint)return o(this,$t).rollbackToSavepoint(e,n,r);throw new Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(e,n,r){if(o(this,$t).releaseSavepoint)return o(this,$t).releaseSavepoint(e,n,r);throw new Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){o(this,Jr)&&(await o(this,Jr),o(this,Zr)||k(this,Zr,o(this,$t).destroy().catch(e=>(k(this,Zr,void 0),Promise.reject(e)))),await o(this,Zr))}}$t=new WeakMap,Ps=new WeakMap,Jr=new WeakMap,Fo=new WeakMap,Zr=new WeakMap,cc=new WeakMap,nn=new WeakSet,Ep=function(){return o(this,Ps).isLevelEnabled("query")||o(this,Ps).isLevelEnabled("error")},Cp=function(e){const n=e.executeQuery,r=e.streamQuery,s=this;e.executeQuery=async a=>{var d,h;let c;const l=ud();try{return await n.call(e,a)}catch(m){throw c=m,await Q(d=s,nn,yu).call(d,m,a,l),m}finally{c||await Q(h=s,nn,bu).call(h,a,l)}},e.streamQuery=async function*(a,c){var h,m;let l;const d=ud();try{for await(const u of r.call(e,a,c))yield u}catch(u){throw l=u,await Q(h=s,nn,yu).call(h,u,a,d),u}finally{l||await Q(m=s,nn,bu).call(m,a,d,!0)}}},yu=async function(e,n,r){await o(this,Ps).error(()=>({level:"error",error:e,query:n,queryDurationMillis:Q(this,nn,wu).call(this,r)}))},bu=async function(e,n,r=!1){await o(this,Ps).query(()=>({level:"query",isStream:r,query:e,queryDurationMillis:Q(this,nn,wu).call(this,n)}))},wu=function(e){return ud()-e};const Fb=()=>{};var lc,Rs,Tl,_p;class th{constructor(e){j(this,Tl);j(this,lc);j(this,Rs);k(this,lc,e)}async provideConnection(e){for(;o(this,Rs);)await o(this,Rs).catch(Fb);return k(this,Rs,Q(this,Tl,_p).call(this,e).finally(()=>{k(this,Rs,void 0)})),o(this,Rs)}}lc=new WeakMap,Rs=new WeakMap,Tl=new WeakSet,_p=async function(e){return await e(o(this,lc))};const Wb=["read only","read write"],Ub=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function Op(t){if(t.accessMode&&!Wb.includes(t.accessMode))throw new Error(`invalid transaction access mode ${t.accessMode}`);if(t.isolationLevel&&!Ub.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}const qb=["query","error"];f(qb);var Ls,Ci;class Vb{constructor(e){j(this,Ls);j(this,Ci);bn(e)?(k(this,Ci,e),k(this,Ls,f({query:!0,error:!0}))):(k(this,Ci,Qb),k(this,Ls,f({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return o(this,Ls)[e]}async query(e){o(this,Ls).query&&await o(this,Ci).call(this,e())}async error(e){o(this,Ls).error&&await o(this,Ci).call(this,e())}}Ls=new WeakMap,Ci=new WeakMap;function Qb(t){if(t.level==="query"){const e=`kysely:query:${t.isStream?"stream:":""}`;console.log(`${e} ${t.query.sql}`),console.log(`${e} duration: ${t.queryDurationMillis.toFixed(1)}ms`)}else t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:t.error,query:t.query.sql,queryDurationMillis:t.queryDurationMillis})}`))}function Hb(t){return ur(t)&&bn(t.compile)}Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));var At;const co=class co extends il{constructor(n){let r,s;if(Jb(n))r={executor:n.executor},s={...n};else{const a=n.dialect,c=a.createDriver(),l=a.createQueryCompiler(),d=a.createAdapter(),h=new Vb(n.log??[]),m=new Bb(c,h),u=new zb(m),p=new xu(l,d,u,n.plugins??[]);r={executor:p},s={config:n,executor:p,dialect:a,driver:m}}super(r);j(this,At);k(this,At,f(s))}get schema(){return new gu(o(this,At).executor)}get dynamic(){return new Mb}get introspection(){return o(this,At).dialect.createIntrospector(this.withoutPlugins())}case(n){return new up({node:Ir.create(Fs(n)?void 0:Wi(n))})}get fn(){return dp()}transaction(){return new vu({...o(this,At)})}startTransaction(){return new Nu({...o(this,At)})}connection(){return new Zb({...o(this,At)})}withPlugin(n){return new co({...o(this,At),executor:o(this,At).executor.withPlugin(n)})}withoutPlugins(){return new co({...o(this,At),executor:o(this,At).executor.withoutPlugins()})}withSchema(n){return new co({...o(this,At),executor:o(this,At).executor.withPluginAtFront(new sa(n))})}withTables(){return new co({...o(this,At)})}async destroy(){await o(this,At).driver.destroy()}get isTransaction(){return!1}getExecutor(){return o(this,At).executor}executeQuery(n,r){r!==void 0&&na("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");const s=Hb(n)?n.compile():n;return this.getExecutor().executeQuery(s)}async[Symbol.asyncDispose](){await this.destroy()}};At=new WeakMap;let Ha=co;var cr;const lo=class lo extends Ha{constructor(n){super(n);j(this,cr);k(this,cr,n)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(n){return new lo({...o(this,cr),executor:o(this,cr).executor.withPlugin(n)})}withoutPlugins(){return new lo({...o(this,cr),executor:o(this,cr).executor.withoutPlugins()})}withSchema(n){return new lo({...o(this,cr),executor:o(this,cr).executor.withPluginAtFront(new sa(n))})}withTables(){return new lo({...o(this,cr)})}};cr=new WeakMap;let hl=lo;function Jb(t){return ur(t)&&ur(t.config)&&ur(t.driver)&&ur(t.executor)&&ur(t.dialect)}var _i;class Zb{constructor(e){j(this,_i);k(this,_i,f(e))}async execute(e){return o(this,_i).executor.provideConnection(async n=>{const r=o(this,_i).executor.withConnectionProvider(new th(n)),s=new Ha({...o(this,_i),executor:r});return await e(s)})}}_i=new WeakMap;var Un;const Al=class Al{constructor(e){j(this,Un);k(this,Un,f(e))}setAccessMode(e){return new Al({...o(this,Un),accessMode:e})}setIsolationLevel(e){return new Al({...o(this,Un),isolationLevel:e})}async execute(e){const{isolationLevel:n,accessMode:r,...s}=o(this,Un),a={isolationLevel:n,accessMode:r};return Op(a),o(this,Un).executor.provideConnection(async c=>{const l=o(this,Un).executor.withConnectionProvider(new th(c)),d=new hl({...s,executor:l});let h=!1;try{await o(this,Un).driver.beginTransaction(c,a),h=!0;const m=await e(d);return await o(this,Un).driver.commitTransaction(c),m}catch(m){throw h&&await o(this,Un).driver.rollbackTransaction(c),m}})}};Un=new WeakMap;let vu=Al;var Cr;const Dl=class Dl{constructor(e){j(this,Cr);k(this,Cr,f(e))}setAccessMode(e){return new Dl({...o(this,Cr),accessMode:e})}setIsolationLevel(e){return new Dl({...o(this,Cr),isolationLevel:e})}async execute(){const{isolationLevel:e,accessMode:n,...r}=o(this,Cr),s={isolationLevel:e,accessMode:n};Op(s);const a=await ap(o(this,Cr).executor);return await o(this,Cr).driver.beginTransaction(a.connection,s),new Su({...r,connection:a,executor:o(this,Cr).executor.withConnectionProvider(new th(a.connection))})}};Cr=new WeakMap;let Nu=Dl;var Je,Oi,_n;const Fr=class Fr extends hl{constructor(n){const r={isCommitted:!1,isRolledBack:!1};n={...n,executor:new ku(n.executor,r)};const{connection:s,...a}=n;super(a);j(this,Je);j(this,Oi);j(this,_n);k(this,Je,f(n)),k(this,_n,r);const c=Ee();k(this,Oi,l=>n.executor.compileQuery(l,c))}get isCommitted(){return o(this,_n).isCommitted}get isRolledBack(){return o(this,_n).isRolledBack}commit(){return oi(o(this,_n)),new xa(async()=>{await o(this,Je).driver.commitTransaction(o(this,Je).connection.connection),o(this,_n).isCommitted=!0,o(this,Je).connection.release()})}rollback(){return oi(o(this,_n)),new xa(async()=>{await o(this,Je).driver.rollbackTransaction(o(this,Je).connection.connection),o(this,_n).isRolledBack=!0,o(this,Je).connection.release()})}savepoint(n){return oi(o(this,_n)),new xa(async()=>{var r,s;return await((s=(r=o(this,Je).driver).savepoint)==null?void 0:s.call(r,o(this,Je).connection.connection,n,o(this,Oi))),new Fr({...o(this,Je)})})}rollbackToSavepoint(n){return oi(o(this,_n)),new xa(async()=>{var r,s;return await((s=(r=o(this,Je).driver).rollbackToSavepoint)==null?void 0:s.call(r,o(this,Je).connection.connection,n,o(this,Oi))),new Fr({...o(this,Je)})})}releaseSavepoint(n){return oi(o(this,_n)),new xa(async()=>{var r,s;return await((s=(r=o(this,Je).driver).releaseSavepoint)==null?void 0:s.call(r,o(this,Je).connection.connection,n,o(this,Oi))),new Fr({...o(this,Je)})})}withPlugin(n){return new Fr({...o(this,Je),executor:o(this,Je).executor.withPlugin(n)})}withoutPlugins(){return new Fr({...o(this,Je),executor:o(this,Je).executor.withoutPlugins()})}withSchema(n){return new Fr({...o(this,Je),executor:o(this,Je).executor.withPluginAtFront(new sa(n))})}withTables(){return new Fr({...o(this,Je)})}};Je=new WeakMap,Oi=new WeakMap,_n=new WeakMap;let Su=Fr;var dc;class xa{constructor(e){j(this,dc);k(this,dc,e)}async execute(){return await o(this,dc).call(this)}}dc=new WeakMap;function oi(t){if(t.isCommitted)throw new Error("Transaction is already committed");if(t.isRolledBack)throw new Error("Transaction is already rolled back")}var Dt,lr;const Ns=class Ns{constructor(e,n){j(this,Dt);j(this,lr);e instanceof Ns?k(this,Dt,o(e,Dt)):k(this,Dt,e),k(this,lr,n)}get adapter(){return o(this,Dt).adapter}get plugins(){return o(this,Dt).plugins}transformQuery(e,n){return o(this,Dt).transformQuery(e,n)}compileQuery(e,n){return o(this,Dt).compileQuery(e,n)}provideConnection(e){return o(this,Dt).provideConnection(e)}executeQuery(e){return oi(o(this,lr)),o(this,Dt).executeQuery(e)}stream(e,n){return oi(o(this,lr)),o(this,Dt).stream(e,n)}withConnectionProvider(e){return new Ns(o(this,Dt).withConnectionProvider(e),o(this,lr))}withPlugin(e){return new Ns(o(this,Dt).withPlugin(e),o(this,lr))}withPlugins(e){return new Ns(o(this,Dt).withPlugins(e),o(this,lr))}withPluginAtFront(e){return new Ns(o(this,Dt).withPluginAtFront(e),o(this,lr))}withoutPlugins(){return new Ns(o(this,Dt).withoutPlugins(),o(this,lr))}};Dt=new WeakMap,lr=new WeakMap;let ku=Ns;var fn,Vn,qc,Eu,Cu;const Fa=class Fa{constructor(e){j(this,Vn);j(this,fn);k(this,fn,f(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Gb(this,e)}$castTo(){return new Fa({...o(this,fn)})}$notNull(){return new Fa(o(this,fn))}withPlugin(e){return new Fa({...o(this,fn),plugins:o(this,fn).plugins!==void 0?f([...o(this,fn).plugins,e]):f([e])})}toOperationNode(){return Q(this,Vn,Eu).call(this,Q(this,Vn,qc).call(this))}compile(e){return Q(this,Vn,Cu).call(this,Q(this,Vn,qc).call(this,e))}async execute(e){const n=Q(this,Vn,qc).call(this,e);return n.executeQuery(Q(this,Vn,Cu).call(this,n))}};fn=new WeakMap,Vn=new WeakSet,qc=function(e){const n=e!==void 0?e.getExecutor():ql;return o(this,fn).plugins!==void 0?n.withPlugins(o(this,fn).plugins):n},Eu=function(e){return e.transformQuery(o(this,fn).rawNode,o(this,fn).queryId)},Cu=function(e){return e.compileQuery(Q(this,Vn,Eu).call(this,e),o(this,fn).queryId)};let ju=Fa;function ls(t){return new ju(t)}var Ii,$s;class Gb{constructor(e,n){j(this,Ii);j(this,$s);k(this,Ii,e),k(this,$s,n)}get expression(){return o(this,Ii)}get alias(){return o(this,$s)}get rawBuilder(){return o(this,Ii)}toOperationNode(){return is.create(o(this,Ii).toOperationNode(),rn(o(this,$s))?o(this,$s).toOperationNode():$e.create(o(this,$s)))}}Ii=new WeakMap,$s=new WeakMap;const Ip=Object.assign((t,...e)=>ls({queryId:Ee(),rawNode:tt.create(t,(e==null?void 0:e.map(pf))??[])}),{ref(t){return ls({queryId:Ee(),rawNode:tt.createWithChild(ss(t))})},val(t){return ls({queryId:Ee(),rawNode:tt.createWithChild(St(t))})},value(t){return this.val(t)},table(t){return ls({queryId:Ee(),rawNode:tt.createWithChild(ft(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",ls({queryId:Ee(),rawNode:tt.create(e,t.map($e.create))})},lit(t){return ls({queryId:Ee(),rawNode:tt.createWithChild(Qn.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return ls({queryId:Ee(),rawNode:tt.createWithSql(t)})},join(t,e=Ip`, `){const n=new Array(Math.max(2*t.length-1,0)),r=e.toOperationNode();for(let s=0;s<t.length;++s)n[2*s]=pf(t[s]),s!==t.length-1&&(n[2*s+1]=r);return ls({queryId:Ee(),rawNode:tt.createWithChildren(n)})}});function pf(t){return rn(t)?t.toOperationNode():St(t)}var Pl;class Kb{constructor(){kn(this,"nodeStack",[]);j(this,Pl,f({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)}));kn(this,"visitNode",e=>{this.nodeStack.push(e),o(this,Pl)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Pl=new WeakMap;const Yb=/'/g;var Wo,Ti;class Xb extends Kb{constructor(){super(...arguments);j(this,Wo,"");j(this,Ti,[])}get numParameters(){return o(this,Ti).length}compileQuery(n,r){return k(this,Wo,""),k(this,Ti,[]),this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(n),f({query:n,queryId:r,sql:this.getSql(),parameters:[...o(this,Ti)]})}getSql(){return o(this,Wo)}visitSelectQuery(n){var s,a;const r=this.parentNode!==void 0&&!Yr.is(this.parentNode)&&!Pt.is(this.parentNode)&&!jn.is(this.parentNode)&&!gs.is(this.parentNode)&&!lp.is(this.parentNode);this.parentNode===void 0&&n.explain&&(this.visitNode(n.explain),this.append(" ")),r&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append("select"),n.distinctOn&&(this.append(" "),this.compileDistinctOn(n.distinctOn)),(s=n.frontModifiers)!=null&&s.length&&(this.append(" "),this.compileList(n.frontModifiers," ")),n.top&&(this.append(" "),this.visitNode(n.top)),n.selections&&(this.append(" "),this.compileList(n.selections)),n.from&&(this.append(" "),this.visitNode(n.from)),n.joins&&(this.append(" "),this.compileList(n.joins," ")),n.where&&(this.append(" "),this.visitNode(n.where)),n.groupBy&&(this.append(" "),this.visitNode(n.groupBy)),n.having&&(this.append(" "),this.visitNode(n.having)),n.setOperations&&(this.append(" "),this.compileList(n.setOperations," ")),n.orderBy&&(this.append(" "),this.visitNode(n.orderBy)),n.limit&&(this.append(" "),this.visitNode(n.limit)),n.offset&&(this.append(" "),this.visitNode(n.offset)),n.fetch&&(this.append(" "),this.visitNode(n.fetch)),(a=n.endModifiers)!=null&&a.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...n.endModifiers])," ")),r&&this.append(")")}visitFrom(n){this.append("from "),this.compileList(n.froms)}visitSelection(n){this.visitNode(n.selection)}visitColumn(n){this.visitNode(n.column)}compileDistinctOn(n){this.append("distinct on ("),this.compileList(n),this.append(")")}compileList(n,r=", "){const s=n.length-1;for(let a=0;a<=s;a++)this.visitNode(n[a]),a<s&&this.append(r)}visitWhere(n){this.append("where "),this.visitNode(n.where)}visitHaving(n){this.append("having "),this.visitNode(n.having)}visitInsertQuery(n){var s;const r=this.parentNode!==void 0&&!Yr.is(this.parentNode)&&!tt.is(this.parentNode)&&!Ri.is(this.parentNode);this.parentNode===void 0&&n.explain&&(this.visitNode(n.explain),this.append(" ")),r&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append(n.replace?"replace":"insert"),n.ignore&&(na("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),n.orAction&&(this.append(" "),this.visitNode(n.orAction)),n.top&&(this.append(" "),this.visitNode(n.top)),n.into&&(this.append(" into "),this.visitNode(n.into)),n.columns&&(this.append(" ("),this.compileList(n.columns),this.append(")")),n.output&&(this.append(" "),this.visitNode(n.output)),n.values&&(this.append(" "),this.visitNode(n.values)),n.defaultValues&&(this.append(" "),this.append("default values")),n.onConflict&&(this.append(" "),this.visitNode(n.onConflict)),n.onDuplicateKey&&(this.append(" "),this.visitNode(n.onDuplicateKey)),n.returning&&(this.append(" "),this.visitNode(n.returning)),r&&this.append(")"),(s=n.endModifiers)!=null&&s.length&&(this.append(" "),this.compileList(n.endModifiers," "))}visitValues(n){this.append("values "),this.compileList(n.values)}visitDeleteQuery(n){var s;const r=this.parentNode!==void 0&&!Yr.is(this.parentNode)&&!tt.is(this.parentNode);this.parentNode===void 0&&n.explain&&(this.visitNode(n.explain),this.append(" ")),r&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append("delete "),n.top&&(this.visitNode(n.top),this.append(" ")),this.visitNode(n.from),n.output&&(this.append(" "),this.visitNode(n.output)),n.using&&(this.append(" "),this.visitNode(n.using)),n.joins&&(this.append(" "),this.compileList(n.joins," ")),n.where&&(this.append(" "),this.visitNode(n.where)),n.orderBy&&(this.append(" "),this.visitNode(n.orderBy)),n.limit&&(this.append(" "),this.visitNode(n.limit)),n.returning&&(this.append(" "),this.visitNode(n.returning)),r&&this.append(")"),(s=n.endModifiers)!=null&&s.length&&(this.append(" "),this.compileList(n.endModifiers," "))}visitReturning(n){this.append("returning "),this.compileList(n.selections)}visitAlias(n){this.visitNode(n.node),this.append(" as "),this.visitNode(n.alias)}visitReference(n){n.table&&(this.visitNode(n.table),this.append(".")),this.visitNode(n.column)}visitSelectAll(n){this.append("*")}visitIdentifier(n){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(n),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(n){if(!tn(n.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(n.name))}visitAnd(n){this.visitNode(n.left),this.append(" and "),this.visitNode(n.right)}visitOr(n){this.visitNode(n.left),this.append(" or "),this.visitNode(n.right)}visitValue(n){n.immediate?this.appendImmediateValue(n.value):this.appendValue(n.value)}visitValueList(n){this.append("("),this.compileList(n.values),this.append(")")}visitTuple(n){this.append("("),this.compileList(n.values),this.append(")")}visitPrimitiveValueList(n){this.append("(");const{values:r}=n;for(let s=0;s<r.length;++s)this.appendValue(r[s]),s!==r.length-1&&this.append(", ");this.append(")")}visitParens(n){this.append("("),this.visitNode(n.node),this.append(")")}visitJoin(n){this.append(tw[n.joinType]),this.append(" "),this.visitNode(n.table),n.on&&(this.append(" "),this.visitNode(n.on))}visitOn(n){this.append("on "),this.visitNode(n.on)}visitRaw(n){const{sqlFragments:r,parameters:s}=n;for(let a=0;a<r.length;++a)this.append(r[a]),s.length>a&&this.visitNode(s[a])}visitOperator(n){this.append(n.operator)}visitTable(n){this.visitNode(n.table)}visitSchemableIdentifier(n){n.schema&&(this.visitNode(n.schema),this.append(".")),this.visitNode(n.identifier)}visitCreateTable(n){this.append("create "),n.frontModifiers&&n.frontModifiers.length>0&&(this.compileList(n.frontModifiers," "),this.append(" ")),n.temporary&&this.append("temporary "),this.append("table "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.table),n.selectQuery?(this.append(" as "),this.visitNode(n.selectQuery)):(this.append(" ("),this.compileList([...n.columns,...n.constraints??[]]),this.append(")"),n.onCommit&&(this.append(" on commit "),this.append(n.onCommit)),n.endModifiers&&n.endModifiers.length>0&&(this.append(" "),this.compileList(n.endModifiers," ")))}visitColumnDefinition(n){n.ifNotExists&&this.append("if not exists "),this.visitNode(n.column),this.append(" "),this.visitNode(n.dataType),n.unsigned&&this.append(" unsigned"),n.frontModifiers&&n.frontModifiers.length>0&&(this.append(" "),this.compileList(n.frontModifiers," ")),n.generated&&(this.append(" "),this.visitNode(n.generated)),n.identity&&this.append(" identity"),n.defaultTo&&(this.append(" "),this.visitNode(n.defaultTo)),n.notNull&&this.append(" not null"),n.unique&&this.append(" unique"),n.nullsNotDistinct&&this.append(" nulls not distinct"),n.primaryKey&&this.append(" primary key"),n.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),n.references&&(this.append(" "),this.visitNode(n.references)),n.check&&(this.append(" "),this.visitNode(n.check)),n.endModifiers&&n.endModifiers.length>0&&(this.append(" "),this.compileList(n.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(n){this.append("references "),this.visitNode(n.table),this.append(" ("),this.compileList(n.columns),this.append(")"),n.onDelete&&(this.append(" on delete "),this.append(n.onDelete)),n.onUpdate&&(this.append(" on update "),this.append(n.onUpdate))}visitDropTable(n){this.append("drop table "),n.ifExists&&this.append("if exists "),this.visitNode(n.table),n.cascade&&this.append(" cascade")}visitDataType(n){this.append(n.dataType)}visitOrderBy(n){this.append("order by "),this.compileList(n.items)}visitOrderByItem(n){this.visitNode(n.orderBy),n.collation&&(this.append(" "),this.visitNode(n.collation)),n.direction&&(this.append(" "),this.visitNode(n.direction)),n.nulls&&(this.append(" nulls "),this.append(n.nulls))}visitGroupBy(n){this.append("group by "),this.compileList(n.items)}visitGroupByItem(n){this.visitNode(n.groupBy)}visitUpdateQuery(n){var s;const r=this.parentNode!==void 0&&!Yr.is(this.parentNode)&&!tt.is(this.parentNode)&&!Ri.is(this.parentNode);if(this.parentNode===void 0&&n.explain&&(this.visitNode(n.explain),this.append(" ")),r&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append("update "),n.top&&(this.visitNode(n.top),this.append(" ")),n.table&&(this.visitNode(n.table),this.append(" ")),this.append("set "),n.updates&&this.compileList(n.updates),n.output&&(this.append(" "),this.visitNode(n.output)),n.from&&(this.append(" "),this.visitNode(n.from)),n.joins){if(!n.from)throw new Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(n.joins," ")}n.where&&(this.append(" "),this.visitNode(n.where)),n.orderBy&&(this.append(" "),this.visitNode(n.orderBy)),n.limit&&(this.append(" "),this.visitNode(n.limit)),n.returning&&(this.append(" "),this.visitNode(n.returning)),r&&this.append(")"),(s=n.endModifiers)!=null&&s.length&&(this.append(" "),this.compileList(n.endModifiers," "))}visitColumnUpdate(n){this.visitNode(n.column),this.append(" = "),this.visitNode(n.value)}visitLimit(n){this.append("limit "),this.visitNode(n.limit)}visitOffset(n){this.append("offset "),this.visitNode(n.offset)}visitOnConflict(n){this.append("on conflict"),n.columns?(this.append(" ("),this.compileList(n.columns),this.append(")")):n.constraint?(this.append(" on constraint "),this.visitNode(n.constraint)):n.indexExpression&&(this.append(" ("),this.visitNode(n.indexExpression),this.append(")")),n.indexWhere&&(this.append(" "),this.visitNode(n.indexWhere)),n.doNothing===!0?this.append(" do nothing"):n.updates&&(this.append(" do update set "),this.compileList(n.updates),n.updateWhere&&(this.append(" "),this.visitNode(n.updateWhere)))}visitOnDuplicateKey(n){this.append("on duplicate key update "),this.compileList(n.updates)}visitCreateIndex(n){this.append("create "),n.unique&&this.append("unique "),this.append("index "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.name),n.table&&(this.append(" on "),this.visitNode(n.table)),n.using&&(this.append(" using "),this.visitNode(n.using)),n.columns&&(this.append(" ("),this.compileList(n.columns),this.append(")")),n.nullsNotDistinct&&this.append(" nulls not distinct"),n.where&&(this.append(" "),this.visitNode(n.where))}visitDropIndex(n){this.append("drop index "),n.ifExists&&this.append("if exists "),this.visitNode(n.name),n.table&&(this.append(" on "),this.visitNode(n.table)),n.cascade&&this.append(" cascade")}visitCreateSchema(n){this.append("create schema "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.schema)}visitDropSchema(n){this.append("drop schema "),n.ifExists&&this.append("if exists "),this.visitNode(n.schema),n.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("primary key ("),this.compileList(n.columns),this.append(")"),this.buildDeferrable(n)}buildDeferrable(n){n.deferrable!==void 0&&(n.deferrable?this.append(" deferrable"):this.append(" not deferrable")),n.initiallyDeferred!==void 0&&(n.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("unique"),n.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(n.columns),this.append(")"),this.buildDeferrable(n)}visitCheckConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("check ("),this.visitNode(n.expression),this.append(")")}visitForeignKeyConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("foreign key ("),this.compileList(n.columns),this.append(") "),this.visitNode(n.references),n.onDelete&&(this.append(" on delete "),this.append(n.onDelete)),n.onUpdate&&(this.append(" on update "),this.append(n.onUpdate)),this.buildDeferrable(n)}visitList(n){this.compileList(n.items)}visitWith(n){this.append("with "),n.recursive&&this.append("recursive "),this.compileList(n.expressions)}visitCommonTableExpression(n){this.visitNode(n.name),this.append(" as "),Kc(n.materialized)&&(n.materialized||this.append("not "),this.append("materialized ")),this.visitNode(n.expression)}visitCommonTableExpressionName(n){this.visitNode(n.table),n.columns&&(this.append("("),this.compileList(n.columns),this.append(")"))}visitAlterTable(n){this.append("alter table "),this.visitNode(n.table),this.append(" "),n.renameTo&&(this.append("rename to "),this.visitNode(n.renameTo)),n.setSchema&&(this.append("set schema "),this.visitNode(n.setSchema)),n.addConstraint&&this.visitNode(n.addConstraint),n.dropConstraint&&this.visitNode(n.dropConstraint),n.renameConstraint&&this.visitNode(n.renameConstraint),n.columnAlterations&&this.compileColumnAlterations(n.columnAlterations),n.addIndex&&this.visitNode(n.addIndex),n.dropIndex&&this.visitNode(n.dropIndex)}visitAddColumn(n){this.append("add column "),this.visitNode(n.column)}visitRenameColumn(n){this.append("rename column "),this.visitNode(n.column),this.append(" to "),this.visitNode(n.renameTo)}visitDropColumn(n){this.append("drop column "),this.visitNode(n.column)}visitAlterColumn(n){this.append("alter column "),this.visitNode(n.column),this.append(" "),n.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(n.dataType),n.dataTypeExpression&&(this.append("using "),this.visitNode(n.dataTypeExpression))),n.setDefault&&(this.append("set default "),this.visitNode(n.setDefault)),n.dropDefault&&this.append("drop default"),n.setNotNull&&this.append("set not null"),n.dropNotNull&&this.append("drop not null")}visitModifyColumn(n){this.append("modify column "),this.visitNode(n.column)}visitAddConstraint(n){this.append("add "),this.visitNode(n.constraint)}visitDropConstraint(n){this.append("drop constraint "),n.ifExists&&this.append("if exists "),this.visitNode(n.constraintName),n.modifier==="cascade"?this.append(" cascade"):n.modifier==="restrict"&&this.append(" restrict")}visitRenameConstraint(n){this.append("rename constraint "),this.visitNode(n.oldName),this.append(" to "),this.visitNode(n.newName)}visitSetOperation(n){this.append(n.operator),this.append(" "),n.all&&this.append("all "),this.visitNode(n.expression)}visitCreateView(n){this.append("create "),n.orReplace&&this.append("or replace "),n.materialized&&this.append("materialized "),n.temporary&&this.append("temporary "),this.append("view "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.name),this.append(" "),n.columns&&(this.append("("),this.compileList(n.columns),this.append(") ")),n.as&&(this.append("as "),this.visitNode(n.as))}visitRefreshMaterializedView(n){this.append("refresh materialized view "),n.concurrently&&this.append("concurrently "),this.visitNode(n.name),n.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(n){this.append("drop "),n.materialized&&this.append("materialized "),this.append("view "),n.ifExists&&this.append("if exists "),this.visitNode(n.name),n.cascade&&this.append(" cascade")}visitGenerated(n){this.append("generated "),n.always&&this.append("always "),n.byDefault&&this.append("by default "),this.append("as "),n.identity&&this.append("identity"),n.expression&&(this.append("("),this.visitNode(n.expression),this.append(")")),n.stored&&this.append(" stored")}visitDefaultValue(n){this.append("default "),this.visitNode(n.defaultValue)}visitSelectModifier(n){n.rawModifier?this.visitNode(n.rawModifier):this.append(ew[n.modifier]),n.of&&(this.append(" of "),this.compileList(n.of,", "))}visitCreateType(n){this.append("create type "),this.visitNode(n.name),n.enum&&(this.append(" as enum "),this.visitNode(n.enum))}visitDropType(n){this.append("drop type "),n.ifExists&&this.append("if exists "),this.visitNode(n.name)}visitExplain(n){this.append("explain"),(n.options||n.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),n.options&&(this.visitNode(n.options),n.format&&this.append(this.getExplainOptionsDelimiter())),n.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(n.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(n){this.append("default")}visitAggregateFunction(n){this.append(n.func),this.append("("),n.distinct&&this.append("distinct "),this.compileList(n.aggregated),n.orderBy&&(this.append(" "),this.visitNode(n.orderBy)),this.append(")"),n.withinGroup&&(this.append(" within group ("),this.visitNode(n.withinGroup),this.append(")")),n.filter&&(this.append(" filter("),this.visitNode(n.filter),this.append(")")),n.over&&(this.append(" "),this.visitNode(n.over))}visitOver(n){this.append("over("),n.partitionBy&&(this.visitNode(n.partitionBy),n.orderBy&&this.append(" ")),n.orderBy&&this.visitNode(n.orderBy),this.append(")")}visitPartitionBy(n){this.append("partition by "),this.compileList(n.items)}visitPartitionByItem(n){this.visitNode(n.partitionBy)}visitBinaryOperation(n){this.visitNode(n.leftOperand),this.append(" "),this.visitNode(n.operator),this.append(" "),this.visitNode(n.rightOperand)}visitUnaryOperation(n){this.visitNode(n.operator),this.isMinusOperator(n.operator)||this.append(" "),this.visitNode(n.operand)}isMinusOperator(n){return Qs.is(n)&&n.operator==="-"}visitUsing(n){this.append("using "),this.compileList(n.tables)}visitFunction(n){this.append(n.func),this.append("("),this.compileList(n.arguments),this.append(")")}visitCase(n){this.append("case"),n.value&&(this.append(" "),this.visitNode(n.value)),n.when&&(this.append(" "),this.compileList(n.when," ")),n.else&&(this.append(" else "),this.visitNode(n.else)),this.append(" end"),n.isStatement&&this.append(" case")}visitWhen(n){this.append("when "),this.visitNode(n.condition),n.result&&(this.append(" then "),this.visitNode(n.result))}visitJSONReference(n){this.visitNode(n.reference),this.visitNode(n.traversal)}visitJSONPath(n){n.inOperator&&this.visitNode(n.inOperator),this.append("'$");for(const r of n.pathLegs)this.visitNode(r);this.append("'")}visitJSONPathLeg(n){const r=n.type==="ArrayLocation";this.append(r?"[":"."),this.append(String(n.value)),r&&this.append("]")}visitJSONOperatorChain(n){for(let r=0,s=n.values.length;r<s;r++)r===s-1?this.visitNode(n.operator):this.append("->"),this.visitNode(n.values[r])}visitMergeQuery(n){var r;n.with&&(this.visitNode(n.with),this.append(" ")),this.append("merge "),n.top&&(this.visitNode(n.top),this.append(" ")),this.append("into "),this.visitNode(n.into),n.using&&(this.append(" "),this.visitNode(n.using)),n.whens&&(this.append(" "),this.compileList(n.whens," ")),n.returning&&(this.append(" "),this.visitNode(n.returning)),n.output&&(this.append(" "),this.visitNode(n.output)),(r=n.endModifiers)!=null&&r.length&&(this.append(" "),this.compileList(n.endModifiers," "))}visitMatched(n){n.not&&this.append("not "),this.append("matched"),n.bySource&&this.append(" by source")}visitAddIndex(n){this.append("add "),n.unique&&this.append("unique "),this.append("index "),this.visitNode(n.name),n.columns&&(this.append(" ("),this.compileList(n.columns),this.append(")")),n.using&&(this.append(" using "),this.visitNode(n.using))}visitCast(n){this.append("cast("),this.visitNode(n.expression),this.append(" as "),this.visitNode(n.dataType),this.append(")")}visitFetch(n){this.append("fetch next "),this.visitNode(n.rowCount),this.append(` rows ${n.modifier}`)}visitOutput(n){this.append("output "),this.compileList(n.selections)}visitTop(n){this.append(`top(${n.expression})`),n.modifiers&&this.append(` ${n.modifiers}`)}visitOrAction(n){this.append(n.action)}visitCollate(n){this.append("collate "),this.visitNode(n.collation)}append(n){k(this,Wo,o(this,Wo)+n)}appendValue(n){this.addParameter(n),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(n){const r=this.getLeftIdentifierWrapper(),s=this.getRightIdentifierWrapper();let a="";for(const c of n)a+=c,c===r?a+=r:c===s&&(a+=s);return a}sanitizeStringLiteral(n){return n.replace(Yb,"''")}addParameter(n){o(this,Ti).push(n)}appendImmediateValue(n){if(tn(n))this.appendStringLiteral(n);else if(Fl(n)||Kc(n)||qu(n))this.append(n.toString());else if(Uu(n))this.append("null");else if(hy(n))this.appendImmediateValue(n.toISOString());else throw new Error(`invalid immediate value ${n}`)}appendStringLiteral(n){this.append("'"),this.append(this.sanitizeStringLiteral(n)),this.append("'")}sortSelectModifiers(n){return n.sort((r,s)=>r.modifier&&s.modifier?gf[r.modifier]-gf[s.modifier]:1),f(n)}compileColumnAlterations(n){this.compileList(n)}announcesNewColumnDataType(){return!0}}Wo=new WeakMap,Ti=new WeakMap;const ew=f({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),gf=f({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),tw=f({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"}),hd=f({raw(t,e=[]){return f({sql:t,query:tt.createWithSql(t),parameters:f(e),queryId:Ee()})}});class nw{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}function fd(t,e){return tt.createWithChildren([tt.createWithSql(`${t} `),$e.create(e)])}var Gr,uc,Uo,qo;class rw{constructor(e){j(this,Gr);j(this,uc,new iw);j(this,Uo);j(this,qo);k(this,Gr,f({...e}))}async init(){k(this,Uo,bn(o(this,Gr).database)?await o(this,Gr).database():o(this,Gr).database),k(this,qo,new sw(o(this,Uo))),o(this,Gr).onCreateConnection&&await o(this,Gr).onCreateConnection(o(this,qo))}async acquireConnection(){return await o(this,uc).lock(),o(this,qo)}async beginTransaction(e){await e.executeQuery(hd.raw("begin"))}async commitTransaction(e){await e.executeQuery(hd.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(hd.raw("rollback"))}async savepoint(e,n,r){await e.executeQuery(r(fd("savepoint",n),Ee()))}async rollbackToSavepoint(e,n,r){await e.executeQuery(r(fd("rollback to",n),Ee()))}async releaseSavepoint(e,n,r){await e.executeQuery(r(fd("release",n),Ee()))}async releaseConnection(){o(this,uc).unlock()}async destroy(){var e;(e=o(this,Uo))==null||e.close()}}Gr=new WeakMap,uc=new WeakMap,Uo=new WeakMap,qo=new WeakMap;var Vo;class sw{constructor(e){j(this,Vo);k(this,Vo,e)}executeQuery(e){const{sql:n,parameters:r}=e,s=o(this,Vo).prepare(n);if(s.reader)return Promise.resolve({rows:s.all(r)});const{changes:a,lastInsertRowid:c}=s.run(r);return Promise.resolve({numAffectedRows:a!=null?BigInt(a):void 0,insertId:c!=null?BigInt(c):void 0,rows:[]})}async*streamQuery(e,n){const{sql:r,parameters:s,query:a}=e,c=o(this,Vo).prepare(r);if(qe.is(a)){const l=c.iterate(s);for(const d of l)yield{rows:[d]}}else throw new Error("Sqlite driver only supports streaming of select queries")}}Vo=new WeakMap;var Ai,Qo;class iw{constructor(){j(this,Ai);j(this,Qo)}async lock(){for(;o(this,Ai);)await o(this,Ai);k(this,Ai,new Promise(e=>{k(this,Qo,e)}))}unlock(){const e=o(this,Qo);k(this,Ai,void 0),k(this,Qo,void 0),e==null||e()}}Ai=new WeakMap,Qo=new WeakMap;const ow=/"/g;class aw extends Xb{visitOrAction(e){this.append("or "),this.append(e.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(ow,'""')}visitDefaultInsertValue(e){this.append("null")}}const cw="kysely_migration",lw="kysely_migration_lock";f({__noMigrations__:!0});var Ho,Bi,_u,Tp;class dw{constructor(e){j(this,Bi);j(this,Ho);k(this,Ho,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){return await Q(this,Bi,Tp).call(this,e)}async getMetadata(e){return{tables:await this.getTables(e)}}}Ho=new WeakMap,Bi=new WeakSet,_u=function(e,n){let r=e.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return n.withInternalKyselyTables||(r=r.where("name","!=",cw).where("name","!=",lw)),r},Tp=async function(e){var a;const n=await Q(this,Bi,_u).call(this,o(this,Ho),e).execute(),r=await o(this,Ho).with("table_list",c=>Q(this,Bi,_u).call(this,c,e)).selectFrom(["table_list as tl",Ip`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),s={};for(const c of r)s[a=c.table]??(s[a]=[]),s[c.table].push(c);return n.map(({name:c,sql:l,type:d})=>{var u,p,w,y,g;let h=(g=(y=(w=(p=(u=l==null?void 0:l.split(/[\(\),]/))==null?void 0:u.find(N=>N.toLowerCase().includes("autoincrement")))==null?void 0:p.trimStart())==null?void 0:w.split(/\s+/))==null?void 0:y[0])==null?void 0:g.replace(/["`]/g,"");const m=s[c]??[];if(!h){const N=m.filter(v=>v.pk>0);N.length===1&&N[0].type.toLowerCase()==="integer"&&(h=N[0].name)}return{name:c,isView:d==="view",columns:m.map(N=>({name:N.name,dataType:N.type,isNullable:!N.notnull,isAutoIncrementing:N.name===h,hasDefaultValue:N.dflt_value!=null,comment:void 0}))}})};class uw extends nw{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,n){}async releaseMigrationLock(e,n){}}var hc;class md{constructor(e){j(this,hc);k(this,hc,f({...e}))}createDriver(){return new rw(o(this,hc))}createQueryCompiler(){return new aw}createAdapter(){return new uw}createIntrospector(e){return new dw(e)}}hc=new WeakMap;class hw{async executeQuery(e){const{sql:n,parameters:r}=e,s=window.electronAPI;if(!s)return fr.debug("[MockDB] Query skipped (Web Mode)",{sql:n}),{rows:[]};if(!s.db)throw fr.error("[IpcConnection] Electron API exists but db is undefined!"),new Error("Database API not available - Main process may not have initialized the database bridge");try{return{rows:await s.db.query(n,r)||[]}}catch(a){throw fr.error("[IpcConnection] Query failed:",a),a}}async*streamQuery(e,n){throw new Error("Streaming not supported in IPC mode")}}class fw{async init(){window.electronAPI||fr.warn(" Electron API not found. Running in Web/Mock Mode.")}async acquireConnection(){return new hw}async beginTransaction(e,n){fr.warn("Transactions skipped in Renderer IPC Driver")}async commitTransaction(e){}async rollbackTransaction(e){}async releaseConnection(e){}async destroy(){}}const mw=new Ha({dialect:{createAdapter:()=>new md({database:void 0}).createAdapter(),createDriver:()=>new fw,createIntrospector:t=>new md({database:void 0}).createIntrospector(t),createQueryCompiler:()=>new md({database:void 0}).createQueryCompiler()}});fr.info(" Kysely initialized in RENDERER mode (IPC)");const ge=mw,Kn={async getByClientId(t){try{return(await ge.selectFrom("client_transactions").selectAll().where("clientId","=",t).orderBy("createdAt","desc").execute()).map(n=>({...n,status:n.status}))}catch(e){return console.error(` ClientTransactionRepository.getByClientId(${t}) failed:`,e),[]}},async getById(t){try{const e=await ge.selectFrom("client_transactions").selectAll().where("id","=",t).executeTakeFirst();return e?{...e,status:e.status}:null}catch(e){return console.error(` ClientTransactionRepository.getById(${t}) failed:`,e),null}},async getByBookingId(t){try{return(await ge.selectFrom("client_transactions").selectAll().where("bookingId","=",t).orderBy("createdAt","desc").execute()).map(n=>({...n,status:n.status}))}catch(e){return console.error(` ClientTransactionRepository.getByBookingId(${t}) failed:`,e),[]}},async create(t){try{await ge.insertInto("client_transactions").values({id:t.id,clientId:t.clientId,bookingId:t.bookingId||null,amount:t.amount,currency:t.currency,type:t.type,note:t.note,status:t.status,createdAt:t.createdAt,updatedAt:t.updatedAt,createdBy:t.createdBy,createdByName:t.createdByName,canReverseUntil:t.canReverseUntil,reversedAt:t.reversedAt||null,reversedBy:t.reversedBy||null,reversedByName:t.reversedByName||null,reversalReason:t.reversalReason||null,balanceAfter:t.balanceAfter}).execute()}catch(e){throw console.error(" ClientTransactionRepository.create failed:",e),e}},async reverse(t,e,n,r){try{const s=new Date().toISOString();await ge.updateTable("client_transactions").set({status:"reversed",updatedAt:s,reversedAt:s,reversedBy:e,reversedByName:n,reversalReason:r||null}).where("id","=",t).execute()}catch(s){throw console.error(` ClientTransactionRepository.reverse(${t}) failed:`,s),s}},async getActiveByClientId(t){try{return(await ge.selectFrom("client_transactions").selectAll().where("clientId","=",t).where("status","=","active").orderBy("createdAt","desc").execute()).map(n=>({...n,status:n.status}))}catch(e){return console.error(` ClientTransactionRepository.getActiveByClientId(${t}) failed:`,e),[]}},async calculateBalance(t){try{const e=await ge.selectFrom("client_transactions").select(({fn:n})=>[n.sum("amount").as("total")]).where("clientId","=",t).where("status","=","active").executeTakeFirst();return(e==null?void 0:e.total)||0}catch(e){return console.error(` ClientTransactionRepository.calculateBalance(${t}) failed:`,e),0}},async getRecent(t=30){try{const e=new Date;return e.setDate(e.getDate()-t),(await ge.selectFrom("client_transactions").selectAll().where("createdAt",">=",e.toISOString()).orderBy("createdAt","desc").execute()).map(r=>({...r,status:r.status}))}catch(e){return console.error(" ClientTransactionRepository.getRecent failed:",e),[]}}},Lt=[];for(let t=0;t<256;++t)Lt.push((t+256).toString(16).slice(1));function pw(t,e=0){return(Lt[t[e+0]]+Lt[t[e+1]]+Lt[t[e+2]]+Lt[t[e+3]]+"-"+Lt[t[e+4]]+Lt[t[e+5]]+"-"+Lt[t[e+6]]+Lt[t[e+7]]+"-"+Lt[t[e+8]]+Lt[t[e+9]]+"-"+Lt[t[e+10]]+Lt[t[e+11]]+Lt[t[e+12]]+Lt[t[e+13]]+Lt[t[e+14]]+Lt[t[e+15]]).toLowerCase()}let pd;const gw=new Uint8Array(16);function xw(){if(!pd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");pd=crypto.getRandomValues.bind(crypto)}return pd(gw)}const yw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xf={randomUUID:yw};function bw(t,e,n){var s;t=t||{};const r=t.random??((s=t.rng)==null?void 0:s.call(t))??xw();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,pw(r)}function Mt(t,e,n){return xf.randomUUID&&!t?xf.randomUUID():bw(t)}class yt{static async enqueue(e,n,r){try{const s=Mt(),a=Date.now(),c=JSON.stringify(r);await ge.insertInto("sync_queue").values({id:s,action:e,entity:n,data:c,createdAt:a.toString(),status:"pending"}).execute(),console.log(` SyncQueue: Enqueued [${e} ${n}]`)}catch(s){console.error(" SyncQueue Enqueue Failed:",s)}}static safeParse(e){if(!e||e==="undefined")return null;try{return JSON.parse(e)}catch{return console.warn(" SyncQueue: Skipping corrupt data:",e),null}}static async peekAll(){try{return(await ge.selectFrom("sync_queue").selectAll().where("status","=","pending").orderBy("createdAt","asc").execute()).map(n=>{const r=this.safeParse(n.data);return r?{id:n.id,action:n.action,entity:n.entity,data:r,createdAt:Number(n.createdAt),retryCount:n.retryCount||0}:null}).filter(n=>n!==null)}catch(e){return console.error(" SyncQueue Peek Failed:",e),[]}}static async updateRetryCount(e,n){try{await ge.updateTable("sync_queue").set({retryCount:n}).where("id","=",e).execute(),console.log(` SyncQueue: Updated retry count for [${e}] to ${n}`)}catch(r){console.error(" SyncQueue Update Retry Count Failed:",r)}}static async markAsFailed(e){try{await ge.updateTable("sync_queue").set({status:"failed"}).where("id","=",e).execute(),console.log(` SyncQueue: Marked [${e}] as failed`)}catch(n){console.error(" SyncQueue Mark Failed:",n)}}static async dequeue(e){try{await ge.deleteFrom("sync_queue").where("id","=",e).execute(),console.log(` SyncQueue: Dequeued [${e}]`)}catch(n){console.error(" SyncQueue Dequeue Failed:",n)}}static async clear(){await ge.deleteFrom("sync_queue").execute()}}class ww{async logAction(e,n,r,s,a){const c=a||JSON.parse(localStorage.getItem("user")||"{}"),l={id:Mt(),userId:c.id||"system",userName:c.name||"System",action:e,entityType:n,entityId:r,details:s,createdAt:new Date().toISOString()};console.log(` Logging Action: ${e} on ${n}`);try{await ge.insertInto("activity_logs").values({id:l.id,userId:l.userId,userName:l.userName,action:l.action,entityType:l.entityType,entityId:l.entityId||null,details:l.details||null,createdAt:l.createdAt}).execute()}catch(d){console.error("Failed to save log locally:",d)}navigator.onLine?H.from("activity_logs").insert({id:l.id,user_id:l.userId,user_name:l.userName,action:l.action,entity_type:l.entityType,entity_id:l.entityId,details:l.details,created_at:l.createdAt}).then(({error:d})=>{d&&console.error("Failed to sync log to cloud:",d)}):await yt.enqueue("create","activity_log",l)}async getRecentLogs(e=50){try{return(await ge.selectFrom("activity_logs").selectAll().orderBy("createdAt","desc").limit(e).execute()).map(r=>({id:r.id,userId:r.userId,userName:r.userName,action:r.action,entityType:r.entityType,entityId:r.entityId||void 0,details:r.details||void 0,createdAt:r.createdAt}))}catch(n){return console.error("Failed to fetch logs:",n),[]}}}const qn=new ww,gd=5;class vw{async addCredit(e){const n=new Date,r=new Date(n.getTime()+gd*60*1e3),a=await Kn.calculateBalance(e.clientId)+e.amount,c={id:`ctx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,clientId:e.clientId,bookingId:e.bookingId,amount:e.amount,currency:e.currency,type:e.type||"credit_addition",note:e.note,status:"active",createdAt:n.toISOString(),updatedAt:n.toISOString(),createdBy:e.createdBy,createdByName:e.createdByName,canReverseUntil:r.toISOString(),balanceAfter:a};return await Kn.create(c),await qn.logAction("create","client_transaction",c.id,`  ${e.amount} ${e.currency}  `,{id:e.createdBy,name:e.createdByName}),await yt.enqueue("create","client_transaction",c),z.success(`  ${e.amount.toLocaleString()} ${e.currency}   `,{description:` : ${a.toLocaleString()} ${e.currency}`,action:{label:"",onClick:()=>this.reverseTransaction({transactionId:c.id,reversedBy:e.createdBy,reversedByName:e.createdByName,reason:" "})}}),c}async reverseTransaction(e){const n=await Kn.getById(e.transactionId);if(!n)return z.error("  "),!1;if(n.status==="reversed")return z.error("    "),!1;const r=new Date,s=new Date(n.canReverseUntil);if(r>s)return z.error(`   (${gd} )`,{description:"       "}),!1;await Kn.reverse(e.transactionId,e.reversedBy,e.reversedByName,e.reason),await qn.logAction("reverse","client_transaction",n.id,`    ${n.amount} ${n.currency}`,{id:e.reversedBy,name:e.reversedByName}),await yt.enqueue("update","client_transaction",{id:n.id,status:"reversed",reversedAt:r.toISOString(),reversedBy:e.reversedBy});const a=await Kn.calculateBalance(n.clientId);return z.success("    ",{description:` : ${a.toLocaleString()} ${n.currency}`}),!0}async getClientTransactions(e){return await Kn.getByClientId(e)}async getClientBalance(e,n="IQD"){const r=await Kn.getActiveByClientId(e),s=r.filter(d=>d.amount>0).reduce((d,h)=>d+h.amount,0),a=r.filter(d=>d.amount<0).reduce((d,h)=>d+Math.abs(h.amount),0),c=await Kn.calculateBalance(e),l=r[0];return{clientId:e,totalAdditions:s,totalDeductions:a,currentBalance:c,currency:n,lastTransactionAt:l==null?void 0:l.createdAt}}async getTransactionSummary(e){const n=await Kn.getByClientId(e),r=n.filter(c=>c.status==="active"),s=r.filter(c=>c.amount>0).reduce((c,l)=>c+l.amount,0),a=r.filter(c=>c.amount<0).reduce((c,l)=>c+Math.abs(l.amount),0);return{totalTransactions:n.length,totalAdditions:s,totalDeductions:a,recentTransactions:n.slice(0,10)}}canReverse(e){if(e.status==="reversed")return!1;const n=new Date,r=new Date(e.canReverseUntil);return n<=r}getReversalTimeRemaining(e){if(e.status==="reversed")return 0;const n=new Date,s=new Date(e.canReverseUntil).getTime()-n.getTime();return Math.max(0,Math.floor(s/1e3))}formatTimeRemaining(e){if(e<=0)return"00:00";const n=Math.floor(e/60),r=e%60;return`${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}async deductCredit(e){const n=await Kn.calculateBalance(e.clientId);if(n<e.amount)return z.error("   ",{description:` : ${n.toLocaleString()} ${e.currency}`}),null;const r=new Date,s=new Date(r.getTime()+gd*60*1e3),a=n-e.amount,c={id:`ctx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,clientId:e.clientId,bookingId:e.bookingId,amount:-e.amount,currency:e.currency,type:"credit_deduction",note:e.note,status:"active",createdAt:r.toISOString(),updatedAt:r.toISOString(),createdBy:e.createdBy,createdByName:e.createdByName,canReverseUntil:s.toISOString(),balanceAfter:a};return await Kn.create(c),await qn.logAction("create","client_transaction",c.id,`  ${e.amount} ${e.currency}   `,{id:e.createdBy,name:e.createdByName}),await yt.enqueue("create","client_transaction",c),z.success(`  ${e.amount.toLocaleString()} ${e.currency}   `,{description:` : ${a.toLocaleString()} ${e.currency}`}),c}}const xs=new vw,Ap=({value:t,onChange:e,placeholder:n="0",className:r="",label:s})=>{const[a,c]=x.useState(""),l=m=>m.replace(/[-]/g,u=>"".indexOf(u).toString()),d=m=>m===0||m==="0"?"0":m?Number(m).toLocaleString("en-US"):"";x.useEffect(()=>{c(d(t))},[t]);const h=m=>{const u=l(m.target.value).replace(/[^0-9.,]/g,"");if((u.match(/\./g)||[]).length>1)return;const p=parseFloat(u.replace(/,/g,""));e(isNaN(p)?0:p),u===""||u.endsWith(".")||u.includes(".")&&u.endsWith("0")?c(u):c(d(p))};return i.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[s&&i.jsx("label",{className:"text-sm font-medium text-gray-700",children:s}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",inputMode:"decimal",autoComplete:"off",value:a,onChange:h,placeholder:n,className:`w-full p-2 border border-gray-300 rounded-md text-left font-mono text-lg ${r}`}),i.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm font-bold",children:"IQD"})]})]})},Nw=({isOpen:t,onClose:e,clientId:n,clientName:r,bookingId:s,currentUser:a,currency:c="IQD",onTransactionAdded:l})=>{const[d,h]=x.useState(0),[m,u]=x.useState(""),[p,w]=x.useState(!1),[y,g]=x.useState([]),[N,v]=x.useState(!1);x.useEffect(()=>{t&&n&&C()},[t,n]),x.useEffect(()=>{t||(h(0),u(""))},[t]);const C=async()=>{v(!0);try{const b=await xs.getClientTransactions(n);g(b.slice(0,5))}catch(b){console.error("Error loading transactions:",b)}finally{v(!1)}},S=async b=>{if(b.preventDefault(),isNaN(d)||d<=0){z.error("   ");return}if(!m.trim()){z.error("     ");return}w(!0);try{await xs.addCredit({clientId:n,bookingId:s,amount:d,currency:c,type:"credit_addition",note:m.trim(),createdBy:a.id,createdByName:a.name}),await C(),h(0),u(""),l==null||l(),setTimeout(()=>{e()},500)}catch(A){console.error("Error adding transaction:",A),z.error("    ")}finally{w(!1)}},_=b=>{h(b)},D=b=>new Date(b).toLocaleDateString("ar-IQ",{year:"numeric",month:"short",day:"numeric"}),O=b=>new Date(b).toLocaleTimeString("ar-IQ",{hour:"2-digit",minute:"2-digit"});return t?i.jsx(Bt,{children:t&&i.jsxs(i.Fragment,{children:[i.jsx(ve.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50",onClick:e}),i.jsx(ve.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden",onClick:b=>b.stopPropagation(),children:[i.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm",children:i.jsx(Rc,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-black text-white",children:"  "}),i.jsx("p",{className:"text-white/80 text-sm font-medium",children:r})]})]}),i.jsx("button",{onClick:e,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-xl flex items-center justify-center transition-colors",children:i.jsx(Jt,{className:"w-5 h-5 text-white"})})]})}),i.jsxs("div",{className:"p-6 space-y-6",children:[i.jsxs("form",{onSubmit:S,className:"space-y-5",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-sm font-bold text-gray-700 flex items-center gap-2",children:[i.jsx(Rc,{className:"w-4 h-4 text-amber-500"})," (",c,")"]}),i.jsx(Ap,{value:d,onChange:h,placeholder:"0",className:"bg-gray-50 border-2 border-gray-100 rounded-2xl px-4 py-4 text-2xl font-black text-gray-900 placeholder-gray-300 focus:border-amber-500 focus:ring-0 transition-all text-center"}),i.jsx("div",{className:"flex gap-2 flex-wrap",children:[5e4,1e5,25e4,5e5,1e6].map(b=>i.jsxs("button",{type:"button",onClick:()=>_(b),className:"px-3 py-1.5 bg-amber-50 hover:bg-amber-100 text-amber-700 rounded-lg text-xs font-bold transition-colors",children:["+",b.toLocaleString()]},b))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-sm font-bold text-gray-700 flex items-center gap-2",children:[i.jsx($l,{className:"w-4 h-4 text-amber-500"}),""]}),i.jsx("textarea",{value:m,onChange:b=>u(b.target.value),placeholder:"   ...",rows:3,className:"w-full bg-gray-50 border-2 border-gray-100 rounded-2xl px-4 py-3 text-sm font-bold text-gray-900 placeholder-gray-400 focus:border-amber-500 focus:ring-0 transition-all resize-none"})]}),i.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4 flex items-start gap-3",children:[i.jsx(Hc,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),i.jsxs("div",{className:"text-sm text-blue-700",children:[i.jsx("p",{className:"font-bold mb-1",children:" "}),i.jsxs("p",{className:"text-blue-600",children:["     "," ",i.jsx("span",{className:"font-bold",children:"5 "}),"    ."]})]})]}),i.jsx("button",{type:"submit",disabled:p||!d||!m.trim(),className:"w-full bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-black py-4 rounded-2xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-amber-500/25",children:p?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"})," ..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Wa,{className:"w-5 h-5"})," "]})})]}),y.length>0&&i.jsxs("div",{className:"border-t border-gray-100 pt-5",children:[i.jsxs("h3",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[i.jsx(Bs,{className:"w-4 h-4 text-gray-400"})," "]}),i.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:y.map(b=>i.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl ${b.status==="reversed"?"bg-gray-50 opacity-60":"bg-gray-50"}`,children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${b.status==="reversed"?"bg-gray-200 text-gray-500":b.amount>0?"bg-emerald-100 text-emerald-600":"bg-rose-100 text-rose-600"}`,children:b.status==="reversed"?i.jsx(Jt,{className:"w-4 h-4"}):b.amount>0?i.jsx(Wa,{className:"w-4 h-4"}):i.jsx(Rc,{className:"w-4 h-4"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-bold text-gray-900 line-clamp-1",children:b.note}),i.jsxs("p",{className:"text-[10px] text-gray-500",children:[D(b.createdAt)," "," ",O(b.createdAt)]})]})]}),i.jsxs("div",{className:"text-left",children:[i.jsxs("p",{className:`text-sm font-black ${b.status==="reversed"?"text-gray-400 line-through":b.amount>0?"text-emerald-600":"text-rose-600"}`,dir:"ltr",children:[b.amount>0?"+":"",zt(Math.abs(b.amount),b.currency)]}),b.status==="reversed"&&i.jsx("p",{className:"text-[10px] text-gray-400",children:""})]})]},b.id))})]})]})]})})]})}):null},Sw=({clientId:t,clientName:e,currentUser:n,currency:r="IQD",compact:s=!1})=>{const[a,c]=x.useState([]),[l,d]=x.useState(!0),[h,m]=x.useState(null),[u,p]=x.useState({}),w=x.useCallback(async()=>{try{const b=await xs.getClientTransactions(t);c(b);const A={};b.forEach(q=>{q.status==="active"&&(A[q.id]=xs.getReversalTimeRemaining(q))}),p(A)}catch(b){console.error("Error loading transactions:",b)}finally{d(!1)}},[t]);x.useEffect(()=>{w()},[w]),x.useEffect(()=>{const b=setInterval(()=>{p(A=>{const q={...A};return Object.keys(q).forEach(I=>{q[I]>0&&(q[I]=Math.max(0,q[I]-1))}),q})},1e3);return()=>clearInterval(b)},[]);const y=async b=>{if(!xs.canReverse(b)){z.error("     ");return}if(window.confirm(`       ${zt(b.amount,b.currency)}

: ${b.note}`)){m(b.id);try{await xs.reverseTransaction({transactionId:b.id,reversedBy:n.id,reversedByName:n.name,reason:"    "})&&await w()}catch(q){console.error("Error reversing transaction:",q),z.error("     ")}finally{m(null)}}},g=b=>new Date(b).toLocaleDateString("ar-IQ",{year:"numeric",month:"short",day:"numeric"}),N=b=>new Date(b).toLocaleTimeString("ar-IQ",{hour:"2-digit",minute:"2-digit"}),v=b=>b.status==="reversed"?i.jsx(wm,{className:"w-4 h-4 text-gray-400"}):b.amount>0?i.jsx(Wa,{className:"w-4 h-4 text-emerald-500"}):i.jsx(eg,{className:"w-4 h-4 text-rose-500"}),C=b=>b.status==="reversed"?"bg-gray-50 border-gray-100":b.amount>0?"bg-emerald-50/50 border-emerald-100":"bg-rose-50/50 border-rose-100",S=a.filter(b=>b.status==="active"),_=S.filter(b=>b.amount>0).reduce((b,A)=>b+A.amount,0),D=S.filter(b=>b.amount<0).reduce((b,A)=>b+Math.abs(A.amount),0),O=_-D;return l?i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsx("div",{className:"w-6 h-6 border-2 border-amber-500 border-t-transparent rounded-full animate-spin"})}):a.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-16 h-16 bg-gray-50 rounded-2xl flex items-center justify-center mx-auto mb-3",children:i.jsx(Jc,{className:"w-8 h-8 text-gray-300"})}),i.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"    "})]}):i.jsxs("div",{className:"space-y-4",children:[!s&&i.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[i.jsxs("div",{className:"bg-emerald-50 rounded-xl p-3 border border-emerald-100",children:[i.jsx("p",{className:"text-[10px] font-bold text-emerald-600 uppercase mb-1",children:""}),i.jsx("p",{className:"text-lg font-black text-emerald-700",dir:"ltr",children:zt(_,r)})]}),i.jsxs("div",{className:"bg-rose-50 rounded-xl p-3 border border-rose-100",children:[i.jsx("p",{className:"text-[10px] font-bold text-rose-600 uppercase mb-1",children:""}),i.jsx("p",{className:"text-lg font-black text-rose-700",dir:"ltr",children:zt(D,r)})]}),i.jsxs("div",{className:`rounded-xl p-3 border ${O>=0?"bg-blue-50 border-blue-100":"bg-amber-50 border-amber-100"}`,children:[i.jsx("p",{className:`text-[10px] font-bold uppercase mb-1 ${O>=0?"text-blue-600":"text-amber-600"}`,children:" "}),i.jsx("p",{className:`text-lg font-black ${O>=0?"text-blue-700":"text-amber-700"}`,dir:"ltr",children:zt(O,r)})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider flex items-center gap-2",children:[i.jsx(Jc,{className:"w-3.5 h-3.5"})," "]}),i.jsx("div",{className:`space-y-2 ${s?"max-h-48":"max-h-64"} overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-200 scrollbar-track-transparent`,children:i.jsx(Bt,{mode:"popLayout",children:a.map((b,A)=>{const q=xs.canReverse(b),I=u[b.id]||0,M=h===b.id;return i.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{delay:A*.05},className:`p-3 rounded-xl border ${C(b)} transition-all`,children:i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[i.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${b.status==="reversed"?"bg-gray-100":b.amount>0?"bg-emerald-100":"bg-rose-100"}`,children:v(b)}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:`text-sm font-bold truncate ${b.status==="reversed"?"text-gray-400 line-through":"text-gray-900"}`,children:b.note}),i.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[i.jsxs("span",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[i.jsx(Bs,{className:"w-3 h-3"}),g(b.createdAt),"  ",N(b.createdAt)]}),i.jsxs("span",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[i.jsx(qs,{className:"w-3 h-3"}),b.createdByName]})]}),b.status==="reversed"&&i.jsxs("div",{className:"mt-2 p-2 bg-gray-100 rounded-lg",children:[i.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[i.jsx(Oh,{className:"w-3 h-3"}),"   ",b.reversedByName]}),b.reversalReason&&i.jsxs("p",{className:"text-[10px] text-gray-400 mt-0.5",children:[": ",b.reversalReason]})]})]})]}),i.jsxs("div",{className:"text-left flex-shrink-0",children:[i.jsxs("p",{className:`text-base font-black ${b.status==="reversed"?"text-gray-400 line-through":b.amount>0?"text-emerald-600":"text-rose-600"}`,dir:"ltr",children:[b.amount>0?"+":"",zt(Math.abs(b.amount),b.currency)]}),b.status==="active"&&q&&I>0&&i.jsx("button",{onClick:()=>y(b),disabled:M,className:"mt-2 text-[10px] font-bold text-amber-600 hover:text-amber-700 bg-amber-50 hover:bg-amber-100 px-2 py-1 rounded-lg transition-colors flex items-center gap-1",children:M?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-3 h-3 border border-amber-600 border-t-transparent rounded-full animate-spin"}),"..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Oh,{className:"w-3 h-3"})," (",xs.formatTimeRemaining(I),")"]})})]})]})},b.id)})})})]}),i.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-gray-500 pt-2 border-t border-gray-100",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),i.jsx("span",{children:""})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-rose-500"}),i.jsx("span",{children:""})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),i.jsx("span",{children:""})]}),i.jsxs("div",{className:"flex items-center gap-1 mr-auto",children:[i.jsx(Bs,{className:"w-3 h-3"}),i.jsx("span",{children:"   5 "})]})]})]})},kw=({isOpen:t,onClose:e,onAdd:n,bookingCurrency:r="IQD"})=>{const[s,a]=x.useState(""),[c,l]=x.useState(""),[d,h]=x.useState(r),m=x.useRef(null);x.useEffect(()=>{t&&m.current&&setTimeout(()=>{var v;return(v=m.current)==null?void 0:v.focus()},100)},[t]);const u=v=>{if(!v&&v!==0)return"";const C=String(v).replace(/[^\d]/g,"");return C?C.replace(/\B(?=(\d{3})+(?!\d))/g,","):""},p=v=>{const C=v.replace(/[^\d]/g,"");return parseInt(C,10)||0},w=v=>{const C=v.target,S=C.selectionStart||0,D=(C.value.slice(0,S).match(/,/g)||[]).length;let O=v.target.value;const b={"":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9"};O=O.split("").map(I=>b[I]||I).join("");const A=O.replace(/[^\d]/g,""),q=u(A);a(A),requestAnimationFrame(()=>{if(m.current){const I=(q.slice(0,S).match(/,/g)||[]).length,M=S+(I-D);m.current.setSelectionRange(M,M)}})},y=()=>{const v=p(s);if(!v||v<=0){z.error("   ");return}if(!c.trim()){z.error("   ");return}n(v,c.trim(),d),a(""),l(""),h(r),e(),z.success(`  ${u(v)} ${d==="USD"?"$":"."} `)};if(x.useEffect(()=>{const v=C=>{C.key==="Escape"&&e()};return t&&window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[t,e]),!t)return null;const g=u(s),N=p(s);return i.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[99999] p-4",onClick:e,children:i.jsxs("div",{className:"bg-[#1a1c22] rounded-3xl shadow-2xl w-full max-w-md border border-white/10 overflow-hidden animate-in zoom-in-95 fade-in duration-200",onClick:v=>v.stopPropagation(),dir:"rtl",children:[i.jsxs("div",{className:"relative p-6 border-b border-white/10 bg-gradient-to-br from-purple-500/10 via-transparent to-pink-500/5",children:[i.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl pointer-events-none"}),i.jsx("div",{className:"absolute bottom-0 right-0 w-24 h-24 bg-pink-500/10 rounded-full blur-2xl pointer-events-none"}),i.jsxs("div",{className:"relative flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white shadow-lg shadow-purple-500/30",children:i.jsx(Zo,{size:22})}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-black text-white",children:"  "}),i.jsx("p",{className:"text-xs text-gray-400",children:"   "})]})]}),i.jsx("button",{onClick:e,className:"p-2.5 hover:bg-white/10 rounded-xl transition-all text-gray-400 hover:text-white hover:rotate-90 duration-300",children:i.jsx(Jt,{size:20})})]})]}),i.jsxs("div",{className:"p-6 space-y-5",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:[i.jsx(Go,{size:14,className:"text-purple-400"}),""]}),i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("button",{type:"button",onClick:()=>h("IQD"),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${d==="IQD"?"bg-purple-500 text-white shadow-lg shadow-purple-500/30":"bg-white/5 text-gray-400 hover:bg-white/10 border border-white/10"}`,children:"  (IQD)"}),i.jsx("button",{type:"button",onClick:()=>h("USD"),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${d==="USD"?"bg-green-500 text-white shadow-lg shadow-green-500/30":"bg-white/5 text-gray-400 hover:bg-white/10 border border-white/10"}`,children:" ($)"})]}),i.jsxs("div",{className:"relative group",children:[i.jsx("input",{ref:m,type:"text",inputMode:"numeric",value:g,onChange:w,onKeyDown:v=>{v.key==="Enter"&&y()},placeholder:"0",className:"w-full px-5 py-4 bg-black/40 border-2 border-white/10 rounded-2xl text-2xl font-black text-white focus:outline-none focus:border-purple-500/50 focus:bg-black/60 transition-all text-center placeholder:text-gray-600 tracking-wider",style:{fontFamily:"monospace"}}),i.jsx("div",{className:`absolute left-3 top-1/2 -translate-y-1/2 px-3 py-1.5 rounded-lg border ${d==="USD"?"bg-green-500/20 border-green-500/30":"bg-purple-500/20 border-purple-500/30"}`,children:i.jsx("span",{className:`text-sm font-black ${d==="USD"?"text-green-400":"text-purple-400"}`,children:d==="USD"?"$":"."})}),i.jsx("div",{className:"absolute inset-0 rounded-2xl bg-purple-500/5 opacity-0 group-focus-within:opacity-100 transition-opacity pointer-events-none"})]}),N>0&&i.jsx("div",{className:"mt-3 p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-xl border border-purple-500/20 animate-in fade-in slide-in-from-top-2 duration-200",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-xs text-gray-400",children:":"}),i.jsxs("span",{className:`text-lg font-black ${d==="USD"?"text-green-400":"text-purple-400"}`,children:[d==="USD"?"$":"",g," ",d==="IQD"?i.jsx("span",{className:"text-xs text-gray-500",children:"."}):""]})]})})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:[i.jsx($l,{size:14,className:"text-pink-400"})," "]}),i.jsx("textarea",{value:c,onChange:v=>l(v.target.value),placeholder:":      ...",rows:3,className:"w-full px-4 py-3.5 bg-black/40 border-2 border-white/10 rounded-2xl text-sm font-medium text-white focus:outline-none focus:border-pink-500/50 focus:bg-black/60 transition-all resize-none placeholder:text-gray-600"})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:[" "," ","",""," "].map(v=>i.jsx("button",{type:"button",onClick:()=>l(v),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${c===v?"bg-purple-500 text-white":"bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border border-white/10"}`,children:v},v))}),i.jsxs("div",{className:"flex gap-3 pt-4",children:[i.jsx("button",{onClick:e,className:"flex-1 py-3.5 bg-white/5 border border-white/10 text-gray-400 rounded-2xl font-bold hover:bg-white/10 hover:text-white transition-all",children:""}),i.jsxs("button",{onClick:y,disabled:!N||!c.trim(),className:"flex-1 py-3.5 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-2xl font-bold shadow-lg shadow-purple-500/30 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:[i.jsx(Wa,{size:18}),""]})]})]})]})})},yf=()=>typeof window<"u"?window.electronAPI:void 0;function Dp({bookingId:t,clientName:e,autoInitialize:n=!0}){const[r,s]=x.useState(null),[a,c]=x.useState([]),[l,d]=x.useState(!1),[h,m]=x.useState(0),[u,p]=x.useState(""),[w,y]=x.useState(0),g=x.useRef(`session_${t}_${Date.now()}`),N=x.useCallback(O=>{const b=O.filter(A=>A.isSelected).length;y(b)},[]);x.useEffect(()=>{n&&C()},[t,e,n]);const v=x.useCallback(async()=>{try{const{data:O,error:b}=await H.from("session_images").select("*").eq("sessionId",(r==null?void 0:r.id)||"").order("createdAt",{ascending:!0});if(b)throw b;const A=O||[];c(A),N(A)}catch(O){console.error("Failed to load images:",O)}},[r==null?void 0:r.id,N]);x.useEffect(()=>{if(!(r!=null&&r.id))return;const O=H.channel(`session-${r.id}`).on("postgres_changes",{event:"*",schema:"public",table:"session_images",filter:`sessionId=eq.${r.id}`},b=>{b.eventType==="INSERT"?c(A=>[...A,b.new]):b.eventType==="UPDATE"?c(A=>A.map(q=>q.id===b.new.id?{...q,...b.new}:q)):b.eventType==="DELETE"&&c(A=>A.filter(q=>q.id!==b.old.id)),c(A=>(N(A),A))}).subscribe();return()=>{O.unsubscribe()}},[r==null?void 0:r.id,N]);const C=x.useCallback(async()=>{var O;try{const{data:b,error:A}=await H.from("sessions").select("*").eq("bookingId",t).single();if(A&&A.code!=="PGRST116")throw A;if(b){s(b),g.current=b.id;const{data:q,error:I}=await H.from("session_images").select("*").eq("sessionId",b.id).order("createdAt",{ascending:!0});if(I)throw I;const M=q||[];c(M),N(M)}else{const q=g.current,I=new Date().toISOString(),M=yf();let V=null;if((O=M==null?void 0:M.sessionLifecycle)!=null&&O.createSessionDirectory){const he=await M.sessionLifecycle.createSessionDirectory(e,q,I);he!=null&&he.success&&he.sessionPath&&(V=he.sessionPath)}const{data:de,error:X}=await H.from("sessions").insert({id:q,bookingId:t,clientName:e,status:"uploaded",folderPath:V,createdAt:I}).select().single();if(X)throw X;s(de)}}catch(b){console.error("Failed to initialize session:",b)}},[t,e]),S=x.useCallback(async O=>{var b,A;if(r){d(!0),m(0),p("  ...");try{const q=Array.from(O),I=[];for(const de of q){const X=de;X.path&&I.push(X.path)}if(I.length===0)throw new Error("No valid file paths found");const M=yf();let V=null;if((b=M==null?void 0:M.sessionLifecycle)!=null&&b.onIngestionProgress&&(V=M.sessionLifecycle.onIngestionProgress(({progress:de,status:X})=>{m(de),p(X)})),(A=M==null?void 0:M.sessionLifecycle)!=null&&A.processFiles){const de=await M.sessionLifecycle.processFiles(I,{clientName:e,sessionId:r.id,date:new Date}),X=new Date().toISOString(),he=de.success.map(ie=>({id:Mt(),sessionId:r.id,fileName:ie.fileName,cloudUrl:ie.cloud,localPath:ie.local,isSelected:!1,createdAt:X}));if(he.length>0){const{error:ie}=await H.from("session_images").insert(he);if(ie)throw ie}await v(),p(`  ${de.success.length}  `)}V&&V()}catch(q){console.error("Upload failed:",q),p(" ")}finally{d(!1)}}},[r,e,v]),_=x.useCallback(async O=>{try{const b=a.find(I=>I.id===O);if(!b)return;const A=!b.isSelected;await H.from("session_images").update({isSelected:A}).eq("id",O),c(I=>I.map(M=>M.id===O?{...M,isSelected:A}:M));const q=A?w+1:w-1;y(q)}catch(b){console.error("Failed to toggle selection:",b)}},[a,w]),D=x.useCallback(()=>a.filter(O=>O.isSelected),[a]);return{session:r,images:a,isUploading:l,uploadProgress:h,uploadStatus:u,selectedCount:w,totalCount:a.length,initializeSession:C,uploadFiles:S,toggleSelection:_,loadImages:v,getSelectedImages:D}}function jw({bookingId:t,clientName:e,onComplete:n}){console.log("[SelectionDashboard] Rendering for booking:",t,"client:",e);const{images:r,isUploading:s,uploadProgress:a,uploadStatus:c,selectedCount:l,totalCount:d,uploadFiles:h,toggleSelection:m}=Dp({bookingId:t,clientName:e}),[u,p]=x.useState("all"),[w,y]=x.useState(!1),g=r.filter(D=>u==="selected"?D.isSelected:u==="unselected"?!D.isSelected:!0),N=x.useCallback(D=>{D.preventDefault(),y(!0)},[]),v=x.useCallback(D=>{D.preventDefault(),y(!1)},[]),C=x.useCallback(D=>{D.preventDefault(),y(!1);const O=D.dataTransfer.files;O.length>0&&h(O)},[h]),S=x.useCallback(D=>{const O=D.target.files;O&&O.length>0&&h(O)},[h]),_=d>0?Math.round(l/d*100):0;return i.jsxs("div",{className:"w-full h-full flex flex-col bg-[#21242b]",children:[i.jsxs("div",{className:"bg-[#1a1c22] border-b border-white/10 px-6 py-4 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-semibold text-white",children:" "}),i.jsx("p",{className:"text-sm text-gray-400",children:e})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2 bg-[#21242b] px-4 py-2 rounded-lg border border-white/10",children:[i.jsx(_d,{className:"w-5 h-5 text-green-500"}),i.jsxs("span",{className:"text-sm font-medium text-white",children:[l," / ",d," "]}),i.jsx("div",{className:"w-24 h-2 bg-gray-700 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${_}%`}})})]}),i.jsxs("div",{className:"flex items-center gap-1 bg-[#21242b] p-1 rounded-lg border border-white/10",children:[i.jsx(xd,{active:u==="all",onClick:()=>p("all"),icon:i.jsx(tg,{className:"w-4 h-4"}),label:""}),i.jsx(xd,{active:u==="selected",onClick:()=>p("selected"),icon:i.jsx(Xr,{className:"w-4 h-4"}),label:""}),i.jsx(xd,{active:u==="unselected",onClick:()=>p("unselected"),icon:i.jsx(Jt,{className:"w-4 h-4"}),label:" "})]})]})]}),d===0&&i.jsxs("div",{onDragOver:N,onDragLeave:v,onDrop:C,className:`
            mx-6 mt-6 p-12 border-2 border-dashed rounded-xl text-center transition-all
            ${w?"border-blue-500 bg-blue-500/10":"border-gray-600 bg-[#1a1c22] hover:border-gray-500"}
          `,children:[i.jsx(Od,{className:"w-12 h-12 mx-auto text-gray-500 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"  "}),i.jsx("p",{className:"text-gray-400 mb-4",children:"     "}),i.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 bg-[#C94557] text-white rounded-lg hover:bg-[#C94557]/90 cursor-pointer transition-colors",children:[i.jsx(uo,{className:"w-4 h-4"}),i.jsx("span",{children:" "}),i.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:S,className:"hidden"})]})]}),s&&i.jsxs("div",{className:"mx-6 mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"text-sm font-medium text-blue-400",children:c}),i.jsxs("span",{className:"text-sm text-blue-400",children:[a,"%"]})]}),i.jsx("div",{className:"w-full h-2 bg-gray-700 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${a}%`}})})]}),i.jsx("div",{className:"flex-1 overflow-auto p-6",children:g.length===0?i.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[i.jsx(uo,{className:"w-16 h-16 mb-4"}),i.jsxs("p",{className:"text-lg",children:["   ",u!=="all"?"  ":""]}),d===0&&!s&&i.jsx("p",{className:"text-sm mt-2",children:"   "})]}):i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:g.map(D=>i.jsx(Ew,{image:D,onToggle:()=>m(D.id)},D.id))})}),d>0&&i.jsxs("div",{className:"bg-[#1a1c22] border-t border-white/10 px-6 py-4 flex items-center justify-between",children:[i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 bg-[#21242b] text-gray-300 rounded-lg hover:bg-[#2a2d35] cursor-pointer transition-colors border border-white/10",children:[i.jsx(Od,{className:"w-4 h-4"}),i.jsx("span",{children:" "}),i.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:S,className:"hidden"})]})}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("span",{className:"text-sm text-gray-400",children:[l,"    ",d]}),i.jsx("button",{onClick:n,disabled:l===0,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-700 disabled:cursor-not-allowed transition-colors",children:" "})]})]})]})}function xd({active:t,onClick:e,icon:n,label:r}){return i.jsxs("button",{onClick:e,className:`
        flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all
        ${t?"bg-[#C94557] text-white":"text-gray-400 hover:text-white hover:bg-white/5"}
      `,children:[n,i.jsx("span",{children:r})]})}function Ew({image:t,onToggle:e}){const[n,r]=x.useState(!1);return i.jsxs("div",{className:`
        relative group rounded-lg overflow-hidden bg-[#1a1c22] cursor-pointer
        transition-all duration-200 hover:shadow-lg border border-white/10
        ${t.isSelected?"ring-2 ring-green-500":""}
      `,onClick:e,children:[i.jsxs("div",{className:"aspect-square relative",children:[!n&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsx("div",{className:"w-8 h-8 border-2 border-gray-600 border-t-blue-500 rounded-full animate-spin"})}),i.jsx("img",{src:t.cloudUrl,alt:t.fileName,className:`
            w-full h-full object-cover transition-opacity duration-300
            ${n?"opacity-100":"opacity-0"}
          `,onLoad:()=>r(!0),loading:"lazy"})]}),i.jsx("div",{className:`
        absolute inset-0 flex items-center justify-center
        transition-opacity duration-200
        ${t.isSelected?"bg-green-500/20 opacity-100":"bg-black/0 opacity-0 group-hover:bg-black/40"}
      `,children:t.isSelected?i.jsx("div",{className:"w-12 h-12 rounded-full bg-green-500 flex items-center justify-center shadow-lg",children:i.jsx(Xr,{className:"w-6 h-6 text-white"})}):i.jsx("div",{className:"w-12 h-12 rounded-full bg-white/90 flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsx(Xr,{className:"w-6 h-6 text-gray-600"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2",children:i.jsx("p",{className:"text-xs text-white truncate",children:t.fileName})}),t.isSelected&&i.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center shadow-md",children:i.jsx(Xr,{className:"w-4 h-4 text-white"})})]})}function Cw({isOpen:t,onClose:e,bookingId:n,clientName:r,onComplete:s}){return console.log("[SelectionModal] Rendering - isOpen:",t,"bookingId:",n),t?i.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:[i.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:e}),i.jsxs("div",{className:"relative w-full h-full max-w-7xl max-h-[90vh] m-4 bg-[#1a1c22] rounded-xl shadow-2xl overflow-hidden flex flex-col border border-white/10",children:[i.jsx("button",{onClick:e,className:"absolute top-4 left-4 z-10 p-2 bg-[#21242b] hover:bg-[#2a2d35] rounded-full shadow-lg transition-colors border border-white/10",children:i.jsx(Jt,{className:"w-5 h-5 text-gray-300"})}),i.jsx("div",{className:"flex-1 overflow-hidden",children:i.jsx(jw,{bookingId:n,clientName:r,onComplete:()=>{s==null||s(),e()}})})]})]}):null}function _w({session:t,imageCount:e,selectedCount:n,onOpenSelection:r,onOpenFolder:s}){const a=e>0?Math.round(n/e*100):0,c=d=>{switch(d){case"uploaded":return"bg-blue-500/20 text-blue-400";case"selected":return"bg-green-500/20 text-green-400";case"printed":return"bg-purple-500/20 text-purple-400";default:return"bg-gray-500/20 text-gray-400"}},l=d=>{switch(d){case"uploaded":return" ";case"selected":return" ";case"printed":return" ";default:return d}};return t?i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(uo,{size:18,className:"text-[#C94557]"}),i.jsx("h3",{className:"text-lg font-bold text-white",children:" "}),i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full mr-auto ${c(t.status)}`,children:l(t.status)})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[i.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-gray-500 mb-2",children:[i.jsx(uo,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs",children:" "})]}),i.jsx("span",{className:"text-2xl font-bold text-white",children:e})]}),i.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-gray-500 mb-2",children:[i.jsx(_d,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs",children:""})]}),i.jsx("span",{className:"text-2xl font-bold text-green-400",children:n})]})]}),e>0&&i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"flex items-center justify-between text-xs mb-2",children:[i.jsx("span",{className:"text-gray-500",children:" "}),i.jsxs("span",{className:"font-medium text-gray-300",children:[a,"%"]})]}),i.jsx("div",{className:"w-full h-2 bg-white/10 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${a}%`}})})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("button",{onClick:r,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#C94557] text-white rounded-xl hover:bg-[#C94557]/90 transition-colors text-sm font-medium",children:[i.jsx(_d,{className:"w-4 h-4"}),i.jsx("span",{children:n>0?" ":" "})]}),t.folderPath&&i.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-4 py-2.5 bg-white/5 text-gray-300 rounded-xl hover:bg-white/10 transition-colors text-sm font-medium",children:[i.jsx(xm,{className:"w-4 h-4"}),i.jsx("span",{children:""})]})]})]}):i.jsx("div",{className:"border border-dashed border-white/20 rounded-xl p-4",children:i.jsxs("div",{className:"flex items-center gap-3 text-gray-500",children:[i.jsx(uo,{className:"w-5 h-5"}),i.jsx("span",{className:"text-sm",children:"   "})]})})}function Pp(t){const e=new Date().toISOString().slice(0,10);if(!t||typeof t!="string")return e;if(/^\d{4}-\d{2}-\d{2}/.test(t)){const s=new Date(t);if(!isNaN(s.getTime()))return t.slice(0,10)}if(t.match(/^(07\d{9,10}|\d{10,15})$/))return console.warn(`[sanitizeDate] Invalid date detected (phone number): ${t}. Using fallback date.`),e;const r=new Date(t);return isNaN(r.getTime())?(console.warn(`[sanitizeDate] Unparseable date: ${t}. Using fallback date.`),e):r.toISOString().slice(0,10)}const uj={mainFilter:"all",suraSubFilter:"all_sura",villaSubFilter:"all_villa"},hj={all_sura:" ",vip:" VIP",wedding_party:" ",wedding_studio:" ",kids:" ",general:" ",printing:" "},fj={all_villa:" ",venue_party:" ",venue_room:" VIP",venue_session:"",venue_commercial:" "};function Ou(t){return t.category!==es.LOCATION}function fl(t){return t.category===es.LOCATION}function Iu(t){if(fl(t)){const n=t.servicePackage||"";return n.includes("")||n.includes("VIP")?"venue_room":n.includes("")||n.includes("")?"venue_party":n.includes("")||n.includes("")?"venue_commercial":"venue_session"}const e=t.servicePackage||"";return e.includes("VIP")?"vip":e.includes("")||e.includes(" ")?"wedding_party":e.includes("")||e.includes("")?"wedding_studio":e.includes("")||e.includes("kids")?"kids":e.includes("")||e.includes("")?"printing":"general"}function mj(t,e,n){return t.filter(r=>{const s=e.filter(l=>l.clientId===r.id);if(s.length===0)return n.mainFilter==="all";const a=s.some(Ou),c=s.some(fl);if(n.mainFilter==="sura"){if(!a||n.suraSubFilter!=="all_sura"&&!s.some(d=>Ou(d)?Iu(d)===n.suraSubFilter:!1))return!1}else if(n.mainFilter==="villa"&&(!c||n.villaSubFilter!=="all_villa"&&!s.some(d=>fl(d)?Iu(d)===n.villaSubFilter:!1)))return!1;return!0})}function pj(t){const e={all:t.length,sura:t.filter(Ou).length,villa:t.filter(fl).length,vip:0,wedding_party:0,wedding_studio:0,kids:0,general:0,printing:0,venue_party:0,venue_room:0,venue_session:0,venue_commercial:0};return t.forEach(n=>{const r=Iu(n);r in e&&e[r]++}),e}const Ow=({booking:t,onStatusChange:e,onUpdateBooking:n,onSettlePayment:r,onBack:s})=>{var A,q,I,M,V,de,X,he,ie;const[a,c]=x.useState(!1),[l,d]=x.useState(!1),[h,m]=x.useState(0),[u,p]=x.useState(!1),[w,y]=x.useState(!1),g={id:"reception-user",name:" "},{session:N,selectedCount:v,totalCount:C}=Dp({bookingId:t.id,clientName:t.clientName}),[S,_]=x.useState({title:t.title,clientName:t.clientName,clientPhone:t.clientPhone,clientEmail:t.clientEmail||"",shootDate:t.shootDate,servicePackage:t.servicePackage,startTime:((A=t.details)==null?void 0:A.startTime)||"",endTime:((q=t.details)==null?void 0:q.endTime)||"",notes:((I=t.details)==null?void 0:I.notes)||""});x.useEffect(()=>{var P,J,le;_({title:t.title,clientName:t.clientName,clientPhone:t.clientPhone,clientEmail:t.clientEmail||"",shootDate:t.shootDate,servicePackage:t.servicePackage,startTime:((P=t.details)==null?void 0:P.startTime)||"",endTime:((J=t.details)==null?void 0:J.endTime)||"",notes:((le=t.details)==null?void 0:le.notes)||""})},[t]);const D=()=>{n(t.id,{title:S.title,clientName:S.clientName,clientPhone:S.clientPhone,clientEmail:S.clientEmail,shootDate:S.shootDate,servicePackage:S.servicePackage,details:{...t.details,startTime:S.startTime,endTime:S.endTime,notes:S.notes}}),c(!1),z.success("   ")},O=async(P,J,le)=>{var Fe;try{const{electronBackend:kt}=await fe(async()=>{const{electronBackend:mt}=await Promise.resolve().then(()=>Yw);return{electronBackend:mt}},void 0,import.meta.url),lt=le||"IQD",K=t.currency===lt;await kt.addExtraService(t.id,P,J,g.id,g.name,lt);const ne=((Fe=t.details)==null?void 0:Fe.extraItems)||[],Ne={id:Date.now().toString(),amount:P,currency:lt,description:J},Qe=[...ne,Ne];if(K)n(t.id,{totalAmount:t.totalAmount+P,paidAmount:t.paidAmount+P,details:{...t.details,extraItems:Qe}});else{const mt=t.addOnTotal||0;n(t.id,{addOnTotal:mt+P,originalPackagePrice:t.originalPackagePrice||t.totalAmount,details:{...t.details,extraItems:Qe}})}z.success("       ")}catch(kt){console.error("Failed to add extra service:",kt),z.error("     ")}},b=t.totalAmount-t.paidAmount;return i.jsxs("div",{className:"bg-[#21242b] min-h-screen p-6 font-sans",dir:"rtl",children:[i.jsx("div",{className:"max-w-6xl mx-auto mb-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("button",{onClick:s,className:"p-2.5 bg-[#1a1c22] rounded-xl border border-white/10 text-gray-300 hover:bg-[#1f222a] transition-colors",children:i.jsx(ng,{size:20})}),i.jsx("div",{className:"flex gap-3",children:i.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-[#1a1c22] text-gray-300 border border-white/10 rounded-xl font-semibold hover:bg-[#1f222a] transition-colors",children:[i.jsx(Wa,{size:18}),"  "]})})]})}),i.jsx("div",{className:"max-w-6xl mx-auto",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[i.jsxs("div",{className:"bg-[#1a1c22] rounded-2xl p-6 border border-white/10 shadow-sm",children:[i.jsxs("div",{className:"flex items-start justify-between mb-6",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-16 h-16 rounded-xl bg-[#C94557]/20 flex items-center justify-center text-[#C94557] text-2xl font-bold",children:(M=t.clientName)==null?void 0:M.charAt(0)}),i.jsx("div",{children:a?i.jsx("input",{type:"text",value:S.clientName,onChange:P=>_({...S,clientName:P.target.value}),className:"text-2xl font-bold text-white border-b-2 border-[#C94557] outline-none bg-transparent pb-1"}):i.jsxs(i.Fragment,{children:[i.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:t.clientName}),i.jsx("p",{className:"text-sm text-gray-400",children:t.title})]})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"px-3 py-1.5 bg-white/5 rounded-lg text-xs font-semibold text-gray-300",children:Zx[t.status]}),a?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:D,"data-testid":"save-booking-btn",className:"p-2 bg-[#C94557] hover:bg-[#B3434F] text-white rounded-lg transition-colors",children:i.jsx(jm,{size:16})}),i.jsx("button",{onClick:()=>c(!1),className:"p-2 bg-white/5 text-gray-300 rounded-lg hover:bg-white/10 transition-colors",children:i.jsx(Jt,{size:16})})]}):i.jsx("button",{onClick:()=>c(!0),"data-testid":"edit-booking-btn",className:"p-2 bg-white/5 text-gray-300 rounded-lg hover:bg-white/10 transition-colors",children:i.jsx(rg,{size:16})})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"p-4 bg-white/5 rounded-xl",children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wider",children:" "}),a?i.jsxs("div",{className:"space-y-2",children:[i.jsx("input",{type:"text",value:S.clientPhone,onChange:P=>_({...S,clientPhone:P.target.value}),className:"w-full text-sm font-medium bg-[#21242b] text-white border border-white/10 rounded-lg px-3 py-2"}),i.jsx("input",{type:"text",value:S.clientEmail,onChange:P=>_({...S,clientEmail:P.target.value}),className:"w-full text-sm font-medium bg-[#21242b] text-white border border-white/10 rounded-lg px-3 py-2"})]}):i.jsxs("div",{className:"space-y-2.5",children:[i.jsxs("div",{className:"flex items-center gap-2 text-white",children:[i.jsx(Em,{size:14,className:"text-[#C94557]"}),i.jsx("span",{className:"text-sm font-medium",dir:"ltr",children:t.clientPhone})]}),i.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[i.jsx(Cm,{size:14,className:"text-[#C94557]"}),i.jsx("span",{className:"text-sm",children:t.clientEmail||" "})]})]})]}),i.jsxs("div",{className:"p-4 bg-white/5 rounded-xl",children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wider",children:" "}),a?i.jsxs("div",{className:"space-y-2",children:[i.jsx("input",{type:"date",value:Pp(S.shootDate),onChange:P=>_({...S,shootDate:P.target.value}),className:"w-full text-sm font-medium bg-[#21242b] text-white border border-white/10 rounded-lg px-3 py-2"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx("input",{type:"time",value:S.startTime,onChange:P=>_({...S,startTime:P.target.value}),className:"w-full text-sm font-medium bg-[#21242b] text-white border border-white/10 rounded-lg px-3 py-2"}),i.jsx("input",{type:"time",value:S.endTime,onChange:P=>_({...S,endTime:P.target.value}),className:"w-full text-sm font-medium bg-[#21242b] text-white border border-white/10 rounded-lg px-3 py-2"})]})]}):i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2 text-white",children:[i.jsx(zs,{size:14,className:"text-[#C94557]"}),i.jsx("span",{className:"text-sm font-medium",children:kg(Eg(t.shootDate),"dd MMMM yyyy",{locale:jg})})]}),i.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[i.jsx(Bs,{size:14,className:"text-[#C94557]"}),i.jsxs("span",{className:"text-sm",children:[((V=t.details)==null?void 0:V.startTime)||"--:--"," - ",((de=t.details)==null?void 0:de.endTime)||"--:--"]})]})]})]})]})]}),i.jsxs("div",{className:"bg-[#1a1c22] rounded-2xl p-6 border border-white/10 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(sg,{size:18,className:"text-[#C94557]"}),i.jsx("h3",{className:"text-lg font-bold text-white",children:""})]}),a?i.jsx("textarea",{value:S.notes,onChange:P=>_({...S,notes:P.target.value}),className:"w-full min-h-[100px] p-4 bg-white/5 border border-white/10 rounded-xl text-sm text-white outline-none focus:border-[#C94557]/50 transition-colors resize-none",placeholder:" ..."}):i.jsx("p",{className:"text-sm text-gray-400 leading-relaxed bg-white/5 p-4 rounded-xl min-h-[100px]",children:((X=t.details)==null?void 0:X.notes)||"  ."})]}),i.jsxs("div",{className:"bg-[#1a1c22] rounded-2xl p-6 border border-white/10 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(Jc,{size:18,className:"text-[#C94557]"}),i.jsx("h3",{className:"text-lg font-bold text-white",children:" "})]}),i.jsx(Sw,{clientId:t.clientId,clientName:t.clientName,currentUser:g,currency:t.currency,compact:!0},h)]}),i.jsx("div",{className:"bg-[#1a1c22] rounded-2xl p-6 border border-white/10 shadow-sm",children:i.jsx(_w,{session:N,imageCount:C,selectedCount:v,onOpenSelection:()=>y(!0),onOpenFolder:()=>{var P,J,le;N!=null&&N.folderPath&&((le=(J=(P=window.electronAPI)==null?void 0:P.fileSystem)==null?void 0:J.openDirectory)==null||le.call(J))}})})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-[#1a1c22] rounded-2xl p-6 border border-white/10 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[i.jsx(Rc,{size:18,className:"text-[#C94557]"}),i.jsx("h3",{className:"text-lg font-bold text-white",children:" "})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-xl border border-blue-500/20",children:[i.jsxs("div",{className:"flex justify-between items-center mb-1",children:[i.jsx("span",{className:"text-sm font-medium text-gray-400",children:" "}),i.jsx(Go,{size:16,className:"text-blue-400"})]}),i.jsx("p",{className:"text-2xl font-bold text-blue-300",children:zt(((he=t.details)==null?void 0:he.baseAmount)||t.totalAmount,t.currency)})]}),((ie=t.details)==null?void 0:ie.extraItems)&&t.details.extraItems.length>0&&i.jsxs("div",{children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wider",children:" "}),i.jsx("div",{className:"space-y-2",children:t.details.extraItems.map((P,J)=>i.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-500/10 rounded-lg border border-purple-500/20",children:[i.jsx("span",{className:"text-sm text-purple-300",children:P.description}),i.jsxs("span",{className:"text-sm font-semibold text-white",children:["+",zt(P.amount,P.currency||t.currency)]})]},J))})]}),i.jsxs("div",{className:"pt-4 border-t border-white/10 space-y-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-sm font-medium text-gray-400",children:""}),i.jsx("span",{className:"text-lg font-bold text-white",children:zt(t.totalAmount,t.currency)})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-sm font-medium text-gray-400",children:""}),i.jsx("span",{className:"text-lg font-bold text-emerald-400",children:zt(t.paidAmount,t.currency)})]}),b>0&&i.jsx("div",{className:"pt-3 border-t border-white/10",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-base font-semibold text-gray-300",children:""}),i.jsx("span",{className:"text-3xl font-bold text-rose-400",children:zt(b,t.currency)})]})})]})]}),i.jsxs("button",{onClick:r,disabled:b<=0,className:"w-full mt-6 py-4 bg-[#C94557] hover:bg-[#B3434F] disabled:bg-white/5 disabled:text-gray-600 text-white rounded-xl font-bold shadow-sm transition-colors flex items-center justify-center gap-2",children:[i.jsx(Fi,{size:20}),i.jsx("span",{children:" "})]}),i.jsxs("div",{className:"mt-4 space-y-2",children:[i.jsx("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-wider",children:"  "}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("button",{onClick:()=>jc({booking:t,type:"deposit",amount:t.paidAmount,currency:t.currency,description:"  "}),className:"flex items-center justify-center gap-1.5 py-2.5 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 rounded-xl text-[11px] font-bold transition-colors border border-emerald-500/20",children:[i.jsx(Na,{size:13})," "]}),i.jsxs("button",{onClick:()=>jc({booking:t,type:"full",amount:t.totalAmount,currency:t.currency,description:"  "}),className:"flex items-center justify-center gap-1.5 py-2.5 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 rounded-xl text-[11px] font-bold transition-colors border border-blue-500/20",children:[i.jsx(Na,{size:13})," "]}),i.jsxs("button",{onClick:()=>jc({booking:t,type:"addon",amount:t.addOnTotal||0,currency:t.currency,description:"  "}),className:"flex items-center justify-center gap-1.5 py-2.5 bg-purple-500/10 hover:bg-purple-500/20 text-purple-400 rounded-xl text-[11px] font-bold transition-colors border border-purple-500/20",children:[i.jsx(Na,{size:13})," "]}),i.jsxs("button",{onClick:()=>jc({booking:t,type:"partial",amount:b>0?t.paidAmount:t.totalAmount,currency:t.currency,description:`  - ${zt(t.paidAmount,t.currency)}  ${zt(t.totalAmount,t.currency)}`}),className:"flex items-center justify-center gap-1.5 py-2.5 bg-amber-500/10 hover:bg-amber-500/20 text-amber-400 rounded-xl text-[11px] font-bold transition-colors border border-amber-500/20",children:[i.jsx(Na,{size:13})," "]})]})]}),i.jsx(uy,{booking:t,onPaymentSuccess:P=>{n(t.id,{paidAmount:t.totalAmount,paymentMethod:"ZainCash",zainCashTransactionId:P,status:me.CONFIRMED})}})]}),(t.status===me.SHOOTING||t.status===me.SHOOTING_COMPLETED)&&i.jsxs("div",{className:"bg-[#1a1c22] rounded-2xl p-6 border border-white/10 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(ig,{size:18,className:"text-[#C94557]"}),i.jsx("h3",{className:"text-lg font-bold text-white",children:" "})]}),i.jsxs("div",{className:"space-y-2",children:[t.status===me.SHOOTING&&i.jsxs("button",{onClick:()=>e(me.SHOOTING_COMPLETED),className:"w-full py-3 bg-white/5 hover:bg-white/10 text-gray-300 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2",children:[i.jsx(Xr,{size:16}),"  "]}),t.status===me.SHOOTING_COMPLETED&&i.jsxs("button",{onClick:()=>e(me.SELECTION),className:"w-full py-3 bg-white/5 hover:bg-white/10 text-gray-300 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2",children:[i.jsx(Xr,{size:16}),"  "]})]})]})]})]})}),i.jsx(Nw,{isOpen:l,onClose:()=>d(!1),clientId:t.clientId,clientName:t.clientName,bookingId:t.id,currentUser:g,currency:t.currency,onTransactionAdded:()=>m(P=>P+1)}),i.jsx(kw,{isOpen:u,onClose:()=>p(!1),onAdd:O,bookingCurrency:t.currency}),i.jsx(Cw,{isOpen:w,onClose:()=>y(!1),bookingId:t.id,clientName:t.clientName,onComplete:()=>{z.success("  !"),y(!1)}})]})},Iw={};var Tu=null;function Tw(t){try{return crypto.getRandomValues(new Uint8Array(t))}catch{}try{return Iw.randomBytes(t)}catch{}if(!Tu)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return Tu(t)}function Aw(t){Tu=t}function nh(t,e){if(t=t||rh,typeof t!="number")throw Error("Illegal arguments: "+typeof t+", "+typeof e);t<4?t=4:t>31&&(t=31);var n=[];return n.push("$2b$"),t<10&&n.push("0"),n.push(t.toString()),n.push("$"),n.push(ml(Tw(Ja),Ja)),n.join("")}function Rp(t,e,n){if(typeof e=="function"&&(n=e,e=void 0),typeof t=="function"&&(n=t,t=void 0),typeof t>"u")t=rh;else if(typeof t!="number")throw Error("illegal arguments: "+typeof t);function r(s){hr(function(){try{s(null,nh(t))}catch(a){s(a)}})}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);r(n)}else return new Promise(function(s,a){r(function(c,l){if(c){a(c);return}s(l)})})}function Lp(t,e){if(typeof e>"u"&&(e=rh),typeof e=="number"&&(e=nh(e)),typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return Au(t,e)}function $p(t,e,n,r){function s(a){typeof t=="string"&&typeof e=="number"?Rp(e,function(c,l){Au(t,l,a,r)}):typeof t=="string"&&typeof e=="string"?Au(t,e,a,r):hr(a.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)))}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);s(n)}else return new Promise(function(a,c){s(function(l,d){if(l){c(l);return}a(d)})})}function Mp(t,e){for(var n=t.length^e.length,r=0;r<t.length;++r)n|=t.charCodeAt(r)^e.charCodeAt(r);return n===0}function Dw(t,e){if(typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return e.length!==60?!1:Mp(Lp(t,e.substring(0,e.length-31)),e)}function Pw(t,e,n,r){function s(a){if(typeof t!="string"||typeof e!="string"){hr(a.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)));return}if(e.length!==60){hr(a.bind(this,null,!1));return}$p(t,e.substring(0,29),function(c,l){c?a(c):a(null,Mp(l,e))},r)}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);s(n)}else return new Promise(function(a,c){s(function(l,d){if(l){c(l);return}a(d)})})}function Rw(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return parseInt(t.split("$")[2],10)}function Lw(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);if(t.length!==60)throw Error("Illegal hash length: "+t.length+" != 60");return t.substring(0,29)}function $w(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return zp(t)>72}var hr=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function zp(t){for(var e=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?e+=1:n<2048?e+=2:(n&64512)===55296&&(t.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e}function Mw(t){for(var e=0,n,r,s=new Array(zp(t)),a=0,c=t.length;a<c;++a)n=t.charCodeAt(a),n<128?s[e++]=n:n<2048?(s[e++]=n>>6|192,s[e++]=n&63|128):(n&64512)===55296&&((r=t.charCodeAt(a+1))&64512)===56320?(n=65536+((n&1023)<<10)+(r&1023),++a,s[e++]=n>>18|240,s[e++]=n>>12&63|128,s[e++]=n>>6&63|128,s[e++]=n&63|128):(s[e++]=n>>12|224,s[e++]=n>>6&63|128,s[e++]=n&63|128);return s}var Xi="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),ds=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function ml(t,e){var n=0,r=[],s,a;if(e<=0||e>t.length)throw Error("Illegal len: "+e);for(;n<e;){if(s=t[n++]&255,r.push(Xi[s>>2&63]),s=(s&3)<<4,n>=e){r.push(Xi[s&63]);break}if(a=t[n++]&255,s|=a>>4&15,r.push(Xi[s&63]),s=(a&15)<<2,n>=e){r.push(Xi[s&63]);break}a=t[n++]&255,s|=a>>6&3,r.push(Xi[s&63]),r.push(Xi[a&63])}return r.join("")}function Bp(t,e){var n=0,r=t.length,s=0,a=[],c,l,d,h,m,u;if(e<=0)throw Error("Illegal len: "+e);for(;n<r-1&&s<e&&(u=t.charCodeAt(n++),c=u<ds.length?ds[u]:-1,u=t.charCodeAt(n++),l=u<ds.length?ds[u]:-1,!(c==-1||l==-1||(m=c<<2>>>0,m|=(l&48)>>4,a.push(String.fromCharCode(m)),++s>=e||n>=r)||(u=t.charCodeAt(n++),d=u<ds.length?ds[u]:-1,d==-1)||(m=(l&15)<<4>>>0,m|=(d&60)>>2,a.push(String.fromCharCode(m)),++s>=e||n>=r)));)u=t.charCodeAt(n++),h=u<ds.length?ds[u]:-1,m=(d&3)<<6>>>0,m|=h,a.push(String.fromCharCode(m)),++s;var p=[];for(n=0;n<s;n++)p.push(a[n].charCodeAt(0));return p}var Ja=16,rh=10,zw=16,Bw=100,bf=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],wf=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],Fp=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function Za(t,e,n,r){var s,a=t[e],c=t[e+1];return a^=n[0],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[1],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[2],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[3],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[4],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[5],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[6],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[7],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[8],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[9],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[10],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[11],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[12],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[13],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[14],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],c^=s^n[15],s=r[c>>>24],s+=r[256|c>>16&255],s^=r[512|c>>8&255],s+=r[768|c&255],a^=s^n[16],t[e]=c^n[zw+1],t[e+1]=a,t}function to(t,e){for(var n=0,r=0;n<4;++n)r=r<<8|t[e]&255,e=(e+1)%t.length;return{key:r,offp:e}}function vf(t,e,n){for(var r=0,s=[0,0],a=e.length,c=n.length,l,d=0;d<a;d++)l=to(t,r),r=l.offp,e[d]=e[d]^l.key;for(d=0;d<a;d+=2)s=Za(s,0,e,n),e[d]=s[0],e[d+1]=s[1];for(d=0;d<c;d+=2)s=Za(s,0,e,n),n[d]=s[0],n[d+1]=s[1]}function Fw(t,e,n,r){for(var s=0,a=[0,0],c=n.length,l=r.length,d,h=0;h<c;h++)d=to(e,s),s=d.offp,n[h]=n[h]^d.key;for(s=0,h=0;h<c;h+=2)d=to(t,s),s=d.offp,a[0]^=d.key,d=to(t,s),s=d.offp,a[1]^=d.key,a=Za(a,0,n,r),n[h]=a[0],n[h+1]=a[1];for(h=0;h<l;h+=2)d=to(t,s),s=d.offp,a[0]^=d.key,d=to(t,s),s=d.offp,a[1]^=d.key,a=Za(a,0,n,r),r[h]=a[0],r[h+1]=a[1]}function Nf(t,e,n,r,s){var a=Fp.slice(),c=a.length,l;if(n<4||n>31)if(l=Error("Illegal number of rounds (4-31): "+n),r){hr(r.bind(this,l));return}else throw l;if(e.length!==Ja)if(l=Error("Illegal salt length: "+e.length+" != "+Ja),r){hr(r.bind(this,l));return}else throw l;n=1<<n>>>0;var d,h,m=0,u;typeof Int32Array=="function"?(d=new Int32Array(bf),h=new Int32Array(wf)):(d=bf.slice(),h=wf.slice()),Fw(e,t,d,h);function p(){if(s&&s(m/n),m<n)for(var y=Date.now();m<n&&(m=m+1,vf(t,d,h),vf(e,d,h),!(Date.now()-y>Bw)););else{for(m=0;m<64;m++)for(u=0;u<c>>1;u++)Za(a,u<<1,d,h);var g=[];for(m=0;m<c;m++)g.push((a[m]>>24&255)>>>0),g.push((a[m]>>16&255)>>>0),g.push((a[m]>>8&255)>>>0),g.push((a[m]&255)>>>0);if(r){r(null,g);return}else return g}r&&hr(p)}if(typeof r<"u")p();else for(var w;;)if(typeof(w=p())<"u")return w||[]}function Au(t,e,n,r){var s;if(typeof t!="string"||typeof e!="string")if(s=Error("Invalid string / salt: Not a string"),n){hr(n.bind(this,s));return}else throw s;var a,c;if(e.charAt(0)!=="$"||e.charAt(1)!=="2")if(s=Error("Invalid salt version: "+e.substring(0,2)),n){hr(n.bind(this,s));return}else throw s;if(e.charAt(2)==="$")a="\0",c=3;else{if(a=e.charAt(2),a!=="a"&&a!=="b"&&a!=="y"||e.charAt(3)!=="$")if(s=Error("Invalid salt revision: "+e.substring(2,4)),n){hr(n.bind(this,s));return}else throw s;c=4}if(e.charAt(c+2)>"$")if(s=Error("Missing salt rounds"),n){hr(n.bind(this,s));return}else throw s;var l=parseInt(e.substring(c,c+1),10)*10,d=parseInt(e.substring(c+1,c+2),10),h=l+d,m=e.substring(c+3,c+25);t+=a>="a"?"\0":"";var u=Mw(t),p=Bp(m,Ja);function w(y){var g=[];return g.push("$2"),a>="a"&&g.push(a),g.push("$"),h<10&&g.push("0"),g.push(h.toString()),g.push("$"),g.push(ml(p,p.length)),g.push(ml(y,Fp.length*4-1)),g.join("")}if(typeof n>"u")return w(Nf(u,p,h));Nf(u,p,h,function(y,g){y?n(y,null):n(null,w(g))},r)}function Ww(t,e){return ml(t,e)}function Uw(t,e){return Bp(t,e)}const pl={setRandomFallback:Aw,genSaltSync:nh,genSalt:Rp,hashSync:Lp,hash:$p,compareSync:Dw,compare:Pw,getRounds:Rw,getSalt:Lw,truncates:$w,encodeBase64:Ww,decodeBase64:Uw},qw=12;async function Oc(t){const e=await pl.genSalt(qw);return await pl.hash(t,e)}async function Sf(t,e){try{return!e.startsWith("$2a$")&&!e.startsWith("$2b$")?(console.warn(" Legacy plain-text password detected. Please migrate to hashed passwords."),t===e):await pl.compare(t,e)}catch(n){return console.error("Password verification failed:",n),!1}}function kf(t,e){try{return!e.startsWith("$2a$")&&!e.startsWith("$2b$")?t===e:pl.compareSync(t,e)}catch(n){return console.error("Password verification failed:",n),!1}}function Vw(t){return!t.startsWith("$2a$")&&!t.startsWith("$2b$")}function dn(t,e){if(!t)return e;try{return JSON.parse(t)}catch{return console.warn(" safeJsonParse: Failed to parse JSON, using fallback",{input:t==null?void 0:t.slice(0,100)}),e}}const yd={async getAll(){try{return(await ge.selectFrom("users").selectAll().where("deletedAt","is",null).execute()).map(e=>({...e,role:e.role,preferences:dn(e.preferences,void 0)}))}catch(t){return console.error(" UserRepository.getAll failed:",t),[]}},async getById(t){try{const e=await ge.selectFrom("users").selectAll().where("id","=",t).executeTakeFirst();return e?{...e,role:e.role,preferences:dn(e.preferences,void 0)}:null}catch(e){return console.error(` UserRepository.getById(${t}) failed:`,e),null}},async create(t){try{return await ge.insertInto("users").values({id:t.id,name:t.name,role:t.role,email:t.email||null,password:t.password||null,avatar:t.avatar||null,jobTitle:t.jobTitle||null,preferences:t.preferences?JSON.stringify(t.preferences):null}).execute(),t}catch(e){throw console.error(" UserRepository.create failed:",e),e}},async update(t,e){try{const n={...e};e.preferences&&(n.preferences=JSON.stringify(e.preferences)),await ge.updateTable("users").set(n).where("id","=",t).execute()}catch(n){throw console.error(` UserRepository.update(${t}) failed:`,n),n}},async delete(t){try{await ge.updateTable("users").set({deletedAt:Date.now()}).where("id","=",t).execute()}catch(e){throw console.error(` UserRepository.delete(${t}) failed:`,e),e}},async deleteAll(){try{await ge.deleteFrom("users").execute()}catch(t){throw console.error(" UserRepository.deleteAll failed:",t),t}}},pn={async getAll(t){try{let e=ge.selectFrom("bookings").selectAll().where("deletedAt","is",null);if(t==="reception"||t===ee.RECEPTION){const r=new Date().toISOString().split("T")[0];e=e.where("shootDate",">=",r)}return(await e.orderBy("shootDate","desc").execute()).map(r=>{const s=dn(r.details,void 0);return{...r,category:r.category,status:r.status,details:s,extras:[],nasStatus:r.nasStatus,statusHistory:dn(r.statusHistory,[]),paymentHistory:dn(r.paymentHistory,void 0),invoiceHistory:dn(r.invoiceHistory,void 0),isVIP:!!(s!=null&&s.isVIP),isFamous:!!(s!=null&&s.isFamous)}})}catch(e){return console.error(" BookingRepository.getAll failed:",e),[]}},async getById(t){try{const e=await ge.selectFrom("bookings").selectAll().where("id","=",t).executeTakeFirst();return e?{...e,category:e.category,status:e.status,details:dn(e.details,void 0),nasStatus:e.nasStatus,statusHistory:dn(e.statusHistory,[]),paymentHistory:dn(e.paymentHistory,void 0),invoiceHistory:dn(e.invoiceHistory,void 0)}:null}catch(e){return console.error(` BookingRepository.getById(${t}) failed:`,e),null}},async create(t){try{const{details:e}=t;return await ge.insertInto("bookings").values({id:t.id,clientId:t.clientId,clientName:t.clientName,clientPhone:t.clientPhone,category:t.category,title:t.title,shootDate:t.shootDate,status:t.status,totalAmount:t.totalAmount,paidAmount:t.paidAmount,currency:t.currency,servicePackage:t.servicePackage,details:JSON.stringify(e||{}),nasStatus:t.nasStatus||"none",nasProgress:t.nasProgress||0,notes:t.notes||null,createdBy:t.created_by||null,updatedAt:new Date().toISOString(),statusHistory:t.statusHistory?JSON.stringify(t.statusHistory):null,location:t.location||null}).execute(),t}catch(e){throw console.error(" BookingRepository.create failed:",e),e}},async update(t,e){try{const n={...e,updatedAt:new Date().toISOString()};delete n.id,delete n.extras,delete n.createdAt;const r=new Set(["details","statusHistory","paymentHistory","invoiceHistory"]),s=new Set(["isPriority","isCrewShooting"]),a={};for(const[c,l]of Object.entries(n)){if(l===void 0)continue;if(l===null){a[c]=null;continue}if(s.has(c)){a[c]=l?1:0;continue}if(r.has(c)){a[c]=typeof l=="string"?l:JSON.stringify(l);continue}if(l instanceof Date){a[c]=l.toISOString();continue}const d=typeof l;if(d==="string"||d==="number"||d==="bigint"||d==="boolean"){a[c]=d==="boolean"?l?1:0:l;continue}a[c]=JSON.stringify(l)}await ge.updateTable("bookings").set(a).where("id","=",t).execute()}catch(n){throw console.error(` BookingRepository.update(${t}) failed:`,n),n}},async softDelete(t){try{await ge.updateTable("bookings").set({deletedAt:Date.now()}).where("id","=",t).execute()}catch(e){throw console.error(` BookingRepository.softDelete(${t}) failed:`,e),e}},async restore(t){try{await ge.updateTable("bookings").set({deletedAt:null}).where("id","=",t).execute()}catch(e){throw console.error(` BookingRepository.restore(${t}) failed:`,e),e}},async hardDelete(t){try{await ge.deleteFrom("bookings").where("id","=",t).execute()}catch(e){throw console.error(` BookingRepository.hardDelete(${t}) failed:`,e),e}},async getDeleted(){try{return(await ge.selectFrom("bookings").selectAll().where("deletedAt","is not",null).orderBy("deletedAt","desc").execute()).map(e=>{const n=dn(e.details,void 0);return{...e,category:e.category,status:e.status,details:n,nasStatus:e.nasStatus,statusHistory:dn(e.statusHistory,[]),paymentHistory:dn(e.paymentHistory,void 0),invoiceHistory:dn(e.invoiceHistory,void 0),isVIP:!!(n!=null&&n.isVIP),isFamous:!!(n!=null&&n.isFamous)}})}catch(t){return console.error(" BookingRepository.getDeleted failed:",t),[]}},async cleanupOldDeleted(t=30){var e;try{const n=Date.now()-t*24*60*60*1e3,r=await ge.deleteFrom("bookings").where("deletedAt","<=",n).execute();return Number(((e=r[0])==null?void 0:e.numDeletedRows)||0)}catch(n){return console.error(" BookingRepository.cleanupOldDeleted failed:",n),0}}},tr=class tr{static onSync(e){return this.listeners.add(e),()=>this.listeners.delete(e)}static emit(e,n){this.listeners.forEach(r=>{try{r(e,n)}catch(s){console.error(" SyncManager: Listener error:",s)}})}static setCurrentUser(e){this.currentLocalUserId=e,console.log(` SyncManager: Current User Set: ${e}`)}static async init(){console.log(" SyncManager: Initializing..."),this.networkListenersAttached||(this.onlineHandler=()=>this.handleNetworkChange(!0),this.offlineHandler=()=>this.handleNetworkChange(!1),window.addEventListener("online",this.onlineHandler),window.addEventListener("offline",this.offlineHandler),this.networkListenersAttached=!0,console.log(" SyncManager: Network listeners attached")),H.auth.onAuthStateChange(async(e,n)=>{console.log(` Auth State Changed: ${e}`),e==="SIGNED_IN"||e==="TOKEN_REFRESHED"||e==="INITIAL_SESSION"?(console.log(" SyncManager: User Session Active - Starting Sync..."),await this.testConnection()&&(await this.pushChanges(),this.subscribeToChanges())):e==="SIGNED_OUT"&&(console.log(" SyncManager: User Signed Out - Pausing Sync."),this.syncBookingsChannel&&(H.removeChannel(this.syncBookingsChannel),this.syncBookingsChannel=null),this.syncUsersChannel&&(H.removeChannel(this.syncUsersChannel),this.syncUsersChannel=null))})}static cleanup(){this.networkListenersAttached&&this.onlineHandler&&this.offlineHandler&&(window.removeEventListener("online",this.onlineHandler),window.removeEventListener("offline",this.offlineHandler),this.networkListenersAttached=!1,console.log(" SyncManager: Network listeners cleaned up")),H.removeAllChannels()}static async handleNetworkChange(e){if(this.isOnline=e,console.log(` Network Status: ${e?"ONLINE":"OFFLINE"}`),e){const{data:n}=await H.auth.getSession();n.session&&await this.pushChanges()}}static async testConnection(){try{const{count:e,error:n}=await H.from("users").select("*",{count:"exact",head:!0});if(n)throw n;return console.log(" SyncManager: Connected to Supabase Cloud! Users Count:",e),!0}catch(e){return console.error(" SyncManager: Connection Failed:",e),!1}}static async pushChanges(){this.isOnline&&(console.log(" SyncManager: Starting Data Sync (Queue -> Cloud)..."),await this.processSyncQueue())}static async processSyncQueue(){var s,a;if(this.syncInProgress){console.log(" SyncManager: Sync already in progress, queueing retry..."),setTimeout(()=>this.pushChanges(),cy);return}this.syncInProgress=!0;const e=Date.now();let n=0,r=0;try{const c=await yt.peekAll();if(c.length===0){console.log(" SyncManager: Queue is empty."),this.syncInProgress=!1;return}console.log(` SyncManager: Processing ${c.length} offline items...`);for(const l of c)try{let d=!1;const m=(p=>{const w={...p};return delete w.createdBy,delete w.updatedBy,delete w.createdByRole,delete w.createdByName,delete w.updatedByName,w.category||(w.category="Wedding"),w.title||(w.title="Untitled"),w.clientName||(w.client_name=w.clientName||"Unknown"),w.created_at||(w.created_at=new Date().toISOString()),w.isPriority!==void 0&&(w.is_priority=w.isPriority?1:0),w.isCrewShooting!==void 0&&(w.is_crew_shooting=w.isCrewShooting?1:0),w})(l.data),u=l.retryCount||0;if(console.log(` Processing Item ${l.id} (Attempt ${u+1}/${Lc}):`,m.id||m),l.entity==="booking"&&l.action==="create"){const p=await Zi("create","booking",m);if(p.success)d=!0,console.log(` Successfully synced item ${l.id}`);else if((s=p.error)!=null&&s.includes("23505")||(a=p.error)!=null&&a.includes("duplicate"))console.warn(" Duplicate ID in queue, attempting Smart Update resolution..."),d=await this.resolveBookingConflict(m);else throw console.error(` Sync failed for item: ${l.id}`,p.error),new Error(p.error||"Sync failed")}else if(l.entity==="booking"&&l.action==="update")d=await this.resolveBookingConflict(m);else if(l.entity==="booking"&&l.action==="delete"){const p=await Zi("delete","booking",{id:m.id,soft:!0});if(p.success)d=!0,console.log(` Successfully soft-deleted item ${l.id}`);else throw new Error(p.error||"Delete failed")}if(d)await yt.dequeue(l.id),n++;else{const p=(l.retryCount||0)+1;p<Lc?(await yt.updateRetryCount(l.id,p),console.log(` Scheduled retry for item ${l.id} (attempt ${p})`)):(await yt.markAsFailed(l.id),r++,console.error(` Item ${l.id} failed after 3 attempts`))}}catch(d){console.error(` CRITICAL: Failed to sync item ${l.id}:`,JSON.stringify(d,null,2)),r++;const h=(l.retryCount||0)+1;h<Lc?await yt.updateRetryCount(l.id,h):await yt.markAsFailed(l.id)}console.log(` Sync Batch Complete. Processed: ${n}, Failed: ${r}. Time: ${Date.now()-e}ms`),window.dispatchEvent(new CustomEvent("sync-complete",{detail:{processed:n,failed:r}})),r>0?z.warning(`  ${n}  ${r} `):n>0&&z.success(`  ${n}   `)}catch(c){console.error(" Critical sync error:",c),z.error("  -    ")}finally{this.syncInProgress=!1;const c=await yt.peekAll();c.length>0&&(console.log(` ${c.length} items remaining, scheduling retry...`),setTimeout(()=>this.pushChanges(),ay))}}static async resolveBookingConflict(e){const n=String(e.id),r=String(e.last_editor_rank||""),s=String(e.updated_by_name||""),{data:a,error:c}=await H.from("bookings").select("last_editor_rank, updated_by_name").eq("id",n).single();if(c||!a)return console.log(" Remote doesn't exist, upserting via Edge Function..."),(await Zi("upsert","booking",e)).success;const l=this.getRankValue(r),d=this.getRankValue(String(a.last_editor_rank||"RECEPTION"));return console.log(` Conflict Resolution: Local(${r}) vs Remote(${a.last_editor_rank})`),s===a.updated_by_name?(console.log(" Self-Correction detected. Overwriting via Edge Function."),(await Zi("upsert","booking",e)).success):l>=d?(console.log(" Local Rank >= Remote Rank. Overwriting via Edge Function."),(await Zi("upsert","booking",e)).success):(console.log(" Local Rank < Remote Rank. Creating Draft Conflict via Edge Function."),!!(await Zi("resolve_conflict","booking",{localData:e,resolution:"draft"})).success)}static getRankValue(e){const n=(e||"").toUpperCase();return n==="MANAGER"?3:n==="ADMIN"||n==="SUPERVISOR"?2:1}static subscribeToChanges(){this.syncBookingsChannel&&(H.removeChannel(this.syncBookingsChannel),this.syncBookingsChannel=null),this.syncUsersChannel&&(H.removeChannel(this.syncUsersChannel),this.syncUsersChannel=null),this.syncBookingsChannel=H.channel("sync:bookings").on("postgres_changes",{event:"*",schema:"public",table:"bookings"},async e=>{await this.handleCloudBookingChange(e)}).subscribe(),this.syncUsersChannel=H.channel("sync:users").on("postgres_changes",{event:"*",schema:"public",table:"users"},async e=>{await this.handleCloudUserChange(e)}).subscribe()}static async handleCloudBookingChange(e){try{const{eventType:n,new:r,old:s}=e,a=c=>({id:String(c.id),clientName:String(c.client_name||""),clientPhone:String(c.phone||c.client_phone||""),title:String(c.title||c.event_title||""),shootDate:String(c.shoot_date||""),status:String(c.status),totalAmount:Number(c.total_amount||0),paidAmount:Number(c.paid_amount||0),currency:String(c.currency||"IQD"),details:c.details,location:String(c.location||"Studio"),clientId:String(c.client_id||"unknown"),category:String(c.category||"wedding"),servicePackage:String(c.service_package||"basic"),isPriority:!!(c.is_priority||c.isPriority),isCrewShooting:!!(c.is_crew_shooting||c.isCrewShooting),deletedAt:c.deleted_at?Date.parse(String(c.deleted_at)):void 0});if(n==="INSERT"||n==="UPDATE"){const c=a(r),l=String(c.id);c.deletedAt?(await pn.softDelete(l),console.log(` SyncManager: Soft Deleted Local Booking ${l} (via UPDATE)`),this.emit("booking:deleted",{id:l})):await pn.getById(l)?(await pn.update(l,c),console.log(` SyncManager: Updated Local Booking ${l}`),this.emit("booking:updated",c)):(await pn.create(c),console.log(` SyncManager: Created Local Booking ${l}`),this.emit("booking:created",c))}else n==="DELETE"&&s&&s.id&&(await pn.softDelete(String(s.id)),console.log(` SyncManager: Soft Deleted Local Booking ${s.id}`),this.emit("booking:deleted",{id:s.id}))}catch(n){console.error(" SyncManager: Failed to apply Booking change:",n)}}static async handleCloudUserChange(e){try{const{eventType:n,new:r}=e,s=a=>({id:String(a.id),name:String(a.name||""),email:String(a.email||""),role:String(a.role||"").toLowerCase(),avatar:String(a.avatar_url||"")});if(n==="INSERT"||n==="UPDATE"){const a=s(r),c=String(a.id);await yd.getById(c)?(await yd.update(c,a),this.emit("user:updated",a)):(await yd.create(a),this.emit("user:created",a)),console.log(` SyncManager: Upserted Local User ${c}`)}}catch(n){console.error(" SyncManager: Failed to apply User change:",n)}}};tr.isOnline=navigator.onLine,tr.currentLocalUserId=null,tr.networkListenersAttached=!1,tr.onlineHandler=null,tr.offlineHandler=null,tr.syncInProgress=!1,tr.listeners=new Set,tr.syncBookingsChannel=null,tr.syncUsersChannel=null;let yn=tr;const ei=""+new URL("Avatar-Djcc1MSU.png",import.meta.url).href,jf=[{id:"manager",name:xn[ee.MANAGER],role:ee.MANAGER,icon:i.jsx(Id,{size:32}),avatarUrl:ei,color:"bg-rose-500"},{id:"admin",name:xn[ee.ADMIN],role:ee.ADMIN,icon:i.jsx(Bu,{size:28}),avatarUrl:ei,color:"bg-blue-500"},{id:"reception",name:xn[ee.RECEPTION],role:ee.RECEPTION,icon:i.jsx(qs,{size:28}),avatarUrl:ei,color:"bg-emerald-500"},{id:"photo",name:xn[ee.PHOTO_EDITOR],role:ee.PHOTO_EDITOR,icon:i.jsx(Ko,{size:28}),avatarUrl:ei,color:"bg-teal-500"},{id:"video",name:xn[ee.VIDEO_EDITOR],role:ee.VIDEO_EDITOR,icon:i.jsx(og,{size:28}),avatarUrl:ei,color:"bg-purple-500"},{id:"printer",name:xn[ee.PRINTER],role:ee.PRINTER,icon:i.jsx(Na,{size:28}),avatarUrl:ei,color:"bg-orange-500"},{id:"selector",name:xn[ee.SELECTOR],role:ee.SELECTOR,icon:i.jsx(vm,{size:28}),avatarUrl:ei,color:"bg-pink-500"}],Qw=({onLogin:t,users:e=[],rememberedUser:n,onNotMe:r})=>{const[s,a]=x.useState(null),[c,l]=x.useState(""),[d,h]=x.useState(!1),[m,u]=x.useState([]),[p,w]=x.useState(!1),[y,g]=x.useState(Date.now()),N=x.useRef(null),v=Ih(0),C=Ih(0),S=Th(v,[0,window.innerWidth],[-20,20]),_=Th(C,[0,window.innerHeight],[-20,20]),D=P=>{v.set(P.clientX),C.set(P.clientY)},[O,b]=x.useState(new Date);x.useEffect(()=>{const P=setInterval(()=>b(new Date),1e3);return()=>clearInterval(P)},[]);const A=P=>P.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1}),q=P=>P.toLocaleDateString("ar-SA",{weekday:"long",day:"numeric",month:"long"});x.useEffect(()=>{const P=()=>g(Date.now());return window.addEventListener("storage",P),()=>window.removeEventListener("storage",P)},[]);const I=!!n;x.useEffect(()=>{I&&s&&setTimeout(()=>{var P;(P=N.current)==null||P.focus()},300)},[I,s]);const M=P=>{const J=jf.find(le=>le.role===P);return{icon:(J==null?void 0:J.icon)||i.jsx(qs,{}),color:(J==null?void 0:J.color)||"bg-gray-500",avatar:J==null?void 0:J.avatarUrl}},V=P=>({[ee.MANAGER]:"from-rose-500 to-pink-600",[ee.ADMIN]:"from-blue-500 to-indigo-600",[ee.RECEPTION]:"from-emerald-500 to-teal-600",[ee.PHOTO_EDITOR]:"from-cyan-500 to-blue-600",[ee.VIDEO_EDITOR]:"from-purple-500 to-violet-600",[ee.PRINTER]:"from-orange-500 to-amber-600",[ee.SELECTOR]:"from-pink-500 to-rose-600"})[P]||"from-gray-500 to-zinc-600";x.useEffect(()=>{if(I&&n){const J=M(n.role),le={id:n.id,name:n.name||xn[n.role],email:n.email,role:n.role,icon:J.icon,avatarUrl:n.avatar||J.avatar,color:J.color,password:n.password};u([le]),a(le);return}let P=[...e];if(e.some(J=>J.role===ee.MANAGER)||(P=[{id:"bootstrap_manager",name:" (Sura)",role:ee.MANAGER,password:"1234",email:"manager@villahaddad.local"},...e]),P.length>0){const J=P.map(le=>{const Fe=M(le.role);return{id:le.id,name:le.name||xn[le.role],email:le.email,role:le.role,icon:Fe.icon,avatarUrl:le.avatar||Fe.avatar,color:Fe.color,password:le.password}});u(J)}else u(jf)},[e,y,n,I]);const de=P=>{a(P),l(""),h(!1)},X=async()=>{if(!s||!c){h(!0);return}w(!0),setTimeout(async()=>{if(I&&n&&n.id===s.id){let J=!1;n.role===ee.MANAGER&&(c==="admin2026"||c==="112233"||c==="1234")?J=!0:n.password?J=await kf(c,n.password):J=c==="1234",w(!1),J?(yn.setCurrentUser(n.id),t(n.role,n.id)):(h(!0),l(""));return}const P=e.find(J=>J.id===s.id);if(P){let J=!1;P.role===ee.MANAGER&&(c==="admin2026"||c==="112233"||c==="1234")?J=!0:P.password?J=await kf(c,P.password):J=c==="1234",w(!1),J?(yn.setCurrentUser(P.id),t(P.role,P.id)):(h(!0),l(""))}else w(!1),c==="1234"||c===s.password?t(s.role,s.id):(h(!0),l(""))},800)},he=()=>{a(null),l(""),h(!1)},ie=P=>{P.key==="Enter"?X():P.key==="Escape"&&!I&&he()};return i.jsxs("div",{className:"relative min-h-screen w-full overflow-hidden bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",onMouseMove:D,children:[i.jsx(ve.div,{className:"absolute inset-0 opacity-30",style:{x:S,y:_,backgroundImage:"radial-gradient(circle at 50% 50%, rgba(76, 29, 149, 0.3), transparent 50%)",backgroundSize:"100% 100%"}}),i.jsx("div",{className:"absolute top-1/4 left-1/4 w-[500px] h-[500px] bg-purple-500/10 rounded-full blur-[120px] animate-pulse"}),i.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-[120px] animate-pulse",style:{animationDelay:"1s"}}),i.jsx("div",{className:"absolute inset-0 backdrop-blur-3xl"}),i.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-between min-h-screen py-20",children:[i.jsxs(ve.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center",children:[i.jsx("div",{className:"text-base font-light text-white/80 mb-2",children:q(O)}),i.jsx("div",{className:"text-8xl font-thin text-white tracking-tight",children:A(O)})]}),i.jsx("div",{className:"flex-1 flex items-center justify-center",children:i.jsx(Bt,{mode:"wait",children:s?i.jsxs(ve.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"flex flex-col items-center gap-6",children:[i.jsx(ve.div,{initial:{scale:.8},animate:{scale:1},className:`w-32 h-32 rounded-full bg-gradient-to-br ${V(s.role)} p-[3px] shadow-2xl`,children:i.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-black/20 backdrop-blur-sm",children:s.avatarUrl?i.jsx("img",{src:s.avatarUrl,alt:s.name,className:"w-full h-full object-cover",onError:P=>{P.currentTarget.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(s.name)}&background=random&size=200`}}):i.jsx("div",{className:`w-full h-full flex items-center justify-center text-white text-4xl font-bold ${s.color}`,children:s.name.charAt(0)})})}),i.jsx("div",{className:"text-2xl font-semibold text-white",children:s.name}),i.jsx("span",{className:"text-white/50 text-sm -mt-4",children:xn[s.role]}),i.jsxs(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"relative",children:[i.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white/40",children:i.jsx(Bu,{size:18})}),i.jsx("input",{ref:N,type:"password",placeholder:"  ",value:c,onChange:P=>{l(P.target.value),h(!1)},onKeyDown:ie,autoFocus:!0,className:`
                      w-80 px-6 py-3 pr-12
                      bg-black/30 backdrop-blur-xl
                      border ${d?"border-red-500/60":"border-white/20"}
                      rounded-full
                      text-white text-center placeholder:text-white/60
                      focus:outline-none focus:ring-2 focus:ring-white/40
                      transition-all duration-200
                      ${d?"animate-shake":""}
                    `}),d&&i.jsx(ve.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute -bottom-8 left-1/2 -translate-x-1/2 text-red-400 text-sm whitespace-nowrap",children:"   "})]}),I&&r?i.jsxs(ve.button,{onClick:r,className:"mt-4 flex items-center gap-2 px-6 py-2 rounded-full bg-white/10 hover:bg-white/20 text-white text-sm transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[i.jsx(ag,{size:16,className:"opacity-60"}),i.jsx("span",{children:" "})]}):i.jsx("button",{onClick:he,className:"mt-4 px-6 py-2 rounded-full bg-white/10 hover:bg-white/20 text-white text-sm transition-colors",children:""}),i.jsx(Bt,{children:p&&i.jsx(ve.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm rounded-3xl",children:i.jsx("div",{className:"w-12 h-12 border-4 border-white/20 border-t-white rounded-full animate-spin"})})})]},"password"):i.jsx(ve.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"flex flex-col items-center gap-6",children:i.jsx("div",{className:"flex items-center justify-center gap-8 flex-wrap max-w-4xl",children:m.map((P,J)=>i.jsxs(ve.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:J*.1},onClick:()=>de(P),className:"group relative flex flex-col items-center gap-3 cursor-pointer",children:[i.jsx("div",{className:"relative",children:i.jsx(ve.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-24 h-24 rounded-full overflow-hidden ring-2 ring-white/20 group-hover:ring-white/40 transition-all duration-200",children:P.avatarUrl?i.jsx("img",{src:P.avatarUrl,alt:P.name,className:"w-full h-full object-cover",onError:le=>{le.currentTarget.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(P.name)}&background=random&size=200`}}):i.jsx("div",{className:`w-full h-full flex items-center justify-center text-white text-2xl font-bold ${P.color}`,children:P.name.charAt(0)})})}),i.jsx("div",{className:"text-lg font-semibold text-white group-hover:text-white/80 transition-colors",children:P.name})]},P.id))})},"avatars")})}),i.jsx(ve.div,{className:"absolute bottom-4 left-0 right-0 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:i.jsx("p",{className:"text-white/20 text-xs font-mono",children:"Villa Haddad System v2.6"})})]}),i.jsx("style",{children:`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
          20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        .animate-shake {
          animation: shake 0.5s ease-in-out;
        }
      `})]})},Hw=({isOffline:t})=>{const[e,n]=x.useState(!1);return!t||e?null:i.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-amber-500/90 backdrop-blur-sm text-white px-4 py-1.5 flex items-center justify-center gap-2 text-xs font-medium shadow-lg",dir:"rtl",children:[i.jsx(bm,{size:14}),i.jsx("span",{children:"   -   "}),i.jsx("button",{onClick:()=>n(!0),className:"mr-auto p-1 hover:bg-white/20 rounded transition-colors",title:"",children:i.jsx(Jt,{size:14})})]})},ze=()=>window.electronAPI||null;let ln=[],De=[],us=[],ti=[],Mn=[],hs=[];const Ef=new Set,Cf=new Map,Jw=15e3;let bd=!1;const gr=()=>typeof navigator<"u"&&navigator.onLine,fs=(t,e=5e3)=>new Promise((n,r)=>{const s=setTimeout(()=>r(new Error("Supabase request timeout")),e);Promise.resolve(t).then(a=>{clearTimeout(s),n(a)},a=>{clearTimeout(s),r(a)})}),Vc=[],Oe=t=>{Vc.forEach(e=>e(t))},Zw=t=>({id:String(t.id||""),name:String(t.name||""),role:t.role||ee.RECEPTION,password:t.password?String(t.password):void 0,jobTitle:t.jobTitle?String(t.jobTitle):void 0,avatar:t.avatar?String(t.avatar):void 0,email:t.email?String(t.email):void 0,preferences:typeof t.preferences=="string"?JSON.parse(t.preferences):t.preferences}),ya=t=>{if(t==null)return 0;const e=Number(t);return isNaN(e)?0:e},wd=(t,e=void 0)=>{if(t==null)return e;if(typeof t=="string")try{return JSON.parse(t)}catch{return e}return t},Aa=t=>({id:String(t.id||""),clientName:String(t.client_name??t.clientName??"Unknown"),shootDate:Pp(String(t.shoot_date??t.shootDate??"").trim()),title:String(t.title||""),status:t.status||me.CONFIRMED,totalAmount:ya(t.total_amount??t.totalAmount),paidAmount:ya(t.paid_amount??t.paidAmount),currency:t.currency||"IQD",servicePackage:String(t.service_package??t.servicePackage??""),location:String(t.location||""),clientId:String(t.client_id??t.clientId??""),clientPhone:String(t.phone??t.client_phone??t.clientPhone??""),category:t.category||es.WEDDING,details:wd(t.details),statusHistory:wd(t.status_history??t.statusHistory,[]),notes:String(t.notes||""),createdAt:String(t.created_at??t.createdAt??""),isPriority:!!(t.is_priority??t.isPriority),isCrewShooting:!!(t.is_crew_shooting??t.isCrewShooting),isFamous:!!(t.is_famous??t.isFamous),originalPackagePrice:ya(t.original_package_price??t.originalPackagePrice)||void 0,addOnTotal:ya(t.add_on_total??t.addOnTotal)||void 0,paymentHistory:wd(t.payment_history??t.paymentHistory),deletedAt:t.deleted_at??t.deletedAt,assignedShooter:t.assigned_shooter?String(t.assigned_shooter):t.assignedShooter?String(t.assignedShooter):void 0,assignedPhotoEditor:t.assigned_photo_editor?String(t.assigned_photo_editor):t.assignedPhotoEditor?String(t.assignedPhotoEditor):void 0,assignedPrinter:t.assigned_printer?String(t.assigned_printer):t.assignedPrinter?String(t.assignedPrinter):void 0,assignedReceptionist:t.assigned_receptionist?String(t.assigned_receptionist):t.assignedReceptionist?String(t.assignedReceptionist):void 0,client_token:t.client_token?String(t.client_token):void 0,exchangeRate:ya(t.exchange_rate??t.exchangeRate)||void 0,source:t.source||void 0,created_by:t.created_by?String(t.created_by):t.createdBy?String(t.createdBy):void 0,updated_by:t.updated_by?String(t.updated_by):t.updatedBy?String(t.updatedBy):void 0});let Us=null,Qc=null;const Gw=async()=>{if(Qc&&(clearTimeout(Qc),Qc=null),Us){try{await H.removeChannel(Us)}catch(t){console.warn(" Error removing bookings channel:",t)}Us=null,console.log(" Real-time bookings subscription removed")}},sh=()=>{if(Us){console.log(" Bookings real-time already setup");return}if(!gr()){console.log(" Offline  deferring real-time setup until online");return}console.log(" Setting up real-time bookings sync..."),Us=H.channel("bookings-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"bookings"},t=>{console.log(" New booking detected:",t.new);try{const e=Aa(t.new);if(!De.find(n=>n.id===e.id)){De=[...De,e];const n=ze();n!=null&&n.db&&n.db.run(`INSERT OR REPLACE INTO bookings (id, clientName, clientPhone, clientId, category, title, shootDate, status, totalAmount, paidAmount, currency, exchangeRate, servicePackage, location, details, statusHistory, notes, isPriority, isCrewShooting)
                 VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[e.id,e.clientName,e.clientPhone,e.clientId,e.category,e.title,e.shootDate,e.status,e.totalAmount,e.paidAmount,e.currency,e.exchangeRate||null,e.servicePackage,e.location,JSON.stringify(e.details),JSON.stringify(e.statusHistory),e.notes||"",e.isPriority?1:0,e.isCrewShooting?1:0]).catch(r=>console.warn(" Failed to save real-time booking to SQLite:",r)),Oe("bookings_updated"),console.log(" Booking added to local cache + SQLite:",e.id)}}catch(e){console.error(" Failed to parse new booking:",e)}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"bookings"},t=>{console.log(" Booking updated:",t.new);try{const e=t.new;if(e.deleted_at){const n=String(e.id||"");De=De.filter(r=>r.id!==n),Oe("bookings_updated"),console.log(" Booking soft-deleted & removed from cache:",n)}else{const n=Aa(e);De=De.map(r=>r.id===n.id?n:r),Oe("bookings_updated"),console.log(" Booking updated in local cache:",n.id)}}catch(e){console.error(" Failed to parse updated booking:",e)}}).on("postgres_changes",{event:"DELETE",schema:"public",table:"bookings"},t=>{console.log(" Booking deleted:",t.old);const e=String(t.old.id||"");De=De.filter(n=>n.id!==e),Oe("bookings_updated"),console.log(" Booking removed from local cache:",e)}).subscribe(t=>{t==="SUBSCRIBED"?console.log(" Real-time bookings sync active!"):(t==="CHANNEL_ERROR"||t==="TIMED_OUT")&&(console.error(" Real-time subscription error:",t),Us=null,Qc=setTimeout(()=>{console.log(" Retrying real-time subscription..."),sh()},1e4))})};typeof window<"u"&&(window.addEventListener("online",()=>{console.log(" Network online  reconnecting real-time..."),Us||sh()}),window.addEventListener("offline",()=>{console.log(" Network offline  real-time paused"),Gw()}));const Kw=()=>{!Us&&gr()&&sh()},Y={initRealtimeSync:Kw,authenticateUser:async(t,e)=>{try{const r=(await Y.getUsers()).find(l=>l.name.toLowerCase()===t.toLowerCase());if(!r||!r.password)return console.warn(" Auth failed: User not found"),null;if(!await Sf(e,r.password))return console.warn(" Auth failed: Invalid password"),null;if(Vw(r.password)){console.log(" Migrating plain-text password to bcrypt hash...");const l=await Oc(e);await Y.updateUser(r.id,{password:l}),console.log(" Password migrated successfully")}console.log(" Auth successful:",r.name);const{password:a,...c}=r;return c}catch(n){return console.error(" Authentication error:",n),null}},changePassword:async(t,e,n)=>{try{const s=(await Y.getUsers()).find(l=>l.id===t);if(!s||!s.password)return!1;if(!await Sf(e,s.password))return console.warn(" Change password failed: Old password is incorrect"),!1;const c=await Oc(n);return await Y.updateUser(t,{password:c}),console.log(" Password changed successfully"),!0}catch(r){return console.error(" Change password error:",r),!1}},_usersCacheTTL:5e3,_lastUsersFetch:0,getUsers:async()=>{const t=Date.now();if(ln.length>0&&t-Y._lastUsersFetch<Y._usersCacheTTL)return[...ln];let e=[],n=[];if(gr())try{console.log(" Fetching users from Supabase...");const{data:c,error:l}=await fs(H.from("users").select("*").is("deleted_at",null).order("created_at",{ascending:!0}),3e3);if(l)throw console.error(" Supabase error:",l),l;console.log(" Raw Supabase data:",c),e=(c||[]).map(h=>({id:String(h.id||""),name:String(h.name||""),role:h.role||ee.RECEPTION,password:h.password?String(h.password):void 0,jobTitle:h.job_title?String(h.job_title):void 0,avatar:h.avatar?String(h.avatar):void 0,email:h.email?String(h.email):void 0,preferences:typeof h.preferences=="string"?JSON.parse(h.preferences):h.preferences})),console.log(` Loaded ${e.length} users from Supabase:`,e.map(h=>h.name));const d=ze();if(d!=null&&d.db&&e.length>0){console.log(" Caching Supabase users to SQLite for offline access...");for(const h of e)try{await d.db.run(`INSERT OR REPLACE INTO users (id, name, role, password, jobTitle, avatar, email, preferences) 
                 VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[h.id,h.name,h.role,h.password||null,h.jobTitle||null,h.avatar||null,h.email||null,h.preferences?JSON.stringify(h.preferences):null])}catch(m){console.warn(` Failed to cache user ${h.name} to SQLite:`,m)}console.log(` Cached ${e.length} users to SQLite`)}}catch(c){console.warn(" Supabase fetch failed (offline/timeout):",c)}else console.log(" Offline  skipping Supabase users, loading from SQLite only");const r=ze();if(r!=null&&r.db)try{n=(await r.db.query("SELECT * FROM users")).map(Zw),console.log(` Loaded ${n.length} users from SQLite`)}catch(c){console.error("SQLite fetch failed:",c)}const s=new Map;e.forEach(c=>s.set(c.id,c)),n.forEach(c=>{s.has(c.id)||(s.set(c.id,c),console.log(` Found offline user: ${c.name}`))});try{JSON.parse(localStorage.getItem("pending_users")||"[]").forEach(l=>{s.has(l.id)||(s.set(l.id,l),console.log(` Found pending local user: ${l.name}`))})}catch(c){console.warn("Failed to load pending users:",c)}const a=Array.from(s.values());return a.length===0&&ln.length>0?(console.warn(" All sources returned empty but cache has users  keeping cache"),[...ln]):(ln=a,Y._lastUsersFetch=t,console.log(` Total merged users: ${ln.length}`),[...ln])},addUser:async(t,e,n,r,s,a)=>{console.log(" [addUser] Starting:",{name:t,role:e,jobTitle:r});const c=n?await Oc(n):await Oc("1234"),l={id:Mt(),name:t,role:e,password:c,jobTitle:r,preferences:s,avatar:a||"",email:`${t.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}@local.app`};try{const{error:d}=await H.from("users").insert([{id:l.id,name:l.name,role:l.role,password:l.password,job_title:l.jobTitle,avatar:l.avatar,email:l.email,preferences:l.preferences||{}}]);if(d)throw d;console.log(" User saved to Supabase:",l.name)}catch(d){console.warn(" Supabase save failed, trying SQLite:",d);const h=ze();if(h!=null&&h.db)try{await h.db.run("INSERT INTO users (id, name, role, password, jobTitle, preferences, avatar) VALUES (?, ?, ?, ?, ?, ?, ?)",[l.id,l.name,l.role,l.password,l.jobTitle,JSON.stringify(l.preferences),l.avatar]),console.log(" User saved to SQLite (offline)")}catch(u){console.error(" SQLite also failed:",u)}const m=JSON.parse(localStorage.getItem("pending_users")||"[]");m.push(l),localStorage.setItem("pending_users",JSON.stringify(m)),z.info("   (  )")}return ln.push(l),Y._lastUsersFetch=0,Oe("users_updated"),l},updateUser:async(t,e)=>{var a,c,l;if(console.log(" [updateUser] Starting...",{id:t,updateKeys:Object.keys(e)}),t==="bootstrap_manager"||t.startsWith("temp_"))return console.log(" Converting Temp/Bootstrap User to Real User..."),Y.addUser(e.name||"User",e.role||ee.MANAGER,e.password||"1234",e.jobTitle||"Staff",e.preferences,e.avatar);const n={};e.name!==void 0&&(n.name=e.name),e.role!==void 0&&(n.role=e.role),e.password!==void 0&&(n.password=e.password),e.jobTitle!==void 0&&(n.job_title=e.jobTitle),e.avatar!==void 0&&(n.avatar=e.avatar,console.log(" [updateUser] Avatar being saved, size:",Math.round((((a=e.avatar)==null?void 0:a.length)||0)/1024),"KB")),e.email!==void 0&&(n.email=e.email),e.preferences!==void 0&&(n.preferences=e.preferences);let r=!1;try{console.log(" [updateUser] Saving to Supabase...");const{data:d,error:h}=await H.from("users").update(n).eq("id",t).select().single();if(h)throw console.error(" [updateUser] Supabase error:",h),h;console.log(" [updateUser] Supabase save SUCCESS!"),console.log("    Saved avatar length:",((c=d==null?void 0:d.avatar)==null?void 0:c.length)||0),r=!0}catch(d){console.warn(" [updateUser] Supabase update failed:",(d==null?void 0:d.message)||d);const h=ze();if(h!=null&&h.db){const m=Object.keys(e).filter(u=>u!=="id");if(m.length>0){const u=m.map(w=>`${w} = ?`).join(", "),p=m.map(w=>{const y=e[w];return typeof y=="object"?JSON.stringify(y):y});try{await h.db.run(`UPDATE users SET ${u} WHERE id = ?`,[...p,t]),console.log(" [updateUser] SQLite save SUCCESS (offline mode)")}catch(w){throw console.error(" [updateUser] SQLite update also failed:",w),new Error("Failed to save user: Both Supabase and SQLite failed")}}}else throw d}ln=ln.map(d=>d.id===t?{...d,...e}:d),Y._lastUsersFetch=0,Oe("users_updated");const s=ln.find(d=>d.id===t)||{};return console.log(" [updateUser] Complete!",{success:r,avatarSaved:!!s.avatar,avatarLength:((l=s.avatar)==null?void 0:l.length)||0}),s},deleteUser:async t=>{let e=!1,n=!1,r="",s="";try{console.log(" Attempting to hard delete user from Supabase:",t);const{error:c}=await H.from("users").delete().eq("id",t);if(c)throw console.error(" Supabase hard delete error:",c),r=c.message,c;console.log(" User hard deleted from Supabase:",t),e=!0}catch(c){console.warn(" Supabase hard delete failed, trying soft delete:",c),r=c instanceof Error?c.message:String(c);try{console.log(" Attempting soft delete for user:",t);const{error:l}=await H.from("users").update({deleted_at:new Date().toISOString()}).eq("id",t);l?(console.error(" Supabase soft delete also failed:",l),r+=` | Soft delete: ${l.message}`):(console.log(" User soft deleted from Supabase:",t),e=!0)}catch(l){console.error(" Soft delete exception:",l),r+=" | Soft delete exception"}}const a=ze();if(a!=null&&a.db)try{console.log(" Attempting to delete user from SQLite:",t);const c=await a.db.run("DELETE FROM users WHERE id = ?",[t]);console.log(" User deleted from SQLite, changes:",c.changes),n=!0}catch(c){console.error(" SQLite delete failed:",c),s=c instanceof Error?c.message:String(c)}ln=ln.filter(c=>c.id!==t);try{const l=JSON.parse(localStorage.getItem("pending_users")||"[]").filter(d=>d.id!==t);localStorage.setItem("pending_users",JSON.stringify(l)),console.log(" Removed user from pending_users if existed")}catch(c){console.warn("Failed to update pending_users:",c)}if(Y._lastUsersFetch=0,Oe("users_updated"),!e&&!n)throw new Error(`  :
Supabase: ${r||"OK"}
SQLite: ${s||"OK"}`);(!e||!n)&&console.warn(" Partial deletion - one source failed, but user removed from UI")},deleteAllUsers:async()=>{const t=ze();if(t!=null&&t.db){await t.db.run("DELETE FROM users"),Oe("users_updated");return}ln=[],Oe("users_updated")},getBookings:async()=>{console.log("[mockBackend]  getBookings called");let t=[],e=[],n=!1;if(gr())try{const{data:d,error:h}=await fs(H.from("bookings").select("*").is("deleted_at",null).order("shoot_date",{ascending:!0}),5e3);h?console.warn("[mockBackend]  Supabase bookings fetch failed:",h.message):(t=(d||[]).map(m=>Aa(m)),n=!0,console.log(`[mockBackend]  Supabase: ${t.length} bookings`))}catch(d){console.warn("[mockBackend]  Supabase bookings error (offline/timeout):",d)}else console.log("[mockBackend]  Offline  skipping Supabase, loading from SQLite only");const r=ze();if(r!=null&&r.db)try{e=(await r.db.query("SELECT * FROM bookings WHERE deletedAt IS NULL ORDER BY shootDate ASC")||[]).map(h=>Aa(h)),console.log(`[mockBackend]  SQLite: ${e.length} bookings`)}catch(d){console.warn("[mockBackend]  SQLite bookings fetch failed:",d)}const s=new Map,a=new Set(t.map(d=>d.id));e.forEach(d=>s.set(d.id,d)),t.forEach(d=>s.set(d.id,d)),De.forEach(d=>{s.has(d.id)||s.set(d.id,d)});const c=Array.from(s.values());if(c.length>0)De=c;else if(De.length>0)return console.log(`[mockBackend]  Both sources empty but cache has ${De.length} - keeping cache`),[...De];const l=e.filter(d=>!a.has(d.id));return l.length>0&&gr()&&n&&!bd?(console.log(`[mockBackend]  Found ${l.length} local-only bookings, syncing to Supabase...`),bd=!0,(async()=>{for(const d of l){const h=Date.now(),m=Cf.get(d.id)||0;if(!(h-m<Jw)){Cf.set(d.id,h);try{let u=null;if(Ef.has(d.id))u={message:"full schema disabled for this booking id"};else{const{error:p}=await H.from("bookings").upsert([{id:d.id,client_name:d.clientName,shoot_date:d.shootDate,title:d.title,status:d.status,total_amount:d.totalAmount,paid_amount:d.paidAmount,currency:d.currency,exchange_rate:d.exchangeRate||null,service_package:d.servicePackage,location:d.location,client_id:d.clientId,phone:d.clientPhone,category:d.category,details:typeof d.details=="string"?d.details:JSON.stringify(d.details),status_history:typeof d.statusHistory=="string"?d.statusHistory:JSON.stringify(d.statusHistory),notes:d.notes,is_priority:d.isPriority?1:0,is_crew_shooting:d.isCrewShooting?1:0}],{onConflict:"id"});u=p}if(u){u.status===400&&Ef.add(d.id);const{error:p}=await H.from("bookings").upsert([{id:d.id,client_name:d.clientName,shoot_date:d.shootDate,title:d.title,status:d.status,total_amount:d.totalAmount,paid_amount:d.paidAmount,currency:d.currency,service_package:d.servicePackage,location:d.location,client_id:d.clientId,category:d.category,details:typeof d.details=="string"?d.details:JSON.stringify(d.details),status_history:typeof d.statusHistory=="string"?d.statusHistory:JSON.stringify(d.statusHistory),notes:d.notes}],{onConflict:"id"});p?console.warn(`[mockBackend]  Failed to sync booking ${d.id} to Supabase:`,p.message):console.log(`[mockBackend]  Synced booking ${d.id} to Supabase (core columns)`)}else console.log(`[mockBackend]  Synced booking ${d.id} to Supabase`)}catch(u){console.warn(`[mockBackend]  Error syncing booking ${d.id}:`,u)}}}})().finally(()=>{bd=!1})):l.length>0&&!n&&console.log("[mockBackend]  Skipping local-only sync because Supabase fetch was unavailable"),console.log(`[mockBackend]  Total bookings: ${De.length} (Supabase: ${t.length}, SQLite: ${e.length})`),[...De]},addBooking:async t=>{var s;const e=t.client_token||`vh-${Mt().replace(/-/g,"").slice(0,12)}`,n={...t,id:t.id||Mt(),client_token:e};if(gr())try{const{error:a}=await fs(H.from("bookings").insert([{id:n.id,client_name:n.clientName,shoot_date:n.shootDate,title:n.title,status:n.status,total_amount:n.totalAmount,paid_amount:n.paidAmount,currency:n.currency,exchange_rate:n.exchangeRate||null,service_package:n.servicePackage,location:n.location,client_id:n.clientId,phone:n.clientPhone,category:n.category,details:JSON.stringify(n.details),status_history:JSON.stringify(n.statusHistory),notes:n.notes,is_priority:n.isPriority?1:0,is_crew_shooting:n.isCrewShooting?1:0,client_token:n.client_token}]),5e3);if(a)throw a;console.log(" Booking saved to Supabase")}catch(a){console.warn(" Failed to save booking to Supabase (full schema), trying core columns...",(a==null?void 0:a.message)||a);try{const{error:c}=await fs(H.from("bookings").insert([{id:n.id,client_name:n.clientName,shoot_date:n.shootDate,title:n.title,status:n.status,total_amount:n.totalAmount,paid_amount:n.paidAmount,currency:n.currency,service_package:n.servicePackage,location:n.location,client_id:n.clientId,category:n.category,details:JSON.stringify(n.details),status_history:JSON.stringify(n.statusHistory),notes:n.notes,client_token:n.client_token}]),5e3);if(c)throw c;console.log(" Booking saved to Supabase (core columns)")}catch(c){console.warn(" Failed to save booking to Supabase entirely (will sync later):",c)}}else console.log(" Offline  booking will be saved locally and synced later");const r=ze();if(r!=null&&r.db)try{await r.db.run(`INSERT OR REPLACE INTO bookings (id, clientName, clientPhone, clientId, category, title, shootDate, status, totalAmount, paidAmount, currency, exchangeRate, servicePackage, location, details, statusHistory, notes, createdBy, isPriority, isCrewShooting, client_token)
           VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[n.id,n.clientName,n.clientPhone,n.clientId,n.category,n.title,n.shootDate,n.status,n.totalAmount,n.paidAmount,n.currency,n.exchangeRate||null,n.servicePackage,n.location,JSON.stringify(n.details),JSON.stringify(n.statusHistory),n.notes||"",n.created_by||"",n.isPriority?1:0,n.isCrewShooting?1:0,n.client_token||null]),console.log(" Booking saved to SQLite")}catch(a){if((s=a==null?void 0:a.message)!=null&&s.includes("no column named exchangeRate"))try{await r.db.run(`INSERT OR REPLACE INTO bookings (id, clientName, clientPhone, clientId, category, title, shootDate, status, totalAmount, paidAmount, currency, servicePackage, location, details, statusHistory, notes, createdBy, isPriority, isCrewShooting, client_token)
               VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[n.id,n.clientName,n.clientPhone,n.clientId,n.category,n.title,n.shootDate,n.status,n.totalAmount,n.paidAmount,n.currency,n.servicePackage,n.location,JSON.stringify(n.details),JSON.stringify(n.statusHistory),n.notes||"",n.created_by||"",n.isPriority?1:0,n.isCrewShooting?1:0,n.client_token||null]),console.log(" Booking saved to SQLite (legacy schema)")}catch(c){console.warn(" Failed to save booking to SQLite:",c)}else console.warn(" Failed to save booking to SQLite:",a)}return De.push(n),Oe("bookings_updated"),n},updateBooking:async(t,e)=>{try{const s={};e.clientName!==void 0&&(s.client_name=e.clientName),e.shootDate!==void 0&&(s.shoot_date=e.shootDate),e.title!==void 0&&(s.title=e.title),e.status!==void 0&&(s.status=e.status),e.totalAmount!==void 0&&(s.total_amount=e.totalAmount),e.paidAmount!==void 0&&(s.paid_amount=e.paidAmount),e.currency!==void 0&&(s.currency=e.currency),e.servicePackage!==void 0&&(s.service_package=e.servicePackage),e.location!==void 0&&(s.location=e.location),e.clientId!==void 0&&(s.client_id=e.clientId),e.clientPhone!==void 0&&(s.phone=e.clientPhone),e.category!==void 0&&(s.category=e.category),e.client_token!==void 0&&(s.client_token=e.client_token);const a=c=>{try{return JSON.stringify(c,(l,d)=>{if(!(d===window||d===document||d instanceof Node)&&typeof d!="function")return d})}catch(l){return console.warn("Failed to stringify object:",l),JSON.stringify({})}};if(e.details!==void 0&&(s.details=a(e.details)),e.statusHistory!==void 0&&(s.status_history=a(e.statusHistory)),e.notes!==void 0&&(s.notes=e.notes),e.isPriority!==void 0&&(s.is_priority=e.isPriority?1:0),e.isCrewShooting!==void 0&&(s.is_crew_shooting=e.isCrewShooting?1:0),e.isFamous!==void 0&&(s.is_famous=e.isFamous?1:0),e.exchangeRate!==void 0&&(s.exchange_rate=e.exchangeRate),gr()){const{error:c}=await fs(H.from("bookings").update(s).eq("id",t),5e3);if(c)throw c;console.log(" Booking updated in Supabase")}else console.log(" Offline  booking update saved locally, will sync later")}catch(s){console.warn(" Failed to update booking in Supabase (will sync later):",s)}De=De.map(s=>s.id===t?{...s,...e}:s);const n=ze();if(n!=null&&n.db)try{const s=[],a=[];e.clientName!==void 0&&(s.push("clientName = ?"),a.push(e.clientName)),e.shootDate!==void 0&&(s.push("shootDate = ?"),a.push(e.shootDate)),e.title!==void 0&&(s.push("title = ?"),a.push(e.title)),e.status!==void 0&&(s.push("status = ?"),a.push(e.status)),e.totalAmount!==void 0&&(s.push("totalAmount = ?"),a.push(e.totalAmount)),e.paidAmount!==void 0&&(s.push("paidAmount = ?"),a.push(e.paidAmount)),e.currency!==void 0&&(s.push("currency = ?"),a.push(e.currency)),e.category!==void 0&&(s.push("category = ?"),a.push(e.category)),e.notes!==void 0&&(s.push("notes = ?"),a.push(e.notes)),e.client_token!==void 0&&(s.push("client_token = ?"),a.push(e.client_token)),e.details!==void 0&&(s.push("details = ?"),a.push(JSON.stringify(e.details))),e.statusHistory!==void 0&&(s.push("statusHistory = ?"),a.push(JSON.stringify(e.statusHistory))),s.length>0&&(a.push(t),await n.db.run(`UPDATE bookings SET ${s.join(", ")} WHERE id = ?`,a))}catch(s){console.warn(" Failed to update booking in SQLite:",s)}Oe("bookings_updated");const r=De.find(s=>s.id===t);return r&&Y.autoCompleteTasksForBooking(t,r).catch(s=>{console.error("Auto-complete tasks error:",s)}),r},softDeleteBooking:async t=>{if(gr())try{const{error:e}=await fs(H.from("bookings").update({deleted_at:new Date().toISOString()}).eq("id",t),5e3);if(e)throw e;console.log(" Booking soft-deleted in Supabase")}catch(e){console.warn("Failed to soft delete booking in Supabase (will sync later):",e)}De=De.map(e=>e.id===t?{...e,deletedAt:Date.now()}:e),Oe("bookings_updated")},restoreBooking:async t=>{if(gr())try{const{error:e}=await fs(H.from("bookings").update({deleted_at:null}).eq("id",t),5e3);if(e)throw e;console.log(" Booking restored in Supabase")}catch(e){console.warn("Failed to restore booking in Supabase (will sync later):",e)}De=De.map(e=>e.id===t?{...e,deletedAt:void 0}:e),Oe("bookings_updated")},getDeletedBookings:async()=>{const t=ze();if(t!=null&&t.db)try{return(await t.db.query("SELECT * FROM bookings WHERE deletedAt IS NOT NULL ORDER BY deletedAt DESC")).map(Aa)}catch(e){console.error("Failed to get deleted bookings:",e)}return De.filter(e=>e.deletedAt)},permanentDeleteBooking:async t=>{if(gr())try{const{error:e}=await fs(H.from("bookings").delete().eq("id",t),5e3);if(e)throw e;console.log(" Booking permanently deleted from Supabase")}catch(e){console.warn("Failed to permanently delete booking from Supabase (will sync later):",e)}De=De.filter(e=>e.id!==t),Oe("bookings_updated")},deleteBooking:async t=>Y.softDeleteBooking(t),updateBookingStatus:async(t,e)=>Y.updateBooking(t,{status:e}),settlePayment:async t=>{const e=De.find(n=>n.id===t);if(e)return Y.updateBooking(t,{paidAmount:e.totalAmount})},getDashboardTasks:async()=>{console.log("[mockBackend]  getDashboardTasks called");const t=ze();if(t!=null&&t.db)try{console.log("[mockBackend]  Fetching tasks from database...");const e=await t.db.query("SELECT * FROM dashboard_tasks WHERE deletedAt IS NULL");console.log(`[mockBackend]  Fetched ${e.length} tasks`);const n=new Date().toDateString();return Mn=e.map(r=>({id:String(r.id),title:String(r.title),time:String(r.time||""),completed:!!r.completed,type:r.type||"general",source:r.source||"manual",relatedBookingId:r.relatedBookingId?String(r.relatedBookingId):void 0,priority:r.priority||"normal",createdAt:r.createdAt})).filter(r=>r.completed?r.createdAt?new Date(r.createdAt).toDateString()===n:!1:!0),console.log(`[mockBackend]  Returning ${Mn.length} filtered tasks`),Mn}catch(e){return console.error("[mockBackend]  IPC getDashboardTasks failed:",e),[]}return console.log("[mockBackend]  No Electron API, returning cached tasks"),[...Mn]},addTask:async(t,e="general",n="manual",r="normal",s,a,c)=>{const l=ze();if(l!=null&&l.db)try{if(a){const h=await l.db.query("SELECT * FROM dashboard_tasks WHERE id = ? AND deletedAt IS NULL",[a]);if(h&&h.length>0){const m=h[0];return{id:String(m.id),title:String(m.title),time:String(m.time||""),completed:!!m.completed,type:m.type||"general",source:m.source||"manual",relatedBookingId:m.relatedBookingId?String(m.relatedBookingId):void 0,priority:m.priority||"normal",createdAt:m.createdAt?String(m.createdAt):new Date().toISOString()}}}const d={id:a||Mt(),title:t,time:c||new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),completed:!1,type:e,source:n,priority:r,relatedBookingId:s,createdAt:new Date().toISOString()};return await l.db.run("INSERT INTO dashboard_tasks (id, title, time, completed, type, source, priority, relatedBookingId, createdAt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)",[d.id,d.title,d.time,0,d.type,d.source,d.priority,d.relatedBookingId,d.createdAt]),Oe("tasks_updated"),d}catch(d){return console.error("IPC addTask failed:",d),{id:a||Mt(),title:t,time:c||new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),completed:!1,type:e,source:n,priority:r,relatedBookingId:s,createdAt:new Date().toISOString()}}else{const d={id:a||Mt(),title:t,time:c||new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),completed:!1,type:e,source:n,priority:r,relatedBookingId:s,createdAt:new Date().toISOString()},h=Mn.findIndex(m=>m.id===d.id);return h!==-1?Mn[h]:(Mn.push(d),Oe("tasks_updated"),d)}},toggleTask:async t=>{const e=ze(),n=Mn.findIndex(r=>r.id===t);if(!(n===-1&&!(e!=null&&e.db))&&(n>-1&&(Mn[n].completed=!Mn[n].completed,Oe("tasks_updated")),e!=null&&e.db))try{await e.db.run("UPDATE dashboard_tasks SET completed = CASE WHEN completed = 1 THEN 0 ELSE 1 END WHERE id = ?",[t]),Oe("tasks_updated")}catch(r){console.error("IPC toggleTask failed:",r)}},deleteTask:async t=>{const e=ze();if(e!=null&&e.db)try{await e.db.run("UPDATE dashboard_tasks SET deletedAt = ? WHERE id = ?",[Date.now(),t]),Oe("tasks_updated")}catch(n){console.error("IPC deleteTask failed:",n)}Mn=Mn.filter(n=>n.id!==t),Oe("tasks_updated")},autoCompleteTasksForBooking:async(t,e)=>{try{const n=e||De.find(a=>a.id===t);if(!n){console.warn("autoCompleteTasksForBooking: Booking not found:",t);return}const s=(await Y.getDashboardTasks()).filter(a=>a.relatedBookingId===t);if(s.length===0)return;if(n.status===me.SHOOTING){const a=`reception-${t}`,c=s.find(l=>l.id===a);c&&!c.completed&&(console.log(" Auto-completing reception task:",a),await Y.toggleTask(a))}if(n.paidAmount>=n.totalAmount){const a=`payment-verify-${t}`,c=s.find(l=>l.id===a);c&&!c.completed&&(console.log(" Auto-completing payment task:",a),await Y.toggleTask(a))}console.log(" Auto-complete tasks check completed for booking:",t)}catch(n){console.error("Error in autoCompleteTasksForBooking:",n)}},getReminders:async t=>hs.filter(e=>e.bookingId===t),addReminder:async(t,e,n,r,s)=>{const a={id:Mt(),bookingId:t,title:e,dueDate:n,type:r,customIcon:s,completed:!1};return hs.push(a),Oe("reminders_updated"),a},updateReminder:async(t,e)=>{hs=hs.map(n=>n.id===t?{...n,...e}:n),Oe("reminders_updated")},deleteReminder:async t=>{hs=hs.filter(e=>e.id!==t),Oe("reminders_updated")},toggleReminder:async t=>{hs=hs.map(e=>e.id===t?{...e,completed:!e.completed}:e),Oe("reminders_updated")},getExpenses:async()=>{try{const{data:t,error:e}=await H.from("expenses").select("*").is("deleted_at",null).order("date",{ascending:!1});if(e)return console.warn("Failed to fetch expenses from Supabase, using cache:",e),[...us];const n=(t||[]).map(l=>({id:String(l.id),title:String(l.title),amount:Number(l.amount),currency:l.currency||"IQD",category:l.category||"other",date:String(l.date),note:l.note,isRecurring:l.is_recurring,exchangeRate:l.exchange_rate})),r=JSON.parse(localStorage.getItem("pending_expenses")||"[]"),s=[];for(const l of r)try{console.log(" Retrying pending expense upload:",l.title);const{error:d}=await H.from("expenses").insert([{id:l.id,title:l.title,amount:l.amount,currency:l.currency,category:l.category,date:l.date,note:l.note,is_recurring:l.isRecurring||!1,exchange_rate:l.exchangeRate||1400}]);if(d)if(d.message&&d.message.includes('column "exchange_rate" does not exist'))await H.from("expenses").insert([{id:l.id,title:l.title,amount:l.amount,currency:l.currency,category:l.category,date:l.date,note:l.note,is_recurring:l.isRecurring||!1}]);else throw d;console.log(" Pending expense synced!")}catch(d){console.warn(" Retry failed, keeping in queue:",d),s.push(l)}localStorage.setItem("pending_expenses",JSON.stringify(s));const a=new Set(s.map(l=>l.id)),c=n.filter(l=>!a.has(l.id));return us=[...s,...c],console.log(` Loaded ${us.length} expenses (Supabase + Local Queue)`),[...us]}catch(t){return console.error("getExpenses error:",t),[...us]}},addExpense:async t=>{const e={...t,id:t.id||Mt()};try{const{error:n}=await H.from("expenses").insert([{id:e.id,title:e.title,amount:e.amount,currency:e.currency,category:e.category,date:e.date,note:e.note,is_recurring:e.isRecurring||!1,exchange_rate:e.exchangeRate||1400}]);if(n)if(n.message&&n.message.includes('column "exchange_rate" does not exist')){console.warn(" Exchange rate column missing, retrying without it...");const{error:r}=await H.from("expenses").insert([{id:e.id,title:e.title,amount:e.amount,currency:e.currency,category:e.category,date:e.date,note:e.note,is_recurring:e.isRecurring||!1}]);if(r)throw r}else throw n;console.log(" Expense saved to Supabase")}catch(n){console.warn("Failed to save expense to Supabase, saving to local queue:",n);const r=JSON.parse(localStorage.getItem("pending_expenses")||"[]");r.push(e),localStorage.setItem("pending_expenses",JSON.stringify(r)),z.success("   (  )")}return us.unshift(e),Oe("expenses_updated"),e},deleteExpense:async t=>{try{const{error:r}=await H.from("expenses").update({deleted_at:new Date().toISOString()}).eq("id",t);if(r)throw r;console.log(" Expense soft-deleted in Supabase")}catch(r){console.warn("Failed to delete expense in Supabase:",r)}us=us.filter(r=>r.id!==t);const n=JSON.parse(localStorage.getItem("pending_expenses")||"[]").filter(r=>r.id!==t);localStorage.setItem("pending_expenses",JSON.stringify(n)),Oe("expenses_updated")},getRecurringExpenses:async()=>{try{const{data:t,error:e}=await H.from("recurring_expenses").select("*").eq("is_active",!0).order("day_of_month",{ascending:!0});return e?(console.warn("recurring_expenses fetch failed:",e),[...ti]):(ti=(t||[]).map(n=>({id:String(n.id),title:String(n.title),amount:Number(n.amount),currency:n.currency||"IQD",category:n.category||"other",dayOfMonth:Number(n.day_of_month)||1,isActive:!!n.is_active,createdAt:String(n.created_at),exchangeRate:n.exchange_rate})),[...ti])}catch{return[...ti]}},getAdminStats:async()=>{var e,n,r,s,a;const t=ze();if(!(t!=null&&t.db))return null;try{const c=new Date().toISOString().split("T")[0],l=await t.db.query("SELECT SUM(amount) as total FROM payments WHERE date LIKE ? AND deletedAt IS NULL",[`${c}%`]),d=await t.db.query("SELECT SUM(amount) as total FROM payments WHERE date LIKE ? AND type = 'deposit' AND deletedAt IS NULL",[`${c}%`]),h=await t.db.query("SELECT SUM(amount) as total FROM payments WHERE date LIKE ? AND (type != 'deposit' OR type IS NULL) AND deletedAt IS NULL",[`${c}%`]),m=await t.db.query("SELECT SUM(totalAmount) as total FROM bookings WHERE deletedAt IS NULL"),u=await t.db.query("SELECT SUM(paidAmount) as total FROM bookings WHERE deletedAt IS NULL"),p=await t.db.query(`
        SELECT u.name, u.role, 
        (SELECT COUNT(*) FROM bookings b WHERE b.assignedPhotoEditor = u.id AND b.status = 'Ready to Print') as photoCompletions,
        (SELECT COUNT(*) FROM bookings b WHERE b.assignedShooter = u.id AND b.status = 'Shooting Completed') as shootCompletions
        FROM users u WHERE u.deletedAt IS NULL
      `),w=await t.db.query("SELECT location, shootDate, details FROM bookings WHERE shootDate LIKE ? AND deletedAt IS NULL",[`${c}%`]);return{vault:{totalInDrawer:Number(((e=l[0])==null?void 0:e.total)||0),deposits:Number(((n=d[0])==null?void 0:n.total)||0),finals:Number(((r=h[0])==null?void 0:r.total)||0),outstanding:Number(((s=m[0])==null?void 0:s.total)||0)-Number(((a=u[0])==null?void 0:a.total)||0)},performance:p.map(y=>({name:y.name,role:y.role,score:(y.photoCompletions||0)+(y.shootCompletions||0)})),venues:w.map(y=>{const g=JSON.parse(y.details||"{}");return{location:y.location,start:g.startTime,end:g.endTime,client:y.clientName}})}}catch(c){return console.error("Failed to aggregate Admin Stats:",c),null}},getInventory:async()=>{const t=ze();if(t!=null&&t.db)try{return(await t.db.query("SELECT * FROM inventory ORDER BY type ASC, name ASC")).map(n=>({id:String(n.id),name:String(n.name),type:String(n.type),icon:String(n.icon||""),status:String(n.status||"storage"),assignedTo:n.assignedTo?String(n.assignedTo):null,batteryPool:n.batteryTotal?{total:Number(n.batteryTotal),charged:Number(n.batteryCharged)}:null,memoryPool:n.memoryTotal?{total:Number(n.memoryTotal),free:Number(n.memoryFree)}:null,notes:n.notes?String(n.notes):""}))}catch(e){console.error("Failed to fetch inventory from SQLite:",e)}return[]},updateInventoryItem:async(t,e)=>{const n=ze();if(n!=null&&n.db){if(Object.keys(e).length===0)return;const s={...e};e.batteryPool&&(s.batteryCharged=e.batteryPool.charged,s.batteryTotal=e.batteryPool.total,delete s.batteryPool),e.memoryPool&&(s.memoryFree=e.memoryPool.free,s.memoryTotal=e.memoryPool.total,delete s.memoryPool);const a=Object.keys(s),c=a.map(d=>`${d} = ?`).join(", "),l=a.map(d=>s[d]);try{await n.db.run(`UPDATE inventory SET ${c}, updatedAt = ? WHERE id = ?`,[...l,new Date().toISOString(),t]),Oe("bookings_updated")}catch(d){console.error("Failed to update inventory in SQLite:",d)}}},getInventoryLogs:async()=>{const t=ze();if(t!=null&&t.db)try{return(await t.db.query("SELECT * FROM inventory_logs ORDER BY createdAt DESC LIMIT 50")).map(n=>({id:String(n.id),itemId:String(n.itemId),action:String(n.action),userId:String(n.userId),details:String(n.details||""),createdAt:String(n.createdAt)}))}catch(e){console.error("Failed to fetch inventory logs:",e)}return[]},addInventoryLog:async t=>{const e=ze();if(e!=null&&e.db)try{await e.db.run("INSERT INTO inventory_logs (id, itemId, action, userId, details, createdAt) VALUES (?, ?, ?, ?, ?, ?)",[Mt(),t.itemId,t.action,t.userId,t.details,new Date().toISOString()])}catch(n){console.error("Failed to add inventory log:",n)}},addInventoryItem:async t=>{const e=ze();if(e!=null&&e.db)try{const n=Mt(),r=new Date().toISOString();return await e.db.run("INSERT INTO inventory (id, name, type, icon, status, assignedTo, batteryCharged, batteryTotal, memoryFree, memoryTotal, notes, createdAt, updatedAt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[n,t.name,t.type,t.icon||"",t.status||"storage",t.assignedTo||null,t.batteryCharged??null,t.batteryTotal??null,t.memoryFree??null,t.memoryTotal??null,t.notes||"",r,r]),n}catch(n){console.error("Failed to add inventory item:",n)}return null},deleteInventoryItem:async t=>{const e=ze();if(e!=null&&e.db)try{await e.db.run("DELETE FROM inventory WHERE id = ?",[t])}catch(n){console.error("Failed to delete inventory item:",n)}},getActivityLogs:async(t=50)=>{const e=ze();if(e!=null&&e.db)try{return(await e.db.query(`SELECT * FROM activity_logs ORDER BY createdAt DESC LIMIT ${t}`)).map(r=>({id:String(r.id),user:String(r.userName),userId:String(r.userId),action:String(r.action),target:String(r.details||r.entityType),time:new Date(String(r.createdAt)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:String(r.action).toLowerCase().includes("delete")?"danger":"info"}))}catch(n){console.error("Failed to fetch activity logs:",n)}return[]},getProductivityStats:async()=>{const t=ze();if(t!=null&&t.db)try{const e=new Date().toISOString().split("T")[0];return await t.db.query(`SELECT strftime('%H:00', createdAt) as time, COUNT(*) as actions
                  FROM activity_logs
                  WHERE createdAt LIKE ?
                  GROUP BY time
                  ORDER BY time ASC`,[`${e}%`])}catch(e){console.error("Failed to fetch productivity stats:",e)}return[]},getTodayAttendance:async()=>{const t=ze();if(t!=null&&t.db)try{const e=new Date().toISOString().split("T")[0];return await t.db.query(`SELECT da.*, u.role, u.avatar, u.jobTitle
           FROM daily_attendance da
           LEFT JOIN users u ON da.userId = u.id
           WHERE da.date = ?
           ORDER BY da.checkIn ASC`,[e])||[]}catch(e){console.error("Failed to fetch today attendance:",e)}return[]},getEmployeeActionsToday:async()=>{const t=ze();if(t!=null&&t.db)try{const e=new Date().toISOString().split("T")[0];return await t.db.query(`SELECT userId, userName, COUNT(*) as actionCount
           FROM activity_logs
           WHERE createdAt LIKE ?
           GROUP BY userId
           ORDER BY actionCount DESC`,[`${e}%`])||[]}catch(e){console.error("Failed to fetch employee actions:",e)}return[]},getEmployeeBookingsToday:async()=>{const t=ze();if(t!=null&&t.db)try{const e=new Date().toISOString().split("T")[0];return await t.db.query(`SELECT updatedBy as userId, COUNT(*) as completedCount
           FROM bookings
           WHERE updatedAt LIKE ? AND status IN ('completed', 'delivered')
           GROUP BY updatedBy`,[`${e}%`])||[]}catch(e){console.error("Failed to fetch employee bookings:",e)}return[]},addExtraService:async(t,e,n,r,s,a)=>{const c=ze();if(c!=null&&c.db)try{const l=Mt(),d=new Date().toISOString(),h=await c.db.query("SELECT currency, totalAmount, addOnTotal, originalPackagePrice FROM bookings WHERE id = ?",[t]),m=h==null?void 0:h[0],u=(m==null?void 0:m.currency)||"IQD",p=a||"IQD",w=p===u;if(await c.db.run(`INSERT INTO add_ons (id, bookingId, category, description, amount, currency, exchangeRate, convertedAmount, requestedBy, requestedByName, requestedAt, status, createdAt, updatedAt, originalPackagePrice, previousTotal, newTotal)
                 VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[l,t,"Other",n,e,p,1400,e,r,s,d,"approved",d,d,Number((m==null?void 0:m.originalPackagePrice)||(m==null?void 0:m.totalAmount)||0),Number((m==null?void 0:m.totalAmount)||0),Number((m==null?void 0:m.totalAmount)||0)+(w?e:0)]),w)await c.db.run("UPDATE bookings SET totalAmount = totalAmount + ?, paidAmount = paidAmount + ? WHERE id = ?",[e,e,t]);else{const g=Number((m==null?void 0:m.addOnTotal)||0),N=Number((m==null?void 0:m.totalAmount)||0),v=Number((m==null?void 0:m.originalPackagePrice)||0);await c.db.run("UPDATE bookings SET addOnTotal = ?, originalPackagePrice = CASE WHEN originalPackagePrice IS NULL OR originalPackagePrice = 0 THEN ? ELSE originalPackagePrice END WHERE id = ?",[g+e,N,t])}await c.db.run("INSERT INTO activity_logs (id, userId, userName, action, entityType, entityId, details, createdAt) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[Mt(),r,s,"Added Extra Service","Booking",t,`Added ${e} ${p} for ${n}`,d]);const y=De.find(g=>g.id===t);return y&&(w?(y.totalAmount=(y.totalAmount||0)+e,y.paidAmount=(y.paidAmount||0)+e):(y.originalPackagePrice||(y.originalPackagePrice=y.totalAmount),y.addOnTotal=(y.addOnTotal||0)+e)),{success:!0}}catch(l){throw console.error("Failed to add extra service:",l),l}return{success:!1}},addRecurringExpense:async t=>{const e={...t,id:Mt(),createdAt:new Date().toISOString()};try{const{data:n,error:r}=await H.from("recurring_expenses").insert([{id:e.id,title:e.title,amount:e.amount,currency:e.currency,category:e.category,day_of_month:e.dayOfMonth,is_active:e.isActive,created_at:e.createdAt,exchange_rate:e.exchangeRate||1400}]).select().single();if(r){if(r.message&&r.message.includes('column "exchange_rate" does not exist')){const{data:s,error:a}=await H.from("recurring_expenses").insert([{id:e.id,title:e.title,amount:e.amount,currency:e.currency,category:e.category,day_of_month:e.dayOfMonth,is_active:e.isActive,created_at:e.createdAt}]).select().single();if(a)throw a;return Oe("recurring_expenses_updated"),{id:String(s.id),title:String(s.title),amount:Number(s.amount),currency:s.currency,category:s.category,dayOfMonth:Number(s.day_of_month),isActive:!!s.is_active,createdAt:String(s.created_at)}}throw r}return Oe("recurring_expenses_updated"),{id:String(n.id),title:String(n.title),amount:Number(n.amount),currency:n.currency,category:n.category,dayOfMonth:Number(n.day_of_month),isActive:!!n.is_active,createdAt:String(n.created_at),exchangeRate:n.exchange_rate}}catch{return console.warn("Failed to save recurring to Supabase, saving locally"),ti.push(e),Oe("recurring_expenses_updated"),e}},deleteRecurringExpense:async t=>{try{const{error:e}=await H.from("recurring_expenses").update({is_active:!1}).eq("id",t);if(e)throw e;return Oe("recurring_expenses_updated"),!0}catch{return ti=ti.filter(e=>e.id!==t),Oe("recurring_expenses_updated"),!0}},generateAiMessage:async t=>"This is a mock AI response for: "+t,subscribe:t=>(Vc.push(t),()=>{const e=Vc.indexOf(t);e>-1&&Vc.splice(e,1)})},Yw=Object.freeze(Object.defineProperty({__proto__:null,electronBackend:Y},Symbol.toStringTag,{value:"Module"})),Rl=class Rl{static start(e){this.intervalId||(console.log(" [NasVision] Service Started (Eye of the Storm)"),this.intervalId=setInterval(async()=>{if(!this.isScanning){this.isScanning=!0;try{const r=(await Y.getBookings()).filter(s=>s.status===me.SHOOTING||s.status===me.SHOOTING_COMPLETED||s.status===me.SELECTION);for(const s of r){if(!s.folderPath)continue;const a=await window.electronAPI.sessionLifecycle.getStats(s.folderPath);a&&(s.status===me.SHOOTING&&a.raw>0&&(console.log(` [NasVision] Files detected for ${s.clientName}. Moving to Completed.`),await Y.updateBooking(s.id,{status:me.SHOOTING_COMPLETED,notes:(s.notes||"")+`
[NAS Vision] Auto-detected ${a.raw} raw files.`}),z.success(`     ${s.clientName} -   `),e&&e()),s.status===me.SELECTION&&a.selected>0&&(console.log(` [NasVision] Selections detected for ${s.clientName}. Moving to Editing.`),await Y.updateBooking(s.id,{status:me.EDITING,notes:(s.notes||"")+`
[NAS Vision] Auto-detected ${a.selected} selections.`}),z.success(`     ${s.clientName} -  `),e&&e()))}}catch(n){console.warn("NasVision scan failed:",n)}finally{this.isScanning=!1}}},1e4))}static stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}};Rl.intervalId=null,Rl.isScanning=!1;let gl=Rl;const Xw=({value:t,onChange:e,label:n})=>{const[r,s]=x.useState(!1),[a,c]=x.useState(12),[l,d]=x.useState(0),[h,m]=x.useState("PM"),[u,p]=x.useState("hours"),[w,y]=x.useState("12"),[g,N]=x.useState("00");x.useEffect(()=>{if(t){const[I,M]=t.split(":");let V=parseInt(I,10);const de=parseInt(M,10);if(!isNaN(V)&&!isNaN(de)){const X=V>=12?"PM":"AM";V>12&&(V-=12),V===0&&(V=12),c(V),d(de),m(X),y(V.toString().padStart(2,"0")),N(de.toString().padStart(2,"0"))}}},[t,r]);const v=I=>{c(I),y(I.toString().padStart(2,"0"))},C=I=>{d(I),N(I.toString().padStart(2,"0"))},S=I=>I.replace(/[-]/g,M=>"".indexOf(M).toString()).replace(/\D/g,""),_=I=>{let M=S(I.target.value);M.length>2&&(M=M.slice(0,2)),y(M);const V=parseInt(M,10);!isNaN(V)&&V>=1&&V<=12&&c(V)},D=()=>{let I=parseInt(w,10);(isNaN(I)||I<1||I>12)&&(I=a),c(I),y(I.toString().padStart(2,"0"))},O=I=>{let M=S(I.target.value);M.length>2&&(M=M.slice(0,2)),N(M);const V=parseInt(M,10);!isNaN(V)&&V>=0&&V<=59&&d(V)},b=()=>{let I=parseInt(g,10);(isNaN(I)||I<0||I>59)&&(I=l),d(I),N(I.toString().padStart(2,"0"))},A=()=>{let I=a;h==="PM"&&a!==12&&(I+=12),h==="AM"&&a===12&&(I=0),e(`${I.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`),s(!1)},q=()=>{if(!t)return"--:-- --";try{const[I,M]=String(t).split(":");let V=parseInt(I,10);isNaN(V)&&(V=12);const de=V>=12?"PM":"AM";V>12&&(V-=12),V===0&&(V=12);const X=M||"00";return`${V.toString().padStart(2,"0")}:${X} ${de}`}catch{return"--:-- --"}};return i.jsxs("div",{className:"w-full relative",children:[i.jsx("button",{onClick:()=>s(!0),className:"w-full bg-[#121212] border border-white/10 rounded-2xl px-5 py-4 flex items-center justify-between shadow-inner hover:border-[#F7931E]/50 transition-all group",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Bs,{className:"text-gray-500 group-hover:text-[#F7931E] transition-colors",size:18}),i.jsx("span",{className:"text-white font-mono text-base font-bold tracking-wider pt-0.5",children:q()})]})}),r&&mm.createPortal(i.jsx("div",{className:"fixed inset-0 z-300000 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in",onClick:()=>s(!1),children:i.jsxs("div",{className:"bg-[#1E1E1E] w-full max-w-[340px] rounded-4xl shadow-2xl border border-white/10 overflow-hidden flex flex-col relative animate-in zoom-in-95",onClick:I=>I.stopPropagation(),children:[i.jsxs("div",{className:"p-6 pb-4 flex flex-col items-center justify-center bg-[#262626] border-b border-white/5 relative overflow-hidden",children:[i.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] mb-4 z-10",children:" "}),i.jsxs("div",{className:"flex items-end gap-2 z-10 font-mono",dir:"ltr",children:[i.jsx("input",{type:"text",value:w,onClick:()=>p("hours"),onChange:_,onBlur:D,className:`w-20 text-5xl font-bold bg-transparent text-center outline-none transition-all ${u==="hours"?"text-[#F7931E]":"text-white/40"}`}),i.jsx("span",{className:"text-5xl font-bold text-white/20 pb-2",children:":"}),i.jsx("input",{type:"text",value:g,onClick:()=>p("minutes"),onChange:O,onBlur:b,className:`w-20 text-5xl font-bold bg-transparent text-center outline-none transition-all ${u==="minutes"?"text-[#F7931E]":"text-white/40"}`})]}),i.jsxs("div",{className:"flex bg-black/30 rounded-lg p-1 border border-white/5 mt-4 z-10",dir:"ltr",children:[i.jsx("button",{onClick:()=>m("AM"),className:`px-4 py-1.5 rounded-md text-xs font-bold transition-all ${h==="AM"?"bg-[#F7931E] text-white":"text-gray-500"}`,children:"AM"}),i.jsx("button",{onClick:()=>m("PM"),className:`px-4 py-1.5 rounded-md text-xs font-bold transition-all ${h==="PM"?"bg-[#F7931E] text-white":"text-gray-500"}`,children:"PM"})]})]}),i.jsx("div",{className:"p-6 flex items-center justify-center bg-[#1E1E1E]",children:i.jsx(ev,{mode:u,value:u==="hours"?a:l,onChange:I=>{u==="hours"?(v(I),setTimeout(()=>p("minutes"),300)):C(I)}})}),i.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#1E1E1E] border-t border-white/5 gap-3",children:[i.jsx("button",{onClick:()=>s(!1),className:"flex-1 py-3 text-sm font-bold text-gray-500 hover:text-white bg-white/5 rounded-xl",children:""}),i.jsx("button",{onClick:A,className:"flex-1 py-3 text-sm font-bold bg-[#F7931E] text-white rounded-xl shadow-lg flex items-center justify-center gap-2",children:i.jsx("span",{children:""})})]})]})}),document.body)]})},ev=({mode:t,value:e,onChange:n})=>{const r=x.useRef(null),[s,a]=x.useState(!1),c=100,l=240,d=l/2,h=t==="hours"?[12,1,2,3,4,5,6,7,8,9,10,11]:[0,5,10,15,20,25,30,35,40,45,50,55],m=t==="hours"?e%12*30:e*6,u=x.useCallback((g,N)=>{if(!r.current)return;const v=r.current.getBoundingClientRect(),C=v.left+v.width/2,S=v.top+v.height/2;let _=Math.atan2(N-S,g-C)*(180/Math.PI)+90;if(_<0&&(_+=360),t==="hours"){let D=Math.round(_/30);D===0&&(D=12),n(D)}else{let D=Math.round(_/6);D===60&&(D=0),n(D)}},[t,n]),p=g=>{a(!0),u(g.clientX,g.clientY)},w=g=>{s&&u(g.clientX,g.clientY)},y=()=>a(!1);return i.jsxs("div",{className:"relative select-none cursor-pointer",style:{width:l,height:l},ref:r,onMouseDown:p,onMouseMove:w,onMouseUp:y,onMouseLeave:y,children:[i.jsx("div",{className:"absolute inset-0 rounded-full bg-[#262626] border border-white/5 shadow-inner"}),i.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-[#F7931E] rounded-full z-20"}),i.jsx("div",{className:"absolute left-1/2 top-1/2 origin-bottom z-10 transition-transform duration-150",style:{height:c,width:2,backgroundColor:"#F7931E",transform:`translate(-50%, -100%) rotate(${m}deg)`},children:i.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-[#F7931E] shadow-lg"})}),h.map(g=>{const N=(g*(360/(t==="hours"?12:60))-90)*(Math.PI/180),v=d+c*Math.cos(N),C=d+c*Math.sin(N);return i.jsx("div",{className:`absolute w-8 h-8 flex items-center justify-center rounded-full text-xs font-black transition-colors z-20 pointer-events-none transform -translate-x-1/2 -translate-y-1/2 ${g===e?"text-white bg-[#F7931E]":"text-gray-500"}`,style:{left:v,top:C},children:g},g)})]})},tv=({value:t,onChange:e,label:n})=>{const[r,s]=x.useState(!1),[a,c]=x.useState(new Date),[l,d]=x.useState(null);x.useEffect(()=>{if(t){const C=new Date(t);isNaN(C.getTime())||(d(C),c(C))}},[t]);const h=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),m=new Date(a.getFullYear(),a.getMonth(),1).getDay(),u=["","","","","","",""],p=["","","","","","","","","","","",""],w=C=>{C.stopPropagation(),c(new Date(a.getFullYear(),a.getMonth()-1,1))},y=C=>{C.stopPropagation(),c(new Date(a.getFullYear(),a.getMonth()+1,1))},g=C=>{const S=new Date(a.getFullYear(),a.getMonth(),C),_=S.getTimezoneOffset(),D=new Date(S.getTime()-_*60*1e3);e(D.toISOString().split("T")[0]),d(S),s(!1)},N=C=>l&&l.getDate()===C&&l.getMonth()===a.getMonth()&&l.getFullYear()===a.getFullYear(),v=C=>{const S=new Date;return S.getDate()===C&&S.getMonth()===a.getMonth()&&S.getFullYear()===a.getFullYear()};return i.jsxs("div",{className:"w-full relative",children:[n&&i.jsx("label",{className:"text-xs text-gray-400 font-bold mb-2 block",children:n}),i.jsx("button",{"data-testid":"date-picker-trigger",onClick:()=>s(!0),className:"w-full bg-[#121212] border border-white/10 rounded-2xl px-5 py-4 flex items-center justify-between shadow-inner hover:border-[#F7931E]/50 transition-all group",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(zs,{className:"text-gray-500 group-hover:text-[#F7931E] transition-colors",size:18}),i.jsx("span",{className:`font-mono text-base font-bold tracking-wider pt-0.5 ${t?"text-white":"text-gray-500"}`,children:t||"YYYY-MM-DD"})]})}),r&&mm.createPortal(i.jsx("div",{className:"fixed inset-0 z-[500000] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:C=>C.stopPropagation(),children:i.jsxs("div",{className:"bg-[#1E1E1E] w-full max-w-[340px] rounded-[2rem] shadow-[0_20px_60px_rgba(0,0,0,0.6)] border border-white/10 overflow-hidden flex flex-col relative animate-in zoom-in-95 duration-200",onClick:C=>C.stopPropagation(),children:[i.jsxs("div",{className:"p-5 bg-[#262626] border-b border-white/5 flex items-center justify-between",children:[i.jsx("button",{onClick:w,className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:i.jsx(cg,{size:18})}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-white font-bold text-lg",children:p[a.getMonth()]}),i.jsx("p",{className:"text-[10px] text-[#F7931E] font-bold",children:a.getFullYear()})]}),i.jsx("button",{onClick:y,className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:i.jsx(_m,{size:18})})]}),i.jsxs("div",{className:"p-5 bg-[#1E1E1E]",children:[i.jsx("div",{className:"grid grid-cols-7 text-center mb-2",children:u.map((C,S)=>i.jsx("span",{className:"text-[10px] font-bold text-gray-500",children:C},S))}),i.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[Array.from({length:m}).map((C,S)=>i.jsx("div",{},`empty-${S}`)),Array.from({length:h}).map((C,S)=>{const _=S+1,D=N(_),O=v(_);return i.jsx("button",{onClick:()=>g(_),className:`
                                    h-9 w-9 rounded-lg flex items-center justify-center text-xs font-bold transition-all relative
                                    ${D?"bg-[#F7931E] text-white shadow-[0_4px_12px_rgba(247,147,30,0.4)] scale-110 z-10":"text-gray-300 hover:bg-white/10 hover:text-white"}
                                    ${O&&!D?"border border-[#F7931E] text-[#F7931E]":""}
                                `,children:_},_)})]})]}),i.jsx("div",{className:"p-4 border-t border-white/5 bg-[#1E1E1E]",children:i.jsx("button",{onClick:()=>s(!1),className:"w-full py-3 bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white rounded-xl text-sm font-bold transition-colors",children:""})})]})}),document.body)]})};function R(t,e,n){function r(l,d){if(l._zod||Object.defineProperty(l,"_zod",{value:{def:d,constr:c,traits:new Set},enumerable:!1}),l._zod.traits.has(t))return;l._zod.traits.add(t),e(l,d);const h=c.prototype,m=Object.keys(h);for(let u=0;u<m.length;u++){const p=m[u];p in l||(l[p]=h[p].bind(l))}}const s=(n==null?void 0:n.Parent)??Object;class a extends s{}Object.defineProperty(a,"name",{value:t});function c(l){var d;const h=n!=null&&n.Parent?new a:this;r(h,l),(d=h._zod).deferred??(d.deferred=[]);for(const m of h._zod.deferred)m();return h}return Object.defineProperty(c,"init",{value:r}),Object.defineProperty(c,Symbol.hasInstance,{value:l=>{var d,h;return n!=null&&n.Parent&&l instanceof n.Parent?!0:(h=(d=l==null?void 0:l._zod)==null?void 0:d.traits)==null?void 0:h.has(t)}}),Object.defineProperty(c,"name",{value:t}),c}class mo extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Wp extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const Up={};function Mi(t){return Up}function qp(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,s])=>e.indexOf(+r)===-1).map(([r,s])=>s)}function Du(t,e){return typeof e=="bigint"?e.toString():e}function ih(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function oh(t){return t==null}function ah(t){const e=t.startsWith("^")?1:0,n=t.endsWith("$")?t.length-1:t.length;return t.slice(e,n)}function nv(t,e){const n=(t.toString().split(".")[1]||"").length,r=e.toString();let s=(r.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(r)){const d=r.match(/\d?e-(\d?)/);d!=null&&d[1]&&(s=Number.parseInt(d[1]))}const a=n>s?n:s,c=Number.parseInt(t.toFixed(a).replace(".","")),l=Number.parseInt(e.toFixed(a).replace(".",""));return c%l/10**a}const _f=Symbol("evaluating");function Le(t,e,n){let r;Object.defineProperty(t,e,{get(){if(r!==_f)return r===void 0&&(r=_f,r=n()),r},set(s){Object.defineProperty(t,e,{value:s})},configurable:!0})}function Ui(t,e,n){Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Hs(...t){const e={};for(const n of t){const r=Object.getOwnPropertyDescriptors(n);Object.assign(e,r)}return Object.defineProperties({},e)}function Of(t){return JSON.stringify(t)}function rv(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const Vp="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function xl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const sv=ih(()=>{var t;if(typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)!=null&&t.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Ga(t){if(xl(t)===!1)return!1;const e=t.constructor;if(e===void 0||typeof e!="function")return!0;const n=e.prototype;return!(xl(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function Qp(t){return Ga(t)?{...t}:Array.isArray(t)?[...t]:t}const iv=new Set(["string","number","symbol"]);function ea(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Js(t,e,n){const r=new t._zod.constr(e??t._zod.def);return(!e||n!=null&&n.parent)&&(r._zod.parent=t),r}function se(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function ov(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const av={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function cv(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const a=Hs(t._zod.def,{get shape(){const c={};for(const l in e){if(!(l in n.shape))throw new Error(`Unrecognized key: "${l}"`);e[l]&&(c[l]=n.shape[l])}return Ui(this,"shape",c),c},checks:[]});return Js(t,a)}function lv(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const a=Hs(t._zod.def,{get shape(){const c={...t._zod.def.shape};for(const l in e){if(!(l in n.shape))throw new Error(`Unrecognized key: "${l}"`);e[l]&&delete c[l]}return Ui(this,"shape",c),c},checks:[]});return Js(t,a)}function dv(t,e){if(!Ga(e))throw new Error("Invalid input to extend: expected a plain object");const n=t._zod.def.checks;if(n&&n.length>0){const a=t._zod.def.shape;for(const c in e)if(Object.getOwnPropertyDescriptor(a,c)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const s=Hs(t._zod.def,{get shape(){const a={...t._zod.def.shape,...e};return Ui(this,"shape",a),a}});return Js(t,s)}function uv(t,e){if(!Ga(e))throw new Error("Invalid input to safeExtend: expected a plain object");const n=Hs(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e};return Ui(this,"shape",r),r}});return Js(t,n)}function hv(t,e){const n=Hs(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e._zod.def.shape};return Ui(this,"shape",r),r},get catchall(){return e._zod.def.catchall},checks:[]});return Js(t,n)}function fv(t,e,n){const s=e._zod.def.checks;if(s&&s.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const c=Hs(e._zod.def,{get shape(){const l=e._zod.def.shape,d={...l};if(n)for(const h in n){if(!(h in l))throw new Error(`Unrecognized key: "${h}"`);n[h]&&(d[h]=t?new t({type:"optional",innerType:l[h]}):l[h])}else for(const h in l)d[h]=t?new t({type:"optional",innerType:l[h]}):l[h];return Ui(this,"shape",d),d},checks:[]});return Js(e,c)}function mv(t,e,n){const r=Hs(e._zod.def,{get shape(){const s=e._zod.def.shape,a={...s};if(n)for(const c in n){if(!(c in a))throw new Error(`Unrecognized key: "${c}"`);n[c]&&(a[c]=new t({type:"nonoptional",innerType:s[c]}))}else for(const c in s)a[c]=new t({type:"nonoptional",innerType:s[c]});return Ui(this,"shape",a),a}});return Js(e,r)}function oo(t,e=0){var n;if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(((n=t.issues[r])==null?void 0:n.continue)!==!0)return!0;return!1}function Hp(t,e){return e.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(t),n})}function Ic(t){return typeof t=="string"?t:t==null?void 0:t.message}function zi(t,e,n){var s,a,c,l,d,h;const r={...t,path:t.path??[]};if(!t.message){const m=Ic((c=(a=(s=t.inst)==null?void 0:s._zod.def)==null?void 0:a.error)==null?void 0:c.call(a,t))??Ic((l=e==null?void 0:e.error)==null?void 0:l.call(e,t))??Ic((d=n.customError)==null?void 0:d.call(n,t))??Ic((h=n.localeError)==null?void 0:h.call(n,t))??"Invalid input";r.message=m}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}function ch(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Ka(...t){const[e,n,r]=t;return typeof e=="string"?{message:e,code:"custom",input:n,inst:r}:{...e}}const Jp=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,Du,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Zp=R("$ZodError",Jp),Gp=R("$ZodError",Jp,{Parent:Error});function pv(t,e=n=>n.message){const n={},r=[];for(const s of t.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:n}}function gv(t,e=n=>n.message){const n={_errors:[]},r=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(c=>r({issues:c}));else if(a.code==="invalid_key")r({issues:a.issues});else if(a.code==="invalid_element")r({issues:a.issues});else if(a.path.length===0)n._errors.push(e(a));else{let c=n,l=0;for(;l<a.path.length;){const d=a.path[l];l===a.path.length-1?(c[d]=c[d]||{_errors:[]},c[d]._errors.push(e(a))):c[d]=c[d]||{_errors:[]},c=c[d],l++}}};return r(t),n}const lh=t=>(e,n,r,s)=>{const a=r?Object.assign(r,{async:!1}):{async:!1},c=e._zod.run({value:n,issues:[]},a);if(c instanceof Promise)throw new mo;if(c.issues.length){const l=new((s==null?void 0:s.Err)??t)(c.issues.map(d=>zi(d,a,Mi())));throw Vp(l,s==null?void 0:s.callee),l}return c.value},dh=t=>async(e,n,r,s)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let c=e._zod.run({value:n,issues:[]},a);if(c instanceof Promise&&(c=await c),c.issues.length){const l=new((s==null?void 0:s.Err)??t)(c.issues.map(d=>zi(d,a,Mi())));throw Vp(l,s==null?void 0:s.callee),l}return c.value},Ql=t=>(e,n,r)=>{const s=r?{...r,async:!1}:{async:!1},a=e._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new mo;return a.issues.length?{success:!1,error:new(t??Zp)(a.issues.map(c=>zi(c,s,Mi())))}:{success:!0,data:a.value}},xv=Ql(Gp),Hl=t=>async(e,n,r)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:n,issues:[]},s);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new t(a.issues.map(c=>zi(c,s,Mi())))}:{success:!0,data:a.value}},yv=Hl(Gp),bv=t=>(e,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return lh(t)(e,n,s)},wv=t=>(e,n,r)=>lh(t)(e,n,r),vv=t=>async(e,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return dh(t)(e,n,s)},Nv=t=>async(e,n,r)=>dh(t)(e,n,r),Sv=t=>(e,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Ql(t)(e,n,s)},kv=t=>(e,n,r)=>Ql(t)(e,n,r),jv=t=>async(e,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Hl(t)(e,n,s)},Ev=t=>async(e,n,r)=>Hl(t)(e,n,r),Cv=/^[cC][^\s-]{8,}$/,_v=/^[0-9a-z]+$/,Ov=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Iv=/^[0-9a-vA-V]{20}$/,Tv=/^[A-Za-z0-9]{27}$/,Av=/^[a-zA-Z0-9_-]{21}$/,Dv=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Pv=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,If=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Rv=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Lv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function $v(){return new RegExp(Lv,"u")}const Mv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,zv=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Bv=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Fv=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Wv=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Kp=/^[A-Za-z0-9_-]*$/,Uv=/^\+[1-9]\d{6,14}$/,Yp="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",qv=new RegExp(`^${Yp}$`);function Xp(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Vv(t){return new RegExp(`^${Xp(t)}$`)}function Qv(t){const e=Xp({precision:t.precision}),n=["Z"];t.local&&n.push(""),t.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${e}(?:${n.join("|")})`;return new RegExp(`^${Yp}T(?:${r})$`)}const Hv=t=>{const e=t?`[\\s\\S]{${(t==null?void 0:t.minimum)??0},${(t==null?void 0:t.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},Jv=/^-?\d+$/,Zv=/^-?\d+(?:\.\d+)?$/,Gv=/^(?:true|false)$/i,Kv=/^[^A-Z]*$/,Yv=/^[^a-z]*$/,wn=R("$ZodCheck",(t,e)=>{var n;t._zod??(t._zod={}),t._zod.def=e,(n=t._zod).onattach??(n.onattach=[])}),e0={number:"number",bigint:"bigint",object:"date"},t0=R("$ZodCheckLessThan",(t,e)=>{wn.init(t,e);const n=e0[typeof e.value];t._zod.onattach.push(r=>{const s=r._zod.bag,a=(e.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<a&&(e.inclusive?s.maximum=e.value:s.exclusiveMaximum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:n,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),n0=R("$ZodCheckGreaterThan",(t,e)=>{wn.init(t,e);const n=e0[typeof e.value];t._zod.onattach.push(r=>{const s=r._zod.bag,a=(e.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>a&&(e.inclusive?s.minimum=e.value:s.exclusiveMinimum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:n,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Xv=R("$ZodCheckMultipleOf",(t,e)=>{wn.init(t,e),t._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=e.value)}),t._zod.check=n=>{if(typeof n.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%e.value===BigInt(0):nv(n.value,e.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:e.value,input:n.value,inst:t,continue:!e.abort})}}),eN=R("$ZodCheckNumberFormat",(t,e)=>{var c;wn.init(t,e),e.format=e.format||"float64";const n=(c=e.format)==null?void 0:c.includes("int"),r=n?"int":"number",[s,a]=av[e.format];t._zod.onattach.push(l=>{const d=l._zod.bag;d.format=e.format,d.minimum=s,d.maximum=a,n&&(d.pattern=Jv)}),t._zod.check=l=>{const d=l.value;if(n){if(!Number.isInteger(d)){l.issues.push({expected:r,format:e.format,code:"invalid_type",continue:!1,input:d,inst:t});return}if(!Number.isSafeInteger(d)){d>0?l.issues.push({input:d,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort}):l.issues.push({input:d,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort});return}}d<s&&l.issues.push({origin:"number",input:d,code:"too_small",minimum:s,inclusive:!0,inst:t,continue:!e.abort}),d>a&&l.issues.push({origin:"number",input:d,code:"too_big",maximum:a,inclusive:!0,inst:t,continue:!e.abort})}}),tN=R("$ZodCheckMaxLength",(t,e)=>{var n;wn.init(t,e),(n=t._zod.def).when??(n.when=r=>{const s=r.value;return!oh(s)&&s.length!==void 0}),t._zod.onattach.push(r=>{const s=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<s&&(r._zod.bag.maximum=e.maximum)}),t._zod.check=r=>{const s=r.value;if(s.length<=e.maximum)return;const c=ch(s);r.issues.push({origin:c,code:"too_big",maximum:e.maximum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),nN=R("$ZodCheckMinLength",(t,e)=>{var n;wn.init(t,e),(n=t._zod.def).when??(n.when=r=>{const s=r.value;return!oh(s)&&s.length!==void 0}),t._zod.onattach.push(r=>{const s=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>s&&(r._zod.bag.minimum=e.minimum)}),t._zod.check=r=>{const s=r.value;if(s.length>=e.minimum)return;const c=ch(s);r.issues.push({origin:c,code:"too_small",minimum:e.minimum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),rN=R("$ZodCheckLengthEquals",(t,e)=>{var n;wn.init(t,e),(n=t._zod.def).when??(n.when=r=>{const s=r.value;return!oh(s)&&s.length!==void 0}),t._zod.onattach.push(r=>{const s=r._zod.bag;s.minimum=e.length,s.maximum=e.length,s.length=e.length}),t._zod.check=r=>{const s=r.value,a=s.length;if(a===e.length)return;const c=ch(s),l=a>e.length;r.issues.push({origin:c,...l?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:t,continue:!e.abort})}}),Jl=R("$ZodCheckStringFormat",(t,e)=>{var n,r;wn.init(t,e),t._zod.onattach.push(s=>{const a=s._zod.bag;a.format=e.format,e.pattern&&(a.patterns??(a.patterns=new Set),a.patterns.add(e.pattern))}),e.pattern?(n=t._zod).check??(n.check=s=>{e.pattern.lastIndex=0,!e.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:e.format,input:s.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(r=t._zod).check??(r.check=()=>{})}),sN=R("$ZodCheckRegex",(t,e)=>{Jl.init(t,e),t._zod.check=n=>{e.pattern.lastIndex=0,!e.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),iN=R("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=Kv),Jl.init(t,e)}),oN=R("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=Yv),Jl.init(t,e)}),aN=R("$ZodCheckIncludes",(t,e)=>{wn.init(t,e);const n=ea(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${n}`:n);e.pattern=r,t._zod.onattach.push(s=>{const a=s._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),t._zod.check=s=>{s.value.includes(e.includes,e.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:s.value,inst:t,continue:!e.abort})}}),cN=R("$ZodCheckStartsWith",(t,e)=>{wn.init(t,e);const n=new RegExp(`^${ea(e.prefix)}.*`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:t,continue:!e.abort})}}),lN=R("$ZodCheckEndsWith",(t,e)=>{wn.init(t,e);const n=new RegExp(`.*${ea(e.suffix)}$`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:t,continue:!e.abort})}}),dN=R("$ZodCheckOverwrite",(t,e)=>{wn.init(t,e),t._zod.check=n=>{n.value=e.tx(n.value)}});class uN{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(c=>c),s=Math.min(...r.map(c=>c.length-c.trimStart().length)),a=r.map(c=>c.slice(s)).map(c=>" ".repeat(this.indent*2)+c);for(const c of a)this.content.push(c)}compile(){const e=Function,n=this==null?void 0:this.args,s=[...((this==null?void 0:this.content)??[""]).map(a=>`  ${a}`)];return new e(...n,s.join(`
`))}}const hN={major:4,minor:3,patch:5},ot=R("$ZodType",(t,e)=>{var s;var n;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=hN;const r=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&r.unshift(t);for(const a of r)for(const c of a._zod.onattach)c(t);if(r.length===0)(n=t._zod).deferred??(n.deferred=[]),(s=t._zod.deferred)==null||s.push(()=>{t._zod.run=t._zod.parse});else{const a=(l,d,h)=>{let m=oo(l),u;for(const p of d){if(p._zod.def.when){if(!p._zod.def.when(l))continue}else if(m)continue;const w=l.issues.length,y=p._zod.check(l);if(y instanceof Promise&&(h==null?void 0:h.async)===!1)throw new mo;if(u||y instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await y,l.issues.length!==w&&(m||(m=oo(l,w)))});else{if(l.issues.length===w)continue;m||(m=oo(l,w))}}return u?u.then(()=>l):l},c=(l,d,h)=>{if(oo(l))return l.aborted=!0,l;const m=a(d,r,h);if(m instanceof Promise){if(h.async===!1)throw new mo;return m.then(u=>t._zod.parse(u,h))}return t._zod.parse(m,h)};t._zod.run=(l,d)=>{if(d.skipChecks)return t._zod.parse(l,d);if(d.direction==="backward"){const m=t._zod.parse({value:l.value,issues:[]},{...d,skipChecks:!0});return m instanceof Promise?m.then(u=>c(u,l,d)):c(m,l,d)}const h=t._zod.parse(l,d);if(h instanceof Promise){if(d.async===!1)throw new mo;return h.then(m=>a(m,r,d))}return a(h,r,d)}}Le(t,"~standard",()=>({validate:a=>{var c;try{const l=xv(t,a);return l.success?{value:l.data}:{issues:(c=l.error)==null?void 0:c.issues}}catch{return yv(t,a).then(d=>{var h;return d.success?{value:d.data}:{issues:(h=d.error)==null?void 0:h.issues}})}},vendor:"zod",version:1}))}),uh=R("$ZodString",(t,e)=>{var n;ot.init(t,e),t._zod.pattern=[...((n=t==null?void 0:t._zod.bag)==null?void 0:n.patterns)??[]].pop()??Hv(t._zod.bag),t._zod.parse=(r,s)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),nt=R("$ZodStringFormat",(t,e)=>{Jl.init(t,e),uh.init(t,e)}),fN=R("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Pv),nt.init(t,e)}),mN=R("$ZodUUID",(t,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=If(r))}else e.pattern??(e.pattern=If());nt.init(t,e)}),pN=R("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Rv),nt.init(t,e)}),gN=R("$ZodURL",(t,e)=>{nt.init(t,e),t._zod.check=n=>{try{const r=n.value.trim(),s=new URL(r);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(s.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:n.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:n.value,inst:t,continue:!e.abort})),e.normalize?n.value=s.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:t,continue:!e.abort})}}}),xN=R("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=$v()),nt.init(t,e)}),yN=R("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Av),nt.init(t,e)}),bN=R("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Cv),nt.init(t,e)}),wN=R("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=_v),nt.init(t,e)}),vN=R("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Ov),nt.init(t,e)}),NN=R("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Iv),nt.init(t,e)}),SN=R("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=Tv),nt.init(t,e)}),kN=R("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=Qv(e)),nt.init(t,e)}),jN=R("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=qv),nt.init(t,e)}),EN=R("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=Vv(e)),nt.init(t,e)}),CN=R("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Dv),nt.init(t,e)}),_N=R("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Mv),nt.init(t,e),t._zod.bag.format="ipv4"}),ON=R("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=zv),nt.init(t,e),t._zod.bag.format="ipv6",t._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:t,continue:!e.abort})}}}),IN=R("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=Bv),nt.init(t,e)}),TN=R("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Fv),nt.init(t,e),t._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[s,a]=r;if(!a)throw new Error;const c=Number(a);if(`${c}`!==a)throw new Error;if(c<0||c>128)throw new Error;new URL(`http://[${s}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:t,continue:!e.abort})}}});function r0(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const AN=R("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Wv),nt.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=n=>{r0(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:t,continue:!e.abort})}});function DN(t){if(!Kp.test(t))return!1;const e=t.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=e.padEnd(Math.ceil(e.length/4)*4,"=");return r0(n)}const PN=R("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Kp),nt.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=n=>{DN(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:t,continue:!e.abort})}}),RN=R("$ZodE164",(t,e)=>{e.pattern??(e.pattern=Uv),nt.init(t,e)});function LN(t,e=null){try{const n=t.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const s=JSON.parse(atob(r));return!("typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&(!("alg"in s)||s.alg!==e))}catch{return!1}}const $N=R("$ZodJWT",(t,e)=>{nt.init(t,e),t._zod.check=n=>{LN(n.value,e.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:t,continue:!e.abort})}}),s0=R("$ZodNumber",(t,e)=>{ot.init(t,e),t._zod.pattern=t._zod.bag.pattern??Zv,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=Number(n.value)}catch{}const s=n.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return n;const a=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:t,...a?{received:a}:{}}),n}}),MN=R("$ZodNumberFormat",(t,e)=>{eN.init(t,e),s0.init(t,e)}),zN=R("$ZodBoolean",(t,e)=>{ot.init(t,e),t._zod.pattern=Gv,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=!!n.value}catch{}const s=n.value;return typeof s=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:t}),n}}),BN=R("$ZodAny",(t,e)=>{ot.init(t,e),t._zod.parse=n=>n}),FN=R("$ZodUnknown",(t,e)=>{ot.init(t,e),t._zod.parse=n=>n}),WN=R("$ZodNever",(t,e)=>{ot.init(t,e),t._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:t}),n)});function Tf(t,e,n){t.issues.length&&e.issues.push(...Hp(n,t.issues)),e.value[n]=t.value}const UN=R("$ZodArray",(t,e)=>{ot.init(t,e),t._zod.parse=(n,r)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:t}),n;n.value=Array(s.length);const a=[];for(let c=0;c<s.length;c++){const l=s[c],d=e.element._zod.run({value:l,issues:[]},r);d instanceof Promise?a.push(d.then(h=>Tf(h,n,c))):Tf(d,n,c)}return a.length?Promise.all(a).then(()=>n):n}});function yl(t,e,n,r,s){if(t.issues.length){if(s&&!(n in r))return;e.issues.push(...Hp(n,t.issues))}t.value===void 0?n in r&&(e.value[n]=void 0):e.value[n]=t.value}function i0(t){var r,s,a,c;const e=Object.keys(t.shape);for(const l of e)if(!((c=(a=(s=(r=t.shape)==null?void 0:r[l])==null?void 0:s._zod)==null?void 0:a.traits)!=null&&c.has("$ZodType")))throw new Error(`Invalid element at key "${l}": expected a Zod schema`);const n=ov(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}}function o0(t,e,n,r,s,a){const c=[],l=s.keySet,d=s.catchall._zod,h=d.def.type,m=d.optout==="optional";for(const u in e){if(l.has(u))continue;if(h==="never"){c.push(u);continue}const p=d.run({value:e[u],issues:[]},r);p instanceof Promise?t.push(p.then(w=>yl(w,n,u,e,m))):yl(p,n,u,e,m)}return c.length&&n.issues.push({code:"unrecognized_keys",keys:c,input:e,inst:a}),t.length?Promise.all(t).then(()=>n):n}const qN=R("$ZodObject",(t,e)=>{ot.init(t,e);const n=Object.getOwnPropertyDescriptor(e,"shape");if(!(n!=null&&n.get)){const l=e.shape;Object.defineProperty(e,"shape",{get:()=>{const d={...l};return Object.defineProperty(e,"shape",{value:d}),d}})}const r=ih(()=>i0(e));Le(t._zod,"propValues",()=>{const l=e.shape,d={};for(const h in l){const m=l[h]._zod;if(m.values){d[h]??(d[h]=new Set);for(const u of m.values)d[h].add(u)}}return d});const s=xl,a=e.catchall;let c;t._zod.parse=(l,d)=>{c??(c=r.value);const h=l.value;if(!s(h))return l.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),l;l.value={};const m=[],u=c.shape;for(const p of c.keys){const w=u[p],y=w._zod.optout==="optional",g=w._zod.run({value:h[p],issues:[]},d);g instanceof Promise?m.push(g.then(N=>yl(N,l,p,h,y))):yl(g,l,p,h,y)}return a?o0(m,h,l,d,r.value,t):m.length?Promise.all(m).then(()=>l):l}}),VN=R("$ZodObjectJIT",(t,e)=>{qN.init(t,e);const n=t._zod.parse,r=ih(()=>i0(e)),s=p=>{var S;const w=new uN(["shape","payload","ctx"]),y=r.value,g=_=>{const D=Of(_);return`shape[${D}]._zod.run({ value: input[${D}], issues: [] }, ctx)`};w.write("const input = payload.value;");const N=Object.create(null);let v=0;for(const _ of y.keys)N[_]=`key_${v++}`;w.write("const newResult = {};");for(const _ of y.keys){const D=N[_],O=Of(_),b=p[_],A=((S=b==null?void 0:b._zod)==null?void 0:S.optout)==="optional";w.write(`const ${D} = ${g(_)};`),A?w.write(`
        if (${D}.issues.length) {
          if (${O} in input) {
            payload.issues = payload.issues.concat(${D}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${O}, ...iss.path] : [${O}]
            })));
          }
        }
        
        if (${D}.value === undefined) {
          if (${O} in input) {
            newResult[${O}] = undefined;
          }
        } else {
          newResult[${O}] = ${D}.value;
        }
        
      `):w.write(`
        if (${D}.issues.length) {
          payload.issues = payload.issues.concat(${D}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${O}, ...iss.path] : [${O}]
          })));
        }
        
        if (${D}.value === undefined) {
          if (${O} in input) {
            newResult[${O}] = undefined;
          }
        } else {
          newResult[${O}] = ${D}.value;
        }
        
      `)}w.write("payload.value = newResult;"),w.write("return payload;");const C=w.compile();return(_,D)=>C(p,_,D)};let a;const c=xl,l=!Up.jitless,h=l&&sv.value,m=e.catchall;let u;t._zod.parse=(p,w)=>{u??(u=r.value);const y=p.value;return c(y)?l&&h&&(w==null?void 0:w.async)===!1&&w.jitless!==!0?(a||(a=s(e.shape)),p=a(p,w),m?o0([],y,p,w,u,t):p):n(p,w):(p.issues.push({expected:"object",code:"invalid_type",input:y,inst:t}),p)}});function Af(t,e,n,r){for(const a of t)if(a.issues.length===0)return e.value=a.value,e;const s=t.filter(a=>!oo(a));return s.length===1?(e.value=s[0].value,s[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:n,errors:t.map(a=>a.issues.map(c=>zi(c,r,Mi())))}),e)}const QN=R("$ZodUnion",(t,e)=>{ot.init(t,e),Le(t._zod,"optin",()=>e.options.some(s=>s._zod.optin==="optional")?"optional":void 0),Le(t._zod,"optout",()=>e.options.some(s=>s._zod.optout==="optional")?"optional":void 0),Le(t._zod,"values",()=>{if(e.options.every(s=>s._zod.values))return new Set(e.options.flatMap(s=>Array.from(s._zod.values)))}),Le(t._zod,"pattern",()=>{if(e.options.every(s=>s._zod.pattern)){const s=e.options.map(a=>a._zod.pattern);return new RegExp(`^(${s.map(a=>ah(a.source)).join("|")})$`)}});const n=e.options.length===1,r=e.options[0]._zod.run;t._zod.parse=(s,a)=>{if(n)return r(s,a);let c=!1;const l=[];for(const d of e.options){const h=d._zod.run({value:s.value,issues:[]},a);if(h instanceof Promise)l.push(h),c=!0;else{if(h.issues.length===0)return h;l.push(h)}}return c?Promise.all(l).then(d=>Af(d,s,t,a)):Af(l,s,t,a)}}),HN=R("$ZodIntersection",(t,e)=>{ot.init(t,e),t._zod.parse=(n,r)=>{const s=n.value,a=e.left._zod.run({value:s,issues:[]},r),c=e.right._zod.run({value:s,issues:[]},r);return a instanceof Promise||c instanceof Promise?Promise.all([a,c]).then(([d,h])=>Df(n,d,h)):Df(n,a,c)}});function Pu(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Ga(t)&&Ga(e)){const n=Object.keys(e),r=Object.keys(t).filter(a=>n.indexOf(a)!==-1),s={...t,...e};for(const a of r){const c=Pu(t[a],e[a]);if(!c.valid)return{valid:!1,mergeErrorPath:[a,...c.mergeErrorPath]};s[a]=c.data}return{valid:!0,data:s}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<t.length;r++){const s=t[r],a=e[r],c=Pu(s,a);if(!c.valid)return{valid:!1,mergeErrorPath:[r,...c.mergeErrorPath]};n.push(c.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Df(t,e,n){const r=new Map;let s;for(const l of e.issues)if(l.code==="unrecognized_keys"){s??(s=l);for(const d of l.keys)r.has(d)||r.set(d,{}),r.get(d).l=!0}else t.issues.push(l);for(const l of n.issues)if(l.code==="unrecognized_keys")for(const d of l.keys)r.has(d)||r.set(d,{}),r.get(d).r=!0;else t.issues.push(l);const a=[...r].filter(([,l])=>l.l&&l.r).map(([l])=>l);if(a.length&&s&&t.issues.push({...s,keys:a}),oo(t))return t;const c=Pu(e.value,n.value);if(!c.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(c.mergeErrorPath)}`);return t.value=c.data,t}const JN=R("$ZodEnum",(t,e)=>{ot.init(t,e);const n=qp(e.entries),r=new Set(n);t._zod.values=r,t._zod.pattern=new RegExp(`^(${n.filter(s=>iv.has(typeof s)).map(s=>typeof s=="string"?ea(s):s.toString()).join("|")})$`),t._zod.parse=(s,a)=>{const c=s.value;return r.has(c)||s.issues.push({code:"invalid_value",values:n,input:c,inst:t}),s}}),ZN=R("$ZodLiteral",(t,e)=>{if(ot.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(e.values);t._zod.values=n,t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?ea(r):r?ea(r.toString()):String(r)).join("|")})$`),t._zod.parse=(r,s)=>{const a=r.value;return n.has(a)||r.issues.push({code:"invalid_value",values:e.values,input:a,inst:t}),r}}),GN=R("$ZodTransform",(t,e)=>{ot.init(t,e),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Wp(t.constructor.name);const s=e.transform(n.value,n);if(r.async)return(s instanceof Promise?s:Promise.resolve(s)).then(c=>(n.value=c,n));if(s instanceof Promise)throw new mo;return n.value=s,n}});function Pf(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}const a0=R("$ZodOptional",(t,e)=>{ot.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Le(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Le(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${ah(n.source)})?$`):void 0}),t._zod.parse=(n,r)=>{if(e.innerType._zod.optin==="optional"){const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>Pf(a,n.value)):Pf(s,n.value)}return n.value===void 0?n:e.innerType._zod.run(n,r)}}),KN=R("$ZodExactOptional",(t,e)=>{a0.init(t,e),Le(t._zod,"values",()=>e.innerType._zod.values),Le(t._zod,"pattern",()=>e.innerType._zod.pattern),t._zod.parse=(n,r)=>e.innerType._zod.run(n,r)}),YN=R("$ZodNullable",(t,e)=>{ot.init(t,e),Le(t._zod,"optin",()=>e.innerType._zod.optin),Le(t._zod,"optout",()=>e.innerType._zod.optout),Le(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${ah(n.source)}|null)$`):void 0}),Le(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(n,r)=>n.value===null?n:e.innerType._zod.run(n,r)}),XN=R("$ZodDefault",(t,e)=>{ot.init(t,e),t._zod.optin="optional",Le(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);if(n.value===void 0)return n.value=e.defaultValue,n;const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>Rf(a,e)):Rf(s,e)}});function Rf(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const e1=R("$ZodPrefault",(t,e)=>{ot.init(t,e),t._zod.optin="optional",Le(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=e.defaultValue),e.innerType._zod.run(n,r))}),t1=R("$ZodNonOptional",(t,e)=>{ot.init(t,e),Le(t._zod,"values",()=>{const n=e.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),t._zod.parse=(n,r)=>{const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>Lf(a,t)):Lf(s,t)}});function Lf(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const n1=R("$ZodCatch",(t,e)=>{ot.init(t,e),Le(t._zod,"optin",()=>e.innerType._zod.optin),Le(t._zod,"optout",()=>e.innerType._zod.optout),Le(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>(n.value=a.value,a.issues.length&&(n.value=e.catchValue({...n,error:{issues:a.issues.map(c=>zi(c,r,Mi()))},input:n.value}),n.issues=[]),n)):(n.value=s.value,s.issues.length&&(n.value=e.catchValue({...n,error:{issues:s.issues.map(a=>zi(a,r,Mi()))},input:n.value}),n.issues=[]),n)}}),r1=R("$ZodPipe",(t,e)=>{ot.init(t,e),Le(t._zod,"values",()=>e.in._zod.values),Le(t._zod,"optin",()=>e.in._zod.optin),Le(t._zod,"optout",()=>e.out._zod.optout),Le(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(n,r)=>{if(r.direction==="backward"){const a=e.out._zod.run(n,r);return a instanceof Promise?a.then(c=>Tc(c,e.in,r)):Tc(a,e.in,r)}const s=e.in._zod.run(n,r);return s instanceof Promise?s.then(a=>Tc(a,e.out,r)):Tc(s,e.out,r)}});function Tc(t,e,n){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},n)}const s1=R("$ZodReadonly",(t,e)=>{ot.init(t,e),Le(t._zod,"propValues",()=>e.innerType._zod.propValues),Le(t._zod,"values",()=>e.innerType._zod.values),Le(t._zod,"optin",()=>{var n,r;return(r=(n=e.innerType)==null?void 0:n._zod)==null?void 0:r.optin}),Le(t._zod,"optout",()=>{var n,r;return(r=(n=e.innerType)==null?void 0:n._zod)==null?void 0:r.optout}),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then($f):$f(s)}});function $f(t){return t.value=Object.freeze(t.value),t}const i1=R("$ZodCustom",(t,e)=>{wn.init(t,e),ot.init(t,e),t._zod.parse=(n,r)=>n,t._zod.check=n=>{const r=n.value,s=e.fn(r);if(s instanceof Promise)return s.then(a=>Mf(a,n,r,t));Mf(s,n,r,t)}});function Mf(t,e,n,r){if(!t){const s={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(s.params=r._zod.def.params),e.issues.push(Ka(s))}}var zf;class o1{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...n){const r=n[0];return this._map.set(e,r),r&&typeof r=="object"&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const n=this._map.get(e);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(e),this}get(e){const n=e._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const s={...r,...this._map.get(e)};return Object.keys(s).length?s:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function a1(){return new o1}(zf=globalThis).__zod_globalRegistry??(zf.__zod_globalRegistry=a1());const ja=globalThis.__zod_globalRegistry;function c1(t,e){return new t({type:"string",...se(e)})}function l1(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...se(e)})}function Bf(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...se(e)})}function d1(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...se(e)})}function u1(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...se(e)})}function h1(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...se(e)})}function f1(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...se(e)})}function m1(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...se(e)})}function p1(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...se(e)})}function g1(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...se(e)})}function x1(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...se(e)})}function y1(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...se(e)})}function b1(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...se(e)})}function w1(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...se(e)})}function v1(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...se(e)})}function N1(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...se(e)})}function S1(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...se(e)})}function k1(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...se(e)})}function j1(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...se(e)})}function E1(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...se(e)})}function C1(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...se(e)})}function _1(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...se(e)})}function O1(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...se(e)})}function I1(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...se(e)})}function T1(t,e){return new t({type:"string",format:"date",check:"string_format",...se(e)})}function A1(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...se(e)})}function D1(t,e){return new t({type:"string",format:"duration",check:"string_format",...se(e)})}function P1(t,e){return new t({type:"number",checks:[],...se(e)})}function R1(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...se(e)})}function L1(t,e){return new t({type:"boolean",...se(e)})}function $1(t){return new t({type:"any"})}function M1(t){return new t({type:"unknown"})}function z1(t,e){return new t({type:"never",...se(e)})}function Ff(t,e){return new t0({check:"less_than",...se(e),value:t,inclusive:!1})}function vd(t,e){return new t0({check:"less_than",...se(e),value:t,inclusive:!0})}function Wf(t,e){return new n0({check:"greater_than",...se(e),value:t,inclusive:!1})}function Nd(t,e){return new n0({check:"greater_than",...se(e),value:t,inclusive:!0})}function Uf(t,e){return new Xv({check:"multiple_of",...se(e),value:t})}function c0(t,e){return new tN({check:"max_length",...se(e),maximum:t})}function bl(t,e){return new nN({check:"min_length",...se(e),minimum:t})}function l0(t,e){return new rN({check:"length_equals",...se(e),length:t})}function B1(t,e){return new sN({check:"string_format",format:"regex",...se(e),pattern:t})}function F1(t){return new iN({check:"string_format",format:"lowercase",...se(t)})}function W1(t){return new oN({check:"string_format",format:"uppercase",...se(t)})}function U1(t,e){return new aN({check:"string_format",format:"includes",...se(e),includes:t})}function q1(t,e){return new cN({check:"string_format",format:"starts_with",...se(e),prefix:t})}function V1(t,e){return new lN({check:"string_format",format:"ends_with",...se(e),suffix:t})}function oa(t){return new dN({check:"overwrite",tx:t})}function Q1(t){return oa(e=>e.normalize(t))}function H1(){return oa(t=>t.trim())}function J1(){return oa(t=>t.toLowerCase())}function Z1(){return oa(t=>t.toUpperCase())}function G1(){return oa(t=>rv(t))}function K1(t,e,n){return new t({type:"array",element:e,...se(n)})}function Y1(t,e,n){return new t({type:"custom",check:"custom",fn:e,...se(n)})}function X1(t){const e=e2(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(Ka(r,n.value,e._zod.def));else{const s=r;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),s.continue??(s.continue=!e._zod.def.abort),n.issues.push(Ka(s))}},t(n.value,n)));return e}function e2(t,e){const n=new wn({check:"custom",...se(e)});return n._zod.check=t,n}function d0(t){let e=(t==null?void 0:t.target)??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:(t==null?void 0:t.metadata)??ja,target:e,unrepresentable:(t==null?void 0:t.unrepresentable)??"throw",override:(t==null?void 0:t.override)??(()=>{}),io:(t==null?void 0:t.io)??"output",counter:0,seen:new Map,cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0}}function Wt(t,e,n={path:[],schemaPath:[]}){var m,u;var r;const s=t._zod.def,a=e.seen.get(t);if(a)return a.count++,n.schemaPath.includes(t)&&(a.cycle=n.path),a.schema;const c={schema:{},count:1,cycle:void 0,path:n.path};e.seen.set(t,c);const l=(u=(m=t._zod).toJSONSchema)==null?void 0:u.call(m);if(l)c.schema=l;else{const p={...n,schemaPath:[...n.schemaPath,t],path:n.path};if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,c.schema,p);else{const y=c.schema,g=e.processors[s.type];if(!g)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${s.type}`);g(t,e,y,p)}const w=t._zod.parent;w&&(c.ref||(c.ref=w),Wt(w,e,p),e.seen.get(w).isParent=!0)}const d=e.metadataRegistry.get(t);return d&&Object.assign(c.schema,d),e.io==="input"&&Kt(t)&&(delete c.schema.examples,delete c.schema.default),e.io==="input"&&c.schema._prefault&&((r=c.schema).default??(r.default=c.schema._prefault)),delete c.schema._prefault,e.seen.get(t).schema}function u0(t,e){var c,l,d,h;const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=new Map;for(const m of t.seen.entries()){const u=(c=t.metadataRegistry.get(m[0]))==null?void 0:c.id;if(u){const p=r.get(u);if(p&&p!==m[0])throw new Error(`Duplicate schema id "${u}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(u,m[0])}}const s=m=>{var g;const u=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){const N=(g=t.external.registry.get(m[0]))==null?void 0:g.id,v=t.external.uri??(S=>S);if(N)return{ref:v(N)};const C=m[1].defId??m[1].schema.id??`schema${t.counter++}`;return m[1].defId=C,{defId:C,ref:`${v("__shared")}#/${u}/${C}`}}if(m[1]===n)return{ref:"#"};const w=`#/${u}/`,y=m[1].schema.id??`__schema${t.counter++}`;return{defId:y,ref:w+y}},a=m=>{if(m[1].schema.$ref)return;const u=m[1],{ref:p,defId:w}=s(m);u.def={...u.schema},w&&(u.defId=w);const y=u.schema;for(const g in y)delete y[g];y.$ref=p};if(t.cycles==="throw")for(const m of t.seen.entries()){const u=m[1];if(u.cycle)throw new Error(`Cycle detected: #/${(l=u.cycle)==null?void 0:l.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const m of t.seen.entries()){const u=m[1];if(e===m[0]){a(m);continue}if(t.external){const w=(d=t.external.registry.get(m[0]))==null?void 0:d.id;if(e!==m[0]&&w){a(m);continue}}if((h=t.metadataRegistry.get(m[0]))==null?void 0:h.id){a(m);continue}if(u.cycle){a(m);continue}if(u.count>1&&t.reused==="ref"){a(m);continue}}}function h0(t,e){var c,l,d;const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=h=>{const m=t.seen.get(h);if(m.ref===null)return;const u=m.def??m.schema,p={...u},w=m.ref;if(m.ref=null,w){r(w);const g=t.seen.get(w),N=g.schema;if(N.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(u.allOf=u.allOf??[],u.allOf.push(N)):Object.assign(u,N),Object.assign(u,p),h._zod.parent===w)for(const C in u)C==="$ref"||C==="allOf"||C in p||delete u[C];if(N.$ref)for(const C in u)C==="$ref"||C==="allOf"||C in g.def&&JSON.stringify(u[C])===JSON.stringify(g.def[C])&&delete u[C]}const y=h._zod.parent;if(y&&y!==w){r(y);const g=t.seen.get(y);if(g!=null&&g.schema.$ref&&(u.$ref=g.schema.$ref,g.def))for(const N in u)N==="$ref"||N==="allOf"||N in g.def&&JSON.stringify(u[N])===JSON.stringify(g.def[N])&&delete u[N]}t.override({zodSchema:h,jsonSchema:u,path:m.path??[]})};for(const h of[...t.seen.entries()].reverse())r(h[0]);const s={};if(t.target==="draft-2020-12"?s.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?s.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?s.$schema="http://json-schema.org/draft-04/schema#":t.target,(c=t.external)!=null&&c.uri){const h=(l=t.external.registry.get(e))==null?void 0:l.id;if(!h)throw new Error("Schema is missing an `id` property");s.$id=t.external.uri(h)}Object.assign(s,n.def??n.schema);const a=((d=t.external)==null?void 0:d.defs)??{};for(const h of t.seen.entries()){const m=h[1];m.def&&m.defId&&(a[m.defId]=m.def)}t.external||Object.keys(a).length>0&&(t.target==="draft-2020-12"?s.$defs=a:s.definitions=a);try{const h=JSON.parse(JSON.stringify(s));return Object.defineProperty(h,"~standard",{value:{...e["~standard"],jsonSchema:{input:wl(e,"input",t.processors),output:wl(e,"output",t.processors)}},enumerable:!1,writable:!1}),h}catch{throw new Error("Error converting schema to JSON.")}}function Kt(t,e){const n=e??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);const r=t._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return Kt(r.element,n);if(r.type==="set")return Kt(r.valueType,n);if(r.type==="lazy")return Kt(r.getter(),n);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return Kt(r.innerType,n);if(r.type==="intersection")return Kt(r.left,n)||Kt(r.right,n);if(r.type==="record"||r.type==="map")return Kt(r.keyType,n)||Kt(r.valueType,n);if(r.type==="pipe")return Kt(r.in,n)||Kt(r.out,n);if(r.type==="object"){for(const s in r.shape)if(Kt(r.shape[s],n))return!0;return!1}if(r.type==="union"){for(const s of r.options)if(Kt(s,n))return!0;return!1}if(r.type==="tuple"){for(const s of r.items)if(Kt(s,n))return!0;return!!(r.rest&&Kt(r.rest,n))}return!1}const t2=(t,e={})=>n=>{const r=d0({...n,processors:e});return Wt(t,r),u0(r,t),h0(r,t)},wl=(t,e,n={})=>r=>{const{libraryOptions:s,target:a}=r??{},c=d0({...s??{},target:a,io:e,processors:n});return Wt(t,c),u0(c,t),h0(c,t)},n2={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},r2=(t,e,n,r)=>{const s=n;s.type="string";const{minimum:a,maximum:c,format:l,patterns:d,contentEncoding:h}=t._zod.bag;if(typeof a=="number"&&(s.minLength=a),typeof c=="number"&&(s.maxLength=c),l&&(s.format=n2[l]??l,s.format===""&&delete s.format,l==="time"&&delete s.format),h&&(s.contentEncoding=h),d&&d.size>0){const m=[...d];m.length===1?s.pattern=m[0].source:m.length>1&&(s.allOf=[...m.map(u=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:u.source}))])}},s2=(t,e,n,r)=>{const s=n,{minimum:a,maximum:c,format:l,multipleOf:d,exclusiveMaximum:h,exclusiveMinimum:m}=t._zod.bag;typeof l=="string"&&l.includes("int")?s.type="integer":s.type="number",typeof m=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(s.minimum=m,s.exclusiveMinimum=!0):s.exclusiveMinimum=m),typeof a=="number"&&(s.minimum=a,typeof m=="number"&&e.target!=="draft-04"&&(m>=a?delete s.minimum:delete s.exclusiveMinimum)),typeof h=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(s.maximum=h,s.exclusiveMaximum=!0):s.exclusiveMaximum=h),typeof c=="number"&&(s.maximum=c,typeof h=="number"&&e.target!=="draft-04"&&(h<=c?delete s.maximum:delete s.exclusiveMaximum)),typeof d=="number"&&(s.multipleOf=d)},i2=(t,e,n,r)=>{n.type="boolean"},o2=(t,e,n,r)=>{n.not={}},a2=(t,e,n,r)=>{},c2=(t,e,n,r)=>{},l2=(t,e,n,r)=>{const s=t._zod.def,a=qp(s.entries);a.every(c=>typeof c=="number")&&(n.type="number"),a.every(c=>typeof c=="string")&&(n.type="string"),n.enum=a},d2=(t,e,n,r)=>{const s=t._zod.def,a=[];for(const c of s.values)if(c===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof c=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");a.push(Number(c))}else a.push(c);if(a.length!==0)if(a.length===1){const c=a[0];n.type=c===null?"null":typeof c,e.target==="draft-04"||e.target==="openapi-3.0"?n.enum=[c]:n.const=c}else a.every(c=>typeof c=="number")&&(n.type="number"),a.every(c=>typeof c=="string")&&(n.type="string"),a.every(c=>typeof c=="boolean")&&(n.type="boolean"),a.every(c=>c===null)&&(n.type="null"),n.enum=a},u2=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},h2=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},f2=(t,e,n,r)=>{const s=n,a=t._zod.def,{minimum:c,maximum:l}=t._zod.bag;typeof c=="number"&&(s.minItems=c),typeof l=="number"&&(s.maxItems=l),s.type="array",s.items=Wt(a.element,e,{...r,path:[...r.path,"items"]})},m2=(t,e,n,r)=>{var h;const s=n,a=t._zod.def;s.type="object",s.properties={};const c=a.shape;for(const m in c)s.properties[m]=Wt(c[m],e,{...r,path:[...r.path,"properties",m]});const l=new Set(Object.keys(c)),d=new Set([...l].filter(m=>{const u=a.shape[m]._zod;return e.io==="input"?u.optin===void 0:u.optout===void 0}));d.size>0&&(s.required=Array.from(d)),((h=a.catchall)==null?void 0:h._zod.def.type)==="never"?s.additionalProperties=!1:a.catchall?a.catchall&&(s.additionalProperties=Wt(a.catchall,e,{...r,path:[...r.path,"additionalProperties"]})):e.io==="output"&&(s.additionalProperties=!1)},p2=(t,e,n,r)=>{const s=t._zod.def,a=s.inclusive===!1,c=s.options.map((l,d)=>Wt(l,e,{...r,path:[...r.path,a?"oneOf":"anyOf",d]}));a?n.oneOf=c:n.anyOf=c},g2=(t,e,n,r)=>{const s=t._zod.def,a=Wt(s.left,e,{...r,path:[...r.path,"allOf",0]}),c=Wt(s.right,e,{...r,path:[...r.path,"allOf",1]}),l=h=>"allOf"in h&&Object.keys(h).length===1,d=[...l(a)?a.allOf:[a],...l(c)?c.allOf:[c]];n.allOf=d},x2=(t,e,n,r)=>{const s=t._zod.def,a=Wt(s.innerType,e,r),c=e.seen.get(t);e.target==="openapi-3.0"?(c.ref=s.innerType,n.nullable=!0):n.anyOf=[a,{type:"null"}]},y2=(t,e,n,r)=>{const s=t._zod.def;Wt(s.innerType,e,r);const a=e.seen.get(t);a.ref=s.innerType},b2=(t,e,n,r)=>{const s=t._zod.def;Wt(s.innerType,e,r);const a=e.seen.get(t);a.ref=s.innerType,n.default=JSON.parse(JSON.stringify(s.defaultValue))},w2=(t,e,n,r)=>{const s=t._zod.def;Wt(s.innerType,e,r);const a=e.seen.get(t);a.ref=s.innerType,e.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(s.defaultValue)))},v2=(t,e,n,r)=>{const s=t._zod.def;Wt(s.innerType,e,r);const a=e.seen.get(t);a.ref=s.innerType;let c;try{c=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=c},N2=(t,e,n,r)=>{const s=t._zod.def,a=e.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;Wt(a,e,r);const c=e.seen.get(t);c.ref=a},S2=(t,e,n,r)=>{const s=t._zod.def;Wt(s.innerType,e,r);const a=e.seen.get(t);a.ref=s.innerType,n.readOnly=!0},f0=(t,e,n,r)=>{const s=t._zod.def;Wt(s.innerType,e,r);const a=e.seen.get(t);a.ref=s.innerType},k2=R("ZodISODateTime",(t,e)=>{kN.init(t,e),ct.init(t,e)});function j2(t){return I1(k2,t)}const E2=R("ZodISODate",(t,e)=>{jN.init(t,e),ct.init(t,e)});function C2(t){return T1(E2,t)}const _2=R("ZodISOTime",(t,e)=>{EN.init(t,e),ct.init(t,e)});function O2(t){return A1(_2,t)}const I2=R("ZodISODuration",(t,e)=>{CN.init(t,e),ct.init(t,e)});function T2(t){return D1(I2,t)}const A2=(t,e)=>{Zp.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:n=>gv(t,n)},flatten:{value:n=>pv(t,n)},addIssue:{value:n=>{t.issues.push(n),t.message=JSON.stringify(t.issues,Du,2)}},addIssues:{value:n=>{t.issues.push(...n),t.message=JSON.stringify(t.issues,Du,2)}},isEmpty:{get(){return t.issues.length===0}}})},Jn=R("ZodError",A2,{Parent:Error}),D2=lh(Jn),P2=dh(Jn),R2=Ql(Jn),L2=Hl(Jn),$2=bv(Jn),M2=wv(Jn),z2=vv(Jn),B2=Nv(Jn),F2=Sv(Jn),W2=kv(Jn),U2=jv(Jn),q2=Ev(Jn),at=R("ZodType",(t,e)=>(ot.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:wl(t,"input"),output:wl(t,"output")}}),t.toJSONSchema=t2(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...n)=>t.clone(Hs(e,{checks:[...e.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),{parent:!0}),t.with=t.check,t.clone=(n,r)=>Js(t,n,r),t.brand=()=>t,t.register=((n,r)=>(n.add(t,r),t)),t.parse=(n,r)=>D2(t,n,r,{callee:t.parse}),t.safeParse=(n,r)=>R2(t,n,r),t.parseAsync=async(n,r)=>P2(t,n,r,{callee:t.parseAsync}),t.safeParseAsync=async(n,r)=>L2(t,n,r),t.spa=t.safeParseAsync,t.encode=(n,r)=>$2(t,n,r),t.decode=(n,r)=>M2(t,n,r),t.encodeAsync=async(n,r)=>z2(t,n,r),t.decodeAsync=async(n,r)=>B2(t,n,r),t.safeEncode=(n,r)=>F2(t,n,r),t.safeDecode=(n,r)=>W2(t,n,r),t.safeEncodeAsync=async(n,r)=>U2(t,n,r),t.safeDecodeAsync=async(n,r)=>q2(t,n,r),t.refine=(n,r)=>t.check(WS(n,r)),t.superRefine=n=>t.check(US(n)),t.overwrite=n=>t.check(oa(n)),t.optional=()=>Hf(t),t.exactOptional=()=>OS(t),t.nullable=()=>Jf(t),t.nullish=()=>Hf(Jf(t)),t.nonoptional=n=>RS(t,n),t.array=()=>yS(t),t.or=n=>vS([t,n]),t.and=n=>SS(t,n),t.transform=n=>Zf(t,CS(n)),t.default=n=>AS(t,n),t.prefault=n=>PS(t,n),t.catch=n=>$S(t,n),t.pipe=n=>Zf(t,n),t.readonly=()=>BS(t),t.describe=n=>{const r=t.clone();return ja.add(r,{description:n}),r},Object.defineProperty(t,"description",{get(){var n;return(n=ja.get(t))==null?void 0:n.description},configurable:!0}),t.meta=(...n)=>{if(n.length===0)return ja.get(t);const r=t.clone();return ja.add(r,n[0]),r},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t.apply=n=>n(t),t)),m0=R("_ZodString",(t,e)=>{uh.init(t,e),at.init(t,e),t._zod.processJSONSchema=(r,s,a)=>r2(t,r,s);const n=t._zod.bag;t.format=n.format??null,t.minLength=n.minimum??null,t.maxLength=n.maximum??null,t.regex=(...r)=>t.check(B1(...r)),t.includes=(...r)=>t.check(U1(...r)),t.startsWith=(...r)=>t.check(q1(...r)),t.endsWith=(...r)=>t.check(V1(...r)),t.min=(...r)=>t.check(bl(...r)),t.max=(...r)=>t.check(c0(...r)),t.length=(...r)=>t.check(l0(...r)),t.nonempty=(...r)=>t.check(bl(1,...r)),t.lowercase=r=>t.check(F1(r)),t.uppercase=r=>t.check(W1(r)),t.trim=()=>t.check(H1()),t.normalize=(...r)=>t.check(Q1(...r)),t.toLowerCase=()=>t.check(J1()),t.toUpperCase=()=>t.check(Z1()),t.slugify=()=>t.check(G1())}),V2=R("ZodString",(t,e)=>{uh.init(t,e),m0.init(t,e),t.email=n=>t.check(l1(Q2,n)),t.url=n=>t.check(m1(H2,n)),t.jwt=n=>t.check(O1(cS,n)),t.emoji=n=>t.check(p1(J2,n)),t.guid=n=>t.check(Bf(qf,n)),t.uuid=n=>t.check(d1(Ac,n)),t.uuidv4=n=>t.check(u1(Ac,n)),t.uuidv6=n=>t.check(h1(Ac,n)),t.uuidv7=n=>t.check(f1(Ac,n)),t.nanoid=n=>t.check(g1(Z2,n)),t.guid=n=>t.check(Bf(qf,n)),t.cuid=n=>t.check(x1(G2,n)),t.cuid2=n=>t.check(y1(K2,n)),t.ulid=n=>t.check(b1(Y2,n)),t.base64=n=>t.check(E1(iS,n)),t.base64url=n=>t.check(C1(oS,n)),t.xid=n=>t.check(w1(X2,n)),t.ksuid=n=>t.check(v1(eS,n)),t.ipv4=n=>t.check(N1(tS,n)),t.ipv6=n=>t.check(S1(nS,n)),t.cidrv4=n=>t.check(k1(rS,n)),t.cidrv6=n=>t.check(j1(sS,n)),t.e164=n=>t.check(_1(aS,n)),t.datetime=n=>t.check(j2(n)),t.date=n=>t.check(C2(n)),t.time=n=>t.check(O2(n)),t.duration=n=>t.check(T2(n))});function Ie(t){return c1(V2,t)}const ct=R("ZodStringFormat",(t,e)=>{nt.init(t,e),m0.init(t,e)}),Q2=R("ZodEmail",(t,e)=>{pN.init(t,e),ct.init(t,e)}),qf=R("ZodGUID",(t,e)=>{fN.init(t,e),ct.init(t,e)}),Ac=R("ZodUUID",(t,e)=>{mN.init(t,e),ct.init(t,e)}),H2=R("ZodURL",(t,e)=>{gN.init(t,e),ct.init(t,e)}),J2=R("ZodEmoji",(t,e)=>{xN.init(t,e),ct.init(t,e)}),Z2=R("ZodNanoID",(t,e)=>{yN.init(t,e),ct.init(t,e)}),G2=R("ZodCUID",(t,e)=>{bN.init(t,e),ct.init(t,e)}),K2=R("ZodCUID2",(t,e)=>{wN.init(t,e),ct.init(t,e)}),Y2=R("ZodULID",(t,e)=>{vN.init(t,e),ct.init(t,e)}),X2=R("ZodXID",(t,e)=>{NN.init(t,e),ct.init(t,e)}),eS=R("ZodKSUID",(t,e)=>{SN.init(t,e),ct.init(t,e)}),tS=R("ZodIPv4",(t,e)=>{_N.init(t,e),ct.init(t,e)}),nS=R("ZodIPv6",(t,e)=>{ON.init(t,e),ct.init(t,e)}),rS=R("ZodCIDRv4",(t,e)=>{IN.init(t,e),ct.init(t,e)}),sS=R("ZodCIDRv6",(t,e)=>{TN.init(t,e),ct.init(t,e)}),iS=R("ZodBase64",(t,e)=>{AN.init(t,e),ct.init(t,e)}),oS=R("ZodBase64URL",(t,e)=>{PN.init(t,e),ct.init(t,e)}),aS=R("ZodE164",(t,e)=>{RN.init(t,e),ct.init(t,e)}),cS=R("ZodJWT",(t,e)=>{$N.init(t,e),ct.init(t,e)}),p0=R("ZodNumber",(t,e)=>{s0.init(t,e),at.init(t,e),t._zod.processJSONSchema=(r,s,a)=>s2(t,r,s),t.gt=(r,s)=>t.check(Wf(r,s)),t.gte=(r,s)=>t.check(Nd(r,s)),t.min=(r,s)=>t.check(Nd(r,s)),t.lt=(r,s)=>t.check(Ff(r,s)),t.lte=(r,s)=>t.check(vd(r,s)),t.max=(r,s)=>t.check(vd(r,s)),t.int=r=>t.check(Vf(r)),t.safe=r=>t.check(Vf(r)),t.positive=r=>t.check(Wf(0,r)),t.nonnegative=r=>t.check(Nd(0,r)),t.negative=r=>t.check(Ff(0,r)),t.nonpositive=r=>t.check(vd(0,r)),t.multipleOf=(r,s)=>t.check(Uf(r,s)),t.step=(r,s)=>t.check(Uf(r,s)),t.finite=()=>t;const n=t._zod.bag;t.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),t.isFinite=!0,t.format=n.format??null});function Ru(t){return P1(p0,t)}const lS=R("ZodNumberFormat",(t,e)=>{MN.init(t,e),p0.init(t,e)});function Vf(t){return R1(lS,t)}const dS=R("ZodBoolean",(t,e)=>{zN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>i2(t,n,r)});function uS(t){return L1(dS,t)}const hS=R("ZodAny",(t,e)=>{BN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>a2()});function fS(){return $1(hS)}const mS=R("ZodUnknown",(t,e)=>{FN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>c2()});function Qf(){return M1(mS)}const pS=R("ZodNever",(t,e)=>{WN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>o2(t,n,r)});function gS(t){return z1(pS,t)}const xS=R("ZodArray",(t,e)=>{UN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>f2(t,n,r,s),t.element=e.element,t.min=(n,r)=>t.check(bl(n,r)),t.nonempty=n=>t.check(bl(1,n)),t.max=(n,r)=>t.check(c0(n,r)),t.length=(n,r)=>t.check(l0(n,r)),t.unwrap=()=>t.element});function yS(t,e){return K1(xS,t,e)}const bS=R("ZodObject",(t,e)=>{VN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>m2(t,n,r,s),Le(t,"shape",()=>e.shape),t.keyof=()=>g0(Object.keys(t._zod.def.shape)),t.catchall=n=>t.clone({...t._zod.def,catchall:n}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Qf()}),t.loose=()=>t.clone({...t._zod.def,catchall:Qf()}),t.strict=()=>t.clone({...t._zod.def,catchall:gS()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=n=>dv(t,n),t.safeExtend=n=>uv(t,n),t.merge=n=>hv(t,n),t.pick=n=>cv(t,n),t.omit=n=>lv(t,n),t.partial=(...n)=>fv(x0,t,n[0]),t.required=(...n)=>mv(y0,t,n[0])});function Zl(t,e){const n={type:"object",shape:t??{},...se(e)};return new bS(n)}const wS=R("ZodUnion",(t,e)=>{QN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>p2(t,n,r,s),t.options=e.options});function vS(t,e){return new wS({type:"union",options:t,...se(e)})}const NS=R("ZodIntersection",(t,e)=>{HN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>g2(t,n,r,s)});function SS(t,e){return new NS({type:"intersection",left:t,right:e})}const Lu=R("ZodEnum",(t,e)=>{JN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(r,s,a)=>l2(t,r,s),t.enum=e.entries,t.options=Object.values(e.entries);const n=new Set(Object.keys(e.entries));t.extract=(r,s)=>{const a={};for(const c of r)if(n.has(c))a[c]=e.entries[c];else throw new Error(`Key ${c} not found in enum`);return new Lu({...e,checks:[],...se(s),entries:a})},t.exclude=(r,s)=>{const a={...e.entries};for(const c of r)if(n.has(c))delete a[c];else throw new Error(`Key ${c} not found in enum`);return new Lu({...e,checks:[],...se(s),entries:a})}});function g0(t,e){const n=Array.isArray(t)?Object.fromEntries(t.map(r=>[r,r])):t;return new Lu({type:"enum",entries:n,...se(e)})}const kS=R("ZodLiteral",(t,e)=>{ZN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>d2(t,n,r),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function jS(t,e){return new kS({type:"literal",values:Array.isArray(t)?t:[t],...se(e)})}const ES=R("ZodTransform",(t,e)=>{GN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>h2(t,n),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Wp(t.constructor.name);n.addIssue=a=>{if(typeof a=="string")n.issues.push(Ka(a,n.value,e));else{const c=a;c.fatal&&(c.continue=!1),c.code??(c.code="custom"),c.input??(c.input=n.value),c.inst??(c.inst=t),n.issues.push(Ka(c))}};const s=e.transform(n.value,n);return s instanceof Promise?s.then(a=>(n.value=a,n)):(n.value=s,n)}});function CS(t){return new ES({type:"transform",transform:t})}const x0=R("ZodOptional",(t,e)=>{a0.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>f0(t,n,r,s),t.unwrap=()=>t._zod.def.innerType});function Hf(t){return new x0({type:"optional",innerType:t})}const _S=R("ZodExactOptional",(t,e)=>{KN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>f0(t,n,r,s),t.unwrap=()=>t._zod.def.innerType});function OS(t){return new _S({type:"optional",innerType:t})}const IS=R("ZodNullable",(t,e)=>{YN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>x2(t,n,r,s),t.unwrap=()=>t._zod.def.innerType});function Jf(t){return new IS({type:"nullable",innerType:t})}const TS=R("ZodDefault",(t,e)=>{XN.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>b2(t,n,r,s),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function AS(t,e){return new TS({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():Qp(e)}})}const DS=R("ZodPrefault",(t,e)=>{e1.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>w2(t,n,r,s),t.unwrap=()=>t._zod.def.innerType});function PS(t,e){return new DS({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():Qp(e)}})}const y0=R("ZodNonOptional",(t,e)=>{t1.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>y2(t,n,r,s),t.unwrap=()=>t._zod.def.innerType});function RS(t,e){return new y0({type:"nonoptional",innerType:t,...se(e)})}const LS=R("ZodCatch",(t,e)=>{n1.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>v2(t,n,r,s),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function $S(t,e){return new LS({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const MS=R("ZodPipe",(t,e)=>{r1.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>N2(t,n,r,s),t.in=e.in,t.out=e.out});function Zf(t,e){return new MS({type:"pipe",in:t,out:e})}const zS=R("ZodReadonly",(t,e)=>{s1.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>S2(t,n,r,s),t.unwrap=()=>t._zod.def.innerType});function BS(t){return new zS({type:"readonly",innerType:t})}const FS=R("ZodCustom",(t,e)=>{i1.init(t,e),at.init(t,e),t._zod.processJSONSchema=(n,r,s)=>u2(t,n)});function WS(t,e={}){return Y1(FS,t,e)}function US(t){return X1(t)}const Or=t=>t.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gim,"").replace(/on\w+="[^"]*"/gim,"").replace(/javascript:[^"]*/gim,"");Ie().transform(Or);Zl({id:Ie(),name:Ie().min(1,"Name is required").transform(Or),role:Ie(),avatar:Ie().optional(),email:Ie().email().optional().or(jS("")),password:Ie().optional(),jobTitle:Ie().optional(),preferences:fS().optional()});const qS=Zl({id:Ie(),clientId:Ie().optional(),clientName:Ie().min(2,"Client name is required").transform(Or),clientPhone:Ie().optional().transform(t=>t&&Or(t)),category:Ie(),title:Ie().min(3,"Title is too short").transform(Or),shootDate:Ie().optional(),status:Ie(),totalAmount:Ru().nonnegative("Total amount cannot be negative"),paidAmount:Ru().nonnegative("Paid amount cannot be negative"),location:Ie().optional().transform(t=>t&&Or(t)),servicePackage:Ie().optional(),notes:Ie().optional().transform(t=>t&&Or(t)),createdBy:Ie().optional(),updatedBy:Ie().optional(),updatedAt:Ie().optional()}).refine(t=>t.paidAmount<=t.totalAmount,{message:"Paid amount cannot exceed total amount",path:["paidAmount"]});Zl({id:Ie(),bookingId:Ie(),amount:Ru().positive("Payment amount must be greater than zero"),date:Ie(),method:g0(["Cash","ZinCash"]),collectedBy:Ie().min(2).transform(Or),notes:Ie().optional().transform(t=>t&&Or(t))});const VS=Zl({id:Ie(),bookingId:Ie().optional(),title:Ie().min(3).transform(Or),dueDate:Ie(),completed:uS().default(!1),type:Ie()});class QS{async getReminders(e){return await ge.selectFrom("reminders").selectAll().where("bookingId","=",e).where("deletedAt","is",null).execute()}async addReminder(e){const n=VS.parse({...e,id:e.id||`r_${Date.now()}`}),r={...n,completed:n.completed===!0?1:0,deletedAt:null};return await ge.insertInto("reminders").values(r).execute(),n}async toggleReminder(e){const n=await ge.selectFrom("reminders").select("completed").where("id","=",e).executeTakeFirst();if(n){const r=n.completed?0:1;await ge.updateTable("reminders").set({completed:r}).where("id","=",e).execute()}}async deleteReminder(e){const n=Date.now();await ge.updateTable("reminders").set({deletedAt:n}).where("id","=",e).execute()}async updateReminder(e,n){if(Object.keys(n).length===0)return;const r={...n};typeof r.completed=="boolean"&&(r.completed=r.completed?1:0),await ge.updateTable("reminders").set(r).where("id","=",e).execute()}}class b0{async checkAvailability(e,n,r,s){var h,m,u,p,w,y,g;const a=this.timeToMinutes(n),c=this.timeToMinutes(r);if(a>=c)return{available:!1,hasConflict:!1,conflictMessage:"  "};const d=(await this.getBookings()).filter(N=>N.shootDate===e&&N.id!==s);for(const N of d){const v=this.timeToMinutes((h=N.details)==null?void 0:h.startTime),C=this.timeToMinutes((m=N.details)==null?void 0:m.endTime);if(v===null||C===null)continue;if(a<C&&c>v){const _=((u=N.details)==null?void 0:u.rentalType)==="Full";return{available:!0,hasConflict:!0,conflictType:_?"full":"partial",conflictingBooking:{title:N.title||N.clientName,startTime:((p=N.details)==null?void 0:p.startTime)||"",endTime:((w=N.details)==null?void 0:w.endTime)||""},conflictMessage:_?"   ":` : ${N.title||N.clientName} (${(y=N.details)==null?void 0:y.startTime} - ${(g=N.details)==null?void 0:g.endTime})`}}}return{available:!0,hasConflict:!1}}async getPendingApprovals(){return(await this.getBookings()).filter(n=>n.approvalStatus==="pending")}async approveBooking(e,n,r){const s={status:"Confirmed",approvalStatus:"approved",approvedBy:n,approvedByRole:r,approvedAt:new Date().toISOString()};await this.updateBooking(e,s),await qn.logAction("approve","booking",e,`${r} ${n}   `,{id:"system",name:n})}async rejectBooking(e,n,r){const s={status:"Archived",approvalStatus:"rejected",rejectedBy:n,rejectedByRole:r,rejectedAt:new Date().toISOString()};await this.updateBooking(e,s),await qn.logAction("reject","booking",e,`${r} ${n}  `,{id:"system",name:n})}timeToMinutes(e){if(!e||typeof e!="string")return null;const n=e.split(":");if(n.length!==2)return null;const r=parseInt(n[0],10),s=parseInt(n[1],10);return isNaN(r)||isNaN(s)?null:r*60+s}async getBookings(e){const n=await this.fetchLocalBookings(e);if(navigator.onLine)try{console.log(" Cloud Mode: Fetching from Supabase...");const{data:s,error:a}=await H.from("bookings").select("*").is("deleted_at",null);if(a)throw a;if(s){console.log(` Supabase Returned ${s.length} bookings. Syncing to Local...`),await this.syncLocalDatabase(s);const c=new Set(s.map(d=>d.id)),l=n.filter(d=>!c.has(d.id));return[...s.map(this.mapBookingData),...l.map(this.mapBookingData)]}}catch(s){console.error(" Cloud Fetch Failed, using local data:",s)}else console.log(" Offline Mode: Using Local DB...");return n.map(this.mapBookingData)}async fetchLocalBookings(e){try{const n=window.electronAPI;return n&&n.db?await n.db.query("SELECT * FROM bookings WHERE deletedAt IS NULL"):await pn.getAll(e)}catch(n){return console.error("Local DB Logic Failed:",n),[]}}async syncLocalDatabase(e){const n=window.electronAPI;if(!(!n||!n.db))try{const r=await n.db.query("SELECT id FROM bookings"),s=new Set(e.map(a=>a.id));for(const a of r)s.has(a.id)||await n.db.query("DELETE FROM bookings WHERE id = ?",[a.id]);for(const a of e){const c=typeof a.details=="string"?a.details:JSON.stringify(a.details||{}),l=typeof a.status_history=="string"?a.status_history:JSON.stringify(a.status_history||[]),d=await n.db.query("SELECT 1 FROM bookings WHERE id = ?",[a.id]);d&&d.length>0?await n.db.query(`
                    UPDATE bookings SET 
                    clientName=?, shootDate=?, title=?, status=?, totalAmount=?, paidAmount=?, 
                    details=?, statusHistory=?, servicePackage=?, category=?
                    WHERE id=?
                 `,[a.client_name||"Unknown",a.shoot_date,a.title||"Untitled",a.status||"pending",a.total_amount||0,a.paid_amount||0,c,l,a.service_package,a.category||"Wedding",a.id]):await n.db.query(`
                    INSERT INTO bookings (id, clientName, shootDate, title, status, totalAmount, paidAmount, details, statusHistory, servicePackage, category)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                 `,[a.id,a.client_name||"Unknown",a.shoot_date,a.title||"Untitled",a.status||"pending",a.total_amount||0,a.paid_amount||0,c,l,a.service_package,a.category||"Wedding"])}}catch(r){console.error("Sync Down Failed:",r)}}mapBookingData(e){const n=r=>{if(r){if(typeof r=="object")return r;try{return JSON.parse(r)}catch{return}}};return{id:String(e.id||e._id||e.ID),clientName:e.clientName||e.client_name||e.clientname||"Unknown",shootDate:(e.shootDate||e.shoot_date||e.date||e.shootdate||"").trim(),title:e.title||e.event_title||e.eventTitle||e.title,status:e.status||"PENDING",totalAmount:Number(e.totalAmount||e.total_amount||0),paidAmount:Number(e.paidAmount||e.paid_amount||0),currency:e.currency||"IQD",servicePackage:e.servicePackage||e.service_package||"",location:e.location||"",clientId:e.clientId||e.client_id||"",clientPhone:e.clientPhone||e.client_phone||"",category:e.category||"Wedding",details:n(e.details||e.json_details)||{},statusHistory:n(e.statusHistory||e.status_history||e.json_statusHistory)||[],actualSelectionDate:e.actualSelectionDate||e.actual_selection_date,deliveryDeadline:e.deliveryDeadline||e.delivery_deadline,photoEditCompletedAt:e.photoEditCompletedAt||e.photo_edit_completed_at,videoEditCompletedAt:e.videoEditCompletedAt||e.video_edit_completed_at,printCompletedAt:e.printCompletedAt||e.print_completed_at,client_token:e.client_token||e.clientToken}}async addBooking(e){console.log(" Adding new booking:",e);const n=qS.parse({...e,id:e.id||crypto.randomUUID(),paidAmount:e.paidAmount||0,totalAmount:e.totalAmount||0}),r=e.client_token||`vh-${crypto.randomUUID().slice(0,12)}`,{CurrentUserService:s}=await fe(async()=>{const{CurrentUserService:d}=await import("./CurrentUserService-BpRsn01f.js");return{CurrentUserService:d}},[],import.meta.url),a=s.getCurrentUser(),c=(a==null?void 0:a.name)||"Unknown";a!=null&&a.roleLabel,s.getFullName();const l={id:n.id,client_name:n.clientName,client_id:e.clientId||"",phone:n.clientPhone||e.clientPhone||"",shoot_date:n.shootDate,category:e.category||n.category||"Wedding",location:e.location||n.location||"",package_type:n.servicePackage||e.servicePackage||e.category||"Wedding",service_package:n.servicePackage||e.servicePackage||"",title:n.title,status:n.status||"pending",total_amount:n.totalAmount,paid_amount:n.paidAmount,currency:e.currency||"IQD",details:JSON.stringify(e.details||{}),status_history:JSON.stringify([]),notes:e.notes||"",source:"offline",nas_status:"none",nas_progress:0,created_by:(a==null?void 0:a.id)||"local",updated_by:(a==null?void 0:a.id)||"local",created_by_name:c,updated_by_name:c,client_token:r};await pn.create({id:n.id,location:n.location||"",clientId:n.clientId||e.clientId||"",clientName:n.clientName,clientPhone:n.clientPhone||e.clientPhone||"",category:n.category,title:n.title,shootDate:n.shootDate,status:n.status||"pending",totalAmount:n.totalAmount,paidAmount:n.paidAmount,currency:e.currency||"IQD",servicePackage:n.servicePackage,details:e.details||{},nasStatus:"none",nasProgress:0,notes:e.notes||"",statusHistory:[],created_by:(a==null?void 0:a.id)||"local",updated_by:(a==null?void 0:a.id)||"local",updated_at:new Date().toISOString(),client_token:r});try{const d={...n,currency:e.currency||"IQD",clientId:n.clientId||e.clientId||"",clientPhone:n.clientPhone||e.clientPhone||"",category:n.category||e.category||"Wedding",location:n.location||e.location||"",statusHistory:e.statusHistory||[],details:e.details||{},nasStatus:"none",nasProgress:0,notes:n.notes||"",created_by:(a==null?void 0:a.id)||"local",createdBy:(a==null?void 0:a.id)||"local",updatedAt:new Date().toISOString(),client_token:r};await pn.create(d),console.log(" Booking persisted locally via Repository")}catch(d){console.error(" Failed to persist booking locally:",d)}if(navigator.onLine)try{console.log(" Attempting to insert into Supabase...");const{data:d,error:h}=await H.from("bookings").insert(l).select();if(h)throw h;console.log(" Booking synced to Cloud successfully!")}catch(d){console.error(" Cloud Sync Failed (Add), adding to SQL queue...",JSON.stringify(d,null,2)),await yt.enqueue("create","booking",l)}else console.log(" Offline mode - adding to SQL queue"),await yt.enqueue("create","booking",l);return await qn.logAction("create","booking",n.id,`Created booking for ${n.clientName}`,{id:(a==null?void 0:a.id)||"unknown",name:c}),{...n,nasStatus:"none",nasProgress:0}}async updateBooking(e,n){const{CurrentUserService:r}=await fe(async()=>{const{CurrentUserService:p}=await import("./CurrentUserService-BpRsn01f.js");return{CurrentUserService:p}},[],import.meta.url),s=r.getCurrentUser();if(!s)throw new Error(" :   ");const a=await this.getBookings().then(p=>p.find(w=>w.id===e));if(!a)throw new Error("  ");const c=a.created_by===s.id,l=s.role==="manager"||s.role==="admin";if(!c&&!l)throw new Error(" :      ");const d=r.getFullName(),h=(s==null?void 0:s.roleLabel)||" ",m={...n,modifiedBy:d,modifiedByRole:h};n.details&&(m.details=JSON.stringify(n.details)),n.statusHistory&&(m.statusHistory=JSON.stringify(n.statusHistory)),await pn.update(e,m);const u={modifiedBy:d,modifiedByRole:h};if(n.clientName&&(u.client_name=n.clientName),n.shootDate&&(u.shoot_date=n.shootDate),n.status&&(u.status=n.status),n.details&&(u.details=JSON.stringify(n.details)),n.statusHistory&&(u.status_history=JSON.stringify(n.statusHistory)),Object.keys(u).length>0)if(navigator.onLine){const{error:p}=await H.from("bookings").update(u).eq("id",e);p&&await yt.enqueue("update","booking",{id:e,...u})}else await yt.enqueue("update","booking",{id:e,...u})}async updateBookingStatus(e,n){const r=await this.getBookings().then(h=>h.find(m=>m.id===e));if(!r)throw new Error("Booking not found");const s=r.statusHistory||[],a={status:n,timestamp:new Date().toISOString(),notes:`   : ${n}`},c=[...s,a],l={status:n,statusHistory:c};if(n==="Editing"||n==="q_editing"){const h=new Date;l.actualSelectionDate=h.toISOString();const m=new Date(h);m.setDate(m.getDate()+60),l.deliveryDeadline=m.toISOString(),console.log(` Deadline Set: Selection finished at ${l.actualSelectionDate}, Deadline is ${l.deliveryDeadline}`)}n==="Ready to Print"&&(l.photoEditCompletedAt=new Date().toISOString()),n==="Montage Completed"&&(l.videoEditCompletedAt=new Date().toISOString()),n==="Delivered"&&(l.printCompletedAt=new Date().toISOString()),await this.updateBooking(e,l);const d=JSON.parse(localStorage.getItem("user")||"{}");await qn.logAction("update","booking",e,`Updated status to ${n}`,{id:d.id,name:d.name||"System"}),n==="Delivered"&&this.dispatchNasCleanupNotification(e,r.clientName||r.title||e)}dispatchNasCleanupNotification(e,n){try{const r={id:`nas-cleanup-${e}-${Date.now()}`,title:":    ",message:`   "${n}"        NAS `,time:new Date().toISOString(),read:!1,type:"nas_cleanup",targetRoles:["selector","manager","admin"],bookingId:e},s=JSON.parse(localStorage.getItem("app_notifications")||"[]");s.unshift(r),s.length>50&&(s.length=50),localStorage.setItem("app_notifications",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("app:notification",{detail:r})),console.log(`[BookingService] NAS cleanup notification dispatched for booking ${e}`)}catch(r){console.error("[BookingService] Failed to dispatch NAS cleanup notification:",r)}}async softDeleteBooking(e){try{await ge.deleteFrom("dashboard_tasks").where("relatedBookingId","=",e).execute(),console.log(` Deleted dashboard tasks for booking ${e}`)}catch(r){console.error(" Failed to delete related tasks:",r)}await pn.softDelete(e),navigator.onLine?await H.from("bookings").update({deleted_at:new Date().toISOString()}).eq("id",e):await yt.enqueue("delete","booking",{id:e});const n=JSON.parse(localStorage.getItem("user")||"{}");await qn.logAction("delete","booking",e,"Soft deleted booking (restorable within 30 days)",{id:n.id,name:n.name||"System"})}async restoreBooking(e){await pn.restore(e),navigator.onLine?await H.from("bookings").update({deleted_at:null}).eq("id",e):await yt.enqueue("update","booking",{id:e,deleted_at:null});const n=JSON.parse(localStorage.getItem("user")||"{}");await qn.logAction("restore","booking",e,"Restored booking from trash",{id:n.id,name:n.name||"System"})}async getDeletedBookings(){return pn.getDeleted()}async permanentDeleteBooking(e){const n=new QS,r=await n.getReminders(e);for(const a of r)await n.deleteReminder(a.id);await ge.deleteFrom("dashboard_tasks").where("relatedBookingId","=",e).execute(),await pn.hardDelete(e),navigator.onLine&&(await H.from("bookings").delete().eq("id",e),await H.from("reminders").delete().eq("bookingId",e));const s=JSON.parse(localStorage.getItem("user")||"{}");await qn.logAction("delete","booking",e,"Permanently deleted booking",{id:s.id,name:s.name||"System"})}async cleanupOldDeletedBookings(e=30){const n=await pn.cleanupOldDeleted(e);if(n>0){const r=JSON.parse(localStorage.getItem("user")||"{}");await qn.logAction("cleanup","booking","system",`Cleaned up ${n} old deleted bookings`,{id:r.id,name:r.name||"System"})}return n}async deleteTestBookings(){console.log(" Starting Smart Cleanup...");let e=0;const r=(await this.getBookings()).filter(s=>{const a=(s.clientName||"").toLowerCase(),c=(s.title||"").toLowerCase(),l=s.clientPhone||"000000",d=a.includes("test")||a.includes("demo")||a.includes("tst")||a==="h",h=c.includes("test")||c.includes("demo");return d||h||(l==="07700000000"||l==="123456"||l==="000000")});console.log(`found ${r.length} test bookings to delete.`);for(const s of r)await this.softDeleteBooking(s.id),e++;return e}}const w0=new b0,gj=Object.freeze(Object.defineProperty({__proto__:null,BookingService:b0,bookingService:w0},Symbol.toStringTag,{value:"Module"})),vl=t=>{const e=t.replace(/\D/g,"");return e.length>10?e.slice(-10):e},Gf=t=>t?t.replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E8\u06EA-\u06ED]/g,"").replace(/[]/g,"").replace(//g,"").replace(//g,"").replace(//g,"").replace(//g,"").trim().toLowerCase():"",HS=(t,e,n)=>{if(!n||n.length===0)return null;const r=t.map(c=>vl(c||"")).filter(c=>c.length>=10);if(r.length===0)return null;const s=e.filter(c=>c&&c.trim().length>1).map(c=>Gf(c));if(s.length===0)return null;const a=n.find(c=>{if(!c.clientPhone||!c.clientName)return!1;const l=vl(typeof c.clientPhone=="string"?c.clientPhone:"");if(l.length<10||!r.some(u=>u===l))return!1;const h=Gf(c.clientName).split(/\s+\s+|\s+/).filter(u=>u.length>1);return s.some(u=>h.some(p=>p===u||p.includes(u)||u.includes(p)))});return(a==null?void 0:a.clientId)||null},Kf=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`},Sd=({isOpen:t,onClose:e,onSave:n,initialCategory:r=es.WEDDING,mode:s="shoot",initialDate:a,editingBooking:c,readOnly:l=!1,existingBookings:d=[],hideHeader:h=!1,rebookClient:m})=>{var ca;const{handleSubmit:u,reset:p,watch:w,setValue:y}=W0({defaultValues:{category:es.WEDDING,servicePackage:"",baseAmount:0,totalAmount:0,paidAmount:0,currency:"IQD",shootDate:new Date().toISOString().split("T")[0],groomName:"",brideName:"",groomBirthday:"",brideBirthday:"",personName:"",familyName:"",isPhotographer:!1,groomPhone:"",bridePhone:"",genericPhone:"",startTime:"10:00",endTime:"12:00",locationLink:"",notes:"",allowPublishing:!1,isFamous:!1,isCrewShooting:!1,isVIP:!1,extraItems:[]}}),g=w(),[N,v]=x.useState(Vh),[C,S]=x.useState(!1),_=x.useRef(null),D=x.useRef(null),[O,b]=x.useState([]),[A,q]=x.useState(""),[I,M]=x.useState(""),[V,de]=x.useState(s==="location"?"venue":cs[0].id),[X,he]=x.useState("venue_session");x.useEffect(()=>{t&&!c&&de(s==="location"?"venue":cs[0].id)},[t,s,c]),x.useEffect(()=>{t&&(async()=>{console.log(" AddBookingModal: Using static packages"),v(Vh)})()},[t]),x.useEffect(()=>{var L,B,ue,we,ke;if(t)if(c){const Ke=N.find(on=>on.title===c.servicePackage);P(!Ke),S(!1);const be=c.details||{},We=cs.find(on=>on.mapTo===c.category)||cs[0];de(We.id);const qt=be.extraItems||[],st=qt.reduce((on,an)=>on+(an.amount||0),0),sn=Math.max(0,(c.totalAmount||0)-st);p({category:c.category,servicePackage:c.servicePackage,baseAmount:sn,totalAmount:c.totalAmount,paidAmount:c.paidAmount,currency:c.currency,shootDate:c.shootDate,groomName:be.groomName||"",brideName:be.brideName||"",groomBirthday:be.groomBirthday||"",brideBirthday:be.brideBirthday||"",personName:be.personName||"",familyName:be.familyName||"",isPhotographer:be.isPhotographer||!1,groomPhone:Array.isArray(c.clientPhone)?c.clientPhone[0]:c.clientPhone,bridePhone:"",genericPhone:typeof c.clientPhone=="string"?c.clientPhone:"",startTime:be.startTime||"10:00",endTime:be.endTime||"12:00",locationLink:((B=(L=be.notes)==null?void 0:L.match(/Mapped Location: (.*)/))==null?void 0:B[1])||"",notes:((ue=be.notes)==null?void 0:ue.replace(/\n\nMapped Location: .*/,""))||"",allowPublishing:be.allowPublishing||!1,allowPhotography:be.allowPhotography!==void 0?be.allowPhotography:!0,isFamous:c.isFamous||!1,isVIP:c.isVIP||!1,extraItems:qt}),b(be.extraItems||[])}else{P(!1),S(!1);const Ke=s==="location"?"venue":cs[0].id;de(Ke),he("venue_session");const be=((we=m==null?void 0:m.name)==null?void 0:we.split(/\s+\s+/))||[],We=be.length>=2;p({category:r,groomName:m?We?be[0].trim():((ke=be[0])==null?void 0:ke.trim())||"":"",brideName:m&&We?be[1].trim():"",personName:m?m.name:"",isPhotographer:!1,groomPhone:m?m.phone:"",bridePhone:"",genericPhone:m?m.phone:"",servicePackage:"",baseAmount:0,totalAmount:0,paidAmount:0,currency:"IQD",startTime:"10:00",endTime:"10:30",shootDate:Kf(a||new Date),locationLink:"",notes:"",allowPublishing:!1,allowPhotography:!0,brideBirthday:"",familyName:"",isFamous:!1,isVIP:!1,extraItems:[]}),b([]),q(""),M("")}},[t,r,a,p,c,m]);const[ie,P]=x.useState(!1),J=x.useMemo(()=>{var We,qt;if(!g.shootDate||!g.startTime||!g.endTime||l)return null;const L=parseInt(String(g.startTime||"").replace(":",""))||0,B=parseInt(String(g.endTime||"").replace(":",""))||0,ue=V==="venue"&&X==="venue_party"||g.servicePackage.includes(""),we=d.filter(st=>st.shootDate===g.shootDate&&st.id!==(c==null?void 0:c.id));let ke=!1,Ke=!1,be="";for(const st of we){if(!((We=st.details)!=null&&We.startTime)||!((qt=st.details)!=null&&qt.endTime))continue;const sn=parseInt(st.details.startTime.replace(":","")),on=parseInt(st.details.endTime.replace(":","")),an=st.details.rentalType==="Full";if(L<on&&B>sn)if(ue||an){ke=!0,be="      ( )";break}else Ke=!0,be="      ( )"}return ke?{type:"error",message:be}:Ke?{type:"warning",message:be}:null},[g.shootDate,g.startTime,g.endTime,V,g.servicePackage,X,d,c,l]),le=x.useMemo(()=>{const L=[g.groomPhone,g.bridePhone,g.genericPhone].map(ue=>vl(ue||"")).filter(ue=>ue.length>=10);if(L.length===0)return null;const B=d.filter(ue=>{if(ue.id===(c==null?void 0:c.id)||!ue.clientPhone)return!1;const we=vl(typeof ue.clientPhone=="string"?ue.clientPhone:"");return we.length<10?!1:L.some(ke=>ke===we)});if(B.length>0){const ue=B.sort((we,ke)=>new Date(ke.shootDate).getTime()-new Date(we.shootDate).getTime())[0];return{count:B.length,lastTitle:ue.title,lastDate:ue.shootDate,clientName:ue.clientName}}return null},[g.groomPhone,g.bridePhone,g.genericPhone,d,c]);x.useEffect(()=>{C&&_.current&&setTimeout(()=>{var L;return(L=_.current)==null?void 0:L.focus()},100)},[C]);const Fe=(L,B)=>{const ue=B.replace(/[-]/g,we=>"".indexOf(we).toString()).replace(/[^0-9]/g,"");y(L,Number(ue)||0)},kt=L=>!L||L===0?"":L.toLocaleString("en-US"),lt=(L,B)=>{const we=B.replace(/[-]/g,ke=>"".indexOf(ke).toString()).replace(/[^0-9+\s()]/g,"");y(L,we)},K=V==="venue",ne=N.filter(L=>K?L.categoryId===X:L.categoryId===V),Ne=L=>{if(L==="custom")P(!0),y("servicePackage"," "),y("baseAmount",0),mt(0,O),S(!1);else{P(!1);const B=N.find(ue=>ue.id===L);B&&(y("servicePackage",B.title),y("baseAmount",B.price),y("currency",B.currency),mt(B.price,O),S(!0))}},Qe=L=>{de(L),y("servicePackage",""),y("baseAmount",0),mt(0,O),P(!1),S(!1);const B=["vip","wedding_party"].includes(L);y("isVIP",B);const ue=cs.find(we=>we.id===L);if(ue&&y("category",ue.mapTo),L==="venue"){const we=g.genericPhone||g.groomPhone||g.bridePhone||"";y("genericPhone",we)}},mt=(L,B)=>{const ue=B.reduce((we,ke)=>we+ke.amount,0);y("totalAmount",L+ue)},Se=()=>O.reduce((L,B)=>L+B.amount,0),[Ut,pe]=x.useState(!1),[F,ce]=x.useState(null),[Ce,Me]=x.useState(!1),[rt,os]=x.useState(null),mr=async(L=!1)=>{var an;if(Ut)return;pe(!0),ce(null);const B=await w0.checkAvailability(g.shootDate,g.startTime,g.endTime,c==null?void 0:c.id);if(B.hasConflict&&!L){const Zt=B.conflictMessage||"  ";os(Zt),Me(!0),pe(!1);return}const ue=B.hasConflict&&L,{groomName:we,brideName:ke,personName:Ke,familyName:be}=g;let We=Ke||"";["vip","wedding_party","wedding_studio"].includes(V)?we&&ke?We=`${we}  ${ke}`:we?We=we:ke&&(We=ke):K?X==="venue_session"?we&&ke?We=`${we}  ${ke}`:We=we||ke||Ke||" ":X==="venue_room"?We=ke||Ke||" VIP":X==="venue_party"?We=Ke||" ":X==="venue_commercial"?We=Ke||" ":We=Ke||(g.isPhotographer?" ":""):V==="general"&&be&&(We=be);const qt=`${((an=cs.find(Zt=>Zt.id===V))==null?void 0:an.label)||""} - ${We}`;let st="";["vip","wedding_party","wedding_studio"].includes(V)?st=g.groomPhone||g.bridePhone||g.genericPhone:K&&X==="venue_room"?st=g.bridePhone||g.genericPhone||g.groomPhone:st=g.genericPhone||g.groomPhone||g.bridePhone,console.log(" [Booking] Phone saved:",{groomPhone:g.groomPhone,bridePhone:g.bridePhone,genericPhone:g.genericPhone,selectedPrimary:st,category:V});const sn=ue?me.INQUIRY:me.CONFIRMED,on=ue?"pending":void 0;n({clientId:HS([g.groomPhone,g.bridePhone,g.genericPhone],[we,ke,Ke,be],d)||`cl_${Date.now()}`,clientName:We,clientPhone:st,category:g.category,title:qt,shootDate:g.shootDate,status:sn,totalAmount:Number(g.totalAmount),paidAmount:Number(g.paidAmount),currency:g.currency,exchangeRate:g.currency==="USD"?1500:void 0,servicePackage:g.servicePackage||"",isFamous:g.isFamous,isVIP:g.isVIP,approvalStatus:on,conflictDetails:ue&&rt||void 0,details:{groomName:we,brideName:ke,personName:Ke,familyName:be,groomBirthday:g.groomBirthday||void 0,brideBirthday:g.brideBirthday||void 0,isPhotographer:g.isPhotographer,startTime:g.startTime,endTime:g.endTime,rentalType:g.servicePackage.includes("")||X==="venue_party"?"Full":"Zone",notes:g.notes,allowPublishing:g.allowPublishing,allowPhotography:g.allowPhotography,extraItems:O,baseAmount:g.baseAmount},location:g.locationLink||""}),pe(!1),e()},Zs=()=>mr(!1),Pn=()=>{Me(!1),mr(!0)},aa=()=>{const L=(g.totalAmount>0||ie)&&g.servicePackage!=="";let B=!1;["vip","wedding_party","wedding_studio"].includes(V)?B=g.groomName.trim().length>1||g.brideName.trim().length>1:K&&X==="venue_room"?B=g.brideName.trim().length>1:B=g.personName.trim().length>1||g.familyName.trim().length>1||g.groomName.trim().length>1;const ue=["vip","wedding_party","wedding_studio"].includes(V)?g.groomPhone.length>3||g.bridePhone.length>3:K&&X==="venue_room"?g.bridePhone.length>3:g.genericPhone.length>3;return L&&ue&&B};return t?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"fixed inset-0 z-200000 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 transition-opacity duration-300",children:i.jsx(Ll,{nodeRef:D,handle:".modal-header",disabled:C,children:i.jsxs("div",{ref:D,"data-testid":"add-booking-modal",className:"bg-[#1E1E1E] border border-white/10 w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] relative",children:[C&&i.jsx("div",{className:"absolute inset-0 z-50 bg-black/60 backdrop-blur-md flex items-center justify-center p-6 animate-in fade-in duration-200",children:i.jsxs("div",{className:"bg-[#262626] border border-[#F7931E]/50 w-full max-w-sm rounded-2xl p-6 transform scale-100 animate-in zoom-in-95",children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsx(Go,{size:28,className:"text-[#F7931E] mx-auto mb-3"}),i.jsx("h4",{className:"text-xl font-bold text-white",children:" ()"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{ref:_,type:"text",dir:"ltr",value:kt(g.paidAmount),onChange:L=>Fe("paidAmount",L.target.value),placeholder:"0",className:"w-full bg-black/40 border border-[#F7931E] rounded-xl px-4 py-4 text-white text-center font-mono text-3xl font-bold outline-none focus:ring-2 focus:ring-[#F7931E]/50 transition-all"}),i.jsx("button",{type:"button",onClick:()=>y("currency",g.currency==="IQD"?"USD":"IQD"),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white font-bold text-sm bg-white/5 px-2 py-1 rounded hover:bg-white/10 transition-colors",children:g.currency})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("button",{onClick:()=>S(!1),className:"flex-1 py-3 bg-[#F7931E] hover:bg-[#F9BE70] text-black font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 active:scale-95",children:[i.jsx(Xr,{size:18})," "]}),i.jsxs("button",{onClick:()=>{Rd.initiatePayment(g.totalAmount-g.paidAmount,`temp_${Date.now()}`,g.servicePackage).then(L=>{window.open&&window.open(L.url,"_blank")}).catch(()=>{z.info("     ")})},className:"px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 text-gray-400 hover:text-white rounded-xl transition-all flex items-center justify-center active:scale-95 group relative",title:"  ()",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:animate-shimmer"}),i.jsx(zu,{size:22})]})]})]})]})}),!h&&i.jsxs("div",{className:"modal-header cursor-move bg-linear-to-l from-[#262626] to-[#1E1E1E] p-6 flex items-center justify-between border-b border-white/5",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h3",{className:"text-lg font-bold text-white",children:l?" ":c?" ":K?"  ":"  "}),J&&i.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full border text-[10px] font-bold animate-in fade-in zoom-in-95 ${J.type==="error"?"bg-red-500/20 border-red-500/30 text-red-400":"bg-yellow-500/20 border-yellow-500/30 text-yellow-400"}`,children:[J.type==="error"?i.jsx(Hc,{size:14}):i.jsx(Jo,{size:14}),i.jsx("span",{children:J.message})]}),F&&i.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full border text-[10px] font-bold animate-in fade-in zoom-in-95 bg-red-500/20 border-red-500/30 text-red-400",children:[i.jsx(Hc,{size:14}),i.jsx("span",{children:F})]})]}),i.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:i.jsx(Jt,{size:24})})]}),i.jsx("div",{className:"p-6 overflow-y-auto flex-1 custom-scrollbar space-y-5",children:i.jsxs("fieldset",{disabled:l,className:"contents",children:[K&&i.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-6",children:[i.jsxs("button",{onClick:()=>{he("venue_party"),y("servicePackage","")},className:`flex items-center justify-center gap-2 py-4 rounded-2xl border transition-all duration-300 ${X==="venue_party"?"bg-purple-600/20 border-purple-500 text-purple-200 shadow-[0_0_15px_rgba(147,51,234,0.3)]":"bg-[#262626] border-transparent text-gray-500 hover:bg-[#333]"}`,children:[i.jsx(lg,{size:18}),i.jsx("span",{className:"font-bold text-xs md:text-sm",children:" "})]}),i.jsxs("button",{onClick:()=>{he("venue_room"),y("servicePackage","")},className:`flex items-center justify-center gap-2 py-4 rounded-2xl border transition-all duration-300 ${X==="venue_room"?"bg-pink-600/20 border-pink-500 text-pink-200 shadow-[0_0_15px_rgba(219,39,119,0.3)]":"bg-[#262626] border-transparent text-gray-500 hover:bg-[#333]"}`,children:[i.jsx(sd,{size:18}),i.jsx("span",{className:"font-bold text-xs md:text-sm",children:" VIP"})]}),i.jsxs("button",{onClick:()=>{he("venue_session"),y("servicePackage","")},className:`flex items-center justify-center gap-2 py-4 rounded-2xl border transition-all duration-300 ${X==="venue_session"?"bg-[#F7931E]/20 border-[#F7931E] text-[#F9BE70] shadow-[0_0_15px_rgba(247,147,30,0.3)]":"bg-[#262626] border-transparent text-gray-500 hover:bg-[#333]"}`,children:[i.jsx(Ko,{size:18}),i.jsx("span",{className:"font-bold text-xs md:text-sm",children:""})]}),i.jsxs("button",{onClick:()=>{he("venue_commercial"),y("servicePackage","")},className:`flex items-center justify-center gap-2 py-4 rounded-2xl border transition-all duration-300 ${X==="venue_commercial"?"bg-blue-500/20 border-blue-500 text-blue-300 shadow-[0_0_15px_rgba(59,130,246,0.3)]":"bg-[#262626] border-transparent text-gray-500 hover:bg-[#333]"}`,children:[i.jsx(Go,{size:18}),i.jsx("span",{className:"font-bold text-xs md:text-sm",children:""})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("div",{className:"w-1 h-5 bg-[#C94557] rounded-full"}),i.jsx("h4",{className:"text-white font-bold text-sm",children:"  "})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[!K&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:" "}),i.jsx("select",{value:V,onChange:L=>Qe(L.target.value),className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-[#F7931E] rounded-2xl px-5 py-4 text-white appearance-none cursor-pointer outline-none transition-all duration-300",children:cs.filter(L=>L.id!=="venue").map(L=>i.jsx("option",{value:L.id,className:"bg-[#121212]",children:L.label},L.id))})]}),i.jsxs("div",{className:`space-y-2 ${K?"md:col-span-2":""}`,children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:" "}),i.jsxs("select",{className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-[#F7931E] rounded-2xl px-5 py-4 text-white appearance-none cursor-pointer outline-none transition-all duration-300",value:ie?"custom":((ca=N.find(L=>L.title===g.servicePackage))==null?void 0:ca.id)||"",onChange:L=>Ne(L.target.value),children:[i.jsx("option",{value:"",children:"--   --"}),ne.map(L=>i.jsx("option",{value:L.id,className:"bg-[#121212]",children:Kx(L)},L.id)),i.jsx("option",{value:"custom",className:"bg-[#121212] text-[#F7931E] font-bold",children:"  "})]})]}),ie&&i.jsxs("div",{className:"space-y-2 md:col-span-2",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:"  ()"}),i.jsx(Ap,{value:g.baseAmount,onChange:L=>{y("baseAmount",L),mt(L,O)},placeholder:"  "}),O.length>0&&i.jsxs("div",{className:"flex justify-between text-xs mt-2",children:[i.jsxs("span",{className:"text-gray-500",children:[": ",g.baseAmount.toLocaleString()]}),i.jsxs("span",{className:"text-emerald-400",children:["+ : ",Se().toLocaleString()]}),i.jsxs("span",{className:"text-white font-bold",children:["= : ",g.totalAmount.toLocaleString()]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold block",children:" "}),i.jsx(tv,{value:g.shootDate,onChange:L=>y("shootDate",L)})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"flex items-center justify-between mb-2",children:i.jsxs("label",{className:"text-xs text-gray-400 font-bold flex items-center gap-2",children:[i.jsx(Bs,{size:12}),"  "]})}),i.jsx(Xw,{value:g.startTime,onChange:L=>{y("startTime",L);const[B,ue]=L.split(":").map(Number),we=ue+30,ke=B+Math.floor(we/60),Ke=we%60,be=`${ke.toString().padStart(2,"0")}:${Ke.toString().padStart(2,"0")}`;y("endTime",be)}}),i.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[i.jsx(Bs,{size:10})," ",i.jsx("span",{className:"text-[#C94557] font-bold",children:g.endTime})," ","(30 )"]})]})]})]}),i.jsxs("div",{className:"bg-[#1a1c22] p-5 lg:p-6 rounded-3xl border border-white/5 space-y-5 relative overflow-hidden group",children:[i.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-[#C94557]/5 rounded-full blur-[60px] pointer-events-none group-hover:bg-[#C94557]/10 transition-colors duration-500"}),i.jsxs("div",{className:"flex items-center justify-between relative z-10 mb-2",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-1.5 h-6 bg-linear-to-b from-[#C94557] to-red-600 rounded-full shadow-[0_0_10px_rgba(201,69,87,0.4)]"}),i.jsx("h4",{className:"text-white font-bold text-base tracking-wide",children:" "})]}),i.jsxs("div",{className:"flex gap-2",children:[!K&&i.jsxs("button",{type:"button",onClick:()=>y("allowPublishing",!g.allowPublishing),className:`flex items-center gap-1.5 px-2 py-0.5 rounded-lg border transition-all text-[9px] font-bold ${g.allowPublishing?"bg-green-500/10 border-green-500/20 text-green-400":"bg-gray-800 border-white/5 text-gray-500"}`,children:[i.jsx(Xr,{size:10})," "]}),i.jsxs("button",{type:"button",onClick:()=>y("isCrewShooting",!g.isCrewShooting),className:`flex items-center gap-1.5 px-2 py-0.5 rounded-lg border transition-all text-[9px] font-bold ${g.isCrewShooting?"bg-blue-500/10 border-blue-500/20 text-blue-400 shadow-[0_0_8px_rgba(59,130,246,0.2)]":"bg-gray-800 border-white/5 text-gray-500"}`,children:[i.jsx(dg,{size:10})," "]}),K&&i.jsxs("button",{type:"button",onClick:()=>y("allowPhotography",!g.allowPhotography),className:`flex items-center gap-1.5 px-2 py-0.5 rounded-lg border transition-all text-[9px] font-bold ${g.allowPhotography?"bg-green-500/10 border-green-500/20 text-green-400":"bg-gray-800 border-white/5 text-gray-500"}`,children:[i.jsx(Ko,{size:10})," "]}),i.jsxs("button",{type:"button",onClick:()=>y("isFamous",!g.isFamous),className:`flex items-center gap-1.5 px-2 py-0.5 rounded-lg border transition-all text-[9px] font-bold ${g.isFamous?"bg-yellow-500/10 border-yellow-500/20 text-yellow-400 shadow-[0_0_8px_rgba(234,179,8,0.2)]":"bg-gray-800 border-white/5 text-gray-500"}`,children:[i.jsx(sd,{size:10,className:g.isFamous?"animate-pulse":""})," ",""]})]})]}),le&&i.jsxs("div",{className:"p-3 bg-linear-to-r from-emerald-500/10 to-teal-500/10 border border-emerald-500/30 rounded-xl flex items-center gap-3 animate-in fade-in slide-in-from-top-2 mb-4",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 shrink-0",children:i.jsx(Jc,{size:16})}),i.jsxs("div",{children:[i.jsxs("p",{className:"text-xs font-bold text-emerald-400 flex items-center gap-2",children:["  ( )"," ",i.jsx(sd,{size:12,className:"text-yellow-500 fill-yellow-500"})]}),i.jsxs("p",{className:"text-[10px] text-gray-400",children:["   ",le.count,"  ( :"," ",le.lastTitle,"  ",le.lastDate,")"]})]})]}),V==="venue"&&i.jsxs("div",{className:"flex gap-2 p-1 bg-black/20 rounded-xl border border-white/5 w-fit",children:[i.jsx("button",{type:"button",onClick:()=>y("isPhotographer",!1),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all duration-300 ${g.isPhotographer?"text-gray-500 hover:text-white hover:bg-white/5":"bg-linear-to-r from-blue-600 to-blue-500 text-white shadow-lg"}`,children:""}),i.jsx("button",{type:"button",onClick:()=>y("isPhotographer",!0),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all duration-300 ${g.isPhotographer?"bg-linear-to-r from-[#F7931E] to-orange-500 text-white shadow-lg":"text-gray-500 hover:text-white hover:bg-white/5"}`,children:""})]}),["vip","wedding_party","wedding_studio"].includes(V)?i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("label",{className:"text-xs text-[#F7931E] font-bold flex items-center gap-2",children:[i.jsx(qs,{size:12}),"  "]}),i.jsx("input",{type:"text",value:g.groomName,onChange:L=>y("groomName",L.target.value),placeholder:" ",className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-[#F7931E] rounded-2xl px-5 py-4 text-white placeholder-gray-600 outline-none transition-all duration-300"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("label",{className:"text-xs text-pink-500 font-bold flex items-center gap-2",children:[i.jsx(qs,{size:12}),"  "]}),i.jsx("input",{type:"text",value:g.brideName,onChange:L=>y("brideName",L.target.value),placeholder:" ",className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-pink-500 rounded-2xl px-5 py-4 text-white placeholder-gray-600 outline-none transition-all duration-300"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:" "}),i.jsx("input",{type:"text",dir:"ltr",value:g.groomPhone,onChange:L=>lt("groomPhone",L.target.value),className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-[#F7931E] rounded-2xl px-5 py-4 text-white placeholder-gray-600 outline-none transition-all duration-300 font-mono text-sm",placeholder:"07XX..."})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:" "}),i.jsx("input",{type:"text",dir:"ltr",value:g.bridePhone,onChange:L=>lt("bridePhone",L.target.value),className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-pink-500 rounded-2xl px-5 py-4 text-white placeholder-gray-600 outline-none transition-all duration-300 font-mono text-sm",placeholder:"07XX..."})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("label",{className:"text-xs text-gray-500 font-bold flex items-center gap-2 opacity-80",children:[i.jsx(zs,{size:12}),"  ",i.jsx("span",{className:"text-[10px] font-normal text-gray-600 bg-white/5 px-2 py-0.5 rounded-md",children:""})]}),i.jsx("input",{type:"date",value:g.groomBirthday,onChange:L=>y("groomBirthday",L.target.value),className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-white/30 rounded-2xl px-5 py-4 text-white/70 outline-none transition-all duration-300"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("label",{className:"text-xs text-gray-500 font-bold flex items-center gap-2 opacity-80",children:[i.jsx(zs,{size:12}),"  ",i.jsx("span",{className:"text-[10px] font-normal text-gray-600 bg-white/5 px-2 py-0.5 rounded-md",children:""})]}),i.jsx("input",{type:"date",value:g.brideBirthday,onChange:L=>y("brideBirthday",L.target.value),className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-white/30 rounded-2xl px-5 py-4 text-white/70 outline-none transition-all duration-300"})]})]}):i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:K&&X==="venue_room"?" ":" "}),i.jsx("input",{type:"text",value:K&&X==="venue_room"?g.brideName:g.personName,onChange:L=>y(K&&X==="venue_room"?"brideName":"personName",L.target.value),placeholder:" ",className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-[#C94557] rounded-2xl px-5 py-4 text-white placeholder-gray-600 outline-none transition-all duration-300"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:" "}),i.jsx("input",{type:"text",dir:"ltr",value:K&&X==="venue_room"?g.bridePhone:g.genericPhone,onChange:L=>lt(K&&X==="venue_room"?"bridePhone":"genericPhone",L.target.value),className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-[#C94557] rounded-2xl px-5 py-4 text-white placeholder-gray-600 outline-none transition-all duration-300 font-mono text-sm",placeholder:"07XX..."})]}),["kids","general"].includes(V)&&i.jsxs("div",{className:"space-y-3 md:col-span-2",children:[i.jsxs("label",{className:"text-xs text-gray-500 font-bold flex items-center gap-2 opacity-80",children:[i.jsx(zs,{size:12})," ",i.jsx("span",{className:"text-[10px] font-normal text-gray-600 bg-white/5 px-2 py-0.5 rounded-md",children:""})]}),i.jsx("input",{type:"date",value:g.groomBirthday,onChange:L=>y("groomBirthday",L.target.value),className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-white/30 rounded-2xl px-5 py-4 text-white/70 outline-none transition-all duration-300"})]})]})]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-xs text-gray-400 font-bold",children:" "}),i.jsx("textarea",{value:g.notes,onChange:L=>y("notes",L.target.value),placeholder:"    ...",rows:3,className:"w-full bg-[#121212] border border-white/10 hover:border-white/20 focus:border-[#C94557] rounded-2xl px-5 py-4 text-white placeholder-gray-600 outline-none transition-all duration-300 resize-none"})]})})]})}),i.jsxs("div",{className:"p-6 bg-[#121212]/50 flex justify-end gap-3 border-t border-white/5",children:[i.jsx("button",{onClick:e,className:"px-6 py-3 text-sm font-semibold text-gray-400 hover:text-white transition-colors",children:l?"":""}),!l&&i.jsx("button",{onClick:u(Zs),disabled:Ut||!aa(),className:"flex items-center gap-2 px-8 py-3 text-sm font-bold rounded-xl shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 bg-linear-to-r from-[#F7931E] to-[#F9BE70] text-white",children:Ut?i.jsx("span",{className:"animate-pulse",children:" ..."}):i.jsxs(i.Fragment,{children:[i.jsx(Fi,{size:18})," ",c?" ":" "]})})]})]})})}),Ce&&i.jsx("div",{className:"fixed inset-0 z-[300000] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:i.jsxs("div",{className:"bg-[#1E1E1E] border border-yellow-500/30 w-full max-w-md rounded-2xl p-6 shadow-2xl",children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsx("div",{className:"w-16 h-16 rounded-full bg-yellow-500/20 flex items-center justify-center mx-auto mb-4",children:i.jsx(Jo,{size:32,className:"text-yellow-500"})}),i.jsx("h4",{className:"text-xl font-bold text-white mb-2",children:"  "}),i.jsx("p",{className:"text-gray-400 text-sm",children:rt})]}),i.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 mb-6",children:i.jsx("p",{className:"text-yellow-400 text-sm text-center",children:"     "})}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>Me(!1),className:"flex-1 px-4 py-3 text-sm font-semibold text-gray-400 hover:text-white border border-white/10 rounded-xl transition-colors",children:""}),i.jsxs("button",{onClick:Pn,className:"flex-1 px-4 py-3 text-sm font-bold bg-yellow-500 hover:bg-yellow-600 text-black rounded-xl shadow-lg transition-all flex items-center justify-center gap-2",children:[i.jsx(Bs,{size:16}),""]})]})]})})]}):null},Dc=({isOpen:t,onClose:e,onConfirm:n,title:r,message:s,confirmLabel:a,cancelLabel:c,customContent:l})=>t?i.jsx("div",{className:"fixed inset-0 z-200 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:i.jsxs("div",{className:"bg-[#2a2d35] rounded-2xl p-6 max-w-md w-full border border-white/10 shadow-2xl animate-in zoom-in-95 duration-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-white",children:r}),i.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:i.jsx(Jt,{size:20})})]}),l?i.jsx("div",{className:"mb-6",children:l}):i.jsx("p",{className:"text-gray-300 mb-6",children:s}),(a||c)&&i.jsxs("div",{className:"flex gap-3 justify-end",children:[c&&i.jsx("button",{onClick:e,className:"px-4 py-2 bg-white/5 hover:bg-white/10 text-gray-300 rounded-xl transition-colors",children:c}),a&&i.jsx("button",{onClick:n,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-xl transition-colors font-bold",children:a})]})]})}):null;class Yf{static async signIn(e,n){try{const{data:r,error:s}=await H.auth.signInWithPassword({email:e,password:n});if(s)throw s;return{user:r.user,error:null}}catch(r){return console.error("AuthService: Login Failed",r),{user:null,error:r}}}static async signOut(){try{return await H.auth.signOut(),{error:null}}catch(e){return console.error("AuthService: Logout Failed",e),{error:e}}}static async getUser(){const{data:{user:e}}=await H.auth.getUser();return e}static async getSession(){const{data:{session:e}}=await H.auth.getSession();return e}static getRoleFromUser(e){if(!e||!e.user_metadata||!e.user_metadata.role)return ee.RECEPTION;const n=e.user_metadata.role.toUpperCase();return n==="MANAGER"?ee.MANAGER:n==="ADMIN"?ee.ADMIN:n==="PHOTO_EDITOR"?ee.PHOTO_EDITOR:n==="VIDEO_EDITOR"?ee.VIDEO_EDITOR:n==="PRINTER"?ee.PRINTER:n==="SELECTOR"?ee.SELECTOR:ee.RECEPTION}static async updatePassword(e){try{const{data:n,error:r}=await H.auth.updateUser({password:e});if(r)throw r;return{data:n,error:null}}catch(n){return console.error("AuthService: Update Password Failed",n),{data:null,error:n}}}static async updateEmail(e){try{const{data:n,error:r}=await H.auth.updateUser({email:e});if(r)throw r;return{data:n,error:null}}catch(n){return console.error("AuthService: Update Email Failed",n),{data:null,error:n}}}}const JS=(t,e=150)=>new Promise((n,r)=>{const s=new Image;s.onload=()=>{const a=document.createElement("canvas"),c=a.getContext("2d");if(!c){r(new Error("Canvas context not available"));return}const l=256;let d=s.width,h=s.height;d>h?d>l&&(h=Math.round(h*l/d),d=l):h>l&&(d=Math.round(d*l/h),h=l),a.width=d,a.height=h,c.drawImage(s,0,0,d,h);let m=.8,u=a.toDataURL("image/jpeg",m);for(;u.length>e*1024&&m>.1;)m-=.1,u=a.toDataURL("image/jpeg",m);console.log(` Image compressed: ${Math.round(u.length/1024)}KB (quality: ${m.toFixed(1)})`),n(u)},s.onerror=()=>r(new Error("Failed to load image")),s.src=t});function ni({isOpen:t,onClose:e,currentUser:n,allUsers:r,onUpdateUser:s,isSafeMode:a}){T.useEffect(()=>{t&&console.log(" SettingsModal MOUNTED/OPENED")},[t]);const[c,l]=x.useState("profile"),[d,h]=x.useState(!1),[m,u]=x.useState(""),[p,w]=x.useState(""),[y,g]=x.useState("idle");T.useEffect(()=>{const F=()=>{const ce=localStorage.getItem("last_update_check");if(ce){const Ce=new Date(ce);w(Ce.toLocaleTimeString("ar-IQ",{hour:"2-digit",minute:"2-digit"}))}};return F(),window.addEventListener("storage",F),()=>window.removeEventListener("storage",F)},[]);const N=F=>{if(!F)return"bg-blue-500";if(F.startsWith("bg-")||F.startsWith("content-"))return F;const ce=F.match(/^url\(['"]?(.+?)['"]?\)$/);return ce?ce[1]:F},[v,C]=x.useState(n.name),[S,_]=x.useState(n.email||""),[D,O]=x.useState(N(n.avatar)),b=x.useRef(null);T.useEffect(()=>{C(n.name),_(n.email||""),O(N(n.avatar))},[n]);const A=D.startsWith("data:")||D.startsWith("http")||D.startsWith("/"),[q,I]=x.useState(""),[M,V]=x.useState(""),[de,X]=x.useState(""),[he,ie]=x.useState(!1),[P,J]=x.useState(!1),[le,Fe]=x.useState(!1);T.useEffect(()=>{c==="security"&&(async()=>{const ce=window.electronAPI;if(ce&&ce.auth){const Ce=await ce.auth.checkBiometric();J(Ce);const Me=localStorage.getItem(`biometric_enabled_${n.id}`)==="true";Fe(Me)}})()},[c,n.id]);const kt=async()=>{if(le)Fe(!1),localStorage.setItem(`biometric_enabled_${n.id}`,"false"),window.dispatchEvent(new Event("storage")),z.info("   ");else{const F=window.electronAPI;F&&F.auth&&(await F.auth.promptTouchID("   ")?(Fe(!0),localStorage.setItem(`biometric_enabled_${n.id}`,"true"),window.dispatchEvent(new Event("storage")),z.success("     ")):z.error("   "))}},[lt,K]=x.useState(""),[ne,Ne]=x.useState(!1),Qe=["","","","","","","","","","","","","","","","","","","","","","","",""];if(!t)return null;const mt=async F=>{var Ce;const ce=(Ce=F.target.files)==null?void 0:Ce[0];if(ce){z.loading("  ...",{id:"compress"});try{const Me=new FileReader;Me.onloadend=async()=>{try{const rt=Me.result;console.log(` Original image size: ${Math.round(rt.length/1024)}KB`);const os=await JS(rt,150);O(os),z.success("   ",{id:"compress"})}catch(rt){console.error("Image compression failed:",rt),z.error("  ",{id:"compress"})}},Me.onerror=()=>{z.error("  ",{id:"compress"})},Me.readAsDataURL(ce)}catch{z.error("   ",{id:"compress"})}}},Se=async()=>{console.log(" handleSaveProfile STARTED"),console.log(" Avatar to save:",D.substring(0,100)+"..."),console.log(" Avatar size:",Math.round(D.length/1024),"KB"),Ne(!0),g("saving");let F="  ";try{if(S!==n.email&&S.includes("@")){console.log(" Attempting Cloud Email Update...");const{error:ce}=await Yf.updateEmail(S);ce?console.warn(" Cloud Email Update Failed:",ce):(console.log(" Cloud Email Update Success"),F="     ")}console.log(" Saving to database..."),console.log("   - Name:",v),console.log("   - Email:",S),console.log("   - Avatar length:",D.length),await s(n.id,{name:v,email:S,avatar:D}),console.log(" Database update completed!"),g("success"),window.dispatchEvent(new Event("storage")),z.success(F),setTimeout(()=>{e(),g("idle")},500)}catch(ce){console.error(" handleSaveProfile ERROR:",ce),g("error"),z.error(`  : ${ce.message||" "}`)}finally{Ne(!1),console.log(" handleSaveProfile FINISHED")}},Ut=async()=>{if(M!==de){z.error("    ");return}if(M.length<4){z.error("   ");return}Ne(!0);let F="    ";try{const{error:ce}=await Yf.updatePassword(M);ce?(console.warn("Cloud Password Update Failed (Offline/No Session):",ce),z.warning("  .       .")):F="       ",await s(n.id,{password:M}),z.success(F),I(""),V(""),X(""),e()}catch(ce){console.error(ce),z.error(`   : ${ce.message}`)}finally{Ne(!1)}},pe=async F=>{try{await s(F,{password:"123"}),z.success('       "123"')}catch{z.error("  ")}};return i.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:i.jsxs("div",{className:"bg-[#1a1d21] rounded-2xl w-full max-w-2xl border border-white/10 shadow-2xl flex flex-col overflow-hidden max-h-[80vh]",children:[i.jsxs("div",{className:"p-6 border-b border-white/5 flex items-center justify-between bg-white/5",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg text-blue-400",children:i.jsx(qs,{size:24})}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-bold text-white",children:""}),i.jsx("p",{className:"text-xs text-gray-400",children:a?"  (Admin Mode)":"  "})]})]}),i.jsx("button",{onClick:e,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:i.jsx(Jt,{size:20})})]}),i.jsxs("div",{className:"flex gap-1 p-2 bg-black/20 border-b border-white/5",children:[i.jsxs("button",{onClick:()=>l("profile"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${c==="profile"?"bg-blue-500/20 text-blue-400":"text-gray-500 hover:text-gray-300"}`,children:[i.jsx(qs,{size:16})," "]}),i.jsxs("button",{onClick:()=>l("security"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${c==="security"?"bg-red-500/20 text-red-400":"text-gray-500 hover:text-gray-300"}`,children:[i.jsx(Bu,{size:16}),"  "]}),a&&i.jsxs("button",{onClick:()=>l("safemode"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${c==="safemode"?"bg-emerald-500/20 text-emerald-400 animate-pulse":"text-gray-500 hover:text-gray-300"}`,children:[i.jsx(Id,{size:16}),"  (Admin)"]}),i.jsxs("button",{onClick:()=>l("about"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${c==="about"?"bg-amber-500/20 text-amber-400":"text-gray-500 hover:text-gray-300"}`,children:[i.jsx(dr,{size:16})," "]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent",children:[c==="profile"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"relative group",children:[i.jsxs("div",{onClick:()=>{var F;return(F=b.current)==null?void 0:F.click()},className:`w-20 h-20 rounded-full ${A?"bg-gray-800":D} flex items-center justify-center text-2xl font-bold shadow-lg ring-4 ring-white/5 cursor-pointer overflow-hidden transition-all hover:ring-white/20`,children:[A?i.jsx("img",{src:D,alt:"Avatar",className:"w-full h-full object-cover",onError:F=>{console.warn("Avatar load failed, using fallback"),F.target.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(v)}&background=random&size=200`}}):!D.includes("content-")&&v.charAt(0),i.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity",children:i.jsx(Od,{size:24,className:"text-white"})})]}),i.jsx("input",{type:"file",ref:b,className:"hidden",accept:"image/*",onChange:mt}),A&&i.jsxs("div",{className:"absolute -bottom-1 -right-1 px-1.5 py-0.5 bg-black/80 rounded text-[10px] text-gray-400",children:[Math.round(D.length/1024),"KB"]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-xs text-gray-500",children:" "}),i.jsx("div",{className:"flex gap-2",children:["bg-blue-500","bg-purple-500","bg-rose-500","bg-emerald-500","bg-orange-500"].map(F=>i.jsx("button",{onClick:()=>{if(A)O(F);else if(D.startsWith("bg-")){const Ce=D.split(" ").map(Me=>Me.startsWith("bg-")?F:Me);O(Ce.join(" "))}else O(F)},className:`w-6 h-6 rounded-full ${F} transition-all hover:scale-110 border border-white/10`},F))})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm text-gray-400",children:" "}),i.jsx("input",{type:"text",value:v,onChange:F=>C(F.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl p-3 text-white focus:border-blue-500/50 outline-none transition-colors"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm text-gray-400",children:" "}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"email",value:S,onChange:F=>_(F.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl p-3 pr-10 text-white focus:border-blue-500/50 outline-none transition-colors",placeholder:"example@villahadad.com"}),i.jsx(Cm,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",size:16})]})]}),i.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/5",children:[i.jsx("label",{className:"text-sm text-gray-400 block mb-2",children:" "}),i.jsx("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3",children:i.jsx("div",{className:"grid grid-cols-8 gap-2",children:Qe.map(F=>i.jsx("button",{onClick:()=>{let ce="bg-blue-500";if(!A){const Ce=D.match(/bg-[\w]+-[\d]+/);Ce&&(ce=Ce[0])}O(`${ce} text-2xl flex items-center justify-center after:content-['${F}']`)},className:"w-full aspect-square flex items-center justify-center hover:bg-white/10 rounded text-xl transition-all",children:F},F))})})]}),y!=="idle"&&i.jsxs("div",{className:`p-3 rounded-lg flex items-center gap-2 ${y==="saving"?"bg-blue-500/10 text-blue-400":y==="success"?"bg-emerald-500/10 text-emerald-400":"bg-red-500/10 text-red-400"}`,children:[y==="saving"&&i.jsx(dr,{size:16,className:"animate-spin"}),y==="success"&&i.jsx(Fi,{size:16}),y==="error"&&i.jsx(Hc,{size:16}),i.jsxs("span",{className:"text-sm",children:[y==="saving"&&" ...",y==="success"&&"  !",y==="error"&&" "]})]})]}),c==="security"&&i.jsxs("div",{className:"space-y-6 max-w-md mx-auto",children:[P&&i.jsxs("div",{className:"bg-white/5 border border-white/10 p-4 rounded-xl flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`p-2 rounded-lg ${le?"bg-emerald-500/20 text-emerald-400":"bg-gray-800 text-gray-500"}`,children:i.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:i.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M12 12c0-3 2.5-5.5 5.5-5.5S23 9 23 12M17.5 12c0-3-2.5-5.5-5.5-5.5S6.5 9 6.5 12"}),i.jsx("path",{d:"M12 17.5c0 3-2.5 5.5-5.5 5.5S1 20.5 1 17.5M17.5 17.5c0 3-2.5 5.5-5.5 5.5"})]})})}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm font-bold text-white",children:"  "}),i.jsx("p",{className:"text-xs text-gray-400",children:"    "})]})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",className:"sr-only peer",checked:le,onChange:kt}),i.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"})]})]}),!a&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm text-gray-400",children:"  "}),i.jsx("div",{className:"relative",children:i.jsx("input",{type:he?"text":"password",value:q,onChange:F=>I(F.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl p-3 text-white focus:border-red-500/50 outline-none"})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm text-gray-400",children:"  "}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:he?"text":"password",value:M,onChange:F=>V(F.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl p-3 text-white focus:border-blue-500/50 outline-none"}),i.jsx("button",{onClick:()=>ie(!he),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:he?i.jsx(ug,{size:16}):i.jsx(hg,{size:16})})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm text-gray-400",children:"  "}),i.jsx("input",{type:he?"text":"password",value:de,onChange:F=>X(F.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl p-3 text-white focus:border-blue-500/50 outline-none"})]})]}),c==="safemode"&&a&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl mb-4",children:[i.jsxs("h3",{className:"text-emerald-400 font-bold mb-1 flex items-center gap-2",children:[i.jsx(Id,{size:18}),"  "]}),i.jsxs("p",{className:"text-xs text-gray-400",children:["            .      ",i.jsx("b",{children:'"123"'}),"."]})]}),i.jsxs("div",{className:"relative",children:[i.jsx(Nm,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",size:16}),i.jsx("input",{type:"text",placeholder:"  ...",value:lt,onChange:F=>K(F.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl py-2 pr-10 pl-4 text-sm text-white focus:border-emerald-500/50 outline-none"})]}),i.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto pr-2",children:r.filter(F=>F.name.toLowerCase().includes(lt.toLowerCase())).map(F=>{var ce,Ce,Me,rt;return i.jsxs("div",{className:"p-3 bg-white/5 border border-white/5 rounded-xl flex items-center justify-between group hover:border-white/10 transition-all",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`w-8 h-8 rounded-full ${(ce=F.avatar)!=null&&ce.startsWith("data:")||(Ce=F.avatar)!=null&&Ce.startsWith("http")?"":F.avatar||"bg-gray-600"} flex items-center justify-center text-xs font-bold overflow-hidden`,children:(Me=F.avatar)!=null&&Me.startsWith("data:")||(rt=F.avatar)!=null&&rt.startsWith("http")?i.jsx("img",{src:F.avatar,alt:"",className:"w-full h-full object-cover"}):F.name.charAt(0)}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold text-sm text-gray-200",children:F.name}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-[10px] text-gray-500 uppercase",children:F.role}),i.jsxs("span",{className:"text-[10px] text-emerald-500/70 font-mono bg-emerald-900/20 px-1 rounded",children:["Pwd: ",F.password||"N/A"]})]})]})]}),i.jsx("button",{onClick:()=>pe(F.id),className:"p-2 bg-white/5 hover:bg-emerald-500 hover:text-white rounded-lg text-gray-400 transition-colors tooltip",title:"   123",children:i.jsx(dr,{size:16})})]},F.id)})})]}),c==="about"&&i.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-6 text-center",children:[i.jsxs("div",{className:"w-24 h-24 bg-white/5 rounded-3xl flex items-center justify-center border border-white/10 shadow-2xl",children:[i.jsx("img",{src:"./icon.png",alt:"Logo",className:"w-16 h-16 opacity-80",onError:F=>F.currentTarget.style.display="none"}),i.jsx("span",{className:"text-4xl",children:""})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:"Villa Hadad"}),i.jsx("p",{className:"text-gray-500 text-sm",children:"   "}),i.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/10",children:[i.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),i.jsx("span",{className:"text-xs font-mono text-gray-300",children:"v1.0.42"})]})]}),i.jsxs("div",{className:"w-full max-w-sm bg-white/5 border border-white/10 rounded-xl p-4",children:[i.jsx("h4",{className:"text-sm font-bold text-gray-300 mb-3 text-right",children:"  "}),i.jsxs("div",{className:"flex gap-2 mb-4 justify-end",children:[i.jsxs("div",{className:"px-2 py-1 bg-emerald-500/10 border border-emerald-500/20 rounded text-[10px] text-emerald-400 flex items-center gap-1",children:[i.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," "]}),i.jsxs("div",{className:"px-2 py-1 bg-blue-500/10 border border-blue-500/20 rounded text-[10px] text-blue-400 flex items-center gap-1",children:[i.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"  "]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("button",{onClick:async()=>{h(!0),u(" ...");try{const F=window.electronAPI;if(F!=null&&F.checkForUpdates){const ce=await F.getAppVersion(),Ce=await F.checkForUpdates();if(Ce.error)throw new Error(Ce.error);Ce.version&&Ce.version!==ce.version?u(" !"):(u(" "),z.success(`     (v${ce.version})`))}else u("   ")}catch(F){u(" : "+F.message)}finally{setTimeout(()=>h(!1),2e3)}},disabled:d,className:`px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm font-bold transition-all flex items-center gap-2 ${d?"opacity-50":""}`,children:[d?i.jsx(dr,{size:16,className:"animate-spin"}):i.jsx(dr,{size:16}),d?" ...":"  "]}),i.jsx("span",{className:"text-xs text-gray-500 font-mono",children:m||(p?` : ${p}`:"...")})]})]}),i.jsxs("div",{className:"text-[10px] text-gray-600 max-w-xs leading-relaxed",children:["    ",i.jsx("span",{className:"text-gray-500 font-bold",children:"Lumina"}),i.jsx("br",{}),"Build ID: ",new Date().toISOString().split("T")[0]]})]})]}),i.jsxs("div",{className:"p-4 border-t border-white/5 bg-black/20 flex gap-3 justify-end",children:[i.jsx("button",{onClick:e,disabled:ne,className:"px-4 py-2 text-sm text-gray-400 hover:text-white transition-colors disabled:opacity-50",children:""}),c!=="safemode"&&c!=="about"&&i.jsxs("button",{onClick:c==="profile"?Se:Ut,disabled:ne,className:`px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold text-sm transition-all flex items-center gap-2 shadow-lg shadow-blue-900/20 ${ne?"opacity-50 cursor-not-allowed":""}`,children:[ne?i.jsx(dr,{size:16,className:"animate-spin"}):i.jsx(jm,{size:16}),ne?" ...":" "]})]})]})})}const kd=({isOpen:t,onClose:e,clientName:n,bookingStatus:r,outstandingAmount:s,onSend:a})=>{const[c,l]=x.useState(""),[d,h]=x.useState(!1),[m,u]=x.useState(!1),p=x.useRef(null);x.useEffect(()=>{t?w():(l(""),u(!1))},[t]);const w=async()=>{h(!0),l("");try{const g={clientName:n,bookingStatus:r,outstandingAmount:s},N=await Y.generateAiMessage(g);let v="";const C=N.text||"",S=String(C).split("");for(let _=0;_<S.length;_++)await new Promise(D=>setTimeout(D,15)),v+=S[_],l(v)}catch{l("     .")}finally{h(!1)}},y=()=>{navigator.clipboard.writeText(c),u(!0),setTimeout(()=>u(!1),2e3)};return t?i.jsx("div",{className:"fixed inset-0 z-100 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 transition-opacity duration-300",children:i.jsx(Ll,{nodeRef:p,handle:".modal-header",children:i.jsxs("div",{ref:p,className:"bg-[#1E1E1E] border border-purple-500/30 w-full max-w-2xl rounded-2xl shadow-[0_0_50px_rgba(168,85,247,0.15)] overflow-hidden animate-in fade-in duration-300 ring-1 ring-white/5",children:[i.jsxs("div",{className:"modal-header cursor-move bg-linear-to-l from-[#2e1065] via-[#1E1E1E] to-[#1E1E1E] p-6 flex items-center gap-4 border-b border-white/5 relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-[-50%] right-[-10%] w-32 h-32 bg-purple-500/20 blur-[50px] rounded-full pointer-events-none"}),i.jsx("div",{className:"p-3 bg-linear-to-br from-purple-500 to-blue-600 rounded-xl text-white shadow-[0_0_20px_rgba(168,85,247,0.4)] relative z-10",children:i.jsx(fg,{size:24})}),i.jsxs("div",{className:"flex-1 relative z-10",children:[i.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[" ",i.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] bg-purple-500/20 text-purple-300 border border-purple-500/30",children:"AI BETA"})]}),i.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"      "})]}),i.jsx("button",{onClick:e,className:"text-gray-500 hover:text-white transition-colors relative z-10",children:i.jsx(Jt,{size:24})})]}),i.jsxs("div",{className:"p-8 space-y-6",children:[i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-medium text-gray-500 mb-4",children:[i.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/5 border border-white/5 flex items-center gap-2",children:[": ",i.jsx("span",{className:"text-gray-300",children:n})]}),i.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/5 border border-white/5 flex items-center gap-2",children:[": ",i.jsx("span",{className:"text-gray-300",children:r})]}),s>0&&i.jsxs("span",{className:"px-3 py-1 rounded-full bg-red-500/10 border border-red-500/20 text-red-400 flex items-center gap-2",children:[": ",i.jsxs("span",{className:"font-bold",children:["$",s]})]})]}),i.jsxs("div",{className:"relative min-h-[180px] bg-black/40 rounded-xl border border-white/10 p-6 shadow-inner group",children:[i.jsxs("p",{className:"text-gray-200 leading-relaxed text-lg font-light whitespace-pre-wrap",children:[c,d&&i.jsx("span",{className:"inline-block w-2 h-5 bg-purple-500 ml-1 animate-pulse align-middle"})]}),!c&&!d&&i.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-600 gap-2",children:[i.jsx(Zo,{size:32,className:"opacity-20"}),i.jsx("span",{className:"text-sm",children:"    ..."})]}),!d&&c&&i.jsx("div",{className:"absolute bottom-4 left-4 flex gap-2",children:i.jsxs("button",{onClick:y,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 text-gray-300 hover:text-white transition-all flex items-center gap-2 text-xs font-bold backdrop-blur-md border border-white/5",children:[m?i.jsx(Xr,{size:14,className:"text-green-400"}):i.jsx(pm,{size:14}),m?" ":" "]})})]})]}),i.jsxs("div",{className:"p-6 bg-[#121212]/50 flex gap-4 justify-between items-center border-t border-white/5",children:[i.jsx("p",{className:"text-[10px] text-gray-600 max-w-[50%]",children:"    AI      ."}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:e,className:"px-5 py-2.5 text-sm font-semibold text-gray-400 hover:text-white transition-colors hover:bg-white/5 rounded-xl",children:""}),i.jsxs("button",{onClick:w,disabled:d,className:"px-6 py-2.5 text-sm font-bold bg-white/5 hover:bg-white/10 text-white rounded-xl border border-white/5 transition-all duration-300 transform hover:scale-[1.02] flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[d?i.jsx(dr,{size:16,className:"animate-spin"}):i.jsx(Zo,{size:16}),c?" ":" "]}),i.jsxs("button",{onClick:()=>a==null?void 0:a(c),disabled:!c||d,className:"px-6 py-2.5 text-sm font-bold bg-linear-to-r from-green-500 to-emerald-600 text-white rounded-xl shadow-lg shadow-green-500/30 hover:shadow-[0_0_20px_rgba(34,197,94,0.5)] transition-all duration-300 transform hover:scale-[1.02] flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx(mg,{size:16})," "]})]})]})]})})}):null},Xf=({isOpen:t,onClose:e,outstandingAmount:n,onSettle:r})=>{const[s,a]=x.useState(n.toString()),[c,l]=x.useState(!1),[d,h]=x.useState(!1),m=x.useRef(null);if(x.useEffect(()=>{t&&(a(n.toString()),l(!1),h(!1))},[t,n]),!t)return null;const u=async()=>{const p=parseFloat(s);isNaN(p)||(h(!0),await r(p),l(!0),setTimeout(()=>{e()},1500))};return i.jsx("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 transition-opacity duration-300",dir:"rtl",children:i.jsx(Ll,{nodeRef:m,handle:".modal-header",children:i.jsx("div",{ref:m,className:"bg-[#1E1E1E] border border-emerald-500/20 w-full max-w-md rounded-3xl shadow-[0_0_50px_rgba(16,185,129,0.15)] overflow-hidden animate-in fade-in duration-300 ring-1 ring-white/5 relative",children:i.jsx(Bt,{mode:"wait",children:c?i.jsxs(ve.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},className:"p-12 flex flex-col items-center justify-center text-center space-y-4",children:[i.jsx("div",{className:"w-24 h-24 bg-emerald-500/20 rounded-full flex items-center justify-center text-emerald-500 shadow-[0_0_30px_rgba(16,185,129,0.3)] border border-emerald-500/30",children:i.jsx(Fi,{size:56,className:"animate-in zoom-in duration-500"})}),i.jsx("h3",{className:"text-2xl font-black text-white",children:"   "}),i.jsx("p",{className:"text-emerald-400 font-bold",children:"     ."})]},"success-step"):i.jsxs(ve.div,{initial:{opacity:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[i.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-emerald-900/20 via-transparent to-transparent opacity-50 pointer-events-none"}),i.jsxs("div",{className:"modal-header cursor-move p-8 pb-0 flex items-start gap-5 relative z-10",children:[i.jsx("div",{className:"p-4 bg-emerald-500/10 rounded-2xl text-emerald-500 border border-emerald-500/20 shadow-[0_0_20px_rgba(16,185,129,0.15)]",children:i.jsx(Jo,{size:32,strokeWidth:2.5})}),i.jsxs("div",{className:"flex-1 pt-1",children:[i.jsx("h3",{className:"text-2xl font-bold text-white tracking-tight",children:"  "}),i.jsx("p",{className:"text-emerald-400 text-sm mt-1 font-medium",children:"    ."})]}),i.jsx("button",{onClick:e,className:"text-gray-500 hover:text-white transition-colors bg-white/5 hover:bg-white/10 p-2 rounded-full",children:i.jsx(Jt,{size:20})})]}),i.jsxs("div",{className:"p-8 space-y-6 relative z-10",children:[i.jsxs("div",{className:"bg-gradient-to-b from-black/60 to-black/30 p-8 rounded-2xl border border-emerald-500/30 flex flex-col items-center justify-center gap-3 shadow-[inset_0_0_30px_rgba(16,185,129,0.1)] relative overflow-hidden group",children:[i.jsx("div",{className:"absolute inset-0 opacity-10 mix-blend-overlay pointer-events-none",style:{backgroundImage:"radial-gradient(circle, #fff 1px, transparent 1px)",backgroundSize:"20px 20px"}}),i.jsx("span",{className:"text-emerald-400/80 text-xs font-bold uppercase tracking-[0.2em] relative z-10",children:"  "}),i.jsx("div",{className:"relative z-10 flex items-center justify-center w-full",children:i.jsx("input",{type:"number",value:s,onChange:p=>a(p.target.value),className:"w-full bg-transparent text-center text-5xl sm:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-b from-emerald-400 to-emerald-600 drop-shadow-[0_0_15px_rgba(16,185,129,0.4)] outline-none",autoFocus:!0})}),i.jsx("p",{className:"text-[10px] text-gray-500 mt-2 font-black uppercase tracking-widest",children:"      "})]}),i.jsx("p",{className:"text-gray-400 text-sm leading-relaxed text-center font-medium",children:'    .         " ".'})]}),i.jsxs("div",{className:"p-6 bg-[#121212]/80 backdrop-blur-sm flex gap-4 justify-between items-center border-t border-white/5 relative z-10",children:[i.jsx("button",{onClick:e,className:"px-6 py-3 text-sm font-bold text-gray-500 hover:text-white transition-colors hover:bg-white/5 rounded-xl disabled:opacity-50",disabled:d,children:""}),i.jsxs("button",{onClick:u,disabled:d,className:"relative flex-1 group overflow-hidden px-8 py-3.5 text-sm font-bold bg-gradient-to-r from-emerald-600 to-teal-700 text-white rounded-xl shadow-[0_4px_20px_rgba(16,185,129,0.4)] hover:shadow-[0_6px_30px_rgba(16,185,129,0.6)] transition-all duration-300 transform hover:scale-[1.02] active:scale-95 ring-1 ring-white/20 disabled:opacity-70",children:[i.jsx("div",{className:"absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 ease-in-out skew-x-12"}),i.jsxs("div",{className:"flex items-center justify-center gap-2 relative z-10",children:[i.jsx("span",{children:d?" ...":" "}),i.jsx(pg,{size:18,className:"transition-transform group-hover:-translate-x-1"})]})]})]})]},"payment-step")})})})})},em=[{id:"Bell",icon:Ms},{id:"DollarSign",icon:Go},{id:"Camera",icon:Ko},{id:"Monitor",icon:Om},{id:"Truck",icon:Im},{id:"Calendar",icon:zs},{id:"FileText",icon:$l},{id:"Gift",icon:gg},{id:"Heart",icon:Sm},{id:"Home",icon:Tm},{id:"Image",icon:uo},{id:"MapPin",icon:xg},{id:"Music",icon:yg},{id:"Phone",icon:Em},{id:"Star",icon:km},{id:"User",icon:qs},{id:"Video",icon:bg},{id:"Zap",icon:Pc},{id:"AlertTriangle",icon:Jo},{id:"Briefcase",icon:wg}],tm=({isOpen:t,onClose:e,onSubmit:n,initialType:r="general",initialData:s,initialTitle:a=""})=>{var D,O;const[c,l]=x.useState(""),[d,h]=x.useState(""),[m,u]=x.useState("general"),[p,w]=x.useState(void 0),[y,g]=x.useState(!1),N=x.useRef(null);if(x.useEffect(()=>{t&&(s?(l(s.title),h(s.dueDate),u(s.type),w(s.customIcon),g(!1)):(u(r),l(a),h(""),w(void 0),g(!1)))},[t,r,s,a]),!t)return null;const v=b=>{b.preventDefault(),c&&d&&(n(c,d,m,p),e())},C=[{id:"general",icon:i.jsx(Ms,{size:18}),color:"from-gray-500 to-gray-600",defaultIconName:"Bell"},{id:"payment",icon:i.jsx(Go,{size:18}),color:"from-green-500 to-emerald-600",defaultIconName:"DollarSign"},{id:"shooting",icon:i.jsx(Ko,{size:18}),color:"from-orange-500 to-red-500",defaultIconName:"Camera"},{id:"editing",icon:i.jsx(Om,{size:18}),color:"from-blue-500 to-indigo-600",defaultIconName:"Monitor"},{id:"delivery",icon:i.jsx(Im,{size:18}),color:"from-purple-500 to-violet-600",defaultIconName:"Truck"}],S=p||((D=C.find(b=>b.id===m))==null?void 0:D.defaultIconName)||"Bell",_=((O=em.find(b=>b.id===S))==null?void 0:O.icon)||Ms;return i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 transition-opacity duration-300",children:i.jsx(Ll,{nodeRef:N,handle:".modal-header",children:i.jsxs("div",{ref:N,className:"bg-[#1E1E1E] border border-white/10 w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-in fade-in duration-300 ring-1 ring-white/5",children:[i.jsxs("div",{className:"modal-header cursor-move bg-gradient-to-l from-[#262626] to-[#1E1E1E] p-6 flex items-center gap-4 border-b border-white/5",children:[i.jsx("div",{className:"p-3 bg-gradient-to-br from-[#F7931E] to-[#F9BE70] rounded-xl text-white shadow-[0_0_15px_rgba(247,147,30,0.3)]",children:i.jsx(Ms,{size:24})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"text-xl font-bold text-white",children:s?" ":" "}),i.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"    "})]}),i.jsx("button",{onClick:e,className:"text-gray-500 hover:text-white transition-colors",children:i.jsx(Jt,{size:24})})]}),i.jsxs("form",{onSubmit:v,className:"p-8 space-y-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"flex justify-between items-center",children:i.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest block",children:" "})}),i.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:C.map(b=>i.jsxs("button",{type:"button",onClick:()=>{u(b.id),s||w(void 0)},className:`relative group flex flex-col items-center justify-center gap-2 p-3 rounded-xl border transition-all duration-300 ${m===b.id?"bg-white/10 border-white/20 shadow-inner":"bg-black/20 border-white/5 hover:bg-white/5"}`,children:[i.jsx("div",{className:`h-8 w-8 rounded-full bg-gradient-to-br ${b.color} flex items-center justify-center text-white shadow-lg ${m===b.id?"scale-110":"scale-100 grayscale group-hover:grayscale-0"} transition-all duration-300`,children:b.icon}),i.jsx("span",{className:`text-xs font-bold ${m===b.id?"text-white":"text-gray-500 group-hover:text-gray-300"}`,children:Gx[b.id]}),m===b.id&&!p&&i.jsx("div",{className:"absolute top-2 left-2 text-[#F7931E]",children:i.jsx(Fi,{size:12})})]},b.id))})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest block",children:" "}),i.jsx("button",{type:"button",onClick:()=>g(!y),className:"text-xs font-bold text-[#F7931E] hover:underline",children:y?" ":" "})]}),y?i.jsx("div",{className:"grid grid-cols-6 gap-2 p-3 bg-black/20 rounded-xl border border-white/5 max-h-[120px] overflow-y-auto custom-scrollbar",children:em.map(b=>i.jsx("button",{type:"button",onClick:()=>w(b.id),className:`p-2 rounded-lg flex items-center justify-center transition-colors ${S===b.id?"bg-[#F7931E] text-white":"text-gray-400 hover:bg-white/10 hover:text-white"}`,title:b.id,children:i.jsx(b.icon,{size:18})},b.id))}):i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-black/20 rounded-xl border border-white/5",children:[i.jsx("div",{className:"p-2 bg-white/5 rounded-lg text-white",children:i.jsx(_,{size:20})}),i.jsxs("span",{className:"text-sm text-gray-400",children:[" : ",S]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest block",children:" / "}),i.jsx("input",{type:"text",value:c,onChange:b=>l(b.target.value),placeholder:m==="payment"?":   ":":    ",className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-[#F7931E]/50 focus:ring-1 focus:ring-[#F7931E]/50 transition-all"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest block",children:" "}),i.jsxs("div",{className:"relative",children:[i.jsx(zs,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),i.jsx("input",{type:"date",value:d,onChange:b=>h(b.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl pr-12 pl-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-[#F7931E]/50 focus:ring-1 focus:ring-[#F7931E]/50 transition-all [color-scheme:dark]"})]})]}),i.jsxs("div",{className:"pt-2 flex gap-4 justify-end border-t border-white/5 mt-4",children:[i.jsx("button",{type:"button",onClick:e,className:"px-6 py-3 text-sm font-semibold text-gray-400 hover:text-white transition-colors hover:bg-white/5 rounded-xl",children:""}),i.jsx("button",{type:"submit",disabled:!c||!d,className:"px-8 py-3 text-sm font-bold bg-gradient-to-r from-[#F7931E] to-[#F9BE70] text-white rounded-xl shadow-lg shadow-orange-500/30 hover:shadow-[0_0_20px_rgba(247,147,30,0.5)] transition-all duration-300 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed",children:s?" ":" "})]})]})]})})})},ZS=()=>{const t=x.useRef(null);return x.useEffect(()=>{const e=t.current;if(!e)return;const n=e.getContext("2d");if(!n)return;let r,s=[];const a=()=>{const h=Math.min(window.innerWidth/60,40);for(let m=0;m<h;m++)s.push({x:Math.random()*e.width,y:Math.random()*e.height,radius:Math.random()*2+.5,speed:Math.random()*.3+.1,wind:Math.random()*.5-.25,alpha:Math.random()*.5+.2})},c=()=>{e.width=window.innerWidth,e.height=window.innerHeight,s=[],a()},l=()=>{n.clearRect(0,0,e.width,e.height),s.forEach(h=>{n.beginPath(),n.fillStyle=`rgba(255, 255, 255, ${h.alpha})`,n.arc(h.x,h.y,h.radius,0,Math.PI*2),n.fill()}),d(),r=requestAnimationFrame(l)},d=()=>{s.forEach(h=>{h.y+=h.speed,h.x+=h.wind,h.x+=Math.sin(h.y*.005)*.1,h.y>e.height&&(h.y=-5,h.x=Math.random()*e.width),h.x>e.width?h.x=0:h.x<0&&(h.x=e.width)})};return window.addEventListener("resize",c),c(),l(),()=>{window.removeEventListener("resize",c),cancelAnimationFrame(r)}},[]),i.jsx(i.Fragment,{children:i.jsx("canvas",{ref:t,className:"fixed inset-0 pointer-events-none z-[999999]",style:{width:"100%",height:"100%"}})})},GS=()=>i.jsxs("div",{className:"fixed top-0 left-0 w-full h-full pointer-events-none z-[999998] overflow-hidden",children:[i.jsx(ve.div,{initial:{y:-100,rotate:5},animate:{y:[-10,0,-10],rotate:[5,-5,5]},transition:{duration:6,repeat:1/0,ease:"easeInOut"},className:"absolute top-0 right-[10%] w-24 h-auto opacity-90",children:i.jsxs("svg",{viewBox:"0 0 100 180",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"drop-shadow-[0_0_15px_rgba(251,191,36,0.6)]",children:[i.jsx("path",{d:"M50 0V20",stroke:"#F59E0B",strokeWidth:"2"}),i.jsx("path",{d:"M50 180V160",stroke:"#F59E0B",strokeWidth:"2"}),i.jsx("path",{d:"M30 20H70L80 40H20L30 20Z",fill:"#FBBF24",stroke:"#B45309",strokeWidth:"1.5"}),i.jsx("rect",{x:"20",y:"40",width:"60",height:"80",rx:"5",fill:"url(#lanternGradient)",stroke:"#B45309",strokeWidth:"1.5"}),i.jsx("path",{d:"M20 120H80L70 140H30L20 120Z",fill:"#FBBF24",stroke:"#B45309",strokeWidth:"1.5"}),i.jsx("circle",{cx:"50",cy:"80",r:"15",fill:"#FEF3C7",className:"animate-pulse"}),i.jsx("defs",{children:i.jsxs("linearGradient",{id:"lanternGradient",x1:"50",y1:"40",x2:"50",y2:"120",gradientUnits:"userSpaceOnUse",children:[i.jsx("stop",{stopColor:"#F59E0B"}),i.jsx("stop",{offset:"1",stopColor:"#D97706"})]})})]})}),i.jsx(ve.div,{initial:{y:-50,rotate:-3},animate:{y:[0,-15,0],rotate:[-3,3,-3]},transition:{duration:8,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute top-[-20px] left-[15%] w-16 h-auto opacity-80",children:i.jsxs("svg",{viewBox:"0 0 100 180",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"drop-shadow-[0_0_10px_rgba(251,191,36,0.4)]",children:[i.jsx("path",{d:"M50 0V20",stroke:"#F59E0B",strokeWidth:"2"}),i.jsx("path",{d:"M30 20H70L80 40H20L30 20Z",fill:"#FBBF24",stroke:"#B45309"}),i.jsx("rect",{x:"25",y:"40",width:"50",height:"70",rx:"5",fill:"url(#lanternGradient2)",stroke:"#B45309"}),i.jsx("path",{d:"M25 110H75L65 130H35L25 110Z",fill:"#FBBF24",stroke:"#B45309"}),i.jsx("circle",{cx:"50",cy:"75",r:"10",fill:"#FEF3C7",className:"animate-pulse"}),i.jsx("defs",{children:i.jsxs("linearGradient",{id:"lanternGradient2",x1:"50",y1:"40",x2:"50",y2:"110",gradientUnits:"userSpaceOnUse",children:[i.jsx("stop",{stopColor:"#F59E0B"}),i.jsx("stop",{offset:"1",stopColor:"#D97706"})]})})]})}),i.jsx(ve.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:2},className:"absolute top-10 right-[5%] w-24 h-24 opacity-20 rotate-[-15deg]",children:i.jsx("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M85 50C85 77.6142 62.6142 100 35 100C30.2 100 25.5 99.2 21 97.8C42 93 58 74 58 50C58 26 42 7 21 2.2C25.5 0.8 30.2 0 35 0C62.6142 0 85 22.3858 85 50Z",fill:"#FCD34D"})})})]}),KS=()=>{const t=x.useRef(null);return x.useEffect(()=>{const e=t.current;if(!e)return;const n=e.getContext("2d");if(!n)return;let r;const s=[],a=["#FCD34D","#F59E0B","#FBBF24","#FFFFFF"],c=()=>{s.length>50||s.push({x:Math.random()*e.width,y:Math.random()*e.height,size:Math.random()*2+.5,speedX:(Math.random()-.5)*.2,speedY:(Math.random()-.5)*.2,life:0,maxLife:Math.random()*100+50,color:a[Math.floor(Math.random()*a.length)]})},l=()=>{e.width=window.innerWidth,e.height=window.innerHeight},d=(m,u,p,w,y,g,N)=>{let v=Math.PI/2*3,C=m,S=u;const _=Math.PI/p;n.beginPath(),n.moveTo(m,u-w);for(let D=0;D<p;D++)C=m+Math.cos(v)*w,S=u+Math.sin(v)*w,n.lineTo(C,S),v+=_,C=m+Math.cos(v)*y,S=u+Math.sin(v)*y,n.lineTo(C,S),v+=_;n.lineTo(m,u-w),n.closePath(),n.fillStyle=g,n.globalAlpha=N,n.fill(),n.globalAlpha=1},h=()=>{n.clearRect(0,0,e.width,e.height),Math.random()<.1&&c(),s.forEach((m,u)=>{m.life++,m.x+=m.speedX,m.y+=m.speedY;const p=1-Math.abs(m.life-m.maxLife/2)/(m.maxLife/2);m.life>=m.maxLife?s.splice(u,1):d(m.x,m.y,4,m.size*2,m.size/2,m.color,p)}),r=requestAnimationFrame(h)};return window.addEventListener("resize",l),l(),h(),()=>{window.removeEventListener("resize",l),cancelAnimationFrame(r)}},[]),i.jsx("canvas",{ref:t,className:"fixed inset-0 pointer-events-none z-[999997]",style:{width:"100%",height:"100%"}})},jd="app_notifications",YS=()=>{const[t,e]=x.useState(!1),[n,r]=x.useState([]),s=x.useCallback(()=>{try{const p=JSON.parse(localStorage.getItem(jd)||"[]"),y=(JSON.parse(localStorage.getItem("user")||"{}").role||"").toLowerCase(),g=p.filter(N=>!N.targetRoles||N.targetRoles.length===0||N.targetRoles.includes(y));r(g)}catch{r([])}},[]);x.useEffect(()=>{s();const p=()=>s();return window.addEventListener("app:notification",p),()=>window.removeEventListener("app:notification",p)},[s]);const a=n.filter(p=>!p.read).length,c=p=>{try{const w=JSON.parse(localStorage.getItem(jd)||"[]"),y=new Map(p.map(v=>[v.id,v])),g=new Set(n.filter(v=>!p.some(C=>C.id===v.id)).map(v=>v.id)),N=w.filter(v=>!g.has(v.id)).map(v=>y.get(v.id)||v);localStorage.setItem(jd,JSON.stringify(N))}catch{}},l=p=>{r(w=>{const y=w.map(g=>g.id===p?{...g,read:!0}:g);return c(y),y})},d=()=>{r(p=>{const w=p.map(y=>({...y,read:!0}));return c(w),w})},h=(p,w)=>{w.stopPropagation(),r(y=>{const g=y.filter(N=>N.id!==p);return c(g),g})},m=p=>{try{const w=Date.now()-new Date(p).getTime(),y=Math.floor(w/6e4);if(y<1)return"";if(y<60)return` ${y} `;const g=Math.floor(y/60);return g<24?` ${g} `:` ${Math.floor(g/24)} `}catch{return p}},u=p=>{switch(p){case"success":return"bg-emerald-500";case"warning":return"bg-amber-500";case"error":return"bg-rose-500";case"nas_cleanup":return"bg-orange-500";case"r2_cleanup":return"bg-sky-500";default:return"bg-blue-500"}};return i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:()=>e(!t),className:"relative w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center transition-all group",children:[i.jsx(Ms,{size:18,className:"text-gray-400 group-hover:text-white transition-colors"}),a>0&&i.jsx("span",{className:"absolute top-2 right-2.5 w-2 h-2 bg-rose-500 rounded-full border border-[#1e1e24]",children:i.jsx("span",{className:"absolute inline-flex h-full w-full rounded-full bg-rose-400 opacity-75 animate-ping"})})]}),t&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>e(!1)}),i.jsxs("div",{className:"absolute top-full left-0 mt-2 w-80 bg-[#1e1e24] border border-white/10 rounded-2xl shadow-2xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 origin-top-left",children:[i.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-between bg-white/5",children:[i.jsx("h3",{className:"text-sm font-bold text-white",children:""}),a>0&&i.jsx("button",{onClick:d,className:"text-[10px] text-cyan-400 hover:text-cyan-300 font-medium",children:"  "})]}),i.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar",children:n.length===0?i.jsx("div",{className:"p-8 text-center text-gray-500 text-xs",children:"   "}):i.jsx("div",{className:"divide-y divide-white/5",children:n.map(p=>i.jsx("div",{onClick:()=>l(p.id),className:`p-4 hover:bg-white/5 transition-colors cursor-pointer relative group ${p.read?"opacity-60":"bg-white/2"}`,children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:`mt-0.5 w-2 h-2 rounded-full shrink-0 ${u(p.type)}`}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex justify-between items-start mb-0.5",children:[i.jsx("p",{className:`text-xs font-bold ${p.read?"text-gray-400":"text-white"}`,children:p.title}),i.jsx("span",{className:"text-[9px] text-gray-600 font-mono",children:m(p.time)})]}),i.jsx("p",{className:"text-[10px] text-gray-500 leading-relaxed line-clamp-2",children:p.message})]}),i.jsx("button",{onClick:w=>h(p.id,w),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-white/10 rounded text-gray-500 hover:text-white transition-all absolute top-2 left-2",children:i.jsx(Jt,{size:12})})]})},p.id))})}),i.jsx("div",{className:"p-2 border-t border-white/5 bg-white/5 text-center",children:i.jsx("button",{className:"text-[10px] text-gray-400 hover:text-white transition-colors",children:"  "})})]})]})]})},XS=({title:t="",currentUser:e,onLogout:n})=>i.jsxs("header",{className:"h-16 flex items-center justify-between px-6 bg-[#121212]/80 backdrop-blur-md border-b border-white/5 sticky top-0 z-30",children:[i.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[i.jsx("div",{className:"p-1.5 bg-white/5 rounded-lg text-gray-400",children:i.jsx(Tm,{size:16})}),i.jsx(_m,{size:14,className:"text-gray-600"}),i.jsx("span",{className:"font-bold text-white",children:t})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(zm,{theme:"reception"}),i.jsx("div",{className:"w-px h-4 bg-white/10"}),i.jsx("div",{className:"relative z-50",children:i.jsx(YS,{})})]})]}),ek=({children:t,className:e="",isDraggable:n=!1,isReception:r=!0,isManager:s=!1,allowOverflow:a=!1,hideBackground:c=!1,noPadding:l=!1,currentUser:d,onLogout:h})=>{const m=s;return i.jsxs("div",{className:`h-full ${c?"bg-transparent shadow-none":m?"bg-[#1a1c22]":r?"bg-[#121212]":"bg-[#1e1e24]"} ${c?"rounded-none":m?"rounded-xl":r?"rounded-[3rem]":"rounded-3xl"} ${c?"":"shadow-[inset_0_4px_20px_rgba(0,0,0,0.9)]"} ${a?"":"overflow-hidden"} flex flex-col relative ${e}`,dir:"rtl",children:[!c&&i.jsx("div",{className:`absolute inset-0 bg-linear-to-br ${m?"from-orange-500/10":r?"from-[#C94557]/5":"from-pink-500/5"} via-transparent to-gray-800/3 pointer-events-none z-0`}),n&&i.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-[0.03] z-0",style:{backgroundImage:"radial-gradient(circle, #FF5722 1px, transparent 1px)",backgroundSize:"40px 40px"}}),i.jsxs("div",{className:`flex-1 min-h-0 ${a?"":"overflow-hidden"} relative z-10 flex flex-col`,children:[r&&!s&&i.jsx(XS,{title:"",currentUser:d,onLogout:h||(()=>{})}),i.jsx("div",{className:`flex-1 ${l?"p-0":"p-4"} ${a?"":"overflow-hidden"}`,children:t})]})]})},nm=t=>t.trim().replace(/\/+$/,""),tk="https://villahadad.org",nk=()=>{const t="".trim();return t?nm(t):typeof window<"u"&&/^https?:\/\//.test(window.location.origin)?nm(window.location.origin):tk},rk=t=>{if(!t)return"";const e=nk(),n=`/select?token=${encodeURIComponent(t)}`;return e?`${e}${n}`:n};class sk{constructor(){this.LATE_THRESHOLD_HOUR=10,this.LATE_THRESHOLD_MINUTE=15}getTodayDateString(){return new Date().toISOString().split("T")[0]}async recordCheckIn(e){const n=this.getTodayDateString();if((await ge.selectFrom("daily_attendance").selectAll().where("userId","=",e.id).where("date","=",n).execute()).length>0){console.log(" Attendance: Already checked in for today.");return}const s=new Date;let a="Present";const c=new Date;c.setHours(this.LATE_THRESHOLD_HOUR,this.LATE_THRESHOLD_MINUTE,0,0),s>c&&(a="Late");const l={id:Mt(),userId:e.id,userName:e.name,date:n,checkIn:s.toISOString(),checkOut:s.toISOString(),status:a,totalHours:0,isFrozen:!1,createdAt:s.toISOString(),updatedAt:s.toISOString()};console.log(` Attendance: Checking In as ${a} at ${s.toLocaleTimeString()}`),await ge.insertInto("daily_attendance").values({...l,isFrozen:l.isFrozen?1:0}).execute(),await qn.logAction("check_in","attendance",l.id,`Checked In (${a})`),this.syncToCloud(l)}async recordCheckOut(e){const n=this.getTodayDateString(),r=await ge.selectFrom("daily_attendance").selectAll().where("userId","=",e).where("date","=",n).executeTakeFirst();if(!r)return;const s=new Date,a=new Date(r.checkIn||s.toISOString()),c=s.getTime()-a.getTime(),l=Number((c/(1e3*60*60)).toFixed(2)),d=s.toISOString();await ge.updateTable("daily_attendance").set({checkOut:d,totalHours:l,updatedAt:d}).where("id","=",r.id).execute(),console.log(` Attendance: Updated Check Out to ${s.toLocaleTimeString()}`),this.syncUpdateToCloud(r.id,{check_out:d,total_hours:l,updated_at:d})}async getAttendanceForToday(){const e=this.getTodayDateString();try{return(await ge.selectFrom("daily_attendance").selectAll().where("date","=",e).execute()).map(r=>({id:r.id,userId:r.userId,userName:r.userName,date:r.date,checkIn:r.checkIn||void 0,checkOut:r.checkOut||void 0,status:r.status,totalHours:r.totalHours||0,isFrozen:!!r.isFrozen,createdAt:r.createdAt,updatedAt:r.updatedAt}))}catch(n){return console.error("Attendance Fetch Error:",n),[]}}async syncToCloud(e){const n={id:e.id,user_id:e.userId,user_name:e.userName,date:e.date,check_in:e.checkIn,check_out:e.checkOut,status:e.status,total_hours:e.totalHours,is_frozen:e.isFrozen,created_at:e.createdAt,updated_at:e.updatedAt};if(navigator.onLine){const{error:r}=await H.from("daily_attendance").insert(n);r&&await yt.enqueue("create","attendance",n)}else await yt.enqueue("create","attendance",n)}async syncUpdateToCloud(e,n){if(navigator.onLine){const{error:r}=await H.from("daily_attendance").update(n).eq("id",e);r&&await yt.enqueue("update","attendance",{id:e,...n})}else await yt.enqueue("update","attendance",{id:e,...n})}}const rm=new sk;class ik{constructor(){this.onlineUsers=[],this.callbacks=[],this.currentUser=null,this.isConnected=!1,this.init()}init(){}async join(e){var n;this.isConnected&&((n=this.currentUser)==null?void 0:n.id)===e.id||(this.currentUser=e,this.channel&&await this.leave(),this.channel=H.channel("online-users",{config:{presence:{key:e.id}}}),this.channel.on("presence",{event:"sync"},()=>{const r=this.channel.presenceState();this.updateOnlineUsers(r)}).on("presence",{event:"join"},({key:r,newPresences:s})=>{console.log("User joined:",r,s)}).on("presence",{event:"leave"},({key:r,leftPresences:s})=>{console.log("User left:",r,s)}).subscribe(async r=>{r==="SUBSCRIBED"&&(this.isConnected=!0,await this.channel.track({id:e.id,name:e.name,role:e.role,avatar:e.avatar,online_at:new Date().toISOString()}),console.log(` Realtime Presence: Joined as ${e.name}`))}))}async leave(){this.channel&&(await this.channel.unsubscribe(),this.channel=null,this.isConnected=!1,this.currentUser=null,console.log(" Realtime Presence: Disconnected"))}subscribe(e){return this.callbacks.push(e),this.onlineUsers.length>0&&e(this.onlineUsers),()=>{this.callbacks=this.callbacks.filter(n=>n!==e)}}updateOnlineUsers(e){const n=[];Object.values(e).forEach(r=>{r.forEach(s=>{n.find(a=>a.id===s.id)||n.push({id:s.id,name:s.name,role:s.role,avatar:s.avatar})})}),this.onlineUsers=n,this.notifySubscribers()}notifySubscribers(){this.callbacks.forEach(e=>e(this.onlineUsers))}getOnlineUsers(){return this.onlineUsers}}const sm=new ik,v0=x.createContext(void 0);function ok({children:t}){const[e,n]=x.useState(void 0),[r,s]=x.useState([]);x.useEffect(()=>{let h=!0;(async()=>{try{const w=await Y.getUsers();h&&(s(w),console.log(` Loaded ${w.length} users`))}catch(w){console.error("Failed to load users:",w)}})();const u=H.channel("users-realtime-sync").on("postgres_changes",{event:"*",schema:"public",table:"users"},async w=>{console.log(" Real-time user change:",w.eventType);const y=await Y.getUsers();if(h&&(s(y),n(g=>{if(!g)return;const N=y.find(v=>v.id===g.id);return N&&JSON.stringify(N)!==JSON.stringify(g)?N:g}),w.eventType==="INSERT"&&w.new)){const g=w.new;z.success(`  : ${g.name||" "}`)}}).subscribe(w=>{console.log(" Users real-time subscription:",w)}),p=Y.subscribe(async w=>{if(w==="users_updated"&&h){const y=await Y.getUsers();s(g=>{const N=JSON.parse(JSON.stringify(y));return JSON.stringify(g)!==JSON.stringify(N)?N:g}),n(g=>{if(!g)return;const N=y.find(v=>v.id===g.id);return N&&JSON.stringify(N)!==JSON.stringify(g)?N:g})}});return()=>{h=!1,H.removeChannel(u),p()}},[]);const d={currentUser:e,users:r,login:async(h,m)=>{let u=m?r.find(p=>p.id===m):null;if(u||(u=r.find(p=>p.role===h)),u){const p={...u};if(!p.name||p.name==="undefined"){const w=xn[h]||h;p.name=`User (${w})`,console.warn("LOGIN_RESCUE: User had no name, allocated fallback:",p.name)}n(p),yn.setCurrentUser(p.id);try{await sm.join(p)}catch(w){console.error("Presence Join Failed",w)}try{Y.initRealtimeSync()}catch(w){console.error("Real-time sync init failed:",w)}try{await rm.recordCheckIn({id:p.id,name:p.name}),z.success("   ")}catch(w){console.error("Attendance Check-In Failed",w)}z.success(` : ${xn[h]}`),yn.pushChanges()}else{const p={id:`temp_${h}`,name:xn[h]||h,role:h,avatar:""};n(p),yn.setCurrentUser(p.id),z.success(` : ${xn[h]}`)}},logout:async()=>{if(e)try{await sm.leave(),await rm.recordCheckOut(e.id),console.log("Attendance Check-Out Recorded")}catch(h){console.error("Attendance Check-Out Failed",h)}n(void 0)},updateUser:async(h,m)=>{try{const u=await Y.updateUser(h,m);s(p=>p.map(w=>w.id===h?u:w)),e&&e.id===h&&n(u)}catch(u){throw console.error(u),z.error("Failed to update user"),u}},isAuthenticated:!!e};return i.jsx(v0.Provider,{value:d,children:t})}function N0(){const t=x.useContext(v0);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const ak=N0;class ck{static async fetchPendingConflicts(){const{data:e,error:n}=await H.from("conflicts").select(`
                *,
                bookings (
                    client_name,
                    shoot_date,
                    title
                )
            `).eq("status","PENDING").order("created_at",{ascending:!1});return n?(console.error(" Failed to fetch conflicts:",n),[]):e||[]}static async resolveConflict(e,n,r){const{data:s,error:a}=await H.from("conflicts").select("*").eq("id",e).single();if(a||!s)throw new Error("Conflict record not found");if(n==="ACCEPT"){const l=s.proposed_data;l.last_editor_rank="MANAGER",l.updated_by_name=`${l.updated_by_name} (Approved by ${r})`;const{error:d}=await H.from("bookings").upsert(l);if(d)throw d}const{error:c}=await H.from("conflicts").update({status:n==="ACCEPT"?"RESOLVED":"REJECTED",resolved_by:r,resolved_at:new Date().toISOString()}).eq("id",e);if(c)throw c}}const lk=(t,e,n)=>{if(!n)return{};const r={};switch(n.role){case ee.RECEPTION:const s=t.filter(p=>p.status===me.INQUIRY||p.status===me.CONFIRMED).length;r["section-bookings"]=s;const a=new Date().toISOString().split("T")[0],c=t.filter(p=>{var w;return(w=p.shootDate)==null?void 0:w.startsWith(a)}).length;c>0&&(r["section-calendar"]=c);break;case ee.MANAGER:r["section-team-chat"]=0;const l=t.filter(p=>p.paidAmount<p.totalAmount).length;l>0&&(r["section-financial"]=l);break;case ee.PRINTER:const d=t.filter(p=>p.status===me.READY_TO_PRINT).length;d>0&&(r["section-home"]=d);break;case ee.PHOTO_EDITOR:const h=t.filter(p=>(p.status===me.SELECTION||p.status===me.EDITING)&&p.assignedPhotoEditor===n.id).length;h>0&&(r["section-gallery"]=h);break;case ee.VIDEO_EDITOR:const m=t.filter(p=>(p.status===me.SHOOTING||p.status===me.EDITING)&&p.assignedVideoEditor===n.id).length;m>0&&(r["section-projects"]=m);break;case ee.SELECTOR:const u=t.filter(p=>p.status===me.SELECTION).length;u>0&&(r["section-home"]=u);break;case ee.ADMIN:break}return r};function Ed(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function dk(t,e,n){const r=x.useRef(e);r.current=e;const s=x.useCallback(()=>{const a=new Date,c=iy*6e4,l=new Date(a.getTime()+c);t.forEach(d=>{var w;if(d.status!==me.CONFIRMED||!d.shootDate)return;const h=new Date(d.shootDate);if((w=d.details)!=null&&w.startTime){const[y,g]=String(d.details.startTime).split(":").map(Number);!isNaN(y)&&!isNaN(g)&&h.setHours(y,g,0,0)}if(h<=a||h>l)return;const m=`reminder-${d.id}`;if(r.current.some(y=>y.id===m||y.message.includes(d.clientName)))return;const p={id:m,title:"  ",message:`   ${d.clientName} (${d.title}).      `,time:"",read:!1,type:"workflow_reminder"};n(y=>[p,...y]),z("    !",{icon:""})})},[t,n]);x.useEffect(()=>{s();const a=setInterval(s,sy);return()=>clearInterval(a)},[s])}const S0=x.createContext(void 0);function uk({children:t}){const{currentUser:e,users:n}=N0(),[r,s]=x.useState([]),[a,c]=x.useState([]),[l,d]=x.useState([]),[h,m]=x.useState(!navigator.onLine),[u,p]=x.useState(!1),[w,y]=x.useState(!1),g=x.useRef(!0),N=x.useRef([]),v=T.useMemo(()=>lk(r,n||[],e),[r,n,e]);x.useEffect(()=>{(async()=>{console.log("[DataProvider]  Starting data load...");const b=Date.now();try{console.log("[DataProvider]  Step 1: Initializing database schema...");const{initDB:A}=await fe(async()=>{const{initDB:V}=await import("./schema-CAZKW4R0.js");return{initDB:V}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);await A(),console.log(`[DataProvider]  initDB completed (${Date.now()-b}ms)`),console.log("[DataProvider]  Step 2: Seeding database...");const{seedDatabase:q}=await fe(async()=>{const{seedDatabase:V}=await import("./seed-Bf6FwK0s.js");return{seedDatabase:V}},__vite__mapDeps([5,1,2,3,4]),import.meta.url);await q(),console.log(`[DataProvider]  seedDatabase completed (${Date.now()-b}ms)`),console.log("[DataProvider]  Step 2.5: Initializing SyncManager..."),yn.init(),console.log(`[DataProvider]  SyncManager initialized (${Date.now()-b}ms)`),console.log("[DataProvider]  Step 3: Loading dashboard tasks...");const I=await Y.getDashboardTasks();c(I),console.log(`[DataProvider]  Loaded ${I.length} tasks (${Date.now()-b}ms)`),console.log("[DataProvider]  Step 4: Loading bookings...");const M=await Y.getBookings();s(M),N.current=M,console.log(`[DataProvider]  Loaded ${M.length} bookings (${Date.now()-b}ms)`),console.log(`[DataProvider]  All data loaded successfully in ${Date.now()-b}ms`)}catch(A){console.error("[DataProvider]  Failed to load data:",A),fr.error("Failed to load data",A)}})()},[]),x.useEffect(()=>{const O=Y.subscribe(async b=>{if(fr.debug("Received sync event",{event:b}),b==="bookings_updated"){const A=await Y.getBookings();s(q=>Ed(q,A)?q:(N.current=A,A))}else if(b==="tasks_updated"){const A=await Y.getDashboardTasks();c(q=>Ed(q,A)?q:A)}});return()=>O()},[]),x.useEffect(()=>{console.log("[DataProvider]  Setting up SyncManager listener...");const O=yn.onSync(async(b,A)=>{if(console.log(`[DataProvider]  SyncManager event: ${b}`,A),b==="booking:created"||b==="booking:updated"||b==="booking:deleted"){const q=await Y.getBookings();s(I=>Ed(I,q)?I:(N.current=q,console.log(`[DataProvider]  Updated bookings from cloud sync: ${q.length} items`),q)),b==="booking:created"&&z.success("     ",{duration:3e3})}});return()=>O()},[]),x.useEffect(()=>{const O=async()=>{var q;const A=window.electronAPI;if((q=A==null?void 0:A.db)!=null&&q.getStatus)try{const I=await A.db.getStatus(),M=u;!I.postgres!==u&&(p(!I.postgres),g.current||(!I.postgres&&!M?z.warning("    -   "):I.postgres&&M&&z.success("   "))),g.current=!1}catch{!g.current&&!u&&z.warning("    -   "),u||p(!0),g.current=!1}else u&&p(!1),g.current=!1};O();const b=setInterval(O,5e3);return()=>clearInterval(b)},[u]),x.useEffect(()=>{const O=q=>{const I=q.detail||{};I.failed>0&&(z.error(`  ${I.failed} `,{duration:5e3}),((e==null?void 0:e.role)==="manager"||(e==null?void 0:e.role)==="admin")&&y(!0))},b=()=>{m(!1),z.success("    "),yn.pushChanges()},A=()=>{m(!0),z.error("  -     ")};return window.addEventListener("sync-complete",O),window.addEventListener("online",b),window.addEventListener("offline",A),()=>{window.removeEventListener("sync-complete",O),window.removeEventListener("online",b),window.removeEventListener("offline",A)}},[e]),x.useEffect(()=>{if(!e||e.role!=="manager"&&e.role!=="admin")return;const O=async()=>{try{const A=await ck.fetchPendingConflicts();A.length>0&&!w&&(z.error(` ${A.length}   !  .`,{duration:5e3}),y(!0))}catch{}};O();const b=setInterval(O,6e4);return()=>clearInterval(b)},[e,w]),dk(r,l,d);const D={bookings:r,dashboardTasks:a,notifications:l,isOffline:h,isPostgresOffline:u,conflictMode:w,setConflictMode:y,updateBooking:async(O,b)=>{var M,V,de;const A=r.find(X=>X.id===O),q=A==null?void 0:A.status,I=b.status;if(s(X=>X.map(he=>he.id===O?{...he,...b}:he)),A&&q===me.SHOOTING&&I===me.SELECTION)if(((M=A.servicePackage)==null?void 0:M.includes(""))||((V=A.servicePackage)==null?void 0:V.includes("External"))||((de=A.location)==null?void 0:de.toLowerCase().includes("external")))console.log(" Skipped folder creation for external booking");else try{const ie=await(await fetch("http://localhost:3000/api/media/create-folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingDate:A.shootDate,clientName:A.clientName,category:A.category})})).json();ie.success?(z.success(`    ${A.clientName}   `),s(P=>P.map(J=>J.id===O?{...J,folderPath:ie.path}:J))):z.error("   ")}catch(he){console.error("Auto folder creation error:",he),z.error("    ")}},addBooking:O=>{s(b=>[O,...b])},deleteBooking:O=>{s(b=>b.filter(A=>A.id!==O))},notificationBadges:v};return i.jsx(S0.Provider,{value:D,children:t})}function hk(){const t=x.useContext(S0);if(t===void 0)throw new Error("useData must be used within a DataProvider");return t}const $u=()=>{const[t,e]=T.useState(0);return T.useEffect(()=>{const n=setInterval(()=>{e(r=>r+1)},1e3);return()=>clearInterval(n)},[]),i.jsx("div",{className:"h-screen w-full flex flex-col items-center justify-center bg-[#09090b]",children:i.jsxs("div",{className:"flex flex-col items-center gap-4",children:[i.jsx(vg,{className:"w-10 h-10 text-white animate-spin"}),i.jsx("p",{className:"text-gray-400 text-sm font-medium animate-pulse",children:"  ..."}),i.jsxs("p",{className:"text-gray-600 text-xs",children:[" ",t," "]})]})})},fk=T.lazy(()=>fe(()=>import("./ManagerLayout-DdAGI23C.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),mk=T.lazy(()=>fe(()=>import("./ManagerDashboard-BzqbmZq8.js"),__vite__mapDeps([7,1,8,2,9,10,4,11,3]),import.meta.url)),pk=T.lazy(()=>fe(()=>import("./ManagerClientsView-mHlHKH7d.js"),__vite__mapDeps([12,1,13,10,14,2,15,16,8,17,4,3]),import.meta.url)),gk=T.lazy(()=>fe(()=>import("./ManagerTeamView-BsQ4kTCV.js"),__vite__mapDeps([18,1,8,2,19,3,4]),import.meta.url)),xk=T.lazy(()=>fe(()=>import("./ManagerGalleryView-ZL4L7Dlj.js"),__vite__mapDeps([20,1,2,3,4]),import.meta.url)),yk=T.lazy(()=>fe(()=>import("./ManagerBookingDetailsView-xi-0oFn1.js"),__vite__mapDeps([21,1,15,2,4,3]),import.meta.url)),bk=T.lazy(()=>fe(()=>import("./AdminLayout-B9gBmglZ.js"),__vite__mapDeps([22,1,23,2,3,4]),import.meta.url)),wk=T.lazy(()=>fe(()=>import("./DashboardOverview-Bh3z-jCZ.js"),__vite__mapDeps([24,1,2,3,4]),import.meta.url)),vk=T.lazy(()=>fe(()=>import("./AdminClientsListView-DRfcUCK-.js"),__vite__mapDeps([25,1,2,4,3]),import.meta.url)),Nk=T.lazy(()=>fe(()=>import("./AdminFinancialView-dSBsTRXQ.js"),__vite__mapDeps([26,1,2,3,4]),import.meta.url)),Sk=T.lazy(()=>fe(()=>import("./AdminSystemView-A2StsLTD.js"),__vite__mapDeps([27,1,2,3,4]),import.meta.url)),kk=T.lazy(()=>fe(()=>import("./ConflictResolutionView-CvlM6q40.js"),__vite__mapDeps([28,1,2,3,4]),import.meta.url)),jk=T.lazy(()=>fe(()=>import("./AdminAuditView-BJQmH90j.js"),__vite__mapDeps([29,1,2]),import.meta.url)),Ek=T.lazy(()=>fe(()=>import("./WorkflowManagerView-DSb2r88O.js"),__vite__mapDeps([30,1,2,4,3]),import.meta.url)),Ck=T.lazy(()=>fe(()=>import("./AdminSentinelView-z4il5wlk.js"),__vite__mapDeps([31,1,2,9,10,32,3,4]),import.meta.url)),_k=T.lazy(()=>fe(()=>import("./AdminHRView-BVHBX5Ln.js"),__vite__mapDeps([33,1,19,2,3,4]),import.meta.url)),Ok=T.lazy(()=>fe(()=>import("./AdminInventoryView-DngpbRkf.js"),__vite__mapDeps([34,1,2,3,4]),import.meta.url)),Ik=T.lazy(()=>fe(()=>import("./AdminWarRoomView-CnM6KPYX.js"),__vite__mapDeps([35,1,2,3,4]),import.meta.url)),Tk=T.lazy(()=>fe(()=>import("./AdminGeniusDashboard-DgAcBQKd.js"),__vite__mapDeps([36,1,2,3,4]),import.meta.url)),Ak=T.lazy(()=>fe(()=>import("./DeletedBookingsView-w2ynIuAs.js"),__vite__mapDeps([37,1,2,3,4]),import.meta.url)),Dk=T.lazy(()=>fe(()=>import("./ReceptionSidebar-HxZqWZsI.js"),__vite__mapDeps([38,1,23,2,3,4]),import.meta.url)),Pk=T.lazy(()=>fe(()=>import("./ReceptionDashboard-Dsx8YEnX.js"),__vite__mapDeps([39,1,2,15,3,4]),import.meta.url)),Rk=T.lazy(()=>fe(()=>import("./ReceptionClientsView-C47VWlCu.js"),__vite__mapDeps([40,1,14,2,15,17,4,3]),import.meta.url)),Lk=T.lazy(()=>fe(()=>import("./ReceptionBookingsView-DJIy0PLq.js"),__vite__mapDeps([41,1,2,3,4]),import.meta.url)),$k=T.lazy(()=>fe(()=>import("./ReceptionFinancialView-C2f5fXgI.js"),__vite__mapDeps([42,1,14,2,43,44,3,4]),import.meta.url)),Mk=T.lazy(()=>fe(()=>import("./ReceptionGalleryView-C40mFtsr.js"),__vite__mapDeps([45,1,2,3,4]),import.meta.url)),zk=T.lazy(()=>fe(()=>import("./PhotoEditorLayout-x4D6GvEm.js"),__vite__mapDeps([46,1,23,2,47,3,4]),import.meta.url)),Bk=T.lazy(()=>fe(()=>import("./PhotoEditorDashboard-CVgswIAP.js"),__vite__mapDeps([48,1,2,49,43,3,4]),import.meta.url)),Fk=T.lazy(()=>fe(()=>import("./PhotoEditorGalleryView-g24nUSg3.js"),__vite__mapDeps([50,1,2,3,4]),import.meta.url)),Wk=T.lazy(()=>fe(()=>import("./VideoEditorLayout-1phYADRS.js"),__vite__mapDeps([51,1,23,2,47,3,4]),import.meta.url)),Uk=T.lazy(()=>fe(()=>import("./VideoEditorDashboard-DIDqc8L6.js"),__vite__mapDeps([52,1,2,3,4]),import.meta.url)),qk=T.lazy(()=>fe(()=>import("./PrinterLayout-DpZV42fC.js"),__vite__mapDeps([53,1,23,2,47,3,4]),import.meta.url)),Vk=T.lazy(()=>fe(()=>import("./PrinterDashboard-M3UFC0Jy.js"),__vite__mapDeps([54,1,2,49,43,3,4]),import.meta.url)),ba=T.lazy(()=>fe(()=>import("./UnifiedTeamChat-C4pUsPfK.js"),__vite__mapDeps([49,1,43,2,3,4]),import.meta.url)),Qk=T.lazy(()=>fe(()=>import("./SelectionLayout-BAqQAoi5.js"),__vite__mapDeps([55,1,23,2,3,4]),import.meta.url)),Hk=T.lazy(()=>fe(()=>import("./SelectionDashboard-BS6PVPHy.js"),__vite__mapDeps([56,1,49,43,2,3,4]),import.meta.url)),Jk=T.lazy(()=>fe(()=>import("./WorkflowView-WAJwU9sY.js"),__vite__mapDeps([57,1,13,10,2,4,3]),import.meta.url)),Zk=T.lazy(()=>fe(()=>import("./ClientPortal-CZASAAEX.js"),__vite__mapDeps([58,1,2,3,4]),import.meta.url)),Gk=T.lazy(()=>fe(()=>import("./ManagerFinancialView-DI45iXno.js").then(t=>t.M),__vite__mapDeps([59,1,9,10,32,13,4,2,60,16,3,44,43]),import.meta.url)),Kk=T.lazy(()=>fe(()=>import("./ManagerAccountsView-BD3H48gB.js"),__vite__mapDeps([60,1,16,13,10,2,9,32,4,3]),import.meta.url)),Cd="villahaddad_lastLoggedInUserId",wa={getLastUserId:()=>{try{return localStorage.getItem(Cd)}catch{return null}},setLastUserId:t=>{try{localStorage.setItem(Cd,t)}catch(e){console.warn("Failed to save device user:",e)}},clearLastUserId:()=>{try{localStorage.removeItem(Cd)}catch(t){console.warn("Failed to clear device user:",t)}}};function Yk(){x.useEffect(()=>{(async()=>{try{const r=window.electronAPI;if(r!=null&&r.getSystemInfo){const s=await r.getSystemInfo();s.platform==="darwin"&&s.arch==="x64"?(console.log(" Performance Mode: Enabled (Intel Mac detected)"),document.documentElement.classList.add("performance-mode")):console.log(" Performance Mode: Disabled (ARM/Modern system)")}}catch(r){console.warn("Could not detect system architecture:",r)}})()},[]),x.useEffect(()=>{var s,a;const n=window.electronAPI,r=(a=(s=n==null?void 0:n.sessionLifecycle)==null?void 0:s.onAppNotification)==null?void 0:a.call(s,c=>{try{const l=JSON.parse(localStorage.getItem("app_notifications")||"[]");l.unshift(c),l.length>50&&(l.length=50),localStorage.setItem("app_notifications",JSON.stringify(l))}catch{}window.dispatchEvent(new CustomEvent("app:notification",{detail:c}))});return()=>{r==null||r()}},[]);const[t,e]=x.useState(!1);return x.useEffect(()=>{const n=window.location.pathname,r=window.location.hash,s=new URLSearchParams(window.location.search);console.log(" Checking Route:",{path:n,hash:r}),(n.startsWith("/select")||n.startsWith("/client-portal")||n.startsWith("/view/")||n.startsWith("/gallery/")||s.has("token")||r.includes("/select")||r.includes("/client-portal")||r.includes("/view/")||r.includes("/gallery/"))&&e(!0)},[]),t?i.jsx(i.Fragment,{children:i.jsx(x.Suspense,{fallback:i.jsx($u,{}),children:i.jsx(Zk,{})})}):i.jsx(i.Fragment,{children:i.jsx(Hx,{name:"Main Application",children:i.jsx(x.Suspense,{fallback:i.jsx($u,{}),children:i.jsx(ok,{children:i.jsxs(uk,{children:[i.jsx(Xk,{}),i.jsx(Jx,{})]})})})})})}function Xk(){const{currentUser:t,users:e,login:n,logout:r,updateUser:s}=ak(),{bookings:a,dashboardTasks:c,notifications:l,isOffline:d,conflictMode:h,setConflictMode:m,notificationBadges:u}=hk(),[p,w]=x.useState("section-home"),[y,g]=x.useState(!1),[N,v]=x.useState(!0),[C,S]=x.useState(!1),[_,D]=x.useState(!1),[O]=x.useState(!1),[b,A]=x.useState(null),[q,I]=x.useState(!1),[M,V]=x.useState(0),[de,X]=x.useState(0);x.useEffect(()=>{const E=wa.getLastUserId();E&&(A(E),console.log(" Device remembered user:",E))},[]),x.useEffect(()=>{if(b&&e.length===0&&M<3){const E=setTimeout(()=>{V($=>$+1),console.log(" Waiting for users... attempt",M+1)},1e3);return()=>clearTimeout(E)}},[b,e.length,M]);const[,he]=x.useState(!0),[,ie]=x.useState(!1),[,P]=x.useState([]),[,J]=x.useState([]),[,le]=x.useState([]),[Fe]=x.useState(!1),[kt]=x.useState(0),[lt,K]=x.useState(!1),[ne,Ne]=x.useState(!1),[Qe,mt]=x.useState(!1),[Se,Ut]=x.useState(!1),[pe,F]=x.useState({}),ce=async(E,$)=>{await n(E,$);let W=$;if($==="bootstrap_manager"){const re=e.find(Z=>Z.role===E);re&&(W=re.id,console.log(" Resolved bootstrap to real user:",{from:$,to:W}))}if(!W){const re=e.find(Z=>Z.role===E);re&&(W=re.id)}W&&W!=="bootstrap_manager"?(wa.setLastUserId(W),A(W),console.log(" Saved device user:",W)):console.warn(" Could not determine valid user ID to save"),w("section-home"),I(!1)},Ce=async(E,$)=>{await s(E,$)},Me=E=>{w(E),ue(null),v(!1)},rt=async()=>{await r(),w("section-home"),ue(null),Ln(null),v(!0),D(!1)},os=()=>{I(!0),console.log(' User clicked "Not me" - showing full login')},[mr,Zs]=x.useState([{id:"s1",name:" ()",role:"Video",avatar:"Ali",gear:[{id:"g1",name:"Canon R5C",icon:"",batteryPool:{total:5,charged:3},memoryPool:{total:4,free:2}},{id:"g2",name:"24-70mm",icon:""}]},{id:"s2",name:" ()",role:"Photo",avatar:"Sara",gear:[{id:"g3",name:"Sony A7S",icon:"",batteryPool:{total:3,charged:2},memoryPool:{total:2,free:0}},{id:"g4",name:"Godox AD600",icon:"",batteryPool:{total:2,charged:1}}]},{id:"s3",name:" ()",role:"Assistant",avatar:"Ahmed",gear:[]}]),[Pn,aa]=x.useState([{id:"loc1",name:"  (A1)",type:"shelf",items:[{id:"i1",name:"Canon Lens 85mm",icon:""},{id:"i2",name:"Canon Lens 50mm",icon:""},{id:"i3",name:"Spare Battery",icon:""}]},{id:"loc2",name:"  (D1)",type:"bag",items:[{id:"i4",name:"DJI Mavic 3",icon:""},{id:"i5",name:"Controller",icon:""}]},{id:"loc3",name:"  (M1)",type:"maintenance",items:[{id:"i6",name:"Broken Mic",icon:"",status:"broken"}]}]),[ca,L]=x.useState([]);x.useEffect(()=>{const E=async()=>{try{const $=await Y.getInventory();if($.length>0){const W=e.map(Z=>({id:Z.id,name:Z.name,role:Z.role,avatar:Z.name,gear:$.filter(Sn=>Sn.assignedTo===Z.id)})).filter(Z=>Z.gear.length>0),re=[{id:"loc1",name:"  (A1)",type:"shelf",items:$.filter(Z=>Z.status==="storage"&&Z.type!=="drone")},{id:"loc2",name:"  (D1)",type:"bag",items:$.filter(Z=>Z.status==="storage"&&Z.type==="drone")}];Zs(W),aa(re)}}catch($){console.error("Failed to load real inventory:",$)}};e.length>0&&E()},[e]);const[B,ue]=x.useState(null),[we,ke]=x.useState([]),[Ke,be]=x.useState(null),[We,qt]=x.useState("general"),[st,sn]=x.useState(""),[on,an]=x.useState(!1),[Zt,Gs]=x.useState({isOpen:!1}),[qi,vn]=x.useState(!1),[Ct,Rn]=x.useState(null),[Gt,Ln]=x.useState(null),[Vi,xe]=x.useState("shoot"),[dt,_t]=x.useState(es.WEDDING),[Rt,as]=x.useState(void 0),[pt,wt]=x.useState(null),[Ks,Ot]=x.useState(!1),[cn,Ys]=x.useState(null),[Zn,la]=x.useState(!1),[j0,gc]=x.useState(!1),[E0,Gl]=x.useState(!1),[ph,xc]=x.useState("client"),[yc,da]=x.useState(null),[gh,C0]=x.useState("dashboard"),[_0,xh]=x.useState(!1),bc={mutate:async({id:E,updates:$})=>{const W=a.find(re=>re.id===E);W==null||W.status,$.status,P(re=>re.map(Z=>Z.id===E?{...Z,...$}:Z))}},Kl={mutate:E=>{P($=>$.filter(W=>W.id!==E))}};x.useEffect(()=>{O0(),(async()=>{ie(!0);try{if(Y!=null&&Y.getBookings){const W=await Y.getBookings();P(JSON.parse(JSON.stringify(W)))}}catch(W){console.error(W)}ie(!1)})();const $=Y.subscribe(async W=>{if(console.log(` Received sync event: ${W}`),W==="bookings_updated"){const re=await Y.getBookings();P(Z=>Z===re?Z:(!Z||!re||Z.length!==re.length,re))}else if(W!=="users_updated"){if(W==="tasks_updated"){const re=await Y.getDashboardTasks();J(Z=>Z===re?Z:(!Z||!re||Z.length!==re.length,re))}}});return gl.start(),()=>{$(),gl.stop()}},[]);const O0=async()=>{try{const{initDB:E}=await fe(async()=>{const{initDB:Z}=await import("./schema-CAZKW4R0.js");return{initDB:Z}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);await E();const{seedDatabase:$}=await fe(async()=>{const{seedDatabase:Z}=await import("./seed-Bf6FwK0s.js");return{seedDatabase:Z}},__vite__mapDeps([5,1,2,3,4]),import.meta.url);await $();const W=await Y.getDashboardTasks();J(W);const re=await Y.getUsers()}catch(E){console.error("Failed to load data",E)}finally{he(!1)}},ua=(t==null?void 0:t.role)===ee.RECEPTION,Dr=(t==null?void 0:t.role)===ee.MANAGER,Gn=x.useMemo(()=>{const E=a.filter($=>!$.deletedAt);return t?E.filter($=>Yx($,t)):E},[a,t]),I0=async E=>{Zs(E);for(const $ of E)for(const W of $.gear)await Y.updateInventoryItem(W.id,{assignedTo:$.id,status:"deployed",batteryPool:W.batteryPool,memoryPool:W.memoryPool})},Yl=()=>{if(B)return Dr?i.jsx(yk,{booking:B,reminders:we,onBack:()=>{ue(null),xc("client")},allBookings:a,initialTab:ph,onUpdateBooking:Nn}):i.jsx(Ow,{booking:B,reminders:we,onStatusChange:M0,onUpdateBooking:Nn,onSettlePayment:ed,onDropFolder:()=>{},onAddReminder:P0,onEditReminder:E=>{be(E),an(!0)},onToggleReminder:async E=>{await Y.toggleReminder(E),await Qi(B.id)},onDeleteReminder:E=>Gs({isOpen:!0,type:"reminder",id:E,message:" "}),onOpenAiAssistant:()=>la(!0),onBack:()=>{ue(null),xc("client")},initialTab:ph});if((t==null?void 0:t.role)===ee.ADMIN)switch(p){case"section-home":return i.jsx(Tk,{bookings:a,users:e,onSelectBooking:Xl,onUpdateBooking:Nn});case"section-bookings":return i.jsx(Ek,{bookings:a,users:e,onSelectBooking:Xl,onUpdateBooking:Nn});case"section-clients":return i.jsx(vk,{bookings:a});case"section-financial":return i.jsx(Nk,{});case"section-logs":return i.jsx("div",{className:"h-full p-4",children:i.jsx(jk,{bookings:a,users:e})});case"section-settings":return i.jsx(Sk,{users:e,onUpdateUser:Ce});case"section-hr":return i.jsx(_k,{});case"section-sentinel":return i.jsx(Ck,{});case"section-inventory":return i.jsx(Ok,{});case"section-war-room":return i.jsx(Ik,{});case"section-team-chat":return i.jsx(ba,{users:e,currentUser:t});default:return i.jsx(wk,{bookings:a,users:e})}switch(p){case"section-home":return Dr?h?i.jsx(kk,{onBack:()=>m(!1)}):i.jsx(mk,{bookings:Gn,users:e,tasks:c,onToggleTask:async E=>{await Y.toggleTask(E),J(await Y.getDashboardTasks())},onLogout:rt}):ua?i.jsx(Pk,{bookings:Gn,users:e,onSelectBooking:Sh,onStatusUpdate:Xs,isDraggable:pe["section-home"]||!1,currentUser:t,onLogout:rt}):i.jsx("div",{children:"Dashboard not configured"});case"section-my-bookings":return i.jsx(Lk,{bookings:Gn,onAddBooking:()=>yh(),onDateClick:E=>yh(void 0,E),onSelectBooking:Sh,onDeleteBooking:async E=>{try{await Y.softDeleteBooking(E),Kl.mutate(E),z.success("      (   30 )")}catch($){console.error(" Failed to soft delete booking:",$),z.error("  ")}},onEditBooking:T0,onViewBooking:A0,onUpdateStatus:Xs,onUpdateBooking:Nn,isDraggable:pe["section-my-bookings"]||!1,isReception:ua,isManager:Dr,users:e});case"section-clients":return Dr?i.jsx(pk,{bookings:Gn,onRebookClient:wh}):ua?i.jsx(Rk,{bookings:Gn,onUpdateBooking:Nn,onRebookClient:wh}):i.jsx("div",{children:"Clients view not configured"});case"section-financial":return Dr?i.jsx(Gk,{bookings:Gn,onUpdateBooking:Nn}):i.jsx($k,{bookings:Gn,isManager:!1});case"section-accounts":return Dr?i.jsx(Kk,{bookings:Gn,onUpdateBooking:Nn}):i.jsx("div",{children:"Access Denied"});case"section-team":return Dr?i.jsx(gk,{users:e,currentUser:t,isManager:!0,onRefresh:async()=>{await Y.getUsers(),X(E=>E+1)}},de):i.jsx(ba,{currentUser:t,users:e});case"section-team-chat":return i.jsx(ba,{users:e,currentUser:t});case"section-files":return Dr?i.jsx(xk,{}):(t==null?void 0:t.role)===ee.PHOTO_EDITOR?i.jsx(Fk,{bookings:Gn}):i.jsx(Mk,{bookings:Gn,isReception:ua});case"section-workflow":return i.jsx(Jk,{bookings:Gn,users:e,onViewBooking:Xl,onStatusUpdate:Xs,onUpdateBooking:Nn,isReception:ua,isManager:Dr});default:return i.jsx("div",{children:"Page Not Found"})}},wc=async(E,$,W)=>{var Sn,Pr;console.log("[App] performStatusUpdate called:",E,$);const re=$||(B==null?void 0:B.id);if(console.log("[App] bookingId resolved:",re),!re){console.log("[App] No bookingId, returning");return}console.log("[App] Updating backend status..."),await Y.updateBookingStatus(re,E);const Z=W||a.find(vt=>vt.id===re);if(console.log("[App] Found booking for automated actions:",Z==null?void 0:Z.clientName,"ID:",Z==null?void 0:Z.id),console.log("[App]  Checking status:",E,"Expected:",me.SHOOTING_COMPLETED),console.log("[App]  Status match:",E===me.SHOOTING_COMPLETED),console.log("[App]  Booking exists:",!!Z),E===me.SHOOTING_COMPLETED&&Z){console.log("[App]  INSIDE IF BLOCK - Creating folder...");try{const vt=window.electronAPI;if(console.log("[App] Electron API available:",!!vt),console.log("[App] Session lifecycle available:",!!((Sn=vt==null?void 0:vt.sessionLifecycle)!=null&&Sn.createSessionDirectory)),(Pr=vt==null?void 0:vt.sessionLifecycle)!=null&&Pr.createSessionDirectory){const Hi=`session_${Z.id}_${Date.now()}`;console.log("[App] Creating session:",Hi);const fa={id:Z.id,title:Z.title,clientName:Z.clientName,clientPhone:Z.clientPhone,clientEmail:Z.clientEmail,shootDate:Z.shootDate,details:Z.details,totalAmount:Z.totalAmount,paidAmount:Z.paidAmount,packageName:Z.packageName,status:Z.status,assignedToName:Z.assignedToName,createdByName:Z.createdByName};console.log("[App] Calling createSessionDirectory...");const $n=await vt.sessionLifecycle.createSessionDirectory(Z.clientName,Hi,new Date().toISOString(),fa);console.log("[App] createSessionDirectory result:",$n),$n!=null&&$n.success&&$n.sessionPath&&(console.log("[App]  Folder created successfully:",$n.sessionPath),await Y.updateBooking(re,{folderPath:$n.sessionPath,nasSessionId:Hi}),await Y.addReminder(re,`    : ${$n.sessionPath}`,new Date().toISOString().split("T")[0],"general","Folder"),z.success("        NAS "),console.log("[Session] Folder created:",$n.sessionPath))}else console.warn("[Session] Electron API not available for folder creation"),z.error("     NAS -      ")}catch(vt){console.error("[Session] Failed to create session folder:",vt),z.error("      NAS")}}if(E===me.EDITING)await Y.addReminder(re,"  : Canon R5C, Canon R, Godox AD600B",new Date().toISOString().split("T")[0],"shooting","Zap"),await Qi(re),z.success("     ");else if(E===me.SELECTION&&Z){const vt=Z.servicePackage||"";if(vt.startsWith("venue_ad")||vt.startsWith("venue_full")||vt.startsWith("venue_room_rental"))console.log(" Rental Session - No Battery Drain Triggered.");else{console.log(" Auto-Draining Batteries for Session Completion...");const fa=[...mr],$n=fa.findIndex(Ji=>Ji.role==="Photo");if($n!==-1){let Ji=0;fa[$n].gear.forEach(ma=>{ma.batteryPool&&ma.batteryPool.charged>0&&(ma.batteryPool.charged--,Ji++)}),Ji>0&&(I0(fa),le(ma=>[{id:Date.now().toString(),title:"  ",message:`   ${Ji}   `,time:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),read:!1,type:"system"},...ma]),z.info(`    ${Ji}   `))}}}else z.success("   ");bc.mutate({id:re,updates:{status:E}}),(B==null?void 0:B.id)===re&&ue(null),da(null),yn.pushChanges()},vc=async E=>{var Z;console.log(" Adding new booking:",E),E.created_by=t==null?void 0:t.id,E.updated_by=t==null?void 0:t.id,E.updated_at=new Date().toISOString();const $=await Y.addBooking(E);console.log(" Booking created:",$),P(Sn=>[...Sn,$]),setTimeout(async()=>{if(Y.getBookings){const Sn=await Y.getBookings();P(Sn)}},100),yn.pushChanges();const W=$.client_token||E.client_token,re=rk(W);if(re)try{(Z=navigator==null?void 0:navigator.clipboard)!=null&&Z.writeText?(await navigator.clipboard.writeText(re),z.success("   +    "),z.info(re)):(z.success("   "),z.info(`   : ${re}`))}catch{z.success("   "),z.info(`   : ${re}`)}else z.success("   "),z.warning("        ")},T0=E=>{const $=a.find(W=>W.id===E);$&&(Rn($),vn(!0))},A0=(E,$="workflow")=>{let W;typeof E=="string"?W=a.find(re=>re.id===E):W=E,W&&(xc($),Ln(W),Rn(null),vn(!0))},Xl=(E,$="workflow")=>{let W;typeof E=="string"?W=a.find(re=>re.id===E):W=E,W&&(xc($),ue(W),Qi(W.id))},D0=E=>{const $=e.find(W=>W.id===E);$&&(n($.role,$.id),w("section-home"))},yh=(E,$)=>{as($||void 0),Rn(null),gc(!0)},bh=E=>{gc(!1),xe(E),_t(E==="location"?es.STUDIO:es.WEDDING),vn(!0)},wh=(E,$)=>{wt({name:E,phone:$}),Rn(null),Ln(null),as(void 0),gc(!0)},Nn=async(E,$)=>{const W={...$,updatedBy:t==null?void 0:t.id,updatedAt:new Date().toISOString()},re=await Y.updateBooking(E,W);bc.mutate({id:E,updates:W}),(B==null?void 0:B.id)===E&&ue(re),yn.pushChanges(),z.success("   ")},Xs=async(E,$)=>{console.log("[App] handleDragStatusChange called:",E,$),console.log("[App]  newStatus value:",JSON.stringify($)),console.log("[App]  BookingStatus.SHOOTING_COMPLETED:",JSON.stringify(me.SHOOTING_COMPLETED)),console.log("[App]  Match check:",$===me.SHOOTING_COMPLETED);const W=a.find(Pr=>Pr.id===E);if(console.log("[App] Found booking:",W==null?void 0:W.clientName,"Current status:",W==null?void 0:W.status),W&&W.status===me.SHOOTING&&$===me.DELIVERED){console.log("[App]  INTERCEPT: Shooting  Delivered detected!"),console.log("[App]  Will trigger SHOOTING_COMPLETED first to create folder...");const Pr={...W,status:me.SHOOTING_COMPLETED};await wc(me.SHOOTING_COMPLETED,E,Pr),console.log("[App]  Folder creation triggered, now proceeding to Delivered..."),await new Promise(vt=>setTimeout(vt,500))}if(W&&($===me.SHOOTING||$===me.DELIVERED)&&W.totalAmount-W.paidAmount>0){console.log("[App] Balance due, showing payment modal"),da(W),Ys($),Ot(!0);return}const re={status:$};$===me.SHOOTING&&(re.shootDate=new Date().toISOString()),console.log("[App] Updating booking status to:",$),bc.mutate({id:E,updates:re});const Z=await Y.updateBooking(E,re);(B==null?void 0:B.id)===E&&ue(Z);const Sn={...W,status:$};console.log("[App] Calling performStatusUpdate with newStatus:",$),console.log("[App] bookingWithNewStatus.status:",Sn.status),await wc($,E,Sn),console.log("[App] performStatusUpdate completed")},ed=async(E,$)=>{const W=yc||B;if(!W)return;const re=$||W.exchangeRate||1400;let Z;if(E!==void 0){const Sn=W.paidAmount+E,Pr={id:`payment_${Date.now()}`,amount:E,currency:W.currency,exchangeRate:re,convertedAmount:E,paidAt:new Date().toISOString(),receivedBy:t==null?void 0:t.name,paymentMethod:W.paymentMethod},Hi=[...W.paymentRecords||[],Pr];Z=await Y.updateBooking(W.id,{paidAmount:Sn,paymentRecords:Hi})}else Z=await Y.settlePayment(W.id);bc.mutate({id:W.id,updates:{paidAmount:Z.paidAmount,paymentRecords:Z.paymentRecords}}),cn?(await wc(cn,W.id),Ys(null),Ot(!1)):((B==null?void 0:B.id)===W.id&&ue(null),da(null),Ot(!1)),yn.pushChanges()},P0=(E="general",$="")=>{be(null),qt(E),sn($),an(!0)},vh=async(E,$,W,re)=>{if(Ke)await Y.updateReminder(Ke.id,{title:E,dueDate:$,type:W,customIcon:re});else{if(!B)return;await Y.addReminder(B.id,E,$,W,re)}B&&await Qi(B.id),an(!1)},Nh=async()=>{const{type:E,id:$}=Zt;if($){if(E==="booking")try{await Y.softDeleteBooking($),Kl.mutate($),(B==null?void 0:B.id)===$&&ue(null),z.success("      (   30 )")}catch(W){console.error(" Failed to soft delete booking:",W),z.error("  ")}else E==="reminder"&&(await Y.deleteReminder($),B&&await Qi(B.id));Gs({...Zt,isOpen:!1})}},R0=()=>{F(E=>({...E,[p]:!E[p]}))},L0=()=>{Gl(!0)},$0=()=>{Gl(!1),z.success("   ")},Qi=async E=>{const $=await Y.getReminders(E);ke($)},Sh=async E=>{ue(E),await Qi(E.id)},M0=async E=>{if(!B)return;if(B.totalAmount-B.paidAmount>0&&(E===me.DELIVERED||E===me.SHOOTING)){da(B),Ys(E),Ot(!0);return}await wc(E)},ha=x.useRef(null),td=x.useCallback(()=>{t&&(ha.current&&clearTimeout(ha.current),ha.current=setTimeout(()=>{D(!0)},300*1e3))},[t]);x.useEffect(()=>{if(!t)return;const E=["mousemove","mousedown","keypress","touchmove","scroll","click"],$=()=>{_||td()};return E.forEach(W=>window.addEventListener(W,$)),td(),()=>{ha.current&&clearTimeout(ha.current),E.forEach(W=>window.removeEventListener(W,$))}},[t,_,td]);const kh=x.useMemo(()=>{if(!b)return null;let E=e.find($=>$.id===b);return!E&&b==="bootstrap_manager"&&(E=e.find($=>$.role===ee.MANAGER),E&&(console.log(" Migrating bootstrap_manager to real UUID:",E.id),wa.setLastUserId(E.id))),E},[b,e]),jh=x.useMemo(()=>{if(b&&e.length===0)return!0;if(b&&e.length>0){const E=e.find($=>$.id===b);return!E&&b==="bootstrap_manager"?!e.some($=>$.role===ee.MANAGER):(E||(console.log(" Remembered user not found in loaded users  clearing stale device storage"),setTimeout(()=>{wa.clearLastUserId(),A(null)},0)),!1)}return!1},[b,e]);if(!t||_){if(b&&jh&&M<3)return i.jsx($u,{});b&&jh&&M>=3&&(console.log(" Clearing stale remembered user - no users in database"),wa.clearLastUserId(),A(null));const E=kh&&!q;return i.jsx(Qw,{onLogin:($,W)=>{ce($,W),D(!1)},users:e,rememberedUser:E?kh:null,onNotMe:os})}return t.role===ee.MANAGER?i.jsxs(fk,{activeSection:p,onNavigate:Me,currentUser:t,onLogout:rt,onOpenSettings:()=>S(!0),onOpenDeletedBookings:()=>xh(!0),hideHeader:!!B||!!Gt||qi,badges:u,children:[i.jsx(Bt,{mode:"wait",children:i.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3,ease:"easeOut"},className:"h-full",children:Yl()},p)}),i.jsx(Xf,{isOpen:Ks,onClose:()=>Ot(!1),outstandingAmount:B?B.totalAmount-B.paidAmount:0,onSettle:ed}),i.jsx(Sd,{isOpen:qi,onClose:()=>{vn(!1),Rn(null),Ln(null),wt(null)},onSave:async E=>{Ct&&!Gt?await Nn(Ct.id,E):Gt||await vc(E),vn(!1),Rn(null),Ln(null),wt(null)},initialCategory:dt,mode:Vi,initialDate:Rt,editingBooking:Ct||Gt,readOnly:!!Gt,existingBookings:a,hideHeader:!0,rebookClient:pt}),B&&i.jsx(kd,{isOpen:Zn,onClose:()=>la(!1),clientName:B.clientName,bookingStatus:B.status,outstandingAmount:B.totalAmount-B.paidAmount,onSend:()=>z.success(" ")}),t&&i.jsx(ni,{isOpen:C,onClose:()=>S(!1),currentUser:t,allUsers:e,onUpdateUser:Ce,isSafeMode:O})]}):(t==null?void 0:t.role)===ee.ADMIN?i.jsxs(bk,{activeSection:p,onNavigate:Me,currentUser:t,onLogout:rt,onLock:()=>D(!0),isSidebarCollapsed:!N,badges:u,children:[i.jsx(Bt,{mode:"wait",children:i.jsx(ve.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.02},transition:{duration:.3},className:"h-full",children:Yl()},p)}),i.jsx(Sd,{isOpen:qi,onClose:()=>{vn(!1),Rn(null),Ln(null),wt(null)},onSave:async E=>{Ct&&!Gt?await Nn(Ct.id,E):Gt||await vc(E),vn(!1),Rn(null),Ln(null),wt(null)},initialCategory:dt,mode:Vi,initialDate:Rt,editingBooking:Ct||Gt,readOnly:!!Gt,existingBookings:a,hideHeader:!0,rebookClient:pt}),i.jsx(tm,{isOpen:on,onClose:()=>an(!1),onSubmit:vh,initialType:We,initialTitle:st,initialData:Ke}),i.jsx(Dc,{isOpen:Zt.isOpen,onClose:()=>Gs({...Zt,isOpen:!1}),onConfirm:Nh,message:Zt.message,title:" ",confirmLabel:"",cancelLabel:""}),B&&i.jsx(kd,{isOpen:Zn,onClose:()=>la(!1),clientName:B.clientName,bookingStatus:B.status,outstandingAmount:B.totalAmount-B.paidAmount,onSend:()=>z.success(" ")}),t&&i.jsx(ni,{isOpen:C,onClose:()=>S(!1),currentUser:t,allUsers:e,onUpdateUser:Ce,isSafeMode:O})]}):t.role===ee.SELECTOR?i.jsxs(Qk,{currentUser:t,onLogout:rt,onOpenSettings:()=>S(!0),badges:u,children:[p!=="section-team-chat"&&i.jsx(Hk,{bookings:a,currentUser:t,users:e,onStatusUpdate:Xs}),t&&i.jsx(ni,{isOpen:C,onClose:()=>S(!1),currentUser:t,allUsers:e,onUpdateUser:Ce,isSafeMode:O}),p==="section-team-chat"&&i.jsx(ek,{isReception:!1,allowOverflow:!0,hideBackground:!0,children:i.jsx(ba,{currentUser:t,users:e})})]}):t.role===ee.PHOTO_EDITOR?i.jsxs(zk,{activeSection:p,onNavigate:Me,currentUser:t,onLogout:rt,onOpenSettings:()=>S(!0),isCollapsed:y,toggleCollapse:()=>g(!y),badges:u,children:[i.jsx(Bt,{mode:"wait",children:i.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"h-full",children:i.jsx(Bk,{activeSection:p,currentUser:t,users:e,bookings:a,onStatusUpdate:Xs})},p)}),t&&i.jsx(ni,{isOpen:C,onClose:()=>S(!1),currentUser:t,allUsers:e,onUpdateUser:Ce,isSafeMode:O})]}):t.role===ee.VIDEO_EDITOR?i.jsxs(Wk,{currentUser:t,onLogout:rt,onOpenSettings:()=>S(!0),activeTab:gh,onNavigate:C0,badges:u,children:[gh==="dashboard"?i.jsx(Uk,{currentUser:t,bookings:a,onStatusUpdate:Xs}):i.jsx(ba,{currentUser:t,users:e}),t&&i.jsx(ni,{isOpen:C,onClose:()=>S(!1),currentUser:t,allUsers:e,onUpdateUser:Ce,isSafeMode:O})]}):t.role===ee.PRINTER?i.jsxs(qk,{activeSection:p,onNavigate:Me,currentUser:t,onLogout:rt,onOpenSettings:()=>S(!0),isCollapsed:y,toggleCollapse:()=>g(!y),badges:u,children:[i.jsx(Bt,{mode:"wait",children:i.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"h-full",children:i.jsx(Vk,{activeSection:p,bookings:a,users:e,currentUser:t,onStatusUpdate:Xs,onUpdateBooking:Nn,onAddBooking:vc})},p)}),t&&i.jsx(ni,{isOpen:C,onClose:()=>S(!1),currentUser:t,allUsers:e,onUpdateUser:Ce,isSafeMode:O})]}):i.jsxs("div",{className:`flex h-screen overflow-hidden ${(t==null?void 0:t.role)===ee.RECEPTION?"bg-[#0F0F0F] text-gray-100":"bg-[#21242b] text-gray-100"} font-sans ${lt?"winter-mode":""}`,dir:"rtl",children:[lt&&i.jsx(ZS,{}),Qe&&i.jsx(GS,{}),Se&&i.jsx(KS,{}),i.jsx(Hw,{isOffline:d}),(t==null?void 0:t.role)===ee.RECEPTION&&i.jsx(Dk,{activeSection:p,onNavigate:Me,isOpen:N,onClose:()=>v(!1),isCollapsed:y,toggleCollapse:()=>g(!y),currentUser:t,onLogout:rt,onOpenSettings:()=>S(!0),badges:u}),i.jsxs("div",{className:`flex-1 flex flex-col min-w-0 relative transition-all duration-300 ${y?"lg:mr-[90px]":"lg:mr-[160px]"}`,children:[(t==null?void 0:t.role)!==ee.RECEPTION&&i.jsx(dy,{currentUser:t,allUsers:e,onSwitchUser:D0,onLogout:rt,activeSection:p,onNavigate:Me,notifications:l,onMarkAllRead:()=>le(E=>E.map($=>({...$,read:!0}))),isUploading:Fe,uploadProgress:kt,isSnowing:lt,onToggleSnow:()=>K(!lt),isHeartTrail:ne,onToggleHeartTrail:()=>Ne(!ne),isRamadan:Qe,onToggleRamadan:()=>mt(!Qe),isSparkles:Se,onToggleSparkles:()=>Ut(!Se),isDraggable:pe[p]||!1,onToggleDraggable:R0,onResetLayout:L0}),i.jsx("main",{className:"flex-1 overflow-hidden p-4 lg:p-6 relative",children:i.jsx(Bt,{mode:"wait",children:i.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"h-full",children:Yl()},p)})})]}),i.jsx(Xf,{isOpen:Ks,onClose:()=>{Ot(!1),da(null),Ys(null)},outstandingAmount:yc?yc.totalAmount-yc.paidAmount:B?B.totalAmount-B.paidAmount:0,onSettle:ed}),i.jsx(tm,{isOpen:on,onClose:()=>an(!1),onSubmit:vh,initialType:We,initialTitle:st,initialData:Ke}),i.jsx(Sd,{isOpen:qi,onClose:()=>{vn(!1),Rn(null),Ln(null),wt(null)},onSave:async E=>{Ct&&!Gt?await Nn(Ct.id,E):Gt||await vc(E),vn(!1),Rn(null),Ln(null),wt(null)},initialCategory:dt,mode:Vi,initialDate:Rt,editingBooking:Ct||Gt,readOnly:!!Gt,existingBookings:a,rebookClient:pt}),i.jsx(Dc,{isOpen:Zt.isOpen,onClose:()=>Gs({...Zt,isOpen:!1}),onConfirm:Nh,message:Zt.message,title:"",confirmLabel:"",cancelLabel:""}),i.jsx(Dc,{isOpen:E0,onClose:()=>Gl(!1),onConfirm:$0,message:"      ",title:"  ",confirmLabel:"  ",cancelLabel:""}),B&&i.jsx(kd,{isOpen:Zn,onClose:()=>la(!1),clientName:B.clientName,bookingStatus:B.status,outstandingAmount:B.totalAmount-B.paidAmount,onSend:()=>z.success(" ")}),i.jsx(Dc,{isOpen:j0,onClose:()=>gc(!1),onConfirm:()=>{},message:"",title:" ",confirmLabel:"",cancelLabel:"",customContent:i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10 mb-4",children:i.jsxs("p",{className:"text-gray-300 text-sm leading-relaxed text-center",children:[i.jsx("span",{className:"text-amber-500 font-bold block mb-2",children:" :"}),'"         "']})}),i.jsxs("div",{className:"grid gap-3",children:[i.jsx("button",{onClick:()=>bh("shoot"),className:"group w-full p-4 bg-linear-to-r from-pink-500/10 to-purple-500/10 border-2 border-pink-500/30 rounded-2xl hover:bg-pink-500/20 transition-all text-right relative overflow-hidden",children:i.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-white font-bold text-lg group-hover:text-pink-400 transition-colors",children:" "}),i.jsx("p",{className:"text-[11px] text-gray-400 mt-1 opacity-80",children:': " " ()'})]}),i.jsx("div",{className:"w-12 h-12 rounded-full bg-pink-500/20 flex items-center justify-center text-pink-500 shadow-lg shadow-pink-500/10",children:i.jsx(Ko,{size:24})})]})}),i.jsx("button",{onClick:()=>bh("location"),className:"group w-full p-4 bg-linear-to-r from-blue-500/10 to-cyan-500/10 border-2 border-blue-500/30 rounded-2xl hover:bg-blue-500/20 transition-all text-right relative overflow-hidden",children:i.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-white font-bold text-lg group-hover:text-blue-400 transition-colors",children:" "}),i.jsx("p",{className:"text-[11px] text-gray-400 mt-1 opacity-80",children:': " " ( )'})]}),i.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 shadow-lg shadow-blue-500/10",children:i.jsx(Ng,{size:24})})]})})]})]})}),i.jsx(Ak,{isOpen:_0,onClose:()=>xh(!1),onRestore:E=>{Kl.mutate(E.id),z.success(`   "${E.clientName}"`)}}),t&&i.jsx(ni,{isOpen:C,onClose:()=>S(!1),currentUser:t,allUsers:e,onUpdateUser:Ce,isSafeMode:O})]})}const ej=new ax({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!1}}}),tj=Ux({storage:window.localStorage}),k0=document.getElementById("root");if(!k0)throw new Error("Could not find root element to mount to");const nj=U0.createRoot(k0);nj.render(i.jsx(T.StrictMode,{children:i.jsxs(Wx,{client:ej,persistOptions:{persister:tj},children:[i.jsx(Mx,{position:"top-center",richColors:!0,closeButton:!0,dir:"rtl",theme:"dark"}),i.jsx(Yk,{})]})}));export{Sd as A,es as B,ck as C,ek as D,hj as E,fj as F,Hx as G,cj as H,dj as I,Vh as J,lj as K,Yw as L,gj as M,zm as N,Xf as P,xn as R,Zx as S,ee as U,fe as _,YS as a,w0 as b,hk as c,uj as d,qn as e,mj as f,pj as g,Y as h,ww as i,nk as j,rk as k,zt as l,Sw as m,me as n,jc as o,sm as p,Nw as q,kw as r,H as s,z as t,N0 as u,Cw as v,ge as w,rm as x,Mt as y,yt as z};
