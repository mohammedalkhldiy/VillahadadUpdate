import{r as o,j as e}from"./vendor-react-Ce27NbrU.js";import{c as v}from"./utils-BykweIWy.js";import{S as L}from"./ScrollReveal-DKkvXRwD.js";import{C as P}from"./ClientBadge-BDLI63ku.js";import{G as V}from"./GlowCard-71-V6_az.js";import{D as Q}from"./ManagerDashboardCard-CvhNOwym.js";import{aI as U,ap as D,aB as B,af as O,aJ as $,o as H,v as S,ae as E,q as R,r as I,$ as G,aK as W,P as Z,aL as q}from"./vendor-ui-TjLGESBy.js";import{F as J}from"./FilterBar-D-KgzGOA.js";import{d as K,g as _,f as X}from"./index-BFvmHygk.js";import{s as Y,p as C,c as ee,d as te,e as ae,f as se}from"./vendor-utils-DKqDJWuS.js";import"./clsx-B-dksMZM.js";import"./vendor-supabase-CSCOup90.js";const re=({bookings:l})=>{var u;const x=o.useMemo(()=>{const c=["المنصور","اليرموك","زيونة","الكرادة","الدورة","الأعظمية","حي الجامعه","الجادرية","الغزالية","بغداد الجديدة"],m=c.map(n=>({name:n,count:0}));return l.forEach(n=>{let h=n.clientId.charCodeAt(0)%c.length;n.totalAmount>5e5&&Math.random()>.5?h=0:n.totalAmount>3e5&&Math.random()>.5&&(h=1),m[h].count+=1}),m.sort((n,g)=>g.count-n.count)},[l]),d=l.length||1;return e.jsx(Q,{title:"خريطة التمركز (Heatmap)",className:"h-full bg-white",noPadding:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-5 py-3 border-b  bg-gray-50/50 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"تحليل المناطق الأكثر طلباً (Baghdad Zones)"}),e.jsx(U,{size:14,className:"text-blue-500"})]}),e.jsx("div",{className:"flex-1 overflow-auto custom-scrollbar p-5 space-y-5",children:x.map((c,m)=>{const n=Math.round(c.count/d*100),g=m<3;return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex justify-between items-end mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:14,className:g?"text-rose-500":"text-gray-400"}),e.jsx("span",{className:`text-sm font-bold ${g?"text-gray-900":"text-gray-600"}`,children:c.name}),g&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold bg-rose-100 text-rose-600 border border-rose-200",children:"HOT ZONE"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-900",children:[n,"%"]}),e.jsxs("span",{className:"text-[10px] text-gray-400 ml-1",children:["(",c.count,")"]})]})]}),e.jsx("div",{className:"h-2 w-full bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${m===0?"bg-gradient-to-r from-rose-500 to-red-600":m===1?"bg-gradient-to-r from-orange-400 to-orange-500":m===2?"bg-gradient-to-r from-amber-400 to-amber-500":"bg-gray-300"}`,style:{width:`${n}%`}})})]},c.name)})}),e.jsx("div",{className:"p-4 bg-blue-50 border-t border-blue-100 mt-auto",children:e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(B,{size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-800 leading-relaxed",children:[e.jsx("strong",{children:"توصية الذكاء الاصطناعي:"}),e.jsx("br",{}),"المنطقة الذهبية هي ",e.jsx("span",{className:"font-bold underline",children:(u=x[0])==null?void 0:u.name}),". يُنصح بتكثيف الإعلانات المستهدفة (Geotargeting) هناك لزيادة العائد بنسبة 15%."]})]})})]})})},le=(l,x)=>{const d=l.replace(/\D/g,""),u=`مرحباً ${x}، نحن من فيلا حداد...`;return`https://wa.me/${d}?text=${encodeURIComponent(u)}`},ne=(l,x)=>{try{if(!l)return"N/A";const d=C(l);return isNaN(d.getTime())?"N/A":se(d,x)}catch{return"N/A"}},ye=({bookings:l=[],onRebookClient:x})=>{const[d,u]=o.useState(""),[c,m]=o.useState(K),[n,g]=o.useState("today"),[h,T]=o.useState(!1),[j,M]=o.useState(1500),y=o.useMemo(()=>{const t=new Map;return l.filter(a=>a&&a.clientId&&a.shootDate).forEach(a=>{var f;t.has(a.clientId)||t.set(a.clientId,{id:a.clientId,name:a.clientName||"Unknown",email:a.clientEmail,phone:a.clientPhone,bookingsCount:0,totalSpent:0,totalSpentUSD:0,totalSpentIQD:0,totalInIQD:0,lastVisit:a.shootDate,notes:[],isFamous:!1,isManualVIP:!1});const s=t.get(a.clientId);s.bookingsCount+=1,s.totalSpent+=a.totalAmount||0,a.currency==="USD"?s.totalSpentUSD+=a.totalAmount||0:s.totalSpentIQD+=a.totalAmount||0;const i=a.exchangeRate||j;a.currency==="USD"?s.totalInIQD+=(a.totalAmount||0)*i:s.totalInIQD+=a.totalAmount||0,a.addOnTotal&&a.addOnTotal>0&&(a.currency==="USD"?(s.totalSpentIQD+=a.addOnTotal,s.totalInIQD+=a.addOnTotal):(s.totalSpentUSD+=a.addOnTotal,s.totalInIQD+=a.addOnTotal*i));try{const b=new Date(a.shootDate),N=new Date(s.lastVisit);!isNaN(b.getTime())&&!isNaN(N.getTime())&&b>N&&(s.lastVisit=a.shootDate)}catch{}(f=a.details)!=null&&f.notes&&s.notes.push(a.details.notes),a.isFamous&&(s.isFamous=!0),a.isVIP&&(s.isManualVIP=!0)}),Array.from(t.values()).map(a=>({...a,isVIP:a.totalSpent>2e3||a.isManualVIP||a.name.toLowerCase().includes("vip"),isLoyal:a.bookingsCount>1,isNew:a.bookingsCount===1,isFamous:a.isFamous}))},[l,j]),z=o.useMemo(()=>_(l),[l]),p=o.useMemo(()=>{let t=y.filter(r=>r.name.toLowerCase().includes(d.toLowerCase())||String(r.phone).includes(d));return t=X(t,l,c),t},[y,d,c,l]),k=o.useMemo(()=>{const t=Y(),r=l.filter(s=>{if(!s||!s.shootDate)return!1;try{const i=C(s.shootDate);return isNaN(i.getTime())?!1:n==="today"?ee(i):n==="tomorrow"?te(i):n==="week"?ae(i,t,{weekStartsOn:6}):!1}catch{return!1}}),a=new Map;return r.forEach(s=>{var i;if(!a.has(s.clientId)&&s.clientId){const f=y.find(b=>b.id===s.clientId);f&&a.set(s.clientId,{...f,bookingTime:((i=s.details)==null?void 0:i.startTime)||"00:00"})}}),Array.from(a.values()).filter(s=>s.isVIP||s.isFamous||!s.isNew).sort((s,i)=>s.bookingTime.localeCompare(i.bookingTime))},[l,n,y]),A=o.useMemo(()=>[...p].filter(t=>t.isVIP).sort((t,r)=>r.totalInIQD-t.totalInIQD).slice(0,3),[p]),F=o.useMemo(()=>[...p].filter(t=>t.isLoyal).sort((t,r)=>r.bookingsCount-t.bookingsCount).slice(0,3),[p]),w=o.useMemo(()=>p.filter(t=>t.isFamous).slice(0,3),[p]);return e.jsxs("div",{className:"h-full flex flex-col p-4 lg:p-6 overflow-hidden",children:[e.jsxs("div",{className:"bg-white/80 dark:bg-[#1a1c22]/80 backdrop-blur-xl rounded-3xl px-6 py-3 shadow-sm mb-4 shrink-0 flex items-center justify-between gap-6 border border-white/20 dark:border-white/5 transition-colors duration-300",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-50/50 dark:bg-blue-900/20 rounded-xl flex items-center justify-center text-blue-500 dark:text-blue-400 shadow-sm",children:e.jsx(O,{size:16})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-gray-900 dark:text-gray-100 uppercase tracking-tight leading-none",children:"سجل العملاء"}),e.jsxs("span",{className:"text-[9px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:[p.length," Profiles Tracking"]})]})]}),e.jsx("div",{className:"h-6 w-px bg-gray-100/50 dark:bg-white/5 hidden sm:block"}),e.jsxs("button",{onClick:()=>T(!h),className:v("text-[9px] font-black px-3 py-1.5 rounded-lg flex items-center gap-2 transition-all uppercase tracking-wider",h?"bg-blue-600 text-white shadow-md":"bg-white/50 dark:bg-white/5 text-gray-400 dark:text-gray-500 hover:text-blue-600 dark:hover:text-blue-400"),children:[e.jsx(D,{size:10})," ",h?"Hide Map":"Heatmap"]}),e.jsx("div",{className:"h-6 w-px bg-gray-100/50 dark:bg-white/5 hidden sm:block"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white/50 dark:bg-white/5 rounded-lg px-2 py-1 border border-white/10 dark:border-white/5",children:[e.jsx($,{size:10,className:"text-emerald-500 shrink-0"}),e.jsx("span",{className:"text-[8px] font-black text-gray-400 dark:text-gray-500 whitespace-nowrap",children:"$1 ="}),e.jsx("input",{type:"text",inputMode:"numeric",value:j.toLocaleString(),onChange:t=>{const r=parseInt(t.target.value.replace(/[^0-9]/g,""),10);!isNaN(r)&&r>0&&M(r)},className:"w-16 bg-transparent text-[10px] font-black text-gray-800 dark:text-white text-center outline-none"}),e.jsx("span",{className:"text-[8px] font-black text-gray-400 dark:text-gray-500",children:"د.ع"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{filter:c,onFilterChange:m,stats:z}),e.jsxs("div",{className:"relative group/search hidden sm:block",children:[e.jsx(H,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-300 dark:text-gray-600 group-focus-within/search:text-blue-500 transition-colors",size:12}),e.jsx("input",{type:"text",placeholder:"Quick search...",value:d,onChange:t=>u(t.target.value),className:"h-8 w-40 bg-white/50 dark:bg-white/5 rounded-xl pr-9 pl-3 text-[10px] font-bold focus:ring-2 focus:ring-blue-500/10 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600 text-gray-900 dark:text-white"})]})]})]}),h&&e.jsx("div",{className:"mb-6 animate-in hover:animate-none fade-in slide-in-from-top-4 duration-500 h-[240px] shrink-0",children:e.jsx(re,{bookings:l})}),!h&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 shrink-0",children:[e.jsxs("div",{className:"bg-white/60 dark:bg-[#1a1c22]/60 backdrop-blur-md p-3 rounded-2xl shadow-sm flex flex-col h-[180px] border border-white/20 dark:border-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:[e.jsx(S,{size:12})," Arrivals"]}),e.jsx("div",{className:"flex gap-1",children:["today","tomorrow","week"].map(t=>e.jsx("button",{onClick:()=>g(t),className:`w-1 h-1 rounded-full ${n===t?"bg-blue-500":"bg-gray-200 dark:bg-gray-700"}`},t))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-1.5",children:k.length>0?k.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-white/40 dark:bg-white/5 rounded-xl",children:[e.jsx("div",{className:"w-5 h-5 rounded-lg bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center text-[9px] font-black",children:t.name[0]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[9px] font-black text-gray-800 dark:text-gray-200 truncate",children:t.name}),e.jsx("p",{className:"text-[8px] font-bold text-gray-400 dark:text-gray-500 leading-none",children:t.bookingTime})]})]},r)):e.jsx("div",{className:"h-full flex items-center justify-center text-[9px] font-bold text-gray-300 dark:text-gray-600 uppercase",children:"Clear Schedule"})})]}),e.jsxs("div",{className:"bg-white/60 dark:bg-[#1a1c22]/60 backdrop-blur-md p-3 rounded-2xl shadow-sm flex flex-col h-[180px] border border-white/20 dark:border-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:[e.jsx(E,{size:12,className:"text-amber-500"})," Top VIPs"]}),e.jsx("span",{className:"text-[9px] font-black text-amber-600 bg-amber-50 dark:bg-amber-900/20 dark:text-amber-500 px-2 py-0.5 rounded-full",children:"Top 3"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-1.5",children:A.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:v("w-5 h-5 rounded-lg flex items-center justify-center text-[9px] font-black text-white shadow-sm",r===0?"bg-amber-500":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"),children:r+1}),e.jsx("p",{className:"text-[9px] font-black text-gray-700 dark:text-gray-300 truncate",children:t.name})]}),e.jsxs("span",{className:"text-[9px] font-black text-gray-900 dark:text-white",children:[t.totalInIQD.toLocaleString()," ",e.jsx("span",{className:"text-[7px] text-gray-400",children:"د.ع"})]})]},r))})]}),e.jsxs("div",{className:"bg-white/60 dark:bg-[#1a1c22]/60 backdrop-blur-md p-3 rounded-2xl shadow-sm flex flex-col h-[180px] border border-white/20 dark:border-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:[e.jsx(R,{size:12,className:"text-rose-500"})," Retention"]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-1.5",children:F.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors border border-transparent hover:border-rose-50 dark:hover:border-rose-900/30",children:[e.jsx("p",{className:"text-[9px] font-black text-gray-700 dark:text-gray-300 truncate",children:t.name}),e.jsxs("span",{className:"text-[8px] bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 px-2 py-0.5 rounded-full font-black uppercase tracking-tighter",children:[t.bookingsCount," Visits"]})]},r))})]}),e.jsxs("div",{className:"bg-white/60 dark:bg-[#1a1c22]/60 backdrop-blur-md p-3 rounded-2xl shadow-sm flex flex-col h-[180px] border border-white/20 dark:border-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:[e.jsx(I,{size:12,className:"text-yellow-500"})," Influencers"]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-1.5",children:w.length>0?w.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-yellow-50/50 dark:bg-yellow-900/20 border border-yellow-100/50 dark:border-yellow-900/30 rounded-xl group hover:bg-yellow-50 dark:hover:bg-yellow-900/30 transition-colors",children:[e.jsx(I,{size:10,className:"text-yellow-500 fill-yellow-500 group-hover:scale-110 transition-transform"}),e.jsx("p",{className:"text-[9px] font-black text-gray-800 dark:text-gray-200 truncate",children:t.name})]},r)):e.jsx("div",{className:"h-full flex items-center justify-center text-[9px] font-black text-gray-300 dark:text-gray-600 uppercase",children:"None Tracked"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:p.map((t,r)=>e.jsx(L,{delay:Math.min(r*.05,.3),children:e.jsxs(V,{variant:"light",className:"p-4 h-full flex flex-col relative overflow-hidden group bg-white dark:bg-[#1a1c22] border border-transparent dark:border-white/5 transition-colors duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gray-50 dark:bg-white/5 text-gray-600 dark:text-gray-300 flex items-center justify-center text-sm font-black  group-hover:scale-110 group-hover:bg-blue-600 group-hover:text-white transition-all shadow-sm",children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white leading-tight mb-0.5",children:t.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 tracking-wider",children:["ID: ",t.id.slice(0,6)]})]})]}),e.jsx(P,{booking:l.find(a=>a.clientId===t.id)||l[0],allBookings:l,compact:!0})]}),e.jsxs("div",{className:"space-y-1.5 mb-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-gray-50 dark:bg-white/5 flex items-center justify-center text-gray-400 dark:text-gray-500",children:e.jsx(G,{size:12})}),e.jsx("span",{dir:"ltr",className:"font-medium text-gray-600 dark:text-gray-400",children:t.phone}),e.jsx("a",{href:le(String(t.phone),t.name),target:"_blank",rel:"noreferrer",className:"text-green-500 hover:scale-110 transition-transform",children:e.jsx(W,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-gray-50 dark:bg-white/5 flex items-center justify-center text-gray-400 dark:text-gray-500",children:e.jsx(S,{size:12})}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:ne(t.lastVisit,"MMM yyyy")})]})]}),e.jsxs("div",{className:"mt-auto pt-3 border-t border-gray-100 dark:border-white/5 flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[9px] text-gray-400 dark:text-gray-500 font-bold uppercase",children:"المجموع"}),e.jsxs("p",{className:"text-xs font-black text-gray-800 dark:text-gray-200",children:[t.totalInIQD.toLocaleString()," ",e.jsx("span",{className:"text-[8px] text-gray-400",children:"د.ع"})]}),t.totalSpentUSD>0&&e.jsxs("p",{className:"text-[8px] text-gray-400 dark:text-gray-500",children:["($",t.totalSpentUSD.toLocaleString()," + ",t.totalSpentIQD.toLocaleString()," د.ع)"]})]}),e.jsx("div",{className:"h-4 w-px bg-gray-100 dark:bg-white/5"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[9px] text-gray-400 dark:text-gray-500 font-bold uppercase",children:"زيارات"}),e.jsx("p",{className:"text-xs font-black text-blue-600 dark:text-blue-400",children:t.bookingsCount})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-px bg-gray-100 dark:bg-white/5"}),e.jsx("button",{onClick:()=>x(t.name,t.phone),className:"w-8 h-8 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-blue-500 dark:text-blue-400 hover:bg-blue-500 hover:text-white flex items-center justify-center transition-all shadow-sm hover:shadow-md hover:scale-110",title:"حجز جديد لهذا العميل",children:e.jsx(Z,{size:14})})]})]}),t.notes.length>0&&e.jsx("div",{className:"absolute bottom-3 left-3 text-amber-400 opacity-50 group-hover:opacity-100",title:t.notes[t.notes.length-1],children:e.jsx(q,{size:12})})]})},t.id))})})]})};export{ye as default};
