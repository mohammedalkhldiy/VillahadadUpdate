const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BFvmHygk.js","./vendor-react-Ce27NbrU.js","./vendor-ui-TjLGESBy.js","./vendor-supabase-CSCOup90.js","./vendor-utils-DKqDJWuS.js","./index-BLpVv1z6.css"])))=>i.map(i=>d[i]);
import{n,p as S,_ as G,t as V,U as f}from"./index-BFvmHygk.js";import{r as c,j as e}from"./vendor-react-Ce27NbrU.js";import{bx as U,a6 as H,by as B,aM as F,a2 as Y,ba as K,l as Q,aQ as W,aS as q,ah as J,bi as X,ap as Z,a5 as ee,x as te,m as se,d as re}from"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";const oe=({bookings:d,users:z,onSelectBooking:E,onUpdateBooking:v})=>{const[P,O]=c.useState(new Date),[x,T]=c.useState(null),[g,w]=c.useState([]),y=c.useMemo(()=>{const t=d.filter(l=>l.approvalStatus==="pending").length,s=d.filter(l=>{if(!l.actualSelectionDate)return!1;const r=new Date(l.actualSelectionDate);return r.setDate(r.getDate()+60),r.getTime()<Date.now()&&l.status!==n.DELIVERED&&l.status!==n.ARCHIVED}).length;return t+s},[d]);c.useEffect(()=>{const t=S.getOnlineUsers();t.length>0&&w(t);const s=S.subscribe(l=>{w(l)});return()=>{s()}},[]),c.useEffect(()=>{const t=setInterval(()=>O(new Date),6e4);return R(),()=>clearInterval(t)},[d]);const R=async()=>{const{electronBackend:t}=await G(async()=>{const{electronBackend:l}=await import("./index-BFvmHygk.js").then(r=>r.L);return{electronBackend:l}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),s=await t.getAdminStats();T(s)},L=c.useMemo(()=>({reception:d.filter(t=>t.status===n.CONFIRMED||t.status===n.INQUIRY),shooting:d.filter(t=>t.status===n.SHOOTING||t.status===n.SHOOTING_COMPLETED),selection:d.filter(t=>t.status===n.SELECTION),editing:d.filter(t=>t.status===n.EDITING||t.status===n.READY_TO_PRINT),printing:d.filter(t=>t.status===n.PRINTING),delivery:d.filter(t=>t.status===n.READY_FOR_PICKUP||t.status===n.DELIVERED)}),[d]),k=c.useMemo(()=>new Set(g.map(t=>t.id)),[g]),C=t=>{const l={reception:[f.RECEPTION],shooting:[f.MANAGER],selection:[f.SELECTOR],editing:[f.PHOTO_EDITOR,f.VIDEO_EDITOR],printing:[f.PRINTER]}[t]||[];return z.filter(r=>l.includes(r.role)).map(r=>({...r,isOnline:k.has(r.id)}))},A=(t,s)=>{v&&v(t,{status:s})},j=new Date().toISOString().split("T")[0],h=c.useMemo(()=>{const t=new Date().toISOString().slice(0,10),s=d.filter(i=>!i.deletedAt),l=s.filter(i=>{const p=i.statusHistory,o=Array.isArray(p)?p[0]:null,a=(o==null?void 0:o.date)||(o==null?void 0:o.timestamp)||"";return String(a).startsWith(t)});let r=0;l.forEach(i=>{r+=i.paidAmount||0});let m=0;return s.forEach(i=>{if(i.status!==n.ARCHIVED){const p=(i.totalAmount||0)-(i.paidAmount||0);p>0&&(m+=p)}}),x!=null&&x.vault?{totalInDrawer:x.vault.totalInDrawer||r,deposits:x.vault.deposits||r,finals:x.vault.finals||0,outstanding:x.vault.outstanding>0?x.vault.outstanding:m}:{deposits:r,finals:0,totalInDrawer:r,outstanding:m}},[d,x,j]),N=c.useMemo(()=>d.filter(t=>t.shootDate===j&&t.status!==n.ARCHIVED),[d,j]),_=c.useMemo(()=>{const t={Garden:"الحديقة الخارجية",Studio:"الاستوديو الداخلي",VIP:"غرفة VIP",Royal:"الجناح الملكي",Outdoor:"التصوير الخارجي"},s=new Set;return N.forEach(r=>{r.location&&s.add(r.location)}),["Garden","Studio","VIP","Royal"].forEach(r=>s.add(r)),Array.from(s).map(r=>({id:r,name:t[r]||r,type:r==="Garden"||r==="Outdoor"?"outdoor":"indoor"}))},[N]),M=(t,s)=>N.find(l=>{var o,a;if(l.location!==t)return!1;const r=(o=l.details)==null?void 0:o.startTime,m=(a=l.details)==null?void 0:a.endTime;if(!r)return!1;const i=parseInt(r.split(":")[0]||"0"),p=m?parseInt(m.split(":")[0]||"24"):i+2;return s>=i&&s<p})||null,D=Array.from({length:14},(t,s)=>s+10),$=[{key:"reception",label:"الاستقبال",icon:U,color:"blue",status:n.CONFIRMED},{key:"shooting",label:"التصوير",icon:H,color:"amber",status:n.SHOOTING},{key:"selection",label:"الاختيار",icon:B,color:"purple",status:n.SELECTION},{key:"editing",label:"التعديل",icon:F,color:"cyan",status:n.EDITING},{key:"printing",label:"الطباعة",icon:Y,color:"pink",status:n.PRINTING},{key:"delivery",label:"التسليم",icon:K,color:"emerald",status:n.READY_FOR_PICKUP}],I={blue:{bg:"bg-blue-500/5",border:"border-blue-500/20",text:"text-blue-400",dot:"bg-blue-500",badge:"bg-blue-500"},amber:{bg:"bg-amber-500/5",border:"border-amber-500/20",text:"text-amber-400",dot:"bg-amber-500",badge:"bg-amber-500"},purple:{bg:"bg-purple-500/5",border:"border-purple-500/20",text:"text-purple-400",dot:"bg-purple-500",badge:"bg-purple-500"},cyan:{bg:"bg-cyan-500/5",border:"border-cyan-500/20",text:"text-cyan-400",dot:"bg-cyan-500",badge:"bg-cyan-500"},pink:{bg:"bg-pink-500/5",border:"border-pink-500/20",text:"text-pink-400",dot:"bg-pink-500",badge:"bg-pink-500"},emerald:{bg:"bg-emerald-500/5",border:"border-emerald-500/20",text:"text-emerald-400",dot:"bg-emerald-500",badge:"bg-emerald-500"}};return e.jsxs("div",{className:"min-h-screen bg-[#0b0c10] text-zinc-100 p-6 space-y-5 font-sans overflow-hidden relative",children:[e.jsxs("header",{className:"flex items-center justify-between border-b border-white/5 pb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-white tracking-tight mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#ff6d00] rounded-lg shadow-[0_0_20px_rgba(255,109,0,0.4)]",children:e.jsx(Q,{size:20,className:"text-white"})}),"مركز قيادة فيلا حداد"]}),e.jsxs("p",{className:"text-zinc-500 font-mono text-[10px] tracking-widest uppercase",children:["SUPERVISOR CONTROL DECK • ",P.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})," • ",g.length," متصلين الآن"]})]}),e.jsx("div",{className:"flex gap-3",children:y>0&&e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-red-500/10 border border-red-500/20 text-red-500 rounded-xl hover:bg-red-500/20 transition-all",children:[e.jsx(W,{size:16}),e.jsxs("span",{className:"text-xs font-bold",children:["تنبيهات (",y,")"]})]})})]}),e.jsxs("section",{className:"bg-[#14161c] border border-white/5 rounded-2xl p-5 relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("h2",{className:"text-base font-bold text-white flex items-center gap-2",children:[e.jsx(q,{size:18,className:"text-emerald-500"}),"شريان العمل الحي"]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-zinc-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-blue-500/10 border border-blue-500/20 rounded-full text-blue-400",children:[e.jsx(J,{size:10,className:"animate-pulse"}),e.jsx("span",{className:"font-bold",children:"مباشر"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),"تحديث مباشر"]})]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-3",children:$.map(t=>{const s=L[t.key]||[],l=C(t.key),r=l.filter(a=>a.isOnline),m=l.filter(a=>!a.isOnline),i=I[t.color]||I.blue,p=t.icon,o=s.length>5;return e.jsxs("div",{onDragOver:a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},onDrop:a=>{a.preventDefault();const u=a.dataTransfer.getData("bookingId");u&&(A(u,t.status),V.success("تم نقل العمل بنجاح"))},className:`relative rounded-xl border p-3 transition-all duration-300 ${o?"bg-red-500/5 border-red-500/20":`${i.bg} ${i.border}`} hover:border-white/20`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-7 h-7 rounded-lg flex items-center justify-center ${i.bg} border ${i.border}`,children:e.jsx(p,{size:14,className:i.text})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-white leading-none",children:t.label}),e.jsxs("p",{className:"text-[9px] text-zinc-500 mt-0.5",children:[s.length," حجز"]})]})]}),s.length>0&&e.jsx("div",{className:`min-w-[22px] h-[22px] px-1 ${i.badge} rounded-full flex items-center justify-center text-[10px] font-black text-white shadow-lg`,children:s.length})]}),e.jsx("div",{className:"mb-3 min-h-[36px]",children:r.length>0?e.jsx("div",{className:"flex flex-wrap gap-1.5",children:r.map(a=>{var u,b;return e.jsxs("div",{className:"group/staff relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-emerald-500/40 bg-zinc-800 overflow-hidden shadow-sm",children:a.avatar?e.jsx("img",{src:a.avatar,className:"w-full h-full object-cover",alt:a.name}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-tr from-zinc-700 to-zinc-600 text-[9px] text-white font-bold",children:((b=(u=a.name)==null?void 0:u[0])==null?void 0:b.toUpperCase())||"?"})}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-emerald-500 rounded-full border-2 border-[#14161c]"})]}),e.jsxs("div",{className:"absolute -bottom-7 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-black/90 text-white text-[9px] rounded opacity-0 group-hover/staff:opacity-100 transition-opacity whitespace-nowrap z-50 pointer-events-none",children:[a.name," ",e.jsx("span",{className:"text-emerald-400",children:"●"})]})]},a.id)})}):e.jsxs("div",{className:"flex items-center gap-1.5 text-[9px] text-zinc-600",children:[e.jsx("div",{className:"w-8 h-8 rounded-full border border-dashed border-zinc-700 flex items-center justify-center opacity-50",children:e.jsx(X,{size:12,className:"text-zinc-600"})}),m.length>0?e.jsxs("span",{className:"text-zinc-600",children:[m.length," غير متصل"]}):e.jsx("span",{children:"لا يوجد"})]})}),e.jsx("div",{className:"space-y-1.5 max-h-[120px] overflow-y-auto custom-scrollbar",children:s.length>0?e.jsxs(e.Fragment,{children:[s.slice(0,4).map(a=>{const u=a.category==="Location";return e.jsxs("div",{draggable:!0,onDragStart:b=>{b.dataTransfer.setData("bookingId",a.id),b.dataTransfer.effectAllowed="move"},onClick:()=>E(a),className:"flex items-center gap-2 p-1.5 rounded-lg bg-white/[0.03] border border-white/5 hover:bg-white/[0.08] hover:border-[#ff6d00]/30 cursor-pointer transition-all active:scale-95 relative",children:[e.jsx("div",{className:`absolute -top-1 -right-1 w-2.5 h-2.5 rounded-full border border-[#14161c] ${u?"bg-blue-500":"bg-purple-500"}`,title:u?"فيلا":"سرى"}),e.jsx("div",{className:`w-1 h-6 shrink-0 rounded-full ${i.dot}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-[10px] font-bold text-zinc-300 truncate dir-rtl text-right leading-tight",children:a.clientName}),e.jsx("p",{className:"text-[8px] text-zinc-600 truncate",children:a.title||a.category})]})]},a.id)}),s.length>4&&e.jsx("div",{className:"text-center pt-1",children:e.jsxs("span",{className:"text-[9px] text-zinc-600 font-mono",children:["+",s.length-4," آخرين"]})})]}):e.jsx("div",{className:"flex items-center justify-center py-3 text-[9px] text-zinc-700 italic",children:"فارغ"})}),o&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-500/50 animate-pulse rounded-b-xl"})]},t.key)})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-5 flex-1 min-h-0",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 bg-[#14161c] border border-white/5 rounded-2xl p-5 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 shrink-0",children:[e.jsxs("h2",{className:"text-base font-bold text-white flex items-center gap-2",children:[e.jsx(Z,{size:18,className:"text-purple-500"}),"شبكة إدارة المكان"]}),e.jsxs("div",{className:"flex gap-2 text-[10px] font-bold",children:[e.jsx("span",{className:"px-2 py-1 bg-zinc-800 rounded text-zinc-400",children:"متاح"}),e.jsx("span",{className:"px-2 py-1 bg-red-500/20 text-red-500 rounded border border-red-500/10",children:"محجوز"})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto custom-scrollbar relative border border-white/5 rounded-xl bg-[#0a0c10]",children:[e.jsxs("div",{className:"flex border-b border-white/5 sticky top-0 bg-[#14161c] z-10",children:[e.jsx("div",{className:"w-32 shrink-0 p-2.5 text-[10px] font-bold text-zinc-500 border-l border-white/5 text-center",children:"القاعة / الوقت"}),D.map(t=>e.jsxs("div",{className:"flex-1 min-w-[50px] p-2.5 text-center text-[10px] font-mono text-zinc-400 border-l border-white/5",children:[t,":00"]},t))]}),_.map(t=>e.jsxs("div",{className:"flex border-b border-white/5 hover:bg-white/[0.02] transition-colors",children:[e.jsxs("div",{className:"w-32 shrink-0 p-3 text-[10px] font-bold text-white border-l border-white/5 flex items-center gap-2",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${t.type==="outdoor"?"bg-green-500":"bg-purple-500"}`}),t.name]}),D.map(s=>{const l=M(t.id,s);return l?e.jsxs("div",{className:"flex-1 min-w-[50px] bg-red-500/20 border-l border-red-500/20 relative group cursor-pointer hover:bg-red-500/30 transition-colors",children:[e.jsx("div",{className:"hidden group-hover:block absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-zinc-900 border border-white/10 px-2 py-1 rounded text-[9px] whitespace-nowrap z-20 shadow-2xl",children:l.clientName}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"})})]},s):e.jsx("div",{className:"flex-1 min-w-[50px] border-l border-white/5 hover:bg-white/5 transition-colors"},s)})]},t.id))]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-4 flex flex-col gap-5",children:[e.jsxs("div",{className:"bg-[#14161c] border border-white/5 rounded-2xl p-5 flex-1 flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-emerald-500/5 rounded-full blur-[60px] -mr-24 -mt-24 pointer-events-none"}),e.jsx("div",{className:"flex items-center justify-between mb-5",children:e.jsxs("h2",{className:"text-base font-bold text-white flex items-center gap-2",children:[e.jsx(ee,{size:18,className:"text-emerald-500"}),"الخزنة اليومية"]})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center space-y-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500 text-[10px] font-bold uppercase tracking-wider mb-1",children:"الموجود الفعلي (في الدرج)"}),e.jsxs("div",{className:"text-4xl font-black text-white font-mono tracking-tighter",children:[h.totalInDrawer.toLocaleString()," ",e.jsx("span",{className:"text-sm text-emerald-500",children:"$"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-900/50 border border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),e.jsx("p",{className:"text-[9px] text-zinc-400 uppercase",children:"عربونات اليوم"})]}),e.jsx("p",{className:"text-lg font-bold text-blue-400 font-mono",children:h.deposits.toLocaleString()})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-900/50 border border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),e.jsx("p",{className:"text-[9px] text-zinc-400 uppercase",children:"تصفية حساب"})]}),e.jsx("p",{className:"text-lg font-bold text-emerald-400 font-mono",children:h.finals.toLocaleString()})]})]}),e.jsxs("div",{className:"pt-4 border-t border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsx("p",{className:"text-zinc-500 text-[10px] font-bold uppercase",children:"ديون مستحقة (في السوق)"}),h.outstanding>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500/10 text-red-500 text-[9px] rounded border border-red-500/10 font-bold",children:h.outstanding>1e6?"عالي":"متوسط"})]}),e.jsx("p",{className:`text-xl font-bold font-mono ${h.outstanding>0?"text-red-400":"text-zinc-500"}`,children:h.outstanding.toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-rose-900/20 to-black border border-rose-500/20 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-rose-400 font-bold text-sm flex items-center gap-2",children:[e.jsx(te,{size:14}),"تسليمات عاجلة"]}),e.jsx("span",{className:"text-[9px] text-zinc-500 bg-zinc-900 px-2 py-0.5 rounded-full border border-white/5",children:"60 يوم من الاختيار"})]}),e.jsxs("div",{className:"space-y-2",children:[d.filter(t=>t.isPriority||t.actualSelectionDate).map(t=>{let s=999;if(t.actualSelectionDate){const l=new Date(t.actualSelectionDate),r=new Date(l);r.setDate(r.getDate()+60),s=Math.ceil((r.getTime()-Date.now())/(1e3*60*60*24))}return{...t,daysLeft:s}}).filter(t=>t.isPriority||t.daysLeft<=10).sort((t,s)=>t.isPriority&&!s.isPriority?-1:!t.isPriority&&s.isPriority?1:t.daysLeft-s.daysLeft).slice(0,4).map((t,s)=>e.jsxs(se.div,{animate:t.isPriority||t.daysLeft<=7?{x:[-1,1,-1,1,0]}:{},transition:{repeat:1/0,duration:.4},className:`flex items-center justify-between p-2.5 rounded-lg border ${t.isPriority?"bg-orange-500/10 border-orange-500/30":t.daysLeft<=3?"bg-rose-500/10 border-rose-500/30":"bg-white/[0.03] border-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("span",{className:`text-[10px] font-bold text-white w-5 h-5 flex items-center justify-center rounded-full shadow-lg ${t.isPriority?"bg-orange-500":"bg-rose-500"}`,children:t.isPriority?"⚡":s+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-zinc-200 font-bold",children:t.clientName}),e.jsx("p",{className:"text-[8px] text-zinc-500",children:t.isPriority?"أولوية قصوى":"موعد التسليم"})]})]}),e.jsx("span",{className:`text-[10px] font-mono font-black ${t.isPriority?"text-orange-400":t.daysLeft<0?"text-rose-500":"text-amber-500"}`,children:t.isPriority?"عاجل":t.daysLeft<0?`متأخر ${Math.abs(t.daysLeft)}`:`${t.daysLeft} يوم`})]},t.id)),d.filter(t=>t.actualSelectionDate||t.isPriority).length===0&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-8 h-8 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-1.5 text-zinc-500",children:e.jsx(re,{size:14})}),e.jsx("p",{className:"text-[9px] text-zinc-600",children:"لا توجد تسليمات عاجلة"})]})]})]})]})]})]})};export{oe as default};
