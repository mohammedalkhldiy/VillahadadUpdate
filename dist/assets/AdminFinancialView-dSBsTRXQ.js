import{r as l,j as e}from"./vendor-react-Ce27NbrU.js";import{w as F}from"./index-BFvmHygk.js";import{m as r}from"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";function Q(d,u=3e4,x=!0){const b=l.useRef(d),[p,v]=l.useState(new Date),[y,g]=l.useState(!1);return l.useEffect(()=>{b.current=d},[d]),l.useEffect(()=>{if(!x)return;const f=setInterval(async()=>{try{g(!0),await b.current(),v(new Date)}catch(c){console.error("Auto-refresh error:",c)}finally{g(!1)}},u);return()=>clearInterval(f)},[u,x]),{lastRefreshTime:p,isRefreshing:y}}const J=()=>{const[d,u]=l.useState({totalReceivables:0,receivedToday:0,pendingPayments:0,overdueClients:0}),[x,b]=l.useState([]),[p,v]=l.useState([]),[y,g]=l.useState([]),[A,f]=l.useState(!0),[c,O]=l.useState(!0),N=async(t=!1)=>{try{t||f(!0);let i=[];try{i=(await F.selectFrom("bookings").selectAll().where("deletedAt","is",null).orderBy("shootDate","asc").execute()).map(a=>({id:a.id,client_name:a.clientName,total_amount:a.totalAmount,paid_amount:a.paidAmount,shoot_date:a.shootDate,status:a.status,details:a.details,paymentReceivedBy:a.paymentReceivedBy||void 0,paymentReceivedAt:a.paymentReceivedAt||void 0}))}catch(s){console.error("Query failed",s),i=[]}let D=0,S=0,T=0;const w=[],k=[],E=[],I=new Date;I.setHours(0,0,0,0),i.forEach(s=>{const a=s.total_amount||0,o=s.paid_amount||0,m=a-o,_=new Date(s.shoot_date);_.setHours(0,0,0,0);const h=Math.floor((_.getTime()-I.getTime())/(1e3*60*60*24));let C="10:00";try{const j=typeof s.details=="string"?JSON.parse(s.details):s.details;C=(j==null?void 0:j.startTime)||"10:00"}catch{}const L={id:s.id,clientName:s.client_name||"Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",sessionDate:s.shoot_date,sessionTime:C,totalAmount:a,paidAmount:o,remainingAmount:m,status:s.status,isDepositOnly:o>0&&m>0&&o<a*.5,paymentReceivedBy:s.paymentReceivedBy,paymentReceivedAt:s.paymentReceivedAt};h===0?(E.push(L),o>0&&(S+=o)):h>0&&h<=7&&k.push(L),m>0&&(D+=m,T++,h<0&&s.status!=="COMPLETED"&&w.push({clientName:s.client_name||"Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",bookingId:s.id,amountDue:m,dueDate:s.shoot_date,daysOverdue:Math.abs(h)}))}),u({totalReceivables:D,receivedToday:S,pendingPayments:T,overdueClients:w.length}),b(w.sort((s,a)=>a.daysOverdue-s.daysOverdue)),v(k),g(E)}catch(i){console.error("Error loading financial data:",i)}finally{f(!1)}},{lastRefreshTime:B,isRefreshing:R}=Q(()=>N(!0),3e4,c);l.useEffect(()=>{N()},[]);const n=t=>new Intl.NumberFormat("ar-IQ",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);return A?e.jsx("div",{className:"flex items-center justify-center h-screen bg-linear-to-br from-slate-900 via-blue-900 to-slate-900",children:e.jsx("div",{className:"text-white text-xl",children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})}):e.jsxs("div",{className:"min-h-screen bg-linear-to-br from-slate-900 via-blue-900 to-slate-900 p-6",children:[e.jsxs(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-2",children:"ðŸŽ¯ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©"}),e.jsx("p",{className:"text-blue-300 text-sm",children:"Ù…Ø±Ø§Ù‚Ø¨Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© - Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-blue-400 mb-1",children:"Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«"}),e.jsx("div",{className:"text-sm text-white font-bold",children:R?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"âŸ³"}),"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«..."]}):new Date(B).toLocaleTimeString("ar-IQ")})]}),e.jsx("button",{onClick:()=>O(!c),className:`px-4 py-2 rounded-xl font-bold text-sm transition-all ${c?"bg-green-500/20 text-green-300 border border-green-400/30 hover:bg-green-500/30":"bg-gray-500/20 text-gray-300 border border-gray-400/30 hover:bg-gray-500/30"}`,children:c?"â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ":"â–¶ï¸ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ"}),e.jsx("button",{onClick:()=>N(!1),disabled:R,className:"px-4 py-2 rounded-xl font-bold text-sm bg-blue-500/20 text-blue-300 border border-blue-400/30 hover:bg-blue-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†"})]})]}),c&&e.jsxs("div",{className:"text-xs text-blue-400 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù‘Ù„ (ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},className:"bg-linear-to-br from-blue-500/20 to-cyan-500/20 backdrop-blur-xl border border-blue-400/30 rounded-3xl p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/30 rounded-2xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ðŸ’°"})}),e.jsx("div",{className:"text-xs text-blue-300 bg-blue-500/20 px-3 py-1 rounded-full",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ"})]}),e.jsx("div",{className:"text-3xl font-black text-white mb-1",dir:"ltr",children:n(d.totalReceivables)}),e.jsx("div",{className:"text-sm text-blue-200",children:"Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©"})]}),e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2},className:"bg-linear-to-br from-green-500/20 to-emerald-500/20 backdrop-blur-xl border border-green-400/30 rounded-3xl p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/30 rounded-2xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"âœ…"})}),e.jsx("div",{className:"text-xs text-green-300 bg-green-500/20 px-3 py-1 rounded-full",children:"Ø§Ù„ÙŠÙˆÙ…"})]}),e.jsx("div",{className:"text-3xl font-black text-white mb-1",dir:"ltr",children:n(d.receivedToday)}),e.jsx("div",{className:"text-sm text-green-200",children:"Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©"})]}),e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3},className:"bg-linear-to-br from-yellow-500/20 to-orange-500/20 backdrop-blur-xl border border-yellow-400/30 rounded-3xl p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-500/30 rounded-2xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"â³"})}),e.jsx("div",{className:"text-xs text-yellow-300 bg-yellow-500/20 px-3 py-1 rounded-full",children:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"})]}),e.jsx("div",{className:"text-3xl font-black text-white mb-1",children:d.pendingPayments}),e.jsx("div",{className:"text-sm text-yellow-200",children:"Ø¯ÙØ¹Ø§Øª Ù…Ø¹Ù„Ù‚Ø©"})]}),e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.4},className:"bg-linear-to-br from-red-500/20 to-pink-500/20 backdrop-blur-xl border border-red-400/30 rounded-3xl p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/30 rounded-2xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"âš ï¸"})}),e.jsx("div",{className:"text-xs text-red-300 bg-red-500/20 px-3 py-1 rounded-full",children:"ØªÙ†Ø¨ÙŠÙ‡"})]}),e.jsx("div",{className:"text-3xl font-black text-white mb-1",children:d.overdueClients}),e.jsx("div",{className:"text-sm text-red-200",children:"Ø¹Ù…Ù„Ø§Ø¡ Ù…ØªØ£Ø®Ø±ÙŠÙ†"})]})]}),x.length>0&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-linear-to-br from-red-500/10 to-pink-500/10 backdrop-blur-xl border border-red-400/20 rounded-3xl p-6 shadow-2xl mb-8",children:[e.jsxs("h2",{className:"text-2xl font-black text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"ðŸš¨"}),"ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¯ÙØ¹"]}),e.jsx("div",{className:"space-y-4",children:x.map((t,i)=>e.jsx(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6+i*.1},className:"bg-white/5 border border-red-400/20 rounded-2xl p-4 hover:bg-white/10 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-bold text-lg mb-1",children:t.clientName}),e.jsxs("div",{className:"text-red-300 text-sm",children:["Ù…ØªØ£Ø®Ø± ",t.daysOverdue," ÙŠÙˆÙ… â€¢ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: ",new Date(t.dueDate).toLocaleDateString("ar-IQ")]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-2xl font-black text-red-400",dir:"ltr",children:n(t.amountDue)}),e.jsx("div",{className:"text-xs text-red-300",children:"Ø¯ÙŠÙ†Ø§Ø±"})]})]})},t.bookingId))})]}),y.length>0&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-linear-to-br from-cyan-500/10 to-blue-500/10 backdrop-blur-xl border border-cyan-400/20 rounded-3xl p-6 shadow-2xl mb-8",children:[e.jsxs("h2",{className:"text-2xl font-black text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ“…"}),"Ø¬Ù„Ø³Ø§Øª Ø§Ù„ÙŠÙˆÙ…"]}),e.jsx("div",{className:"space-y-4",children:y.map((t,i)=>e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.7+i*.1},className:`border rounded-2xl p-4 transition-all ${t.remainingAmount>0?"bg-orange-500/10 border-orange-400/30 hover:bg-orange-500/20":"bg-green-500/10 border-green-400/30 hover:bg-green-500/20"}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-white font-black text-lg",children:t.clientName}),t.isDepositOnly&&e.jsx("span",{className:"text-xs bg-orange-500/30 text-orange-300 px-2 py-1 rounded-full font-bold",children:"Ø¹Ø±Ø¨ÙˆÙ† ÙÙ‚Ø·"}),t.remainingAmount===0&&e.jsx("span",{className:"text-xs bg-green-500/30 text-green-300 px-2 py-1 rounded-full font-bold",children:"Ù…Ø¯ÙÙˆØ¹ ÙƒØ§Ù…Ù„"})]}),e.jsxs("div",{className:"text-cyan-300 text-sm",children:["Ø§Ù„Ø³Ø§Ø¹Ø© ",t.sessionTime]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3 pt-3 border-t border-white/10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ"}),e.jsx("div",{className:"text-white font-bold",dir:"ltr",children:n(t.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Ø§Ù„Ù…Ø¯ÙÙˆØ¹"}),e.jsx("div",{className:"text-green-400 font-bold",dir:"ltr",children:n(t.paidAmount)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Ø§Ù„Ø¨Ø§Ù‚ÙŠ"}),e.jsx("div",{className:`font-bold ${t.remainingAmount>0?"text-orange-400":"text-green-400"}`,dir:"ltr",children:n(t.remainingAmount)})]})]}),t.paymentReceivedBy&&t.paidAmount>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-cyan-400/20",children:e.jsxs("div",{className:"flex items-center gap-2 text-cyan-300 text-sm",children:[e.jsx("span",{children:"ðŸ‘¤"}),e.jsxs("span",{children:["Ù‚Ø¨Ø¶Ù‡Ø§: ",e.jsx("span",{className:"font-bold",children:t.paymentReceivedBy})]}),t.paymentReceivedAt&&e.jsxs("span",{className:"text-xs text-gray-400",children:["â€¢ ",new Date(t.paymentReceivedAt).toLocaleTimeString("ar-IQ",{hour:"2-digit",minute:"2-digit"})]})]})}),t.remainingAmount>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-orange-400/20",children:e.jsxs("div",{className:"flex items-center gap-2 text-orange-300 text-sm font-bold",children:[e.jsx("span",{children:"âš ï¸"}),e.jsx("span",{children:"ØªÙ†Ø¨ÙŠÙ‡: Ø§Ø³ØªÙ„Ù… Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©!"})]})})]},t.id))})]}),p.length>0&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"bg-linear-to-br from-indigo-500/10 to-purple-500/10 backdrop-blur-xl border border-indigo-400/20 rounded-3xl p-6 shadow-2xl mb-8",children:[e.jsxs("h2",{className:"text-2xl font-black text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ”®"}),"Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (7 Ø£ÙŠØ§Ù…)"]}),e.jsx("div",{className:"space-y-4",children:p.map((t,i)=>e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.8+i*.1},className:"bg-white/5 border border-indigo-400/20 rounded-2xl p-4 hover:bg-white/10 transition-all",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-bold text-lg mb-1",children:t.clientName}),e.jsxs("div",{className:"text-indigo-300 text-sm",children:[new Date(t.sessionDate).toLocaleDateString("ar-IQ",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," â€¢ ",t.sessionTime]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3 pt-3 border-t border-white/10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ"}),e.jsx("div",{className:"text-white font-bold",dir:"ltr",children:n(t.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Ø§Ù„Ù…Ø¯ÙÙˆØ¹"}),e.jsx("div",{className:"text-green-400 font-bold",dir:"ltr",children:n(t.paidAmount)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Ø§Ù„Ø¨Ø§Ù‚ÙŠ"}),e.jsx("div",{className:`font-bold ${t.remainingAmount>0?"text-yellow-400":"text-green-400"}`,dir:"ltr",children:n(t.remainingAmount)})]})]})]},t.id))})]})]})};export{J as default};
