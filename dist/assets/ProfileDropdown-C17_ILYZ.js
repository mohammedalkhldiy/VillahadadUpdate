import{r as l,j as e}from"./vendor-react-Ce27NbrU.js";import{u as k,U as a,t as o}from"./index-BFvmHygk.js";import{a6 as j,ax as I,bW as O}from"./vendor-ui-TjLGESBy.js";function M({currentUser:r,onLogout:v,onOpenSettings:f,collapsed:h=!1,minimal:D=!1,dropDirection:N="up"}){const[m,n]=l.useState(!1),[p,c]=l.useState(!1),u=l.useRef(null),x=l.useRef(null),{updateUser:y}=k();l.useEffect(()=>{const t=s=>{u.current&&!u.current.contains(s.target)&&n(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const g=()=>{switch(r.role){case a.MANAGER:return"المديرة";case a.ADMIN:return"المشرف";case a.RECEPTION:return"الاستقبال";case a.PHOTO_EDITOR:return"مصمم صور";case a.VIDEO_EDITOR:return"مونتير";case a.PRINTER:return"الطباعة";case a.SELECTOR:return"الانتقاء";default:return r.role}},b=()=>{var s;const t=r.avatar;if(t&&(t.includes("http")||t.includes("data:")||t.includes("url("))){const d=t.startsWith("url(")?t.slice(4,-1):t;return e.jsx("img",{src:d,alt:r.name,className:"w-full h-full object-cover"})}return e.jsx("span",{className:"text-white font-bold text-sm",children:((s=r.name)==null?void 0:s.charAt(0))||"?"})},R=async t=>{var d;const s=(d=t.target.files)==null?void 0:d[0];if(s){if(!s.type.startsWith("image/")){o.error("يرجى اختيار صورة");return}if(s.size>2*1024*1024){o.error("حجم الصورة كبير (أقصى 2MB)");return}c(!0);try{const i=new FileReader;i.onload=async z=>{var w;const A=(w=z.target)==null?void 0:w.result;await y(r.id,{avatar:A}),o.success("تم تغيير الصورة بنجاح"),c(!1)},i.onerror=()=>{o.error("فشل في قراءة الصورة"),c(!1)},i.readAsDataURL(s)}catch(i){console.error("Avatar update failed:",i),o.error("فشل في تحديث الصورة"),c(!1)}}},C={up:"bottom-full left-0 right-0 mb-2",left:"right-full bottom-0 mr-2",right:"left-full bottom-0 ml-2",down:"top-full left-0 right-0 mt-2"},E=e.jsx("input",{ref:x,type:"file",accept:"image/*",className:"hidden",onChange:R});return e.jsxs("div",{ref:u,className:"relative",dir:"rtl",children:[E,e.jsxs("button",{"data-testid":"profile-dropdown-trigger",onClick:()=>n(!m),className:`w-full flex items-center gap-3 p-3 hover:bg-white/5 transition-all ${h?"justify-center":""}`,children:[e.jsx("div",{className:"w-9 h-9 bg-zinc-800 border border-white/10 overflow-hidden flex items-center justify-center shrink-0",children:b()}),!h&&e.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[e.jsx("p",{className:"text-sm font-bold text-white truncate",children:r.name}),e.jsx("p",{className:"text-[10px] text-zinc-500",children:g()})]})]}),m&&e.jsxs("div",{className:`absolute ${C[N]} w-56 bg-[#111] border border-white/[0.06] rounded-xl shadow-2xl overflow-hidden z-[100]`,children:[e.jsxs("div",{className:"p-4 border-b border-white/[0.06] flex items-center gap-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-11 h-11 bg-zinc-800 border border-white/10 overflow-hidden flex items-center justify-center",children:b()}),e.jsx("button",{onClick:t=>{var s;t.stopPropagation(),(s=x.current)==null||s.click()},disabled:p,className:"absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:e.jsx(j,{size:14,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-white truncate",children:r.name}),e.jsx("p",{className:"text-[10px] text-zinc-500",children:g()})]})]}),e.jsxs("div",{className:"p-1",children:[e.jsxs("button",{onClick:()=>{var t;(t=x.current)==null||t.click(),n(!1)},className:"w-full flex items-center gap-3 px-3 py-2.5 text-sm text-zinc-400 hover:text-white hover:bg-white/5 transition-colors",children:[e.jsx(j,{size:16}),e.jsx("span",{children:p?"جارِ التحديث...":"تغيير الصورة"})]}),f&&e.jsxs("button",{onClick:()=>{n(!1),f()},className:"w-full flex items-center gap-3 px-3 py-2.5 text-sm text-zinc-400 hover:text-white hover:bg-white/5 transition-colors",children:[e.jsx(I,{size:16}),e.jsx("span",{children:"الإعدادات"})]}),e.jsx("div",{className:"h-px bg-white/6 my-1"}),e.jsxs("button",{onClick:()=>{n(!1),v()},className:"w-full flex items-center gap-3 px-3 py-2.5 text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:[e.jsx(O,{size:16}),e.jsx("span",{children:"تسجيل خروج"})]})]})]})]})}export{M as P};
