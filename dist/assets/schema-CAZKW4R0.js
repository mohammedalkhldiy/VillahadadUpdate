import{w as e}from"./index-BFvmHygk.js";import"./vendor-react-Ce27NbrU.js";import"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";async function r(){console.log("üîß [initDB] Starting database schema initialization...");const a=Date.now();try{await e.schema.createTable("users").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("name","text",t=>t.notNull()).addColumn("role","text",t=>t.notNull()).addColumn("avatar","text").addColumn("password","text").addColumn("email","text").addColumn("jobTitle","text").addColumn("preferences","text").addColumn("deletedAt","integer").execute(),await e.schema.createTable("bookings").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("location","text").addColumn("clientId","text").addColumn("clientName","text",t=>t.notNull()).addColumn("clientPhone","text").addColumn("category","text",t=>t.notNull()).addColumn("title","text",t=>t.notNull()).addColumn("shootDate","text").addColumn("status","text",t=>t.notNull()).addColumn("totalAmount","real",t=>t.notNull().defaultTo(0)).addColumn("paidAmount","real",t=>t.notNull().defaultTo(0)).addColumn("currency","text",t=>t.notNull().defaultTo("IQD")).addColumn("servicePackage","text").addColumn("details","text").addColumn("nasStatus","text",t=>t.defaultTo("none")).addColumn("nasProgress","integer",t=>t.defaultTo(0)).addColumn("notes","text").addColumn("assignedShooter","text").addColumn("assignedPhotoEditor","text").addColumn("assignedPrinter","text").addColumn("assignedReceptionist","text").addColumn("statusHistory","text").addColumn("createdBy","text").addColumn("updatedBy","text").addColumn("updatedAt","text").addColumn("deletedAt","integer").addColumn("actualSelectionDate","text").addColumn("deliveryDeadline","text").addColumn("photoEditCompletedAt","text").addColumn("videoEditCompletedAt","text").addColumn("printCompletedAt","text").addColumn("paymentReceivedBy","text").addColumn("paymentReceivedAt","text").addColumn("isPriority","integer",t=>t.defaultTo(0)).addColumn("isCrewShooting","integer",t=>t.defaultTo(0)).addColumn("originalPackagePrice","real").addColumn("addOnTotal","real",t=>t.defaultTo(0)).addColumn("paymentHistory","text").addColumn("invoiceHistory","text").addColumn("exchangeRate","real").addColumn("client_token","text").execute(),await e.schema.createTable("payments").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("bookingId","text",t=>t.notNull().references("bookings.id").onDelete("cascade")).addColumn("amount","real",t=>t.notNull()).addColumn("date","text",t=>t.notNull()).addColumn("method","text",t=>t.notNull()).addColumn("collectedBy","text",t=>t.notNull()).addColumn("notes","text").addColumn("deletedAt","integer").addColumn("currency","text").addColumn("exchangeRate","real").addColumn("convertedAmount","real").addColumn("type","text").addColumn("relatedAddOnId","text").execute(),await e.schema.createTable("reminders").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("bookingId","text",t=>t.references("bookings.id").onDelete("cascade")).addColumn("title","text",t=>t.notNull()).addColumn("dueDate","text",t=>t.notNull()).addColumn("completed","integer",t=>t.notNull().defaultTo(0)).addColumn("type","text",t=>t.notNull().defaultTo("general")).addColumn("customIcon","text").addColumn("deletedAt","integer").execute(),await e.schema.createTable("dashboard_tasks").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("title","text",t=>t.notNull()).addColumn("time","text").addColumn("createdAt","text").addColumn("completed","integer",t=>t.notNull().defaultTo(0)).addColumn("type","text",t=>t.notNull().defaultTo("general")).addColumn("source","text",t=>t.defaultTo("manual")).addColumn("relatedBookingId","text").addColumn("priority","text",t=>t.defaultTo("normal")).addColumn("deletedAt","integer").execute(),await e.schema.createTable("sync_queue").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("action","text",t=>t.notNull()).addColumn("entity","text",t=>t.notNull()).addColumn("data","text",t=>t.notNull()).addColumn("status","text",t=>t.defaultTo("pending")).addColumn("createdAt","text",t=>t.notNull()).addColumn("retryCount","integer",t=>t.defaultTo(0)).execute(),await e.schema.createTable("leaves").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("userId","text",t=>t.notNull()).addColumn("userName","text",t=>t.notNull()).addColumn("startDate","text",t=>t.notNull()).addColumn("endDate","text",t=>t.notNull()).addColumn("type","text",t=>t.notNull()).addColumn("reason","text").addColumn("status","text",t=>t.notNull().defaultTo("Pending")).addColumn("approvedBy","text").addColumn("createdAt","text",t=>t.notNull()).addColumn("updatedAt","text",t=>t.notNull()).addColumn("deletedAt","text").execute(),await e.schema.createTable("activity_logs").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("userId","text",t=>t.notNull()).addColumn("userName","text",t=>t.notNull()).addColumn("action","text",t=>t.notNull()).addColumn("entityType","text",t=>t.notNull()).addColumn("entityId","text").addColumn("details","text").addColumn("createdAt","text",t=>t.notNull()).execute(),await e.schema.createTable("daily_attendance").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("userId","text",t=>t.notNull()).addColumn("userName","text",t=>t.notNull()).addColumn("date","text",t=>t.notNull()).addColumn("checkIn","text").addColumn("checkOut","text").addColumn("status","text",t=>t.notNull().defaultTo("Absent")).addColumn("totalHours","real",t=>t.defaultTo(0)).addColumn("isFrozen","integer",t=>t.defaultTo(0)).addColumn("createdAt","text",t=>t.notNull()).addColumn("updatedAt","text",t=>t.notNull()).execute(),await e.schema.createTable("messages").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("content","text",t=>t.notNull()).addColumn("senderId","text",t=>t.notNull()).addColumn("senderName","text",t=>t.notNull()).addColumn("senderRole","text",t=>t.notNull()).addColumn("recipientId","text").addColumn("type","text",t=>t.notNull().defaultTo("text")).addColumn("createdAt","text",t=>t.notNull()).addColumn("isRead","integer",t=>t.defaultTo(0)).execute(),await e.schema.createTable("packages").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("category","text",t=>t.notNull()).addColumn("name","text",t=>t.notNull()).addColumn("basePrice","real",t=>t.notNull()).addColumn("currentPrice","real",t=>t.notNull()).addColumn("currency","text",t=>t.notNull().defaultTo("IQD")).addColumn("discountType","text").addColumn("discountValue","real").addColumn("discountStart","text").addColumn("discountEnd","text").addColumn("isCustom","integer",t=>t.defaultTo(0)).addColumn("isActive","integer",t=>t.defaultTo(1)).addColumn("isBestseller","integer",t=>t.defaultTo(0)).addColumn("features","text").addColumn("details","text").addColumn("createdAt","text",t=>t.notNull()).addColumn("updatedAt","text",t=>t.notNull()).addColumn("deletedAt","integer").execute(),await e.schema.createTable("add_ons").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("bookingId","text",t=>t.notNull().references("bookings.id").onDelete("cascade")).addColumn("category","text",t=>t.notNull()).addColumn("description","text",t=>t.notNull()).addColumn("amount","real",t=>t.notNull()).addColumn("currency","text",t=>t.notNull().defaultTo("IQD")).addColumn("exchangeRate","real",t=>t.notNull()).addColumn("convertedAmount","real",t=>t.notNull()).addColumn("status","text",t=>t.notNull().defaultTo("pending")).addColumn("requestedBy","text",t=>t.notNull()).addColumn("requestedByName","text",t=>t.notNull()).addColumn("requestedAt","text",t=>t.notNull()).addColumn("approvedBy","text").addColumn("approvedByName","text").addColumn("approvedAt","text").addColumn("originalPackagePrice","real",t=>t.notNull()).addColumn("previousTotal","real",t=>t.notNull()).addColumn("newTotal","real",t=>t.notNull()).addColumn("customerNotifiedAt","text").addColumn("notificationMethod","text").addColumn("invoiceId","text").addColumn("invoicedAt","text").addColumn("paymentRecordId","text").addColumn("paidAt","text").addColumn("notes","text").addColumn("createdAt","text",t=>t.notNull()).addColumn("updatedAt","text",t=>t.notNull()).addColumn("deletedAt","integer").execute(),await e.schema.createTable("add_on_audit").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("addOnId","text",t=>t.notNull()).addColumn("bookingId","text",t=>t.notNull()).addColumn("action","text",t=>t.notNull()).addColumn("performedBy","text",t=>t.notNull()).addColumn("performedByName","text",t=>t.notNull()).addColumn("performedAt","text",t=>t.notNull()).addColumn("details","text",t=>t.notNull()).addColumn("oldValues","text").addColumn("newValues","text").execute(),await e.schema.createIndex("idx_add_ons_booking_id").ifNotExists().on("add_ons").column("bookingId").execute(),await e.schema.createIndex("idx_add_ons_status").ifNotExists().on("add_ons").column("status").execute(),await e.schema.createIndex("idx_add_on_audit_add_on_id").ifNotExists().on("add_on_audit").column("addOnId").execute(),await e.schema.createIndex("idx_add_on_audit_booking_id").ifNotExists().on("add_on_audit").column("bookingId").execute(),await e.schema.createTable("client_transactions").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("clientId","text",t=>t.notNull()).addColumn("bookingId","text").addColumn("amount","real",t=>t.notNull()).addColumn("currency","text",t=>t.notNull().defaultTo("IQD")).addColumn("type","text",t=>t.notNull()).addColumn("note","text",t=>t.notNull()).addColumn("status","text",t=>t.notNull().defaultTo("active")).addColumn("createdAt","text",t=>t.notNull()).addColumn("updatedAt","text",t=>t.notNull()).addColumn("createdBy","text",t=>t.notNull()).addColumn("createdByName","text",t=>t.notNull()).addColumn("canReverseUntil","text",t=>t.notNull()).addColumn("reversedAt","text").addColumn("reversedBy","text").addColumn("reversedByName","text").addColumn("reversalReason","text").addColumn("balanceAfter","real",t=>t.notNull()).execute(),await e.schema.createIndex("idx_client_transactions_client_id").ifNotExists().on("client_transactions").column("clientId").execute(),await e.schema.createIndex("idx_client_transactions_booking_id").ifNotExists().on("client_transactions").column("bookingId").execute(),await e.schema.createIndex("idx_client_transactions_status").ifNotExists().on("client_transactions").column("status").execute(),await e.schema.createIndex("idx_client_transactions_created_at").ifNotExists().on("client_transactions").column("createdAt").execute(),await e.schema.createTable("session_images").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("sessionId","text",t=>t.notNull()).addColumn("bookingId","text",t=>t.references("bookings.id").onDelete("cascade")).addColumn("fileName","text",t=>t.notNull()).addColumn("originalPath","text").addColumn("cloudUrl","text").addColumn("thumbnailUrl","text").addColumn("status","text",t=>t.notNull().defaultTo("pending")).addColumn("selectedBy","text").addColumn("selectedAt","text").addColumn("liked","integer",t=>t.defaultTo(0)).addColumn("notes","text").addColumn("sortOrder","integer",t=>t.defaultTo(0)).addColumn("uploadedAt","text",t=>t.notNull()).addColumn("updatedAt","text").addColumn("syncedToCloud","integer",t=>t.defaultTo(0)).execute(),await e.schema.createIndex("idx_session_images_session_id").ifNotExists().on("session_images").column("sessionId").execute(),await e.schema.createIndex("idx_session_images_booking_id").ifNotExists().on("session_images").column("bookingId").execute(),await e.schema.createIndex("idx_session_images_status").ifNotExists().on("session_images").column("status").execute(),await e.schema.createIndex("idx_session_images_selected").ifNotExists().on("session_images").column("liked").execute(),await e.schema.createTable("sessions").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("bookingId","text",t=>t.references("bookings.id").onDelete("cascade")).addColumn("clientName","text",t=>t.notNull()).addColumn("nasPath","text").addColumn("cloudGalleryUrl","text").addColumn("status","text",t=>t.notNull().defaultTo("ingesting")).addColumn("totalImages","integer",t=>t.defaultTo(0)).addColumn("selectedImages","integer",t=>t.defaultTo(0)).addColumn("uploadProgress","integer",t=>t.defaultTo(0)).addColumn("selectionMethod","text",t=>t.defaultTo("studio")).addColumn("selectionConfirmedAt","text").addColumn("r2CleanupAfter","text").addColumn("r2Cleaned","integer",t=>t.defaultTo(0)).addColumn("createdAt","text",t=>t.notNull()).addColumn("updatedAt","text").addColumn("completedAt","text").execute(),await e.schema.createTable("inventory").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("name","text",t=>t.notNull()).addColumn("type","text",t=>t.notNull()).addColumn("icon","text").addColumn("status","text",t=>t.defaultTo("storage")).addColumn("assignedTo","text").addColumn("batteryCharged","integer").addColumn("batteryTotal","integer").addColumn("memoryFree","integer").addColumn("memoryTotal","integer").addColumn("notes","text").addColumn("createdAt","text",t=>t.notNull()).addColumn("updatedAt","text").execute(),await e.schema.createTable("inventory_logs").ifNotExists().addColumn("id","text",t=>t.primaryKey()).addColumn("itemId","text",t=>t.notNull()).addColumn("action","text",t=>t.notNull()).addColumn("userId","text",t=>t.notNull()).addColumn("details","text").addColumn("createdAt","text",t=>t.notNull()).execute(),await e.schema.createIndex("idx_inventory_assigned_to").ifNotExists().on("inventory").column("assignedTo").execute(),await e.schema.createIndex("idx_sessions_booking_id").ifNotExists().on("sessions").column("bookingId").execute(),await e.schema.createIndex("idx_sessions_status").ifNotExists().on("sessions").column("status").execute(),console.log(`‚úÖ [initDB] Database Schema Initialized Successfully (${Date.now()-a}ms)`),await o()}catch(t){throw console.error("‚ùå [initDB] Failed to initialize database schema:",t),t}}async function o(){var a;try{console.log("üîÑ [Migration] Running database migrations...");const t=window.electronAPI;if(!(t!=null&&t.db)){console.log("‚ö†Ô∏è [Migration] No Electron API available, skipping migrations");return}try{const d=await t.db.query("SELECT COUNT(*) as count FROM pragma_table_info('bookings') WHERE name = 'exchangeRate'");((a=d==null?void 0:d[0])==null?void 0:a.count)>0?console.log("‚úÖ [Migration] exchangeRate column already exists"):(console.log("üîÑ [Migration] Adding exchangeRate column to bookings table..."),await t.db.run("ALTER TABLE bookings ADD COLUMN exchangeRate REAL"),console.log("‚úÖ [Migration] exchangeRate column added successfully"))}catch(d){console.warn("‚ö†Ô∏è [Migration] exchangeRate migration failed:",d)}try{await t.db.run("PRAGMA foreign_keys = OFF"),console.log("‚úÖ [Migration] Foreign key enforcement disabled")}catch(d){console.warn("‚ö†Ô∏è [Migration] Failed to disable FK enforcement:",d)}console.log("‚úÖ [Migration] All migrations completed")}catch(t){console.warn("‚ö†Ô∏è [Migration] Failed to run migrations:",t)}}export{r as initDB};
