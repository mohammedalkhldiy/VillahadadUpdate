import{r as x,j as e}from"./vendor-react-Ce27NbrU.js";import{C as v,s as N,N as C,a as _}from"./index-BFvmHygk.js";import{X as S,V as z,av as k,O as A,A as E,aw as F,M as $,f as I,ax as y}from"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";const T=({onClose:d,managerName:m="Manager"})=>{const[a,b]=x.useState([]),[l,t]=x.useState(!0),[s,r]=x.useState(null);x.useEffect(()=>{n()},[]);const n=async()=>{t(!0);const h=await v.fetchPendingConflicts();b(h),t(!1),h.length>0&&g(h[0].booking_id)},g=async h=>{const{data:p}=await N.from("bookings").select("*").eq("id",h).single();r(p)},u=async(h,p)=>{try{await v.resolveConflict(h,p,m);const o=a.filter(f=>f.id!==h);b(o),o.length>0?g(o[0].booking_id):d()}catch{alert("فشل في تنفيذ العملية. تأكد من الاتصال.")}};if(l)return null;const i=a[0];return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#1A1A1A] rounded-2xl shadow-2xl w-full max-w-5xl h-[80vh] flex flex-col overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center bg-gray-50 dark:bg-[#1F1F1F]",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-amber-500"}),"غرفة التدقيق وفض التضارب"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["يوجد ",a.length," حالات تضارب تحتاج لقرارك."]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(S,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto border-l border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-[#151515]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-200 text-gray-700 dark:bg-gray-800 dark:text-gray-300",children:"النسخة الحالية (السحابية)"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["آخر تعديل: ",(s==null?void 0:s.updated_by_name)||"غير معروف"]})]}),e.jsx(j,{data:s,isProposed:!1})]}),e.jsx("div",{className:"w-12 flex items-center justify-center bg-white dark:bg-[#1A1A1A] z-10",children:e.jsx(z,{className:"text-gray-300 dark:text-gray-600"})}),e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto bg-amber-50/30 dark:bg-amber-900/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-100 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-500 animate-pulse"}),"المقترح الجديد"]}),e.jsxs("span",{className:"text-xs text-amber-600 dark:text-amber-400 font-medium",children:["المقترح من: ",i.proposed_by_name," (",i.proposed_by_rank,")"]})]}),e.jsx(j,{data:i.proposed_data,isProposed:!0,original:s})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 dark:border-gray-800 bg-white dark:bg-[#1F1F1F] flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"بقبولك للتعديل، سيتم اعتماده كحقيقة نهائية ومسح النسخة القديمة."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>u(i.id,"REJECT"),className:"px-6 py-3 rounded-xl border border-red-200 text-red-600 hover:bg-red-50 dark:border-red-900/30 dark:text-red-400 dark:hover:bg-red-900/20 font-medium flex items-center gap-2 transition-all",children:[e.jsx(k,{className:"w-4 h-4"}),"رفض (إبقاء الحالي)"]}),e.jsxs("button",{onClick:()=>u(i.id,"ACCEPT"),className:"px-6 py-3 rounded-xl bg-amber-500 hover:bg-amber-600 text-white shadow-lg shadow-amber-500/20 font-bold flex items-center gap-2 transition-all",children:[e.jsx(A,{className:"w-5 h-5"}),"قبول التعديل المقترح"]})]})]})]})}):null},j=({data:d,isProposed:m,original:a})=>{if(!d)return e.jsx("div",{className:"p-10 text-center text-gray-400",children:"جاري التحميل..."});const b=[{key:"client_name",label:"العميل"},{key:"phone",label:"الهاتف"},{key:"title",label:"عنوان المناسبة"},{key:"shoot_date",label:"تاريخ التصوير",isTime:!0},{key:"total_amount",label:"المبلغ الكلي",isMoney:!0},{key:"status",label:"الحالة"},{key:"notes",label:"ملاحظات"}];return e.jsx("div",{className:"space-y-4",children:b.map(l=>{const t=d[l.key],s=a?a[l.key]:null,r=m&&a&&t!=s;return e.jsxs("div",{className:`p-3 rounded-lg border ${r?"border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-900/20":"border-transparent hover:bg-white dark:hover:bg-gray-800"} transition-all`,children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:l.label}),e.jsx("div",{className:`font-medium ${r?"text-amber-800 dark:text-amber-200":"text-gray-800 dark:text-gray-200"}`,children:t||"-"}),r&&e.jsxs("div",{className:"mt-1 text-xs text-red-400 line-through",children:["كان: ",s||"(فارغ)"]})]},l.key)})})},P=({managerName:d})=>{const[m,a]=x.useState(0),[b,l]=x.useState(!1);return x.useEffect(()=>{const t=async()=>{const r=await v.fetchPendingConflicts();a(r.length)};t();const s=setInterval(t,15e3);return()=>clearInterval(s)},[]),m===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>l(!0),className:"relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:"تضارب بيانات يحتاج مراجعة",children:[e.jsx(E,{className:"w-6 h-6 text-amber-500 animate-pulse"}),e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full shadow-md",children:m})]}),b&&e.jsx(T,{onClose:()=>{l(!1),v.fetchPendingConflicts().then(t=>a(t.length))},managerName:d})]})},R=({activeSection:d,onNavigate:m,currentUser:a,onLogout:b,onOpenSettings:l,onOpenDeletedBookings:t,badges:s,isDarkMode:r,themeMode:n,toggleTheme:g})=>{var f;const[u,i]=x.useState(!1),[h,p]=x.useState(!1),o=[{id:"section-home",label:"الرئيسية"},{id:"section-team",label:"الفريق"},{id:"section-team-chat",label:"دردشة الفريق"},{id:"section-clients",label:"العملاء"},{id:"section-workflow",label:"سير العمل"},{id:"section-financial",label:"المالية"},{id:"section-files",label:"المعرض"}];return e.jsxs("header",{className:"flex items-center justify-between mb-2 mt-1",children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("nav",{className:"hidden md:flex items-center gap-1.5 bg-white/70 dark:bg-black/40 backdrop-blur-xl rounded-4xl p-1.5 pl-2 shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-white/40 dark:border-white/5 ring-1 ring-black/5 dark:ring-white/10 transition-all hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] hover:bg-white/90 dark:hover:bg-black/60",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-linear-to-tr from-amber-300 to-yellow-500 shadow-[0_0_10px_rgba(251,191,36,0.6)]":"bg-linear-to-tr from-amber-400 to-amber-600 shadow-[0_0_8px_rgba(251,191,36,0.5)]"} mx-2 animate-pulse`}),o.map(c=>e.jsxs("button",{"data-testid":c.id,onClick:()=>m(c.id),className:`px-5 py-2.5 rounded-3xl text-sm font-bold font-tajawal transition-all duration-300 relative overflow-hidden group ${d===c.id?"text-white dark:text-black shadow-lg shadow-gray-900/20 dark:shadow-amber-500/20":"text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-white/50 dark:hover:bg-white/10"}`,children:[d===c.id&&e.jsx("div",{className:`absolute inset-0 ${r?"bg-amber-400":"bg-gray-900"} rounded-3xl -z-10`}),c.label,s&&s[c.id]?e.jsx("span",{className:"absolute top-1.5 left-2 w-2 h-2 bg-rose-500 rounded-full animate-pulse shadow-sm ring-1 ring-white"}):null]},c.id))]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[g&&e.jsxs("button",{onClick:g,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 shadow-sm border relative group ${r?"bg-amber-500/10 border-amber-500/30 text-amber-400 hover:bg-amber-500/20":"bg-white/70 border-white/40 text-amber-500 hover:bg-white hover:text-amber-600"}`,title:`الوضع الحالي: ${n==="auto"?"تلقائي (حسب الوقت)":n==="dark"?"ليلي":"نهاري"}`,children:[n==="auto"&&e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-sky-500"})]}),n==="light"?e.jsx(F,{size:18}):n==="dark"?e.jsx($,{size:18}):e.jsx(I,{size:18,className:"text-sky-500"}),e.jsxs("span",{className:"absolute top-full mt-2 right-0 px-2 py-1 bg-black text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:[n==="light"&&"نهاري ثابت",n==="dark"&&"ليلي ثابت",n==="auto"&&"تلقائي (مساءً/صباحاً)"]})]}),e.jsx(C,{theme:"manager"}),e.jsx("div",{className:"relative z-50",children:e.jsx(P,{managerName:a==null?void 0:a.name})}),t&&e.jsxs("button",{onClick:t,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 shadow-sm border relative group ${r?"bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20":"bg-white/70 border-white/40 text-red-500 hover:bg-white hover:text-red-600"}`,title:"سلة المحذوفات",children:[e.jsx(k,{size:18}),e.jsx("span",{className:"absolute top-full mt-2 right-0 px-2 py-1 bg-black text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"سلة المحذوفات"})]}),e.jsx("div",{className:"relative z-50",children:e.jsx(_,{})}),e.jsxs("div",{className:"flex items-center gap-2 relative",children:[e.jsx("button",{"data-testid":"user-menu-btn",onClick:()=>i(!u),className:"w-11 h-11 rounded-full p-0.5 bg-linear-to-tr from-amber-200 to-transparent shadow-sm hover:scale-105 transition-transform",children:e.jsx("div",{className:"w-full h-full rounded-full border-2 border-white dark:border-gray-800 overflow-hidden relative group",children:a!=null&&a.avatar&&a.avatar.startsWith("bg-")?e.jsx("div",{className:`w-full h-full ${a.avatar} flex items-center justify-center text-white font-bold text-xs`,children:a.name.charAt(0)}):e.jsx("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center text-gray-500 font-bold",children:((f=a==null?void 0:a.name)==null?void 0:f.charAt(0))||"U"})})}),u&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-56 bg-white/90 dark:bg-[#1a1c22]/95 backdrop-blur-3xl shadow-2xl ring-1 ring-black/5 rounded-2xl z-100 p-2 border border-white dark:border-white/5 animate-in slide-in-from-top-2 fade-in",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-gray-100 dark:border-white/5 flex items-center gap-3 mb-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${(a==null?void 0:a.avatar)||"bg-gray-400"} flex items-center justify-center text-white text-xs font-bold`,children:a==null?void 0:a.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 dark:text-white",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-[10px] text-gray-400 uppercase",children:a==null?void 0:a.role})]})]}),e.jsxs("button",{onClick:()=>{i(!1),l&&l()},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-xl transition-colors",children:[e.jsx(y,{size:16}),e.jsx("span",{children:"إعدادات الحساب"})]}),e.jsxs("button",{onClick:()=>{i(!1),b&&b()},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors mt-1",children:[e.jsx(y,{size:16,className:"rotate-180"})," ",e.jsx("span",{children:"تسجيل خروج"})]})]})]})]})]})},M=({children:d,activeSection:m,onNavigate:a,currentUser:b,onLogout:l,onOpenSettings:t,onOpenDeletedBookings:s,hideHeader:r=!1,badges:n})=>{const[g,u]=x.useState(()=>localStorage.getItem("manager_theme_mode")||"light"),[i,h]=x.useState(!1);x.useEffect(()=>{const o=()=>{let c=!1;if(g==="auto"){const w=new Date().getHours();c=w<6||w>=18}else c=g==="dark";h(c),c?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};o();const f=setInterval(o,6e4);return()=>clearInterval(f)},[g]);const p=()=>{u(o=>{const f=o==="light"?"dark":o==="dark"?"auto":"light";return localStorage.setItem("manager_theme_mode",f),f})};return e.jsx("div",{className:`${i?"dark":""} h-screen w-full`,children:e.jsxs("div",{className:"h-screen w-full relative bg-linear-to-b from-[#F2E9CE] via-[#F8F9FA] to-white dark:from-[#0f1115] dark:via-[#1a1c22] dark:to-[#0f1115] text-gray-900 dark:text-gray-100 font-sans overflow-hidden flex flex-col transition-colors duration-500",children:[e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02] mix-blend-overlay bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"}),e.jsx("div",{className:"absolute -top-[10%] -left-[10%] w-[50vw] h-[50vw] bg-white/40 dark:bg-amber-500/5 rounded-full blur-[120px] mix-blend-overlay animate-pulse-slow"}),e.jsx("div",{className:"absolute top-[20%] right-[-10%] w-[40vw] h-[40vw] bg-amber-50/20 dark:bg-purple-500/5 rounded-full blur-[100px] mix-blend-overlay"})]}),!r&&e.jsx("div",{className:"px-6 pt-2 relative z-50",children:e.jsx(R,{activeSection:m,onNavigate:a,currentUser:b,onLogout:l,onOpenSettings:t,onOpenDeletedBookings:s,badges:n,isDarkMode:i,themeMode:g,toggleTheme:p})}),e.jsx("main",{className:"flex-1 px-6 pt-2 pb-8 overflow-hidden flex flex-col relative z-10",children:e.jsx("div",{className:"w-full h-full overflow-y-auto custom-scrollbar rounded-4xl bg-white/10 dark:bg-black/20 backdrop-blur-md shadow-[0_8px_32px_0_rgba(31,38,135,0.07)] p-5 pb-0",children:d})})]})})};export{M as default};
