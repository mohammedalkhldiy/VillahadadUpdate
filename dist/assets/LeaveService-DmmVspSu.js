import{y as l,w as u,e as i,s as c,z as o}from"./index-BFvmHygk.js";import"./vendor-react-Ce27NbrU.js";import"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";class v{async addLeaveForEmployee(r,t,a){const s=JSON.parse(localStorage.getItem("user")||"{}"),e={id:l(),userId:r,userName:t,startDate:a.startDate,endDate:a.endDate,type:a.type,reason:a.reason||"",status:"Approved",approvedBy:s.name||"Admin",createdAt:new Date().toISOString()},n=new Date().toISOString();await u.insertInto("leaves").values({id:e.id,userId:e.userId,userName:e.userName,startDate:e.startDate,endDate:e.endDate,type:e.type,reason:e.reason,status:e.status,createdAt:e.createdAt,updatedAt:n,approvedBy:e.approvedBy||null,deletedAt:null}).execute(),await i.logAction("add_leave","leave",e.id,`Admin added ${e.type} leave for ${t}`);const d={id:e.id,user_id:e.userId,user_name:e.userName,start_date:e.startDate,end_date:e.endDate,type:e.type,reason:e.reason,status:e.status,approved_by:e.approvedBy,created_at:e.createdAt};if(navigator.onLine){const{error:p}=await c.from("leaves").insert(d);p&&(console.error("Cloud sync failed for leave:",p),await o.enqueue("create","leave",d))}else await o.enqueue("create","leave",d);return e}async requestLeave(r){const t=JSON.parse(localStorage.getItem("user")||"{}"),a={id:l(),userId:t.id||"unknown",userName:t.name||"Unknown",startDate:r.startDate,endDate:r.endDate,type:r.type,reason:r.reason||"",status:"Pending",createdAt:new Date().toISOString()},s={...a,updatedAt:new Date().toISOString()};await u.insertInto("leaves").values({id:s.id,userId:s.userId,userName:s.userName,startDate:s.startDate,endDate:s.endDate,type:s.type,reason:s.reason,status:s.status,createdAt:s.createdAt,updatedAt:s.updatedAt,approvedBy:null,deletedAt:null}).execute(),await i.logAction("leave_request","leave",a.id,`New ${a.type} leave request from ${a.userName}`);const e={id:a.id,user_id:a.userId,user_name:a.userName,start_date:a.startDate,end_date:a.endDate,type:a.type,reason:a.reason,status:a.status,created_at:a.createdAt};if(navigator.onLine){const{error:n}=await c.from("leaves").insert(e);n&&(console.error("Cloud sync failed for leave:",n),await o.enqueue("create","leave",e))}else await o.enqueue("create","leave",e);return a}async updateLeaveStatus(r,t){const s=JSON.parse(localStorage.getItem("user")||"{}").name||"Manager",e=new Date().toISOString();await u.updateTable("leaves").set({status:t,approvedBy:s,updatedAt:e}).where("id","=",r).execute(),await i.logAction(t==="Approved"?"approve_leave":"reject_leave","leave",r,`${t} leave request ${r}`);const n={status:t,approved_by:s,updated_at:e};if(navigator.onLine){const{error:d}=await c.from("leaves").update(n).eq("id",r);d&&await o.enqueue("update","leave",{id:r,...n})}else await o.enqueue("update","leave",{id:r,...n})}async getAllLeaves(){try{return(await u.selectFrom("leaves").selectAll().orderBy("createdAt","desc").execute()).map(t=>({id:t.id,userId:t.userId,userName:t.userName,startDate:t.startDate,endDate:t.endDate,type:t.type,reason:t.reason||"",status:t.status,approvedBy:t.approvedBy||void 0,createdAt:t.createdAt}))}catch(r){return console.error("Error fetching leaves:",r),[]}}}const S=new v;export{v as LeaveService,S as leaveService};
