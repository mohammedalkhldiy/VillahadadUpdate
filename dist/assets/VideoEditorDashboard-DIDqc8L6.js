import{r as n,j as e}from"./vendor-react-Ce27NbrU.js";import{n as l}from"./index-BFvmHygk.js";import{a7 as j,b5 as T,b3 as A,e as O,ab as _,x as R,bB as D,d as G,h as L,ar as V,k as w,aF as $,v as Y}from"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";const F=({isManager:h=!1,bookings:f=[]})=>{const N=f.filter(t=>{var o;return(t.status==="completed"||t.status==="confirmed")&&(t.category==="Wedding"||t.category==="زفاف"||((o=t.details)==null?void 0:o.includesVideo))}).slice(0,10).map(t=>{var o,a;return{id:t.id,name:`فيديو ${t.clientName}`,notes:((o=t.details)==null?void 0:o.videoNotes)||((a=t.details)==null?void 0:a.notes)||void 0,status:"pending"}}),[r,p]=n.useState(N),[d,b]=n.useState(new Set),[c,u]=n.useState(!1),[m,s]=n.useState({x:100,y:100}),[i,x]=n.useState(!1),[g,v]=n.useState({x:0,y:0}),S=t=>{b(o=>{const a=new Set(o);return a.has(t)?a.delete(t):a.add(t),a})},M=t=>{p(o=>o.map(a=>{if(a.id===t){const P=a.status==="pending"?"in_progress":a.status==="in_progress"?"completed":"pending";return{...a,status:P}}return a}))},k=t=>{c&&(x(!0),v({x:t.clientX-m.x,y:t.clientY-m.y}))},I=t=>{i&&s({x:t.clientX-g.x,y:t.clientY-g.y})},y=()=>{x(!1)},C=t=>{switch(t){case"completed":return e.jsx(G,{size:16,className:"text-green-400"});case"in_progress":return e.jsx(D,{size:16,className:"text-purple-400 fill-purple-400/30"});default:return e.jsx(D,{size:16,className:"text-gray-500"})}},z=t=>{switch(t){case"completed":return"مكتمل";case"in_progress":return"قيد المونتاج";default:return"في الانتظار"}};if(r.length===0)return e.jsxs("div",{className:"bg-[#1a1c22] rounded-2xl border border-white/5 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-white font-bold text-sm flex items-center gap-2",children:[e.jsx(j,{size:16,className:"text-purple-400"}),"مشاريع الفيديو"]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(j,{size:32,className:"mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"لا توجد فيديوهات للمونتاج"}),e.jsx("p",{className:"text-xs mt-1",children:"ستظهر هنا بعد حفلات الزفاف"})]})]});const E=e.jsxs("div",{className:`bg-[#1a1c22] rounded-2xl border border-white/5 ${c?"shadow-2xl":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/5 cursor-move",onMouseDown:k,children:[e.jsxs("h3",{className:"text-white font-bold text-sm flex items-center gap-2",children:[e.jsx(j,{size:16,className:"text-purple-400"}),"مشاريع الفيديو",e.jsx("span",{className:"text-xs bg-purple-500/20 text-purple-400 px-2 py-0.5 rounded-full",children:r.length})]}),e.jsx("button",{onClick:()=>u(!c),className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors text-gray-400 hover:text-white",children:c?e.jsx(T,{size:14}):e.jsx(A,{size:14})})]}),e.jsx("div",{className:"p-3 space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar",children:r.map(t=>e.jsxs("div",{className:"bg-black/20 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("button",{onClick:()=>S(t.id),className:"flex items-center gap-2 flex-1 hover:bg-white/5 -m-1 p-1 rounded transition-colors",children:[d.has(t.id)?e.jsx(O,{size:16,className:"text-gray-400 shrink-0"}):e.jsx(_,{size:16,className:"text-gray-400 shrink-0"}),e.jsx("span",{className:"text-white text-sm font-medium truncate",children:t.name})]}),e.jsxs("button",{onClick:()=>M(t.id),className:"flex items-center gap-1.5 px-2 py-1 rounded-lg hover:bg-white/10 transition-colors",title:"تغيير الحالة",children:[C(t.status),e.jsx("span",{className:"text-xs text-gray-400",children:z(t.status)})]})]}),d.has(t.id)&&e.jsx("div",{className:"px-3 pb-3 border-t border-white/5",children:t.notes?e.jsx("div",{className:"mt-2 p-2 bg-purple-500/10 border border-purple-500/20 rounded-lg",children:e.jsxs("p",{className:"text-purple-400 text-xs flex items-start gap-2",children:[e.jsx(R,{size:12,className:"shrink-0 mt-0.5"}),e.jsx("span",{children:t.notes})]})}):e.jsx("p",{className:"text-gray-500 text-xs mt-2 text-center py-2",children:"لا توجد ملاحظات خاصة"})})]},t.id))})]});return c?e.jsx("div",{className:"fixed z-50 w-80",style:{left:m.x,top:m.y},onMouseMove:I,onMouseUp:y,onMouseLeave:y,children:E}):E},q=({currentUser:h,bookings:f=[],onStatusUpdate:N})=>{const r=n.useMemo(()=>f.filter(s=>s.assignedVideoEditor===h.id||s.assignedShooter===h.id),[f,h.id]),p=n.useMemo(()=>r.filter(s=>s.status===l.EDITING||s.status===l.SHOOTING_COMPLETED),[r]),d=n.useMemo(()=>r.filter(s=>s.status===l.READY_TO_PRINT||s.status===l.PRINTING||s.status===l.READY_FOR_PICKUP||s.status===l.DELIVERED||s.status===l.ARCHIVED),[r]),b=n.useMemo(()=>r.filter(s=>s.status===l.EDITING),[r]),c=[{label:"مشاريع نشطة",value:String(p.length),icon:L,color:"text-blue-400"},{label:"قيد التحرير",value:String(b.length),icon:V,color:"text-yellow-400"},{label:"مكتملة",value:String(d.length),icon:w,color:"text-green-400"},{label:"إجمالي المشاريع",value:String(r.length),icon:j,color:"text-purple-400"}],u=n.useMemo(()=>p.map(s=>{let i=0,x="";switch(s.status){case l.SHOOTING_COMPLETED:i=10,x="بانتظار البدء";break;case l.EDITING:const g=s.videoEditStartedAt||s.updatedAt;if(g){const v=Math.floor((Date.now()-new Date(g).getTime())/864e5);i=Math.min(90,20+v*10)}else i=30;x="قيد التحرير";break;default:i=50,x=s.status}return{id:s.id,name:s.clientName||s.title,status:x,progress:i,shootDate:s.shootDate,category:s.category,bookingStatus:s.status}}).sort((s,i)=>s.progress-i.progress),[p]),m=async s=>{N&&await N(s,l.READY_TO_PRINT)};return e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-[#1E1E1E]",dir:"rtl",children:[e.jsx("div",{className:"h-16 bg-[#252526] border-b border-[#3E3E42] flex items-center px-8 shrink-0",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-white text-xl font-semibold",children:["مرحباً، ",h.name]}),e.jsx("p",{className:"text-[#858585] text-sm",children:"محرر فيديو"})]})}),e.jsxs("div",{className:"flex-1 flex gap-6 p-8 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-6 overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"#3E3E42 transparent"},children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map(s=>{const i=s.icon;return e.jsxs("div",{className:"bg-[#252526] border border-[#3E3E42] rounded-lg p-5 hover:border-[#0078D4] transition-colors",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx(i,{className:`${s.color}`,size:22})}),e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:s.value}),e.jsx("div",{className:"text-sm text-[#858585]",children:s.label})]},s.label)})}),e.jsxs("div",{className:"bg-[#252526] border border-[#3E3E42] rounded-lg p-6",children:[e.jsxs("h2",{className:"text-white text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx($,{size:18,className:"text-blue-400"}),"المشاريع النشطة (",u.length,")"]}),e.jsx("div",{className:"space-y-3",children:u.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{size:40,className:"text-emerald-500 mx-auto mb-3 opacity-40"}),e.jsx("p",{className:"text-[#858585] text-sm",children:"لا توجد مشاريع نشطة حالياً"}),e.jsx("p",{className:"text-[#555] text-xs mt-1",children:"المشاريع المعينة لك ستظهر هنا"})]}):u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#1E1E1E] rounded border border-[#3E3E42] hover:border-[#0078D4] transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium mb-1",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.bookingStatus===l.EDITING?"bg-yellow-500/10 text-yellow-400":"bg-blue-500/10 text-blue-400"}`,children:s.status}),s.shootDate&&e.jsxs("span",{className:"text-[11px] text-[#666] flex items-center gap-1",children:[e.jsx(Y,{size:10}),s.shootDate]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-28",children:[e.jsx("div",{className:"h-2 bg-[#3E3E42] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${s.progress>=80?"bg-emerald-500":s.progress>=50?"bg-blue-500":"bg-yellow-500"}`,style:{width:`${s.progress}%`}})}),e.jsxs("div",{className:"text-xs text-[#858585] mt-1 text-left",children:[s.progress,"%"]})]}),s.bookingStatus===l.EDITING&&e.jsx("button",{onClick:()=>m(s.id),className:"px-3 py-1.5 bg-emerald-500/10 border border-emerald-500/20 rounded text-[10px] font-bold text-emerald-400 hover:bg-emerald-500 hover:text-white transition-colors",children:"اكتمل"})]})]},s.id))})]}),d.length>0&&e.jsxs("div",{className:"bg-[#252526] border border-[#3E3E42] rounded-lg p-6",children:[e.jsxs("h2",{className:"text-white text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(w,{size:18,className:"text-emerald-400"}),"مكتملة (",d.length,")"]}),e.jsx("div",{className:"space-y-2",children:d.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#1E1E1E] rounded border border-[#3E3E42]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white text-sm",children:s.clientName||s.title}),e.jsxs("span",{className:"text-[#555] text-xs mr-2",children:["(",s.shootDate,")"]})]}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-emerald-500/10 text-emerald-400",children:"مكتمل"})]},s.id))})]})]}),e.jsx("div",{className:"w-80 shrink-0",children:e.jsx(F,{isManager:!1})})]})]})};export{q as default};
