import{r as x,j as e}from"./vendor-react-Ce27NbrU.js";import{s as D}from"./index-BFvmHygk.js";import{y as T,K as M,i as S,R as z,l as h,bk as U,aQ as F,k as E,W as _,n as q}from"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";const P=()=>{const[p,g]=x.useState([]),[C,R]=x.useState([]),[i,A]=x.useState({totalBookings:0,overdueBookings:0,unpaidBookings:0,onlineUsers:0,totalUsers:0,todayBookings:0,syncStatus:"unknown",dbSize:"...",lastSync:"..."}),[L,f]=x.useState(!0),u=x.useCallback(async()=>{var j,N,v;f(!0);const s=window.electronAPI,t=[],b=new Date,m=b.toLocaleTimeString("ar-IQ",{hour:"2-digit",minute:"2-digit"});try{let n=0,o=0,c=0,y=0;if(s!=null&&s.db)try{const r=await s.db.query("SELECT id, status, shootDate, totalAmount, paidAmount, deliveryDeadline FROM bookings WHERE deletedAt IS NULL");n=r.length;const l=b.toISOString().split("T")[0];y=r.filter(a=>a.shootDate===l).length,o=r.filter(a=>a.deliveryDeadline?a.deliveryDeadline<l&&a.status!=="Delivered"&&a.status!=="Archived":!1).length,c=r.filter(a=>{const k=Number(a.totalAmount)||0,$=Number(a.paidAmount)||0;return k>0&&$<k&&a.status!=="Delivered"&&a.status!=="Archived"}).length,o>0&&t.push({id:"overdue",type:"critical",source:"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",message:`${o} Ø­Ø¬ÙˆØ²Ø§Øª ØªØ¬Ø§ÙˆØ²Øª Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…`,time:m,icon:T}),c>3&&t.push({id:"unpaid",type:"warning",source:"Ø§Ù„Ù…Ø§Ù„ÙŠØ©",message:`${c} Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ù…Ø¨Ø§Ù„Øº Ù…Ø³ØªØ­Ù‚Ø© ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©`,time:m,icon:M})}catch(r){console.error("War Room: booking stats failed",r)}let w=0;if(s!=null&&s.db)try{w=((j=(await s.db.query("SELECT COUNT(*) as count FROM users WHERE deletedAt IS NULL"))[0])==null?void 0:j.count)||0}catch{}let d="offline";try{const{data:r,error:l}=await D.from("users").select("id").limit(1);l||(d="online")}catch{d="offline"}if(d==="offline"&&t.push({id:"sync",type:"critical",source:"Ø§Ù„Ø§ØªØµØ§Ù„",message:"ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ - Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„",time:m,icon:S}),s!=null&&s.db)try{const l=((N=(await s.db.query("SELECT COUNT(*) as count FROM sync_queue WHERE status = 'pending'"))[0])==null?void 0:N.count)||0;l>10&&t.push({id:"sync-queue",type:"warning",source:"Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©",message:`${l} Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©`,time:m,icon:z})}catch{}if(s!=null&&s.db)try{const l=((v=(await s.db.query("SELECT COUNT(*) as count FROM activity_logs WHERE createdAt > datetime('now', '-1 hour')"))[0])==null?void 0:v.count)||0;l>100&&t.push({id:"activity",type:"warning",source:"Ø§Ù„Ù†Ø´Ø§Ø·",message:`Ù†Ø´Ø§Ø· Ù…Ø±ØªÙØ¹ ØºÙŠØ± Ø¹Ø§Ø¯ÙŠ: ${l} Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©`,time:m,icon:h})}catch{}const W=[{label:"Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…",value:d==="online"?100:0,max:100,status:d==="online"?"good":"critical",unit:"%"},{label:"Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©",value:n,max:Math.max(n,100),status:n>0?"good":"warning",unit:"Ø­Ø¬Ø²"},{label:"Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©",value:o,max:n||1,status:o===0?"good":o>3?"critical":"warning",unit:"Ø­Ø¬Ø²"},{label:"Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª",value:c,max:n||1,status:c===0?"good":c>5?"critical":"warning",unit:"Ø­Ø¬Ø²"}];g(t),R(W),A({totalBookings:n,overdueBookings:o,unpaidBookings:c,onlineUsers:0,totalUsers:w,todayBookings:y,syncStatus:d,dbSize:"...",lastSync:d==="online"?"Ø§Ù„Ø¢Ù†":"ØºÙŠØ± Ù…ØªØµÙ„"})}catch(n){console.error("War Room: system data fetch failed",n)}f(!1)},[]);x.useEffect(()=>{u();const s=setInterval(u,6e4);return()=>clearInterval(s)},[u]);const O=s=>{g(t=>t.filter(b=>b.id!==s))},B=s=>{switch(s){case"good":return"bg-emerald-500";case"warning":return"bg-amber-500";case"critical":return"bg-rose-500";default:return"bg-zinc-500"}},I=s=>{switch(s){case"good":return"text-emerald-400";case"warning":return"text-amber-400";case"critical":return"text-rose-400";default:return"text-zinc-400"}};return e.jsxs("div",{className:"h-full flex flex-col font-mono p-4 gap-4",dir:"rtl",children:[e.jsxs("div",{className:"bg-rose-950/20 backdrop-blur-xl border border-rose-500/30 rounded-2xl p-5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[repeating-linear-gradient(45deg,transparent,transparent_10px,rgba(244,63,94,0.05)_10px,rgba(244,63,94,0.05)_20px)] pointer-events-none"}),e.jsx("div",{className:"absolute top-4 left-4 animate-pulse",children:e.jsx("div",{className:"w-3 h-3 bg-rose-500 rounded-full shadow-[0_0_15px_#f43f5e]"})}),e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-rose-500/20 rounded-xl text-rose-500 border border-rose-500/30",children:e.jsx(U,{size:28,className:"animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-rose-500 tracking-tighter uppercase",children:"ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"}),e.jsxs("p",{className:"text-[10px] text-rose-400/60 font-bold tracking-[0.15em] uppercase",children:["WAR ROOM â€¢ LIVE MONITORING â€¢ ",i.syncStatus==="online"?"ðŸŸ¢ ONLINE":"ðŸ”´ OFFLINE"]})]})]}),e.jsxs("button",{onClick:u,className:"px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-[10px] font-bold text-zinc-300 flex items-center gap-1 transition-colors",children:[e.jsx(z,{size:12,className:L?"animate-spin":""})," ØªØ­Ø¯ÙŠØ«"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-4 relative z-10",children:[e.jsxs("div",{className:"bg-black/30 rounded-xl p-3 border border-white/5 text-center",children:[e.jsx("p",{className:"text-2xl font-black text-white",children:i.totalBookings}),e.jsx("p",{className:"text-[9px] text-zinc-500 uppercase",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"})]}),e.jsxs("div",{className:"bg-black/30 rounded-xl p-3 border border-white/5 text-center",children:[e.jsx("p",{className:"text-2xl font-black text-cyan-400",children:i.todayBookings}),e.jsx("p",{className:"text-[9px] text-zinc-500 uppercase",children:"Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…"})]}),e.jsxs("div",{className:"bg-black/30 rounded-xl p-3 border border-white/5 text-center",children:[e.jsx("p",{className:`text-2xl font-black ${i.overdueBookings>0?"text-rose-400":"text-emerald-400"}`,children:i.overdueBookings}),e.jsx("p",{className:"text-[9px] text-zinc-500 uppercase",children:"Ù…ØªØ£Ø®Ø±Ø©"})]}),e.jsxs("div",{className:"bg-black/30 rounded-xl p-3 border border-white/5 text-center",children:[e.jsx("p",{className:"text-2xl font-black text-white",children:i.totalUsers}),e.jsx("p",{className:"text-[9px] text-zinc-500 uppercase",children:"Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 flex-1 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"lg:col-span-2 bg-zinc-900/40 border border-rose-500/10 rounded-2xl flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/5 bg-rose-950/10 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-black text-rose-400 uppercase flex items-center gap-2",children:[e.jsx(F,{size:14}),"Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (",p.length,")"]}),e.jsxs("span",{className:"flex items-center gap-2 text-[9px] font-mono text-gray-500",children:[e.jsx(h,{size:10,className:"text-rose-500 animate-bounce"}),"Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø©"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",style:{scrollbarWidth:"thin",scrollbarColor:"#333 transparent"},children:p.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-emerald-500 opacity-50",children:[e.jsx(E,{size:48,className:"mb-4"}),e.jsx("p",{className:"text-lg font-bold",children:"ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ù…Ø³ØªÙ‚Ø±Ø©"}),e.jsx("p",{className:"text-xs text-zinc-600 mt-1",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹"})]}):p.map(s=>{const t=s.icon;return e.jsxs("div",{className:`relative overflow-hidden rounded-xl border p-4 flex items-center justify-between group transition-all duration-300
                    ${s.type==="critical"?"bg-rose-500/5 border-rose-500/20 hover:bg-rose-500/10":s.type==="warning"?"bg-amber-500/5 border-amber-500/20 hover:bg-amber-500/10":"bg-blue-500/5 border-blue-500/20 hover:bg-blue-500/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shadow-lg border border-white/5
                        ${s.type==="critical"?"bg-rose-500/20 text-rose-500":s.type==="warning"?"bg-amber-500/20 text-amber-500":"bg-blue-500/20 text-blue-500"}`,children:e.jsx(t,{size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-0.5 rounded-md ${s.type==="critical"?"bg-rose-500 text-white":s.type==="warning"?"bg-amber-500 text-black":"bg-blue-500 text-white"}`,children:s.source}),e.jsx("span",{className:"text-[10px] font-mono text-gray-500",children:s.time})]}),e.jsx("h4",{className:"font-bold text-gray-200 text-sm",children:s.message})]})]}),e.jsxs("button",{onClick:()=>O(s.id),className:"px-3 py-2 bg-white/5 hover:bg-emerald-500 hover:text-white border border-white/10 rounded-lg text-xs font-bold transition-all flex items-center gap-1 relative z-10",children:[e.jsx(E,{size:12}),"ØªØ¬Ø§Ù‡Ù„"]})]},s.id)})})]}),e.jsxs("div",{className:"bg-zinc-900/40 border border-white/5 rounded-2xl p-4 flex flex-col overflow-hidden",children:[e.jsxs("h3",{className:"text-sm font-black text-white uppercase flex items-center gap-2 mb-4",children:[e.jsx(h,{size:14,className:"text-blue-400"}),"Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…"]}),e.jsxs("div",{className:"space-y-3 flex-1 overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"#333 transparent"},children:[C.map((s,t)=>e.jsxs("div",{className:"bg-black/40 border border-white/5 rounded-xl p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:s.label}),e.jsxs("span",{className:`text-[10px] font-mono ${I(s.status)}`,children:[s.value," ",s.unit]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${B(s.status)} ${s.status==="critical"?"animate-pulse":""}`,style:{width:`${Math.min(s.value/s.max*100,100)}%`}})})]},t)),e.jsx("div",{className:"bg-black/40 border border-white/5 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"Supabase"}),e.jsx("div",{className:"flex items-center gap-1.5",children:i.syncStatus==="online"?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:12,className:"text-emerald-400"}),e.jsx("span",{className:"text-[10px] text-emerald-400 font-mono",children:"Ù…ØªØµÙ„"})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:12,className:"text-rose-400"}),e.jsx("span",{className:"text-[10px] text-rose-400 font-mono",children:"ØºÙŠØ± Ù…ØªØµÙ„"})]})})]})}),e.jsx("div",{className:"bg-black/40 border border-white/5 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"SQLite"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{size:12,className:"text-emerald-400"}),e.jsx("span",{className:"text-[10px] text-emerald-400 font-mono",children:"Ù†Ø´Ø·"})]})]})}),e.jsx("div",{className:"bg-black/40 border border-white/5 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©"}),e.jsx("span",{className:"text-[10px] text-zinc-400 font-mono",children:i.lastSync})]})})]})]})]})]})};export{P as default};
