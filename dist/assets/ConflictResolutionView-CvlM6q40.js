import{r as d,j as e}from"./vendor-react-Ce27NbrU.js";import{t as j}from"./index-BFvmHygk.js";import{O as g,A as o,f as u,H as p,v as N}from"./vendor-ui-TjLGESBy.js";import"./vendor-supabase-CSCOup90.js";import"./vendor-utils-DKqDJWuS.js";class y{constructor(){this.conflicts=[]}checkForConflict(s,l){if(s.status!==l.status||s.shootDate!==l.shootDate||s.title!==l.title){const i={id:crypto.randomUUID(),entityId:s.id,localData:s,serverData:l,resolved:!1,timestamp:Date.now()};return this.conflicts.push(i),i}return null}getConflicts(){return this.conflicts.filter(s=>!s.resolved)}resolveConflict(s,l){const c=this.conflicts.find(i=>i.id===s);c&&(c.resolved=!0,c.resolution=l)}}const m=new y,A=({onBack:a})=>{const[s,l]=d.useState([]),[c,i]=d.useState(null);d.useEffect(()=>{l(m.getConflicts())},[]);const n=(t,x)=>{m.resolveConflict(t,x),l(f=>f.filter(b=>b.id!==t)),j.success(x==="local"?"تم اعتماد النسخة المحلية ✅":"تم اعتماد نسخة السيرفر ✅"),c===t&&i(null)},r=s.find(t=>t.id===c)||s[0];return s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center",children:e.jsx(g,{size:40,className:"text-emerald-500"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"All Clear!"}),e.jsx("p",{className:"text-gray-500 max-w-md",children:"جميع البيانات متزامنة بنجاح. لا توجد تعارضات معلقة."}),e.jsx("button",{onClick:a,className:"px-6 py-2 bg-gray-900 text-white rounded-xl hover:bg-gray-800 transition-colors",children:"العودة للوحة التحكم"})]}):e.jsxs("div",{className:"h-full flex flex-col gap-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(o,{className:"text-amber-500"}),"حل تعارض البيانات"]}),e.jsxs("p",{className:"text-gray-500 mt-1",children:["يوجد ",s.length," حالات تتطلب التدخل اليدوي"]})]}),e.jsx("button",{onClick:a,className:"px-4 py-2 text-sm text-gray-500 hover:text-gray-900",children:"إغلاق"})]}),e.jsxs("div",{className:"flex flex-1 gap-6 overflow-hidden",children:[e.jsx("div",{className:"w-80 border-l border-gray-100 flex flex-col gap-2 overflow-y-auto pr-2",children:s.map(t=>e.jsxs("button",{onClick:()=>i(t.id),className:`p-4 rounded-xl text-right transition-all border ${(r==null?void 0:r.id)===t.id?"bg-amber-50 border-amber-500/30 ring-2 ring-amber-500/10":"bg-white border-gray-100 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold px-2 py-0.5 bg-gray-100 rounded text-gray-600",children:t.localData.title||"حجز بدون عنوان"}),e.jsx("span",{className:"text-[10px] text-gray-400 font-mono",children:new Date(t.timestamp).toLocaleTimeString()})]}),e.jsx("p",{className:"text-sm text-gray-800 font-bold mb-1",children:t.localData.clientName}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(o,{size:12,className:"text-amber-500"}),e.jsx("span",{children:"تضارب في البيانات"})]})]},t.id))}),r&&e.jsx("div",{className:"flex-1 bg-gray-50 rounded-2xl p-6 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-2 gap-8 h-full",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"p-4 bg-blue-50/50 border border-blue-200 rounded-xl flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600",children:e.jsx(u,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900",children:"نسخة السيرفر"}),e.jsx("p",{className:"text-xs text-blue-500",children:"الموجودة حالياً في قاعدة البيانات"})]})]})}),e.jsx(h,{data:r.serverData,type:"server"}),e.jsx("button",{onClick:()=>n(r.id,"server"),className:"mt-auto w-full py-4 bg-white text-blue-600 border border-blue-200 font-bold rounded-xl hover:bg-blue-50 transition-colors shadow-sm",children:"اعتماد السيرفر وإلغاء المحلي"})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"p-4 bg-emerald-50/50 border border-emerald-200 rounded-xl flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center text-emerald-600",children:e.jsx(p,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-emerald-900",children:"النسخة المحلية"}),e.jsx("p",{className:"text-xs text-emerald-500",children:"التي تحاول حفظها الآن"})]})]})}),e.jsx(h,{data:r.localData,type:"local"}),e.jsx("button",{onClick:()=>n(r.id,"local"),className:"mt-auto w-full py-4 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20",children:"اعتماد النسخة المحلية"})]})]})})]})]})},h=({data:a,type:s})=>{const l=s==="local";return e.jsxs("div",{className:`p-6 rounded-2xl border flex-1 space-y-4 ${l?"bg-white border-emerald-100":"bg-white border-blue-100"}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"اسم العميل"}),e.jsx("p",{className:"font-bold text-lg text-gray-800",children:a.clientName})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"نوع الحجز"}),e.jsx("p",{className:"font-medium text-gray-700",children:a.title})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(N,{size:12})," التاريخ"]}),e.jsx("p",{className:"font-mono text-gray-700",children:a.shootDate||"غير محدد"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"الحالة"}),e.jsx(v,{status:a.status})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"آخر تعديل"}),e.jsx("p",{className:"text-xs font-mono text-gray-500",children:new Date().toLocaleString()})]})})]})},v=({status:a})=>e.jsx("span",{className:"px-2 py-1 rounded-md bg-gray-100 text-gray-600 text-xs font-bold",children:a});export{A as default};
